<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ArsteX Exchange</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
  min-height: 100vh;
  color: #fff;

  /* ФОН НА ВСЮ СРАНИЦУ — КАК У ТОП-БАРА */
  background:
    radial-gradient(circle at 0 0, #151c51 0, #050814 50%, #03040c 100%);
}

    .topbar-wrapper {
  width: 100%;
  background: transparent;
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);

  position: sticky;   /* ← держим бар сверху */
  top: 0;
  /* Важно: на мобильных внутри топбара открывается бургер-меню (fixed overlay).
     Если у внутренних экранов/панелей есть свой высокий z-index, меню может оказаться "под" ними.
     Поэтому держим топбар (и все его оверлеи) выше остальных слоёв. */
  z-index: 50000;     /* выше контента/панелей */
}

    .topbar {
      max-width: 1200px;
      margin: 0 auto;
      padding: 14px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 32px;
    }

    .logo {
      font-weight: 700;
      font-size: 20px;
      letter-spacing: 0.03em;
      color: #ffffff;
      cursor: pointer;
      white-space: nowrap;
    }

    .nav {
      display: flex;
      gap: 28px;
      flex: 1;
      justify-content: center;
    }

    .nav a {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.85);
      text-decoration: none;
      position: relative;
      padding-bottom: 3px;
      transition: color 0.18s ease;
      white-space: nowrap;
    }

    .nav a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, #267dff, #6f9bff);
      transition: width 0.18s ease;
    }

    .nav a:hover {
      color: #ffffff;
    }

    .nav a:hover::after {
      width: 100%;
    }

    .actions {
      display: flex;
      gap: 12px;
      white-space: nowrap;
    }

    .btn {
      font-size: 14px;
      padding: 8px 22px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: transparent;
      color: #ffffff;
      cursor: pointer;
      transition: background 0.18s ease, color 0.18s ease, border-color 0.18s ease,
        box-shadow 0.18s ease, transform 0.08s ease;
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn-outline {
      border-color: rgba(255, 255, 255, 0.5);
      background: rgba(3, 6, 24, 0.4);
    }

    .btn-outline:hover {
      background: rgba(255, 255, 255, 0.06);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.12);
    }

    .btn-primary {
      background: linear-gradient(135deg, #1b6dff, #005bff);
      box-shadow: 0 0 24px rgba(0, 91, 255, 0.45);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #2b7aff, #0b63ff);
      box-shadow: 0 0 28px rgba(0, 110, 255, 0.6);
    }

    /* Простой контент под баром, чтобы не было пустого экрана */
    main {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 24px;
      color: rgba(255, 255, 255, 0.4);
      font-size: 14px;
    }

    /* Адаптивность */
    @media (max-width: 900px) {
      .nav {
        gap: 20px;
      }

      .topbar {
        padding-inline: 16px;
      }
    }

    @media (max-width: 720px) {
      .nav {
        display: none; /* для первого шага просто скрываем меню на мобилке */
      }

      .topbar {
        justify-content: space-between;
      }
    }

    /* ===== HERO ===== */

.hero {
  min-height: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding-bottom: 40px;
  padding-top: 120px;
margin-bottom: 100px;
}

/* Контент */
.hero-content {
  position: relative;
  z-index: 2;
  max-width: 820px;
}

.hero-title {
  font-size: clamp(36px, 5vw, 56px);
  line-height: 1.1;
  font-weight: 800;
  margin-bottom: 18px;
  letter-spacing: -0.03em;
}

.hero-subtitle {
  font-size: 16px;
  line-height: 1.6;
  color: rgba(255, 255, 255, 0.78);
  max-width: 640px;
  margin: 0 auto 32px;
}

/* Кнопка */
.hero-btn {
  padding: 14px 40px;
  border-radius: 999px;
  font-size: 16px;
  font-weight: 600;
  color: #fff;
  background: linear-gradient(135deg, #1b6dff, #005bff);
  border: none;
  cursor: pointer;
  box-shadow: 0 20px 50px rgba(0, 90, 255, 0.55);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.hero-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 26px 60px rgba(0, 110, 255, 0.75);
}

.hero-btn:active {
  transform: translateY(0);
}

/* Адаптив */
@media (max-width: 600px) {
  .hero {
    padding-top: 40px;
  }

  .hero-subtitle {
    font-size: 15px;
  }
}

.markets {
  max-width: 1200px;
  margin: 0px auto 60px;
  padding: 0 24px;
}

.markets-wrap {
  background: transparent;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,0.08);
  overflow: hidden;
}

.markets-header,
.market-row {
  display: grid;
  grid-template-columns: 3fr 1.5fr 1.5fr 2fr 1.5fr 1.5fr 1fr;
  padding: 18px 20px;
  align-items: center;
}

.markets-header {
  font-size: 13px;
  color: rgba(255,255,255,0.55);
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.market-row {
  font-size: 14px;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}

.asset {
  display: flex;
  align-items: center;
  gap: 14px;
}

.coin {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
  background: rgba(255, 255, 255, 0.04);
  display: flex;
  align-items: center;
  justify-content: center;
}

.coin img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 50%;
  display: block;
}

.symbol {
  font-weight: 600;
}

.symbol span {
  font-weight: 400;
  color: rgba(255,255,255,0.5);
  margin-left: 6px;
}

.up { color: #00e3a1; }
.down { color: #ff4d6d; }

.sparkline {
  height: 36px;
  border-radius: 999px;
  background: linear-gradient(90deg, transparent, rgba(0,120,255,0.6));
}

.sparkline.red {
  background: linear-gradient(90deg, transparent, rgba(255,77,109,0.65));
}

.sparkline.green {
  background: linear-gradient(90deg, transparent, rgba(0,227,161,0.7));
}

.action-btn {
  padding: 8px 22px;
  border-radius: 999px;
  border: 1px solid #2b7aff;
  background: #0a1c3f;
  color: #2b7aff;
  font-weight: 500;
  cursor: pointer;
}

.action-btn:hover {
  background: rgba(43,122,255,0.2);
}

.markets-footer {
  display: flex;
  justify-content: center;
  margin-top: 28px;
}

.more-btn {
  padding: 14px 38px;
  border-radius: 999px;
  font-size: 15px;
  font-weight: 600;
  color: #fff;
  border: none;
  cursor: pointer;

  background: linear-gradient(135deg, #1b6dff, #005bff);
  box-shadow: 0 20px 50px rgba(0, 90, 255, 0.55);

  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.more-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 26px 60px rgba(0, 110, 255, 0.75);
}

.more-btn:active {
  transform: translateY(0);
}

.spark {
  width: 140px;
  height: 36px;
}

.spark svg {
  width: 100%;
  height: 100%;
}

.spark path {
  stroke: #3b82f6;
  filter: drop-shadow(0 0 6px rgba(59,130,246,0.6));
}

.spark svg path {
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.spark svg {
    background: transparent !important;
}

.spark svg path {
    fill: none !important;
}

.pager-btn {
  padding: 10px 18px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.35);
  background: rgba(3, 6, 24, 0.7);
  color: #fff;
  cursor: pointer;
  font-size: 16px;
  margin: 0 6px;
  transition: background 0.15s ease, transform 0.08s ease, opacity 0.15s ease;
}

.pager-btn:hover:not(:disabled) {
  background: rgba(255,255,255,0.08);
  transform: translateY(-1px);
}

.pager-btn:disabled {
  opacity: 0.35;
  cursor: default;
  transform: none;
}

.forex-page .markets {
  margin: 0 auto 12px;
}

.steps {
  max-width: 1200px;
  margin: 50px auto 170px;
  padding: 0 24px;
  margin-top: 50px;
}

/* общий контейнер без фона и рамки */
.steps-inner {
  background: none;
  border: none;
  box-shadow: none;
  padding: 40px 32px 46px;
}

.steps-title {
  text-align: center;
  font-size: clamp(26px, 3vw, 32px);
  font-weight: 700;
  margin-bottom: 32px;
}

/* три карточки в ряд */
.steps-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 24px;
  align-items: flex-start;
}

/* карточка шага */
.step-card {
  text-align: center;
}

/* кружок под иконку */
.step-icon {
  width: 80px;
  height: 80px;
  margin: 0 auto 18px;
  border-radius: 50%;
  background: #ffffff !important;   /* ← белый фон */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* сами картинки */
.step-icon img {
  width: 52px;
  height: 52px;
  object-fit: contain;
}

/* разные градиенты под каждый шаг */
.step-icon-1 {
  background: radial-gradient(circle at 30% 20%, #ff4baf33 0, transparent 45%),
              linear-gradient(135deg, #ff4baf, #8b5cff);
}
.step-icon-2 {
  background: radial-gradient(circle at 30% 20%, #ffb34733 0, transparent 45%),
              linear-gradient(135deg, #ffb347, #ff6a00);
}
.step-icon-3 {
  background: radial-gradient(circle at 30% 20%, #3ee9b233 0, transparent 45%),
              linear-gradient(135deg, #3ee9b2, #1b9dff);
}

.step-heading {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 8px;
}

.step-text {
  font-size: 14px;
  color: rgba(255,255,255,0.7);
  line-height: 1.6;
}

/* адаптив: на мобиле в колонку */
@media (max-width: 900px) {
  .steps-inner {
    padding: 32px 20px 36px;
  }

  .steps-grid {
    grid-template-columns: 1fr;
  }
}

.faq {
  max-width: 900px;
  margin: 0 auto 120px;
  padding: 0 24px;
}

.faq-inner {
  /* без фона, чтобы плавно вписывалось в фон страницы */
}

.faq-title {
  font-size: clamp(24px, 3vw, 28px);
  font-weight: 700;
  margin-bottom: 24px;
}

.faq-list {
  border-top: 1px solid rgba(255,255,255,0.08);
}

/* одна строка FAQ */
.faq-item {
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

/* шапка вопроса */
.faq-head {
  width: 100%;
  padding: 14px 0;
  display: flex;
  align-items: center;
  gap: 16px;
  background: transparent;
  border: none;
  color: inherit;
  cursor: pointer;
}

/* номер в маленьком прямоугольнике */
.faq-index {
  width: 28px;
  height: 28px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.25);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
}

/* текст вопроса */
.faq-question {
  flex: 1;
  text-align: left;
  font-size: 15px;
}

/* плюсик справа */
.faq-icon {
  font-size: 20px;
  line-height: 1;
  transition: transform 0.18s ease;
}

/* при открытии — иконка вращается */
.faq-item.open .faq-icon {
  transform: rotate(45deg); /* становится крестиком */
}

/* тело ответа */
.faq-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.22s ease;
  font-size: 14px;
  color: rgba(255,255,255,0.7);
  padding-right: 32px;
}

/* когда открыт */
.faq-item.open .faq-body {
  padding-bottom: 12px;
  max-height: 200px; /* хватит для короткого ответа */
}

.faq-title {
  font-size: clamp(28px, 4vw, 34px);
  margin-bottom: 32px; /* чуть больше */
}

.faq-head {
  padding: 18px 0; /* больше кликабельная область */
}

.faq-question {
  font-size: 17px; /* крупнее текст вопроса */
}

.faq-body {
  font-size: 15px;
  line-height: 1.55;
}

.partners-strip {
  width: 100%;
  overflow: hidden;
  padding: 30px 0;
  margin-top: 80px;
}

.partners-strip img {
  height: 32px;              /* размер логотипов */
  margin: 0 32px;
  opacity: 0.8;
  transition: opacity 0.2s ease;
}

.partners-strip img {
  filter: brightness(1.3); /* делает светлее */
  opacity: 1;              /* полностью белые */
}

.partners-strip img:hover {
  opacity: 1;
}

.partners-track {
  display: flex;
  align-items: center;
  white-space: nowrap;
  animation: partners-scroll 22s linear infinite;
}

@keyframes partners-scroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}

.footer {

  border-top: 1px solid rgba(255,255,255,0.06);
  padding: 40px 24px 36px;
}

.footer-inner {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  gap: 48px;
  align-items: flex-start;
}

.footer-brand {
  flex: 0 0 260px;
}

.footer-logo {
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 18px;
}

.footer-socials {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 18px;
}

.footer-socials a {
  width: 32px;
  height: 32px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.35);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  text-decoration: none;
  color: #fff;
  opacity: 0.9;
  transition: background 0.15s ease, opacity 0.15s ease, transform 0.08s ease;
}

.footer-socials a:hover {
  background: rgba(255,255,255,0.1);
  opacity: 1;
  transform: translateY(-1px);
}

.footer-copy {
  font-size: 12px;
  color: rgba(255,255,255,0.55);
}

/* правые колонки */
.footer-columns {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 32px;
}

.footer-col h4 {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 14px;
}

.footer-col a {
  display: block;
  font-size: 14px;
  color: rgba(255,255,255,0.7);
  text-decoration: none;
  margin-bottom: 6px;
  transition: color 0.15s ease;
}

.footer-col a:hover {
  color: #ffffff;
}

/* адаптив */
@media (max-width: 900px) {
  .footer-inner {
    flex-direction: column;
    gap: 32px;
  }

  .footer-brand {
    flex: 1;
  }

  .footer-columns {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 24px;
  }
}

@media (max-width: 600px) {
  .footer-columns {
    grid-template-columns: 1fr;
  }
}

/* ===== SIGNUP PAGE ===== */

.signup-page {
  min-height: calc(100vh - 60px); /* минус высота топ-бара */
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px 16px 60px;
}

.signup-card {
  width: 100%;
  max-width: 420px;
  background: rgba(5, 8, 20, 0.9);
  border-radius: 24px;
  padding: 32px 28px 30px;
  box-shadow: 0 24px 80px rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(20px);
}

.signup-title {
  font-size: 26px;
  font-weight: 700;
  margin-bottom: 20px;
}

/* Tabs */
.signup-tabs {
  display: inline-flex;
  padding: 4px;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.04);
  margin-bottom: 18px;
}

.signup-tab {
  border: none;
  background: transparent;
  padding: 8px 20px;
  border-radius: 999px;
  color: rgba(255, 255, 255, 0.7);
  font-size: 14px;
  cursor: pointer;
}

.signup-tab-active {
  background: #ffffff;
  color: #000000;
}

/* поля */
.signup-field {
  margin-bottom: 14px;
}

.signup-field.optional label {
  display: block;
  font-size: 12px;
  color: rgba(255,255,255,0.6);
  margin-bottom: 6px;
}

.signup-field input {
  width: 100%;
  padding: 11px 12px;
  border-radius: 10px;
  border: none;
  outline: none;
  background: rgba(255, 255, 255, 0.06);
  color: #fff;
  font-size: 14px;
}

.signup-field input::placeholder {
  color: rgba(255,255,255,0.45);
}

/* чекбокс */
.signup-checkbox {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  font-size: 12px;
  color: rgba(255,255,255,0.7);
  margin-top: 6px;
  margin-bottom: 18px;
}

.signup-checkbox input {
  margin-top: 2px;
}

/* кнопка Sign Up */
.signup-btn {
  width: 100%;
  padding: 12px 0;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  font-size: 15px;
  font-weight: 600;
  color: #fff;
  background: linear-gradient(135deg, #1b6dff, #005bff);
  box-shadow: 0 15px 40px rgba(0, 90, 255, 0.6);
  margin-bottom: 18px;
}

/* Or */
.signup-or {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-size: 12px;
  color: rgba(255,255,255,0.5);
  margin-bottom: 16px;
}

.signup-or span {
  flex: 1;
  height: 1px;
  background: rgba(255,255,255,0.12);
}

/* соцкнопки */
.signup-social {
  width: 100%;
  padding: 10px 0;
  border-radius: 999px;
  border: none;
  background: rgba(255,255,255,0.08);
  color: #fff;
  font-size: 14px;
  cursor: pointer;
  margin-bottom: 10px;
}

.signup-footer {
  text-align: center;
  font-size: 13px;
  color: rgba(255,255,255,0.6);
  margin-top: 6px;
}

.signup-footer a {
  color: #2b7aff;
  text-decoration: none;
}

/* ===== MODAL (Security Verification) ===== */

.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(3, 4, 12, 0.8);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

.modal-backdrop.show {
  display: flex;
}

.modal-card {
  width: 100%;
  max-width: 480px;
  background: #ffffff;
  color: #000;
  border-radius: 20px;
  padding: 26px 28px 24px;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.modal-title {
  font-size: 20px;
  font-weight: 700;
}

.modal-close {
  border: none;
  background: transparent;
  font-size: 20px;
  cursor: pointer;
}

.modal-body {
  font-size: 14px;
  margin-bottom: 16px;
}

.modal-input {
  width: 100%;
  padding: 11px 12px;
  border-radius: 10px;
  border: none;
  background: #f3f4f6;
  margin-bottom: 10px;
}

.modal-timer {
  font-size: 14px;
  color: #3b82f6;
  margin-bottom: 18px;
}

.modal-confirm {
  width: 100%;
  padding: 12px 0;
  border-radius: 999px;
  border: none;
  background: #005bff;
  color: #fff;
  font-weight: 600;
  cursor: pointer;
}

.signup-btn:disabled,
.signup-btn.disabled {
  opacity: 0.4;
  cursor: not-allowed;
  box-shadow: none;
  background: linear-gradient(135deg, #1b6dff44, #005bff44);
}

/* Общий слой для страниц авторизации/сброса */
.auth-page{
  position: fixed;
  inset: 0;
  display: none;              /* показываем через JS */
  align-items: center;
  justify-content: center;
  padding: 120px 20px 40px;   /* чтобы topbar не перекрывал */
  z-index: 9999;
}

/* Контейнер формы (карточка) */
.auth-card{
  width: min(520px, 92vw);
  background: rgba(10, 14, 25, 0.75);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 18px;
  padding: 26px;
  backdrop-filter: blur(12px);
}

/* Поля */
.auth-card input{
  width: 100%;
  height: 44px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.06);
  color: #fff;
  padding: 0 12px;
  outline: none;
}

.auth-card button{
  width: 100%;
  height: 44px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
}

@media (max-width: 720px) {
  .markets { padding: 0 12px; }

  .markets-header { display: none; }

  .market-row {
    grid-template-columns: 1fr;
    gap: 10px;
    padding: 14px 14px;
  }

  /* чтобы элементы красиво располагались */
  .market-row .asset { order: 1; }
  .market-row .price { order: 2; font-size: 16px; font-weight: 700; }
  .market-row .change { order: 3; }
  .market-row .spark { order: 4; width: 100%; }
  .market-row .market-cap { order: 5; color: rgba(255,255,255,0.65); }
  .market-row .volume { order: 6; color: rgba(255,255,255,0.65); }
  .market-row .action-btn { order: 7; width: 100%; }
}

/* ===== ABOUT PAGE (ArsteX) ===== */
.about-wrap{
  max-width: 1200px;
  margin: 0 auto;
  padding: 40px 24px 140px;
}

.about-hero{
  text-align:center;
  padding: 10px 0 60px;
}

.about-title{
  font-size: clamp(44px, 6vw, 72px);
  font-weight: 700;
  margin-bottom: 22px;
  letter-spacing: -0.02em;
}

.about-hero-text{
  max-width: 980px;
  margin: 0 auto 16px;
  font-size: 15px;
  line-height: 1.75;
  color: rgba(255,255,255,0.75);
}

.about-block{
  margin-top: 140px;
}

.about-split{
  display:grid;
  grid-template-columns: 1.1fr 0.9fr;
  gap: 40px;
  align-items: center;
}

.about-left{ max-width: 720px; }

.about-right{
  min-height: 240px;
  border-radius: 18px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.06);
}

.about-h2{
  font-size: clamp(42px, 6vw, 64px);
  line-height: 1.05;
  font-weight: 700;
  margin-bottom: 16px;
  letter-spacing: -0.02em;
}

.dot{
  color:#2b7aff;
}

.about-p{
  font-size: 15px;
  line-height: 1.75;
  color: rgba(255,255,255,0.75);
  margin-bottom: 14px;
}

.about-center{ text-align:center; }

.about-h2-center{
  font-size: clamp(44px, 6vw, 72px);
  font-weight: 700;
  margin-bottom: 14px;
  letter-spacing: -0.02em;
}

.about-sub{
  max-width: 980px;
  margin: 0 auto 36px;
  font-size: 14px;
  line-height: 1.8;
  color: rgba(255,255,255,0.7);
}

.about-cards{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 28px;
  margin-top: 28px;
}

.about-card{
  text-align:center;
  padding: 44px 28px 38px;
  border-radius: 22px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.06);
}

.about-card-title{
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 10px;
}

.about-card-text{
  font-size: 14px;
  line-height: 1.7;
  color: rgba(255,255,255,0.65);
  max-width: 420px;
  margin: 0 auto 28px;
}

.about-art{
  height: 180px;
  margin: 0 auto;
  width: min(380px, 90%);
  border-radius: 18px;
  background: rgba(0,0,0,0.15);
  position: relative;
  overflow: hidden;
}

/* простая “графика” как на примере */
.mission-art::before{
  content:"";
  position:absolute;
  left: 50%;
  top: 38%;
  transform: translate(-50%, -50%);
  width: 140px;
  height: 70px;
  background: #fff;
  border-radius: 0 0 140px 140px;
}
.mission-art::after{
  content:"";
  position:absolute;
  left: 50%;
  top: 72%;
  transform: translate(-50%, -50%);
  width: 220px;
  height: 120px;
  background: linear-gradient(135deg,#0b63ff,#2b7aff);
  clip-path: polygon(50% 0, 78% 100%, 62% 100%, 50% 55%, 38% 100%, 22% 100%);
  border-radius: 18px;
}

.vision-art::before{
  content:"";
  position:absolute;
  left: 50%;
  top: 46%;
  transform: translate(-50%, -50%);
  width: 120px;
  height: 120px;
  background: #fff;
  border-radius: 50%;
}
.vision-art::after{
  content:"";
  position:absolute;
  left: 50%;
  top: 62%;
  transform: translate(-50%, -50%);
  width: 220px;
  height: 110px;
  background: linear-gradient(135deg,#0b63ff,#2b7aff);
  border-radius: 0 0 220px 220px;
  opacity: 0.95;
}

.values-grid{
  margin-top: 40px;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 36px 40px;
  text-align:left;
  align-items:start;
}

/* расширяем только блок Values */
.about-block.about-center{
  max-width: 1400px;
  margin-left: auto;
  margin-right: auto;
}

.value-item{
  display:flex;
  gap: 22px;
  align-items:flex-start;
}

.value-icon{
  width: auto;
  height: auto;
  min-width: 48px;

  display: flex;
  align-items: center;
  justify-content: center;

  background: none;
  border: none;
}

.value-title{
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 6px;
}

.value-text{
  font-size: 14px;
  line-height: 1.65;
  color: rgba(255,255,255,0.65);
}

.service-split .about-right{
  background: transparent;
  border: none;
  min-height: 280px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.service-box{
  width: min(420px, 92%);
  height: 240px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.4);
  position: relative;
  background: rgba(255,255,255,0.02);
}

.service-badge{
  position:absolute;
  top: 44px;
  left: 50%;
  transform: translateX(-50%);
  width: 120px;
  height: 120px;
  border-radius: 50%;
  border: 2px solid rgba(43,122,255,0.9);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight: 800;
  font-size: 28px;
}

.service-line{
  position:absolute;
  left: 50%;
  bottom: 34px;
  transform: translateX(-50%);
  width: 220px;
  height: 6px;
  border-radius: 99px;
  background: rgba(255,255,255,0.35);
}

/* адаптив */
@media (max-width: 900px){
  .about-split{ grid-template-columns: 1fr; }
  .about-right{ min-height: 200px; }
  .about-cards{ grid-template-columns: 1fr; }
  .values-grid{ grid-template-columns: 1fr; }
}

/* больше расстояние между блоками */
.about-block{
  margin-top: 200px;
}

/* убрать правые рамки */
.about-split .about-right{
  display: none;
}

/* центрировать контент */
.about-split{
  grid-template-columns: 1fr;
  text-align: center;
}

.about-left{
  margin: 0 auto;
}

/* убрать синие точки */
.dot{
  display: none;
}

.about-link{
  color: #2b7aff;
  font-weight: 500;
}

.value-icon{
  width: 96px;
  height: 96px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;

}

.value-icon img{
  width: 72px;
  height: 72px;
  object-fit: contain;
}

/* центрирование страницы */
.feedback-page{
  min-height: 100vh;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 110px 16px 40px;  /* ↑ форма поднимется */
}

/* .feedback-container{
  width: 100%;
  max-width: 560px;
} */

/* дополнительно уменьшаем отступ между заголовком и карточкой */
#feedback-page .feedback-block{
  margin-top: 24px !important;
}

#feedback-page .about-wrap{
  width: 100%;
  max-width: 560px;
  margin: 0 auto;          /* центрирует */
}

/* #feedback-page .about-card{
  margin: 0 auto;
} */

/* форма */
.feedback-form{ display: grid; gap: 14px; }
.feedback-label{ display: grid; gap: 6px; font-size: 14px; }
.feedback-input{
  width: 100%;
  padding: 12px 12px;
  border-radius: 8px;
  border: 1px solid rgba(0,0,0,.2);
  font-size: 14px;
}
.feedback-textarea{ min-height: 120px; resize: vertical; }
.feedback-submit{
  width: 100%;
  padding: 14px 16px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}

.toast{
  position: fixed;
  top: 24px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(20,20,20,.95);
  color: #fff;
  padding: 14px 20px;
  border-radius: 8px;
  font-size: 14px;
  opacity: 0;
  pointer-events: none;
  transition: opacity .25s ease;
  z-index: 9999;
}
.toast.show{ opacity: 1; }

/* чтобы select/textarea выглядели как твои тёмные инпуты */
#feedback-page .signup-field select,
#feedback-page .signup-field textarea{
  width: 100%;
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.08);
  color: #fff;
  border-radius: 12px;
  padding: 14px 16px;
  outline: none;
  font-size: 14px;
}

#feedback-page .signup-field textarea{
  min-height: 140px;
  resize: vertical;
}

/* ===== FIX FEEDBACK CENTERING ===== */
#feedback-page .about-wrap{
  max-width: 560px;   /* как карточка */
  padding: 0;         /* ❗ убираем боковые отступы */
  margin: 0 auto;
}

/* ===== DARK SELECT DROPDOWN ===== */
.feedback-input,
.feedback-input option {
  background-color: #0b1022;
  color: #ffffff;
}

.feedback-input option {
  padding: 12px;
}

/* убираем системный светлый стиль */
.feedback-input {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
}

/* ===== Custom dark select (Feedback) ===== */
#feedback-page .ax-select { position: relative; width: 100%; }

#feedback-page .ax-select-btn{
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;

  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.08);
  color: #fff;
  border-radius: 12px;
  padding: 14px 16px;
  cursor: pointer;
}

#feedback-page .ax-select-btn:focus{
  outline: none;
  border-color: rgba(43,122,255,0.65);
  box-shadow: 0 0 0 3px rgba(43,122,255,0.15);
}

#feedback-page .ax-select-arrow{ opacity: .8; }

#feedback-page .ax-select-menu{
  position: absolute;
  left: 0;
  right: 0;
  top: calc(100% + 8px);
  z-index: 9999;

  background: rgba(10, 14, 28, 0.98);
  border: 1px solid rgba(255,255,255,0.10);
  border-radius: 12px;
  padding: 8px;
  display: none;

  backdrop-filter: blur(10px);
}

#feedback-page .ax-select.open .ax-select-menu{ display: block; }

#feedback-page .ax-select-opt{
  width: 100%;
  text-align: left;
  border: 0;
  background: transparent;
  color: #fff;
  padding: 10px 12px;
  border-radius: 10px;
  cursor: pointer;
}

#feedback-page .ax-select-opt:hover{
  background: rgba(43,122,255,0.18);
}
/* ===== Custom file upload ===== */
.file-upload{
  display: flex;
  align-items: center;
  gap: 14px;
  cursor: pointer;
}

.file-upload-btn{
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;

  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.12);
  color: #fff;
  font-size: 28px;
  font-weight: 300;
  line-height: 1;

  transition: background .2s ease, border-color .2s ease;
}

.file-upload:hover .file-upload-btn{
  background: rgba(43,122,255,0.18);
  border-color: rgba(43,122,255,0.6);
}

.file-upload-text{
  font-size: 14px;
  opacity: .85;
}

/* ===== Trading Fees table ===== */
#fees-page .about-card{
  padding: 0;               /* чтобы таблица легла как на скрине */
  overflow: hidden;         /* чтобы линии не вылезали за рамку */
}

.fees-table-wrap{
  width: 100%;
}

.fees-table{
  width: 100%;
  border-collapse: collapse;
  color: rgba(255,255,255,0.92);
  font-size: 14px;
}

.fees-table thead th{
  text-align: left;
  font-weight: 500;
  color: rgba(255,255,255,0.7);
  padding: 22px 26px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.fees-table tbody td{
  padding: 22px 26px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  font-weight: 600;
}

.fees-table tbody tr:last-child td{
  border-bottom: none;
}

/* выравнивание чисел как на скрине */
.fees-table th:nth-child(2),
.fees-table th:nth-child(3),
.fees-table td:nth-child(2),
.fees-table td:nth-child(3){
  text-align: center;
}

/* ===== CABINET (Dashboard) ===== */
.cabinet-page{
  display:none;
  min-height: 100vh;
  background:#000;
  padding-top:0; /* чтобы контент не залезал под topbar */
}
/* чтобы кабинет НЕ центрировался */
.cabinet-inner{
  max-width: none;
  margin: 0;
  padding: 0;
  width: 100%;
}

.actions.actions-auth{
  display:flex;
  align-items:center;
  gap:12px;
}

.top-deposit-btn{
  background:#2b7aff;
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}

.top-link{
  color:#fff;
  opacity:.9;
  text-decoration:none;
  font-weight:600;
}

.top-icon-btn{
  position:relative;
  width:36px;
  height:36px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

/* ===== MOBILE AUTH BURGER (Deposit/Assets inside) ===== */
.burger-btn{ display:none; }

/* Dropdown menu like profile (no full-screen overlay) */
.mobile-auth-menu{
  position: absolute;
  top: 48px;
  right: 0;
  width: 240px;
  z-index: 60000;

  opacity: 0;
  transform: translateY(8px);
  pointer-events: none;
  transition: .18s ease;

  /* keep it out of layout flow but allow animation */
  display: block;
}

@media (max-width: 720px){
  /* Anchor dropdown under the burger button, but never overflow the viewport */
  #topbar-guest, #topbar-auth{
    position: relative;
  }

  .mobile-auth-menu{
    left: auto !important;
    right: 0 !important;
    width: 240px !important;
    max-width: calc(100vw - 24px) !important; /* 12px padding on each side */
  }
}


.mobile-auth-menu.open{
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.mobile-auth-panel{
  position: relative;
  width: 100%;
  padding: 10px;
  border-radius: 16px;
  background: rgba(18,18,18,.92);
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: 0 20px 60px rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
}

/* Logged-in mobile menu items: compact */
.mobile-auth-panel--logged .mobile-auth-item{
  height: 42px;
  border-radius: 12px;
  font-size: 14px;
}
.mobile-auth-panel--logged .mobile-auth-item + .mobile-auth-item{
  margin-top: 10px;
}

.mobile-auth-item--danger{
  border-color: rgba(255, 59, 48, .35);
  background: rgba(255, 59, 48, .12);
}

.mobile-auth-item{
  width: 100%;
  height: 40px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  color:#fff;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
}
.mobile-auth-item + .mobile-auth-item{ margin-top: 8px; }
.mobile-auth-item:active{ transform: translateY(1px); }

.mobile-auth-item.primary{
  background: rgba(46, 124, 255, .20);
  border-color: rgba(46, 124, 255, .35);
}


@media (max-width: 720px){
  /* Phone layout */
  #topbar-auth,
  #topbar-guest{ position: relative; }

  /* Logged-in: actions moved into profile menu */
  #topbar-auth .top-deposit-btn,
  #topbar-auth #assets-dropdown{ display:none !important; }
  #topbar-auth .burger-btn{ display:none !important; }

  /* Guest: show Sign in / Get Started (no burger) */
  #topbar-guest #btn-top-signin,
  #topbar-guest #btn-top-get-started{ display:inline-flex !important; }

  #topbar-guest .burger-btn,
  #mobile-guest-menu{ display:none !important; }
}

.top-badge{
  position:absolute;
  top:-6px;
  right:-6px;
  min-width:18px;
  height:18px;
  padding:0 6px;
  border-radius:999px;
  background:#ff3b30;
  color:#fff;
  font-size:12px;
  line-height:18px;
  font-weight:700;
}

.assets-dropdown{
  position:relative;
}

/* ===== USER DROPDOWN ===== */

.user-dropdown{
  position: relative;
}

.user-menu{
  position: absolute;
  top: 48px;
  right: 0;
  width: 240px;
  z-index: 10000;

  opacity: 0;
  transform: translateY(8px);
  pointer-events: none;
  transition: .18s ease;
}

.user-dropdown:hover .user-menu,
.user-dropdown:focus-within .user-menu{
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.user-card{
  background: rgba(18,18,18,.92);
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 16px;
  padding: 10px;
  box-shadow: 0 20px 60px rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
}

.user-item{
  display: block;
  padding: 12px 12px;
  border-radius: 12px;
  color: #fff;
  text-decoration: none;
  font-weight: 700;
  opacity: .9;
}

.user-item:hover{
  background: rgba(255,255,255,.06);
  opacity: 1;
}



/* Ensure <button class="user-item"> looks like links (no default button bg/border) */
.user-menu button.user-item{
  background: transparent;
  border: none;
  width: 100%;
  text-align: left;
  font: inherit;
  cursor: pointer;
  padding: 12px 12px;
}
.user-menu button.user-item:focus{
  outline: none;
}

/* Mobile-only section inside profile menu */
.user-mobile-nav{ display:none; }

@media (min-width: 721px){
  /* Profile dropdown visible only on phones */
  .top-icon-btn.user-trigger{ display:none !important; }
  .user-menu{ display:none !important; }
}



.user-mobile-nav-divider{ display:none; }
@media (max-width:720px){ .user-mobile-nav-divider{ display:block; } }

@media (max-width:720px){
  .user-mobile-nav{ display:block; }
}
@media (min-width:721px){
  .user-mobile-nav{ display:none; }
}
.assets-trigger{
  background:transparent;
  border:none;
  cursor:pointer;
  padding:6px 8px;
  border-radius:10px;
}

.assets-menu{
  position:absolute;
  top:48px;
  left:0;
  width:360px;
  max-width: calc(100vw - 24px);
  z-index:10000;

  opacity:0;
  transform: translateY(8px);
  pointer-events:none;
  transition: .18s ease;
}

.assets-dropdown:hover .assets-menu,
.assets-dropdown:focus-within .assets-menu{
  opacity:1;
  transform: translateY(0);
  pointer-events:auto;
}

.assets-card{
  background: rgba(18,18,18,.92);
  border: 1px solid rgba(255,255,255,.10);
  border-radius:16px;
  padding:16px;
  box-shadow: 0 20px 60px rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
}

.assets-total-title{
  color: rgba(255,255,255,.8);
  font-size: 13px;
  margin-bottom: 8px;
}

.assets-total-value .big{
  font-size: 34px;
  font-weight: 800;
  letter-spacing: .2px;
}

.assets-total-value .unit{
  color: rgba(255,255,255,.65);
  font-size: 12px;
  margin-left: 6px;
}

.assets-total-sub{
  color: rgba(255,255,255,.55);
  font-size: 12px;
  margin-top: 4px;
}

.assets-note{
  color: rgba(255,255,255,.45);
  font-size: 12px;
  margin-top: 10px;
}

.assets-actions{
  display:flex;
  gap:12px;
  margin-top: 14px;
}

.assets-btn{
  flex:1;
  height: 40px;
  border-radius: 999px;
  font-weight: 700;
  border: none;
  cursor: pointer;
}

.assets-btn.ghost{
  background: rgba(255,255,255,.08);
  color:#fff;
  border: 1px solid rgba(255,255,255,.10);
}

.assets-btn.primary{
  background: #2b7aff;
  color:#fff;
}

.assets-section{
  margin-top: 14px;
}

.assets-section-title{
  color: rgba(255,255,255,.45);
  font-size: 12px;
  margin: 10px 0 6px;
}

.assets-item{
  display:block;
  padding:10px 10px;
  border-radius:12px;
  color:#fff;
  text-decoration:none;
  font-weight: 600;
  opacity:.9;
}

.assets-item:hover{
  background: rgba(255,255,255,.06);
}

.assets-dropdown.open .assets-menu{
  opacity:1;
  transform: translateY(0);
  pointer-events:auto;
}

/* ===== CABINET MODE ===== */
body.cabinet-mode .topbar-wrapper{
  background:#000 !important;
  border-bottom: 1px solid rgba(255,255,255,.08);
}

body.cabinet-mode .footer{
  display: none !important; /* футер скрыть */
}

/* контейнер кабинета */
/* .cabinet-page{
  display:none;
  padding-top: 80px; /* под фиксированный топбар */
  /* min-height: 100vh;
  background: #000;
} */

/* layout: sidebar + content */

.cabinet-content-wrap{
  padding: 24px 32px;
}

/* sidebar */
.cabinet-sidebar{
  background: rgba(18,18,18,0.90);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px;
  overflow: visible;
}

.cabinet-nav a{
  display:flex;
  align-items:center;
  gap: 14px;
  padding: 18px 18px;
  color:#fff;
  text-decoration:none;
  font-weight: 700;
  opacity: .92;
  border-left: 3px solid transparent;
}

.cabinet-nav a:hover{
  background: rgba(255,255,255,.05);
}

.cabinet-nav a.active{
  background: rgba(255,255,255,.06);
  border-left-color: #2b7aff;
}

.cabinet-nav .divider{
  height: 1px;
  background: rgba(255,255,255,.08);
  margin: 8px 0;
}

/* простые иконки-кружочки (если без svg) */
.cabinet-ic{
  width: 20px;
  height: 20px;
  opacity: .8;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}

.cabinet-layout{
  width: 100%;
  margin: 0;
  padding: 24px 32px;
  display: grid;
  grid-template-columns: 320px 1fr;
  gap: 24px;
}

/* мобилка */
@media (max-width: 900px){
  .cabinet-layout{
    grid-template-columns: 1fr;
  }
}

body.cabinet-mode .cabinet-nav{
  padding: 12px;
  background: transparent !important;
}

body.cabinet-mode .cabinet-nav a{
  padding: 18px 28px;
  border-left: 3px solid transparent;
  margin-bottom: 6px;
  font-size: 15px;
  background: transparent;
}

body.cabinet-mode .cabinet-nav a:hover{
  background: rgba(255,255,255,0.04);
}

body.cabinet-mode .cabinet-nav a.active{
  background: rgba(255,255,255,0.06);
  border-left-color: #2b7aff;
}

body.cabinet-mode .cabinet-content-wrap{
  height: auto;
  min-height: 100%;
  overflow-y: auto;
}

.cabinet-ic{
  width: 22px;
  height: 22px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-right: 12px;
  flex: 0 0 22px;
}

.cabinet-ic svg{
  width: 22px;
  height: 22px;
  fill: none;
  stroke: rgba(255,255,255,.75);
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.cabinet-nav a:hover .cabinet-ic svg{
  stroke: #fff;
}

.cabinet-nav a.active .cabinet-ic svg{
  stroke: #2b7aff; /* твой синий */
}

/* ===== OVERVIEW (Fund Account) ===== */
/* ===== OVERVIEW (Fund Account) ===== */
.overview-bar {
  position: sticky;
  top: 64px;               /* высота topbar */
  z-index: 900;
  background: transparent; /* ВАЖНО: вместо #000 */
  border-bottom: 1px solid rgba(255,255,255,0.08);
  backdrop-filter: blur(10px); /* можно убрать если не надо */
}

.overview-inner {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px 24px 24px;
}

/* ===== Overview / Fund Account ===== */
.overview-inner{
  max-width: 1200px;
  margin: 0 auto;
  padding: 24px 24px 0;
}

.overview-title{
  margin: 0 0 18px;
  font-size: 44px;
  font-weight: 800;
  color: rgba(255,255,255,0.95);
  opacity: 1;
}

.fund-card{
  border: 1px solid rgba(255,255,255,0.10);
  border-radius: 16px;
  background: rgba(255,255,255,0.03);
  padding: 22px 24px 24px;
}

.fund-label{
  opacity: .75;
  font-size: 14px;
  margin-bottom: 8px;
}

.fund-value{
  font-size: 44px;
  font-weight: 800;
  line-height: 1.1;
  margin-bottom: 6px;
}

.fund-unit{
  font-size: 14px;
  font-weight: 700;
  opacity: .75;
  margin-left: 6px;
}

.fund-sub{
  opacity: .6;
  margin-bottom: 10px;
}

.fund-pnl{
  font-size: 13px;
  margin-bottom: 18px;
  opacity: .75;
}

.fund-pnl-up{
  color: #00e3a1;
  opacity: 1;
}

.fund-actions{
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 12px;
  max-width: 560px;
}

.fund-btn{
  height: 44px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.06);
  color: #fff;
  font-weight: 700;
  cursor: pointer;
}

.fund-btn.primary{
  background: #2b7aff;
  border-color: #2b7aff;
}

@media (max-width: 700px){
  .fund-actions{ grid-template-columns: 1fr 1fr; }
  .overview-title{ font-size: 34px; }
  .fund-value{ font-size: 34px; }
}

/* чтобы контент кабинета не уезжал вниз из-за global main { margin:40px ... } */
body.cabinet-mode main#cabinet-content{
  margin: 0 !important;
  max-width: none !important;
  padding: 24px 32px !important;
}

.cabinet-layout{
  display:grid;
  grid-template-columns:260px 1fr;
  gap:24px;
  align-items:start;
}

.cabinet-layout{
  display: grid;
  grid-template-columns: 260px 1fr;
  grid-template-rows: auto 1fr;
  grid-template-areas:
    "sidebar overview"
    "sidebar content";
  gap: 24px;
  align-items: start;
}

.cabinet-sidebar{ grid-area: sidebar; }
#overview-bar{ grid-area: overview; }
#cabinet-content{ grid-area: content; }

/* чтобы сайдбар был закреплен */

body.cabinet-mode{
  overflow: hidden; /* отключаем общий скролл страницы */
}

/* ВАЖНО: делаем контейнер кабинета высотой экрана */

/* Скролл только у правого блока (content area) */
#cabinet-content{
  overflow-y: auto;
  min-height: 0;  /* критично для grid, иначе overflow может не заработать */
}

.assets-card-simple{
  margin-top: 18px;
  border: 1px solid rgba(255,255,255,0.10);
  border-radius: 16px;
  background: rgba(255,255,255,0.03);
  padding: 18px 20px;
}

.assets-card-title{
  font-weight: 800;
  font-size: 18px;
}

.assets-card-sub{
  opacity: .6;
  font-size: 13px;
  margin-top: 6px;
}

.assets-card-body{
  margin-top: 14px;
  border-top: 1px solid rgba(255,255,255,0.08);
  padding-top: 14px;
}

.assets-empty{
  opacity: .5;
}

/* вкладки */
.cabinet-tab { display: none; }
.cabinet-tab.is-active { display: block; }

/* убираем синюю полосу (зазор под topbar) */

/* вместо margin-top делаем отступ у всей страницы кабинета */
body.cabinet-mode .cabinet-page{
  padding-top: 64px;                      /* <-- ВОТ ТАК */
}

/* сайдбар стоит на месте */

/* скролл только справа */

/* Кабинет под topbar */
body.cabinet-mode .cabinet-page{
  padding-top: var(--topbar-h);
}

/* Общий скролл отключаем */
body.cabinet-mode{
  overflow: hidden;
}

/* Grid высотой экрана, без margin-top */

/* Сайдбар закреплён и НЕ скроллит страницу */

/* Скролл только в правой части */

/* FIX: делаем текст в карточках светлее */
.fund-card,
.assets-card-simple{
  color: rgba(255,255,255,0.92);
}

.fund-label{
  color: rgba(255,255,255,0.92);
  opacity: 1; /* перебиваем старую opacity */
}

.fund-sub,
.fund-pnl{
  color: rgba(255,255,255,0.92);
  opacity: 1;
}

.assets-card-title{
  color: rgba(255,255,255,0.92);
}

.assets-card-sub,
.assets-empty{
  color: rgba(255,255,255,0.92);
  opacity: 1;
}

:root { --topbar-h: 64px; }

body.cabinet-mode .topbar-wrapper{
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 50000; /* чтобы мобильный бургер-оверлей был поверх кабинета */
}

body.cabinet-mode{
  overflow: hidden;
}

body.cabinet-mode .cabinet-page{
  padding-top: var(--topbar-h);
}

body.cabinet-mode .cabinet-layout{
  margin-top: 0 !important;
  height: calc(100vh - var(--topbar-h));
  overflow: hidden;
  align-items: stretch;
}

body.cabinet-mode .cabinet-sidebar{
  position: sticky;
  top: var(--topbar-h);
  height: calc(100vh - var(--topbar-h));
  overflow-y: auto;
  background: transparent !important;
  border: none !important;
  border-radius: 0 !important;
  box-shadow: none !important;
}

body.cabinet-mode #cabinet-content{
  height: calc(100vh - var(--topbar-h));
  overflow-y: auto;
  min-height: 0;
}

.records-page{
  max-width: 1200px;
  margin: 0 auto;
}

/* Tabs */
.records-tabs{
  display:flex;
  gap:24px;
  margin-bottom: 22px;
}

.records-tab{
  background:none;
  border:none;
  color: rgba(255,255,255,.6);
  font-size:15px;
  font-weight:700;
  padding-bottom:6px;
  cursor:pointer;
  position:relative;
}

.records-tab.active{
  color:#fff;
}

.records-tab.active::after{
  content:"";
  position:absolute;
  left:0; bottom:0;
  width:100%;
  height:2px;
  background:#2b7aff;
  border-radius:2px;
}

/* Filters */
.records-filters{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom: 18px;
}

.records-filters select{
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.08);
  color:#fff;
  padding:10px 14px;
  border-radius:10px;
  font-size:14px;
}

.filter-reset{
  padding:10px 18px;
  border-radius:10px;
  border:none;
  background: rgba(255,255,255,.1);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}

/* Table */
.records-table{
  border:1px solid rgba(255,255,255,.08);
  border-radius:14px;
  overflow:hidden;
}

.records-head,
.records-row{
  display:grid;
  grid-template-columns: 2.2fr 1.4fr 1fr 1.2fr 1.2fr;
  padding:16px 18px;
  align-items:center;
}

.records-head{
  font-size:13px;
  color: rgba(255,255,255,.55);
  border-bottom:1px solid rgba(255,255,255,.08);
}

.records-row{
  font-size:14px;
  border-bottom:1px solid rgba(255,255,255,.05);
}

.records-row:last-child{
  border-bottom:none;
}

/* Amount colors */
.records-row .positive{ color:#00e3a1; }
.records-row .negative{ color:#ff4d6d; }
.records-row .neutral{ color: rgba(255,255,255,.7); }

.muted{
  color: rgba(255,255,255,.5);
}

.records-filters select{
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  background-color: rgba(12,16,30,0.95);
  color: #fff;

  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 10px;
  padding: 10px 36px 10px 14px;
  font-size: 14px;

  background-image:
    linear-gradient(45deg, transparent 50%, #fff 50%),
    linear-gradient(135deg, #fff 50%, transparent 50%);
  background-position:
    calc(100% - 18px) calc(50% - 2px),
    calc(100% - 12px) calc(50% - 2px);
  background-size: 6px 6px;
  background-repeat: no-repeat;
}

/* выпадающий список */
.records-filters select option{
  background-color: #0b1022;
  color: #fff;
}

/* ===== DEPOSIT PAGE ===== */
#deposit-page{
  min-height: 100vh;
  background: #000;            /* ← ЧИСТО ЧЁРНЫЙ ФОН */
  padding: 120px 0 80px;       /* отступ под topbar */
}

.deposit-wrap{
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px;
  display: grid;
  grid-template-columns: 1fr 420px;
  gap: 64px;
}

@media (max-width: 900px){
  .deposit-wrap{
    grid-template-columns: 1fr;
  }
}

/* steps */
.deposit-step{ margin-bottom: 34px; }

.step-head{
  display:flex;
  align-items:center;
  gap:14px;
  margin-bottom:14px;
}

.step-num{
  width:28px;
  height:28px;
  border-radius:50%;
  background:#2b7aff;
  color:#fff;
  font-weight:800;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
}

.step-num.ghost{
  background:transparent;
  border:1px solid rgba(255,255,255,0.25);
  color:rgba(255,255,255,0.45);
}

.step-title{
  font-size:20px;
  font-weight:700;
}

.step-title.muted{
  color:rgba(255,255,255,0.45);
}

/* select */
.dark-select{
  height:48px;
  border-radius:10px;
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.08);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 16px;
  color:rgba(255,255,255,0.6);
}

.dark-select.disabled{
  opacity:.4;
}

/* crypto pills */
.crypto-list{
  display:flex;
  gap:10px;
  margin-top:14px;
  flex-wrap:wrap;
}

.crypto-pill{
  height:36px;
  padding:0 14px;
  border-radius:999px;
  border:none;
  background:rgba(255,255,255,0.06);
  color:#fff;
  font-weight:700;
  display:flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
}

.crypto-pill.active{
  background:#1a2cff;
}

.coin{
  width:18px;
  height:18px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:11px;
  font-weight:900;
  color:#fff;
}

.coin.usdt{ background:#26a17b; }
.coin.usdc{ background:#2775ca; }
.coin.btc{ background:#f7931a; }
.coin.eth{ background:#3c3c3d; }
.coin.trx{ background:#ff060a; }

/* FAQ */
.deposit-right{
  padding-top:6px;
}

.faq-title{
  font-size:26px;
  font-weight:700;
  margin-bottom:18px;
}

.faq-links{
  display:flex;
  flex-direction:column;
  gap:14px;
}

.faq-links a{
  color:rgba(255,255,255,0.7);
  text-decoration:none;
  font-size:14px;
}

.faq-links a:hover{
  color:#fff;
}

/* deposit page bg */
#deposit-page{ background:#000; min-height:100vh; padding:120px 0 90px; }

.dep-steps{ max-width: 740px; }

/* step layout */
.dep-step{
  display:grid;
  grid-template-columns: 34px 1fr;
  gap: 18px;
  margin-bottom: 34px;
}

.dep-rail{ position:relative; display:flex; flex-direction:column; align-items:center; }

.dep-dot{
  width:28px; height:28px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-weight:800; font-size:14px;
  background: transparent;
  border:1px solid rgba(255,255,255,0.20);
  color: rgba(255,255,255,0.45);
}

.dep-dot.done{
  background:#0b1b3f;
  border-color:#2b7aff;
  color:#2b7aff;
}

.dep-dot.active{
  background:#2b7aff;
  border-color:#2b7aff;
  color:#fff;
}

.dep-line{
  width:2px;
  flex:1;
  margin-top:10px;
  background: rgba(255,255,255,0.10);
  border-radius: 999px;
  min-height: 48px;
}

.dep-line.on{ background:#2b7aff; }

.dep-title{
  font-size: 26px;
  font-weight: 800;
  color: rgba(255,255,255,0.95);
  margin-bottom: 14px;
}

/* custom select */
.dep-select{ position:relative; margin-bottom: 12px; }

.dep-select-btn{
  width:100%;
  height:48px;
  border-radius:10px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.08);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 14px;
  cursor:pointer;
}

.dep-sel-left{ display:flex; align-items:center; gap:10px; }
.dep-arrow{ opacity:.8; }

.dep-menu{
  position:absolute;
  left:0; right:0;
  top: calc(100% + 8px);
  z-index: 9999;

  background: #0b0f18;                 /* НЕ прозрачный */
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 14px;
  padding: 8px;

  box-shadow: 0 20px 50px rgba(0,0,0,0.65);

  max-height: 280px;                   /* чтобы не разъезжалось */
  overflow-y: auto;

  display:none;
}

.dep-select.open .dep-menu{ display:block; }

.dep-opt{
  width:100%;
  text-align:left;
  border:none;
  background:transparent;
  color:#fff;
  padding:10px 12px;
  border-radius:10px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:10px;
}

.dep-opt:hover{ background: rgba(255,255,255,0.08); }

/* pills */
.dep-pills{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }

.dep-pill{
  height:36px;
  padding:0 14px;
  border-radius:999px;
  border:none;
  background: rgba(255,255,255,0.06);
  color:#fff;
  font-weight:800;
  display:flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
}

.dep-pill.active{ background: rgba(43,122,255,0.25); outline: 1px solid rgba(43,122,255,0.55); }

/* coin badges */
.dep-coin{
  width:18px; height:18px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-size:11px; font-weight:900; color:#fff;
}
.dep-coin.usdt{ background:#26a17b; }
.dep-coin.usdc{ background:#2775ca; }
.dep-coin.btc{ background:#f7931a; }
.dep-coin.eth{ background:#3c3c3d; }
.dep-coin.trx{ background:#ff060a; }

/* hint under network */
.dep-hint{
  display:flex;
  gap:10px;
  align-items:flex-start;
  margin-top: 10px;
  color: rgba(255,255,255,0.55);
  font-size: 13px;
  line-height: 1.55;
}

.dep-i{
  width:18px; height:18px; border-radius:50%;
  border:1px solid rgba(255,255,255,0.22);
  display:flex; align-items:center; justify-content:center;
  font-size:12px; font-weight:900;
  opacity:.75;
  flex: 0 0 18px;
}

/* deposit info card */
.dep-address-card{
  margin-top: 14px;
  border-radius: 12px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.08);
  padding: 18px;
}

.dep-address-label{
  font-size: 14px;
  font-weight: 800;
  color: rgba(255,255,255,0.8);
  margin-bottom: 10px;
}

.dep-address-row{
  display:flex;
  align-items:center;
  gap:12px;
}

.dep-address-text{
  flex:1;
  font-size: 14px;
  color: rgba(255,255,255,0.92);
  word-break: break-all;
}

.dep-copy{
  height: 38px;
  padding: 0 18px;
  border-radius: 10px;
  border: none;
  background: #2b7aff;
  color: #fff;
  font-weight: 800;
  cursor: pointer;
}

.dep-copy:active{ transform: translateY(1px); }

.dep-step.is-disabled .dep-main { opacity: .35; }
.dep-step.is-disabled .dep-dot { opacity: .55; }
.dep-step.is-disabled .dep-select-btn,
.dep-step.is-disabled .dep-pill,
.dep-step.is-disabled .dep-opt,
.dep-step.is-disabled .dep-copy{
  pointer-events: none;
  opacity: .35;
}

.risk-text {
  color: #cbd5e1;
  line-height: 1.7;
  font-size: 14px;
}

.risk-text h3 {
  color: #ffffff;
  margin-top: 28px;
  margin-bottom: 10px;
  font-size: 16px;
  font-weight: 600;
}

.risk-text p {
  margin-bottom: 14px;
}

.risk-text ul {
  margin: 10px 0 16px 18px;
  padding: 0;
}

.risk-text li {
  margin-bottom: 6px;
  list-style: disc;
  color: #d1d5db;
}

.legal-text {
  color: #cbd5e1;
  font-size: 14px;
  line-height: 1.7;
}

.legal-text h2 {
  margin-top: 36px;
  margin-bottom: 14px;
  font-size: 18px;
  color: #ffffff;
}

.legal-text h3 {
  margin-top: 24px;
  margin-bottom: 10px;
  font-size: 15px;
  color: #ffffff;
}

.legal-text p {
  margin-bottom: 14px;
}

/* иконки в select и меню */
.coin-ic {
  width: 24px;        /* было 18 */
  height: 24px;
  padding: 2px;
  border-radius: 50%;
  background: #fff;
  object-fit: contain;
}

/* кнопка выбранного значения */
.dep-select-btn {
  height: 56px;       /* было ~48 */
  font-size: 16px;    /* ↑ текст */
}

/* текст выбранной валюты */
.dep-sel-left span {
  font-size: 16px;
  font-weight: 600;
}

/* пункты выпадающего меню */
.dep-opt {
  padding: 14px 14px; /* больше воздуха */
  font-size: 16px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 14px;          /* больше расстояние от иконки */
}

/* hover остаётся мягким */
.dep-opt:hover {
  background: rgba(43,122,255,0.18);
}

.crypto-pill {
  height: 38px;
  padding: 0 14px;
  border-radius: 999px;
  border: none;
  background: rgba(255,255,255,0.06);
  color: #fff;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

/* активный */
.crypto-pill.active {
  background: #1a2cff;
}

/* иконки */
.crypto-pill img {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #fff;
  padding: 2px;
  object-fit: contain;
}

/* ===== SPOT PAGE ===== */
#spot-page {
  min-height: 100vh;
  background: #000;                 /* чисто чёрный фон */
  padding-top: var(--topbar-h);     /* чтобы topbar не перекрывал */
}

/* просто пустое пространство */
.spot-empty {
  height: calc(100vh - var(--topbar-h));
}

body.spot-mode .footer {
  display: none !important;
}

body.spot-mode .topbar {
  background: #000 !important;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}

body.spot-mode .header {
  background: #000 !important;
}

/* ===== SPOT: topbar wrapper must be black (fix blue block) ===== */
body.spot-mode .topbar-wrapper{
  background: #000 !important;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}

/* если фон делается через псевдо-элемент */
body.spot-mode .topbar-wrapper::before,
body.spot-mode .topbar-wrapper::after{
  background: none !important;
  content: none !important;
}

/* можно оставить, но уже не обязательно */
body.spot-mode .topbar{
  background: transparent !important;
}

/* ===== SPOT LAYOUT ===== */
.spot-layout{
  display: grid;
  grid-template-columns: 1fr 320px 320px;
  grid-template-rows: auto auto auto;

  /* Pair row on top, main terminal row in middle, orders at bottom */
  grid-template-areas:
    "pair pair pair"
    "chart orderbook trade"
    "orders orders orders";

  gap: 12px;
  padding: 12px;
  background: #000;
  height: auto;
  align-content: start;
}

/* Keep main terminal panels the same height, while the page can scroll down to Orders */
.spot-chart,
.spot-orderbook,
.spot-trade{
  height: 640px;
  min-height: 640px;
}

/* Order book + trade panels: allow internal scrolling where needed */
.spot-orderbook,
.spot-trade{
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.spot-orderbook .ob-body{
  flex: 1 1 auto;
  min-height: 0;
  overflow-y: auto;
}

.spot-trade{
  overflow-y: auto;
}


/* areas */
.spot-pair      { grid-area: pair; }
.spot-chart     { grid-area: chart; }
.spot-orderbook { grid-area: orderbook; }


/* ===== SPOT: ORDER BOOK (live) ===== */
.spot-orderbook{
  background:#0b0b0b;
  border:1px solid #1f1f1f;
  border-radius: 10px;
  padding: 10px 12px;
  display:flex;
  flex-direction: column;
  min-height: 0;
}

.ob-head{
  font-weight: 800;
  font-size: 13px;
  margin-bottom: 8px;
}

.ob-cols{
  display:grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 8px;
  padding: 0 6px 6px;
  font-size: 11px;
  color: rgba(255,255,255,0.55);
}

.t-right{ text-align:right; }

.ob-body{
  flex:1;
  min-height:0;
  display:flex;
  flex-direction:column;
}

.ob-side{
  flex:1;
  min-height:0;
  overflow:auto;
  padding-right: 2px;
}

.ob-mid{
  padding: 6px;
  margin: 6px 0;
  text-align:center;
  font-weight: 800;
  font-variant-numeric: tabular-nums;
  border-top: 1px solid rgba(255,255,255,0.08);
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.ob-empty{
  padding: 12px 6px;
  text-align:center;
  font-size: 12px;
  color: rgba(255,255,255,0.55);
}

.ob-row{
  position:relative;
  display:grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 8px;
  padding: 4px 6px;
  border-radius: 8px;
  font-size: 12px;
  font-variant-numeric: tabular-nums;
  cursor: default;
}

.ob-row .bar{
  position:absolute;
  inset:0;
  border-radius: 8px;
  opacity: 0.18;
}

.ob-row span{ position:relative; z-index:1; }

.ob-row.ask .bar{ background: #ff4d6d; }
.ob-row.bid .bar{ background: #00e3a1; }

.ob-row.ask .price{ color: #ff4d6d; }
.ob-row.bid .price{ color: #00e3a1; }

.ob-row:hover{ background: rgba(255,255,255,0.04); }
.spot-trade     { grid-area: trade; }
.spot-orders    { grid-area: orders; }

/* grey blocks */
.spot-layout > div{
  background: #111;
  border: 1px solid #1f1f1f;
  border-radius: 10px;
  position: relative;
}

/* placeholder text */
.placeholder{
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #666;
  font-size: 14px;
  letter-spacing: 0.5px;
}


/* ===== TRADE PANEL (BUY/SELL) ===== */
.trade-card{
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 18px;
  padding: 14px 14px 16px;
  box-shadow: 0 14px 34px rgba(0,0,0,.35);
  backdrop-filter: blur(6px);
}

.trade-bs-toggle{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 12px;
}
.bs-btn{
  height: 34px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.78);
  font-weight: 800;
  font-size: 13px;
  letter-spacing: .2px;
  cursor: pointer;
  transition: transform .08s ease, background .12s ease, border-color .12s ease, color .12s ease;
}
.bs-btn:active{ transform: scale(0.98); }
.bs-btn.active{
  background: rgba(11,191,118,0.22);
  border-color: rgba(11,191,118,0.55);
  color: #fff;
}
.trade-card[data-side="sell"] .bs-btn.active{
  background: rgba(255,77,109,0.18);
  border-color: rgba(255,77,109,0.55);
  color: #fff;
}

.trade-types{
  display: flex;
  gap: 10px;
  margin: 8px 0 10px;
  align-items: center;
}
.type-btn{
  height: 30px;
  padding: 0 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.78);
  font-weight: 800;
  font-size: 12px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition: background .12s ease, border-color .12s ease, color .12s ease, transform .08s ease;
}
.type-btn .caret{ opacity:.8; font-weight: 900; }
.type-btn:active{ transform: scale(0.98); }
.type-btn.active{
  background: rgba(43,122,255,0.20);
  border-color: rgba(43,122,255,0.55);
  color: #fff;
}
.type-btn .caret{ font-size: 12px; opacity: .8; margin-left: 4px; }

.trade-available{
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-top: 1px solid #1f1f1f;
  padding-top: 12px;
  margin-top: 6px;
}
.trade-available-label{ color: #7f8aa0; font-size: 12px; }
.trade-available-val{
  display: flex;
  align-items: center;
  gap: 8px;
  color: #fff;
  font-weight: 800;
  font-size: 12px;
}
.avail-swap{
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.85);
  border-radius: 10px;
  width: 28px;
  height: 28px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-left: 8px;
  transition: transform .08s ease, background .12s ease, border-color .12s ease;
}
.avail-swap:active{ transform: scale(0.96); }
.avail-swap:hover{
  border-color: rgba(43,122,255,0.35);
}

.trade-field{ margin-top: 12px; }
.trade-field-label{
  color: #cfd6e4;
  font-size: 12px;
  font-weight: 700;
  margin-bottom: 8px;
}
.trade-field-label .muted{ color:#7f8aa0; font-weight: 600; }

.trade-input{
  width: 100%;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.10);
  border-radius: 14px;
  color: #fff;
  padding: 12px 12px;
  font-size: 16px;
  outline: none;
}
.trade-input:focus{
  border-color: rgba(43,122,255,0.55);
}
.trade-input:focus{
  border-color: rgba(255,255,255,.18);
}

.trade-slider{ margin-top: 12px; }
.trade-range{ width: 100%; }
.slider-marks{
  display: flex;
  justify-content: space-between;
  margin-top: 8px;
}
.slider-marks button{
  border: 0;
  background: transparent;
  color: rgba(255,255,255,0.55);
  font-weight: 800;
  font-size: 12px;
  cursor: pointer;
  padding: 2px 4px;
  border-radius: 8px;
}
.slider-marks button:hover{
  color: rgba(255,255,255,0.85);
  background: rgba(255,255,255,0.06);
}
.slider-marks button:hover{ color:#fff; }

.trade-tpsl-toggle{
  display:flex;
  align-items:center;
  gap:10px;
  color:#cfd6e4;
  font-weight:700;
  font-size: 13px;
  margin-top: 10px;
  user-select: none;
}
.trade-tpsl-toggle input{ accent-color: #0bbf76; }
.trade-card[data-side="sell"] .trade-tpsl-toggle input{ accent-color:#ff4d6d; }

/* TP/SL раскрывающаяся панель */
.trade-tpsl-panel{
  margin-top: 10px;
  padding: 10px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  transform: translateY(-4px);
  transition: max-height .22s ease, opacity .18s ease, transform .18s ease;
}
.trade-tpsl-panel.open{
  max-height: 220px;
  opacity: 1;
  transform: translateY(0);
}
.tpsl-field{ margin-top: 10px; }
.tpsl-field:first-child{ margin-top: 0; }
.tpsl-label{
  font-size: 12px;
  font-weight: 800;
  color: rgba(255,255,255,0.85);
  margin-bottom: 6px;
}
.tpsl-inputwrap{
  position: relative;
  display: flex;
  align-items: center;
}
.tpsl-input{
  padding-right: 56px !important;
}
.tpsl-suffix{
  position: absolute;
  right: 12px;
  font-size: 12px;
  font-weight: 900;
  color: rgba(255,255,255,0.85);
  pointer-events: none;
  opacity: .95;
}

.trade-submit{
  width: 100%;
  height: 44px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.06);
  color: #fff;
  font-weight: 900;
  letter-spacing: .2px;
  cursor: pointer;
  margin-top: 12px;
  transition: transform .08s ease, background .12s ease, border-color .12s ease;
}
.trade-submit:active{ transform: scale(0.99); }
.trade-card[data-side="buy"] .trade-submit{
  background: rgba(11,191,118,0.18);
  border-color: rgba(11,191,118,0.55);
}
.trade-card[data-side="sell"] .trade-submit{
  background: rgba(255,77,109,0.16);
  border-color: rgba(255,77,109,0.55);
}

/* Make range look nicer in dark UI */
.trade-range{
  -webkit-appearance: none;
  appearance: none;
  height: 4px;
  border-radius: 999px;
  background: rgba(255,255,255,.14);
  outline: none;
}
.trade-range::-webkit-slider-thumb{
  -webkit-appearance: none;
  appearance: none;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #cfd6e4;
  border: 2px solid rgba(0,0,0,.35);
  cursor: pointer;
}
.trade-range::-moz-range-thumb{
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #cfd6e4;
  border: 2px solid rgba(0,0,0,.35);
  cursor: pointer;
}
/* responsive (optional) */
@media (max-width: 1200px){
  .spot-layout{
    grid-template-columns: 1fr;
    grid-template-rows: 64px 300px 300px 300px 220px;
    grid-template-areas:
      "pair"
      "chart"
      "orderbook"
      "trade"
      "orders";
  }
}
body.spot-mode{
  overflow: hidden;
}

/* ===== SPOT: PAIR / INFO BAR ===== */
.spot-pair{
  padding: 10px 12px;
  background: #0b0b0b;
}

.pairbar{
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 14px;
}

.pair-select{
  display: grid;
  grid-template-columns: 28px auto 18px;
  grid-template-rows: auto auto;
  grid-template-areas:
    "ic main caret"
    "ic sub  caret";
  align-items: center;
  column-gap: 10px;

  padding: 10px 12px;
  min-width: 190px;

  background: transparent;
  border: none;
  color: #fff;
  cursor: pointer;
}

.pair-coin{
  grid-area: ic;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: rgba(255,255,255,0.08);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
}

.pair-main{ grid-area: main; font-weight: 800; font-size: 14px; letter-spacing: .2px; }
.pair-sub{ grid-area: sub; font-size: 12px; color: rgba(255,255,255,0.55); }
.pair-caret{ grid-area: caret; color: rgba(255,255,255,0.65); }

.pair-stats{
  flex: 1;
  display: flex;
  align-items: center;
  gap: 20px;
  overflow: hidden;
}

.stat{ min-width: 110px; }
.stat-label{ font-size: 12px; color: rgba(255,255,255,0.5); margin-bottom: 4px; }
.stat-value{ font-size: 14px; font-weight: 800; color: #fff; }
.stat-sub{ font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 2px; }

.stat-price{ font-size: 18px; }
.stat-pos{ color: #19c37d; } /* зелёный как на биржах */

/* чтобы не ломалось на узких экранах */
@media (max-width: 1200px){
  .pair-stats{ gap: 12px; overflow-x: auto; padding-bottom: 4px; }
  .stat{ min-width: 140px; }
}

/* SPOT: убираем лишний верхний отступ */
body.spot-mode #spot-page{
  padding-top: 0 !important;
  margin-top: 0 !important;
}

/* Сетка занимает ровно экран под topbar */
body.spot-mode .spot-layout{
  padding-top: 12px; /* обычный внутренний отступ */
  height: calc(100vh - var(--topbar-h));
  margin-top: 0 !important;
}

/* FUTURES: тот же терминал, что и SPOT (те же отступы/высоты) */
body.futures-mode #spot-page{
  padding-top: 0 !important;
  margin-top: 0 !important;
}

/* Сетка занимает ровно экран под topbar */
body.futures-mode .spot-layout{
  padding-top: 12px; /* обычный внутренний отступ */
  height: calc(100vh - var(--topbar-h));
  margin-top: 0 !important;
}


/* left pair button */
.spot-pair{
  position: relative;
  display:flex;
  align-items:center;
  gap:10px;
  padding: 10px 12px;
  cursor:pointer;
  user-select:none;
}
#spot-pair-icon{
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background:#fff;
  padding:2px;
  object-fit:contain;
}
.pair-caret{ margin-left:auto; color:rgba(255,255,255,.6); }

/* dropdown */
.pair-dd{
  position:absolute;
  top: calc(100% + 8px);
  left: 0;
  width: 520px;
  background:#0b0f18;
  border:1px solid rgba(255,255,255,0.12);
  border-radius:12px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.65);
  display:none;
  z-index:9999;
}
.spot-pair.open .pair-dd{ display:block; }

.pair-dd-head{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,0.08);
}
.pair-search{
  width:100%;
  height:36px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.10);
  background:#0a0d14;
  color:#fff;
  padding:0 10px;
  outline:none;
}

.pair-dd-list{
  max-height: 1000px;
  overflow:auto;
  padding:6px;
}

.pair-item{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px;
  border-radius:10px;
  cursor:pointer;
}
.pair-item:hover{ background: rgba(255,255,255,0.06); }

.pair-item img{
  width:20px;height:20px;border-radius:50%;
  background:#fff;padding:2px;object-fit:contain;
}

.pair-item .sym{ font-weight:800; font-size:13px; color:#fff; }
.pair-item .nm{ font-size:12px; color:rgba(255,255,255,0.55); margin-top:2px; }
.pair-item .right{
  margin-left:auto;
  text-align:right;
  font-weight:800;
  font-size:13px;
  color:#fff;
}

/* ===== Block 1 container ===== */
.spot-pair{
  grid-area: pair;
  background:#0b0b0b;
  border:1px solid #1f1f1f;
  border-radius: 10px;
  padding: 10px 12px;
}

.pairbar{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 14px;
}

/* ===== left select ===== */
.pair-select-wrap{ position:relative; }

.pair-select{
  display:flex;
  align-items:center;
  gap:10px;
  min-width: 220px;
  padding: 8px 10px;
  background: transparent;
  border: none;
  cursor:pointer;
  color:#fff;
}

#spot-pair-icon{
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background:#fff;
  padding:2px;
  object-fit:contain;
}

.pair-text #spot-pair-symbol{ font-weight:800; font-size:14px; }
.pair-text #spot-pair-name{ font-size:12px; color: rgba(255,255,255,0.55); }

.pair-caret{ margin-left: 8px; color: rgba(255,255,255,0.6); }

/* ===== stats right ===== */
.spot-stats{
  flex: 1;
  display:flex;
  align-items:center;
  gap: 20px;
  overflow:hidden;
}

.spot-stat{ min-width: 110px; }
.spot-stat .label{ font-size:12px; color:rgba(255,255,255,0.5); margin-bottom:4px; }
.spot-stat .value{ font-size:14px; font-weight:800; color:#fff; }
.spot-stat .sub{ font-size:12px; color:rgba(255,255,255,0.5); margin-top:2px; }

#spot-last-price{ font-size:18px; }

#spot-last-price.up{ color:#00c176 !important; }
#spot-last-price.down{ color:#ff4d4f !important; }
#spot-24h-change.up{ color:#00c176 !important; }
#spot-24h-change.down{ color:#ff4d4f !important; }

/* ===== dropdown ===== */
.pair-dd{
  position:absolute;
  top: calc(100% + 8px);
  left: 0;
  width: 340px;
  background:#0b0f18;
  border:1px solid rgba(255,255,255,0.12);
  border-radius:12px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.65);
  display:none;
  z-index:9999;
}

.pair-select-wrap.open .pair-dd{ display:block; }

.pair-dd-head{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,0.08);
}

.pair-search{
  width:100%;
  height:36px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.10);
  background:#0a0d14;
  color:#fff;
  padding:0 10px;
  outline:none;
}

.pair-dd-list{
  max-height: 1000px;
  overflow:auto;
  padding:6px;
}

.pair-item{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px;
  border-radius:10px;
  cursor:pointer;
}

.pair-item:hover{ background: rgba(255,255,255,0.06); }

.pair-item img{
  width:20px;height:20px;border-radius:50%;
  background:#fff;padding:2px;object-fit:contain;
}

.pair-item .sym{ font-weight:800; font-size:13px; color:#fff; }
.pair-item .nm{ font-size:12px; color:rgba(255,255,255,0.55); margin-top:2px; }
.pair-item .right{
  margin-left:auto;
  text-align:right;
  font-weight:800;
  font-size:13px;
  color:#fff;
}

/* базовые панели для терминала (2–5) */
.spot-chart,
.spot-orderbook,
.spot-trade,
.spot-orders{
  background: #111;
  border: 1px solid #1f1f1f;
  border-radius: 10px;
  position: relative;
  min-height: 0; /* важно для grid */
}

/* плейсхолдер по центру */
.placeholder{
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #666;
  font-size: 14px;
  letter-spacing: 0.5px;
  pointer-events: none;
}

/* dropdown shell */
.pair-dd{
  position:absolute;
  top: calc(100% + 10px);
  left: 0;
  width: 460px;
  background: #12151c;
  border: 1px solid rgba(255,255,255,0.10);
  border-radius: 12px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.65);
  overflow: hidden;
  display:none;
  z-index:9999;
}
.pair-select-wrap.open .pair-dd{ display:block; }

/* head */
.pair-dd-head{
  padding: 12px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.pair-search-wrap{
  position: relative;
}
.pair-search-ic{
  position:absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  opacity: .65;
  font-size: 14px;
}
.pair-search{
  width:100%;
  height: 42px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.10);
  background:#0f1218;
  color:#fff;
  padding: 0 12px 0 36px;
  outline:none;
}

/* tabs */
.pair-tabs{
  display:flex;
  gap: 10px;
  margin-top: 10px;
  align-items:center;
}
.pair-tab{
  background: transparent;
  border: 0;
  color: rgba(255,255,255,.75);
  font-weight: 700;
  cursor: pointer;
  padding: 6px 2px;
}
.pair-tab.is-active{
  color:#fff;
}

/* header row */
.pair-dd-cols{
  display:grid;
  grid-template-columns: 1.3fr 0.9fr 0.7fr;
  gap: 10px;
  padding: 10px 12px;
  font-size: 12px;
  color: rgba(255,255,255,.55);
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
.t-right{ text-align:right; }

/* list */
.pair-dd-list{
  max-height: 1000px;
  overflow:auto;
}

/* row */
.pair-item{
  display:grid;
  grid-template-columns: 1.3fr 0.9fr 0.7fr;
  gap: 10px;
  padding: 10px 12px;
  cursor:pointer;
}
.pair-item:hover{ background: rgba(255,255,255,0.05); }

.pair-left{
  display:flex;
  gap: 10px;
  align-items:center;
  min-width: 0;
}
.pair-star{
  width: 18px;
  opacity: .75;
}
.pair-asset{
  display:flex;
  flex-direction: column;
  min-width: 0;
}
.pair-sym{
  font-weight: 800;
  font-size: 13px;
  color:#fff;
  white-space: nowrap;
  overflow:hidden;
  text-overflow: ellipsis;
}
.pair-vol{
  margin-top: 2px;
  font-size: 12px;
  color: rgba(255,255,255,.55);
}

.pair-price{
  text-align:right;
  font-weight: 800;
  color:#fff;
  font-size: 13px;
}

.pair-chg{
  text-align:right;
  font-weight: 800;
  font-size: 13px;
}
.pair-chg.up{ color: #22c55e; }
.pair-chg.down{ color: #ef4444; }

/* dropdown container */
.pair-select-wrap{
  position: relative;
}

.pair-dd{
  position: absolute;
  top: calc(100% + 10px);
  left: 0;
  width: 420px;
  max-height: 1000px;
  background: rgba(20, 24, 30, 0.98);
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 14px;
  box-shadow: 0 20px 60px rgba(0,0,0,.55);
  overflow: hidden;
  z-index: 50;
}

/* search */
.pair-dd .pair-search-wrap{
  padding: 12px;
  border-bottom: 1px solid rgba(255,255,255,.08);
}
.pair-dd input{
  width: 100%;
  height: 40px;
  border-radius: 10px;
  background: rgba(0,0,0,.25);
  border: 1px solid rgba(255,255,255,.10);
  color: #e5e7eb;
  padding: 0 12px 0 38px;
  outline: none;
}
.pair-dd .pair-search-ic{
  position:absolute;
  left: 24px;
  top: 24px;
  opacity:.6;
}

/* tabs */
.pair-tabs{
  display:flex;
  gap:14px;
  padding: 10px 12px;
  border-bottom: 1px solid rgba(255,255,255,.08);
}
.pair-tab{
  font-size: 13px;
  color: rgba(255,255,255,.6);
  cursor: pointer;
}
.pair-tab.active{
  color:#fff;
  font-weight:600;
}

/* header row */
.pair-head{
  display:grid;
  grid-template-columns: 1.6fr 110px 90px;
  gap: 10px;
  padding: 10px 12px;
  font-size: 12px;
  color: rgba(255,255,255,.45);
  border-bottom: 1px solid rgba(255,255,255,.08);
}

/* list scroll */
#pair-list{
  max-height: calc(100vh - 260px); /* под topbar + сам dropdown */
  overflow:auto;
}
#pair-list::-webkit-scrollbar{ width: 8px; }
#pair-list::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,.12);
  border-radius: 999px;
}

/* item */
.pair-item{
  display:grid;
  grid-template-columns: 1.6fr 110px 90px;
  gap: 10px;
  align-items:center;
  padding: 10px 12px;
  cursor:pointer;
}
.pair-item:hover{ background: rgba(255,255,255,.05); }

.pair-left{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
}
.pair-star{
  width: 18px;
  opacity:.7;
  cursor:pointer;
  user-select:none;
}
.pair-star.active{ opacity:1; color:#fff; }

.pair-asset{ min-width:0; }
.pair-sym{ color:#fff; font-weight:600; font-size: 14px; line-height: 1.1; }
.pair-vol{ color: rgba(255,255,255,.5); font-size: 12px; margin-top:2px; }

.pair-price{ text-align:right; color:#fff; font-weight:600; }
.pair-chg{ text-align:right; font-weight:700; }
.pair-chg.up{ color:#22c55e; }
.pair-chg.down{ color:#ef4444; }

/* сам дропдаун — не выше экрана */
.pair-dd{
  max-height: 60vh;
  overflow: hidden; /* скролл будет только у списка */
}

/* скролл только списка пар */
#pair-list{
  max-height: calc(50vh - 150px);
  overflow: auto;
}

/* ===== CHART BLOCK ===== */
.spot-chart{
  padding: 10px;
}

.chart-card{
  height: 100%;
  display: flex;
  flex-direction: column;
  background: #0b0b0b;
  border: 1px solid #1f1f1f;
  border-radius: 10px;
  overflow: hidden;
}

.chart-head{
  height: 54px;
  padding: 10px 12px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}

.chart-title{
  font-weight: 800;
  font-size: 14px;
  color: rgba(255,255,255,0.9);
}

.chart-tools{
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.chart-btn{
  height: 30px;
  padding: 0 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.85);
  font-weight: 700;
  font-size: 12px;
  cursor: pointer;
}

.chart-btn.is-active{
  background: rgba(43,122,255,0.22);
  border-color: rgba(43,122,255,0.55);
  color: #fff;
}

.chart-body{
  flex: 1;
  min-height: 0;
  position: relative;
}

.chart-empty{
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: rgba(255,255,255,0.35);
  font-size: 14px;
}

.chart-stage{
  position: relative;
  width: 100%;
  height: 100%;
  min-height: 240px;
}

#ax-chart{
  width: 100%;
  height: 100%;
  display: block;
}

.chart-hud{
  position:absolute;
  top: 10px;
  left: 10px;
  display:flex;
  gap: 10px;
  padding: 8px 10px;
  border-radius: 12px;
  background: rgba(0,0,0,0.35);
  border: 1px solid rgba(255,255,255,0.08);
  backdrop-filter: blur(10px);
  font-size: 12px;
  color: rgba(255,255,255,0.75);
}
.chart-hud .hud-line{ display:flex; gap:6px; align-items:center; }
.chart-hud b{ color:#fff; font-weight:800; }


/* hide scrollbar but keep scroll */
#ob-asks, #ob-bids{
  overflow-y: auto;
  scrollbar-width: none;        /* Firefox */
  -ms-overflow-style: none;     /* IE/Edge legacy */
}

#ob-asks::-webkit-scrollbar,
#ob-bids::-webkit-scrollbar{
  width: 0;
  height: 0;
  display: none;                /* Chrome/Safari */
}

/* прячем скроллбар, но оставляем прокрутку */
.ob-side{
  overflow: auto;
  scrollbar-width: none;          /* Firefox */
  -ms-overflow-style: none;       /* IE/Edge old */
}
.ob-side::-webkit-scrollbar{
  width: 0;
  height: 0;
}

/* mid: две строки + плавная смена цвета */
.ob-mid{
  padding: 10px 8px;
  border-radius: 10px;
  text-align: center;
  font-weight: 800;
  transition: background .18s ease, color .18s ease;
  margin: 8px 0;
}
.ob-mid.up{
  background: rgba(0, 227, 161, 0.14);
  color: #00e3a1;
}
.ob-mid.down{
  background: rgba(255, 77, 109, 0.14);
  color: #ff4d6d;
}
.ob-mid-price{
  font-size: 18px;
  line-height: 1.1;
}
.ob-mid-sub{
  margin-top: 4px;
  font-size: 12px;
  font-weight: 700;
  color: rgba(255,255,255,0.65);
}

/* полоска Buy/Sell как на скрине */
.ob-pressure{
  position: relative;
  height: 10px;
  border-radius: 999px;
  overflow: hidden;
  background: rgba(255,255,255,0.08);
  margin-top: 10px;
}
.ob-pressure-buy{
  position:absolute; left:0; top:0; bottom:0;
  background: rgba(0, 227, 161, 0.85);
  transition: width .25s ease;
}
.ob-pressure-sell{
  position:absolute; right:0; top:0; bottom:0;
  background: rgba(255, 77, 109, 0.85);
  transition: width .25s ease;
}
.ob-pressure-labels{
  display:flex;
  justify-content: space-between;
  margin-top: 6px;
  font-size: 12px;
  font-weight: 800;
}

.logo {
  font-size: 28px;
  font-weight: 700;
  letter-spacing: 0.5px;
  color: #ffffff;
  display: flex;
  align-items: center;
}

.logo span {
  margin-left: 2px;
  font-weight: 800;
  background: linear-gradient(135deg, #00e5ff, #7c4dff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  transform: translateY(1.3px);
}

#chart-root{
  position: relative; /* важно, чтобы absolute-панель якорилась внутри графика */
}

/* левая плавающая панель инструментов */
.chart-draw-tools{
  position: absolute;
  left: 4px;
  top: 45%;
  transform: translateY(-50%);
  z-index: 30;

  display: flex;
  flex-direction: column;
  gap: 8px;

  padding: 6px 4px;
  border-radius: 18px;

  background: rgba(20, 20, 20, 0.55);
  border: 1px solid rgba(255,255,255,0.12);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 10px 28px rgba(0,0,0,0.45);
}

/* keep toolbar compact */
.sim-vol-wrap{ display:none !important; }
.chart-draw-tools{ max-width: 44px; }

/* кнопки */
.chart-draw-tools .tool-btn{
  width: 30px;
  height: 30px;
  border-radius: 10px;

  display: grid;
  place-items: center;

  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.10);
  color: rgba(255,255,255,0.92);

  font-size: 16px;
  line-height: 1;
  cursor: pointer;

  transition: transform .08s ease, background .15s ease, border-color .15s ease;
}

.chart-draw-tools .tool-btn:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,0.10);
  border-color: rgba(255,255,255,0.18);
}

.chart-draw-tools .tool-btn.active{
  background: rgba(59,130,246,0.22);
  border-color: rgba(59,130,246,0.70);
}

/* разделители */
.chart-draw-tools .tool-sep{
  width: 100%;
  height: 1px;
  margin: 2px 0;
  background: rgba(255,255,255,0.10);
}





/* ===== TRADE PANEL: COMPACT + NO CLIP ON EXPAND ===== */
.spot-trade{
  padding: 10px;
  overflow-y: auto;
}
.trade-card{
  padding: 10px 10px 12px;
  border-radius: 14px;
}
.trade-bs-toggle{ gap: 8px; margin-bottom: 10px; }
.bs-btn{ height: 30px; font-size: 12px; }
.trade-types{ gap: 8px; margin: 6px 0 8px; }
.type-btn{ height: 26px; padding: 0 9px; font-size: 11.5px; }
.trade-available{ padding-top: 10px; }
.trade-available-label{ font-size: 11.5px; }
.trade-available-val{ font-size: 11.5px; gap: 6px; }
.avail-swap{ width: 26px; height: 26px; border-radius: 9px; margin-left: 6px; }

.trade-field{ margin-top: 8px; }
.trade-field-label{ font-size: 11.5px; margin-bottom: 6px; }

.trade-input{
  padding: 9px 10px;
  font-size: 14px;
  border-radius: 12px;
}

.trade-slider{ margin-top: 10px; }
.slider-marks{ margin-top: 6px; }
.slider-marks button{ font-size: 11.5px; }

.trade-tpsl-toggle{ margin-top: 8px; font-size: 12px; }

.trade-tpsl-panel{
  margin-top: 8px;
  padding: 8px;
  border-radius: 12px;
}
.trade-tpsl-panel.open{ max-height: 190px; }

.tpsl-label{ font-size: 11.5px; margin-bottom: 5px; }
.tpsl-suffix{ right: 10px; font-size: 11.5px; }
.tpsl-input{ padding-right: 52px !important; }

.trade-submit{
  height: 40px;
  margin-top: 10px;
  font-size: 13px;
}

/* Mobile: make trade column breathe a bit */
@media (max-width: 980px){
  .spot-layout{ grid-template-columns: 1fr; grid-template-rows: auto auto auto auto; }
  .spot-trade{ max-height: 70vh; }
}

/* Лэйаут верхней строки: слева title+TF, справа tools */
.chart-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.chart-head-left{
  display:flex;
  align-items:center;
  gap:12px;
  min-width: 0;
}

.chart-head-right{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:8px;
}

/* === ПЕРЕОПРЕДЕЛЕНИЕ: когда tools уже в шапке, делаем их "как на 2-м скрине" === */
.chart-head .chart-draw-tools{
  position: static;         /* вместо absolute слева */
  left: auto;
  top: auto;
  transform: none;

  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 6px;

  padding: 4px;
  border-radius: 999px;

  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.10);
  box-shadow: none;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  max-width: none;          /* у тебя был max-width:44px для левой колонки */
}

/* разделители в верхней строке лучше спрятать (или сделай тонкую вертикаль) */
.chart-head .chart-draw-tools .tool-sep{
  display: none;
}

/* Кнопки tools — “пилюли”, как таймфреймы */
.chart-head .chart-draw-tools .tool-btn{
  width: auto;
  height: 26px;
  min-width: 26px;
  padding: 0 10px;

  border-radius: 999px;

  background: rgba(0,0,0,0.35);
  border: 1px solid rgba(255,255,255,0.14);
  color: rgba(255,255,255,0.88);

  font-size: 12px;
  line-height: 1;
}

/* active — как выделенный 1m на скрине */
.chart-head .chart-draw-tools .tool-btn.active{
  background: #1a2cff;
  border-color: #1a2cff;
  color: #fff;
}

/* hover */
.chart-head .chart-draw-tools .tool-btn:hover{
  background: rgba(255,255,255,0.10);
  border-color: rgba(255,255,255,0.22);
  transform: none; /* в топ-баре лучше без подпрыгивания */
}

/* Кнопка ×SIM (она у тебя отдельная draw-btn + inline margin-top) — выравниваем в ряд */
.chart-head #clear-sim-btn{
  margin-top: 0 !important;
  height: 26px;
  border-radius: 999px;
  padding: 0 10px;
}

.chart-draw-tools{
  background: rgba(0,0,0,0.55);
  border: 0 !important;
  box-shadow: none;
  border-radius: 10px;
  padding: 6px;
}

/* разделители убрать */
.chart-draw-tools .tool-sep{ display:none; }

/* кнопки-иконки */
.chart-draw-tools .tool-btn{
  width: 34px;
  height: 34px;
  border: 0 !important;
  outline: none;
  background: transparent;
  border-radius: 8px;
  color: rgba(255,255,255,0.92);
  display:flex;
  align-items:center;
  justify-content:center;
}

/* hover — легкая подсветка */
.chart-draw-tools .tool-btn:hover{
  background: rgba(255,255,255,0.08);
}

/* active — синяя подложка */
.chart-draw-tools .tool-btn.active{
  background: #1a2cff;
  color:#fff;
}

/* Контейнер таймфреймов */
.chart-tools{
  display:flex;
  align-items:center;
  gap:14px;
  background: transparent;
  padding: 0;
  border: 0;
  box-shadow: none;
}

/* Кнопки таймфреймов */
.chart-btn{
  appearance: none;
  border: 0 !important;
  outline: none;
  background: transparent;
  color: rgba(255,255,255,0.65);
  font-size: 12px;
  line-height: 1;
  padding: 0;
  height: 24px;
  cursor: pointer;
}

/* hover — просто немного ярче */
.chart-btn:hover{
  color: rgba(255,255,255,0.9);
  background: transparent;
}

/* active — синяя капсула, без обводки */
.chart-btn.is-active{
  background: #1a2cff;
  color: #fff;
  padding: 0 10px;
  height: 24px;
  border-radius: 999px;
}

/* Тулбар в шапке — просто ряд кнопок, без фоновой плашки */
.chart-head .chart-draw-tools{
  position: static;
  left: auto;
  top: auto;
  transform: none;

  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 14px;              /* как у TM */
  padding: 0;
  background: transparent;
  border: 0 !important;
  box-shadow: none;
  max-width: none;
}

/* разделители скрыть */
.chart-head .chart-draw-tools .tool-sep{
  display: none;
}

/* Кнопки тулов — “как TM”: без обводок, просто иконка */
.chart-head .chart-draw-tools .tool-btn{
  appearance: none;
  border: 0 !important;
  outline: none;

  background: transparent;
  color: rgba(255,255,255,0.65);

  height: 24px;           /* как TM */
  padding: 0;             /* как TM (без капсулы по умолчанию) */
  border-radius: 999px;
  cursor: pointer;

  display: inline-flex;
  align-items: center;
  justify-content: center;

  /* если внутри svg/иконка — не сжимать */
  min-width: 24px;
}

/* hover — просто ярче, без плашки */
.chart-head .chart-draw-tools .tool-btn:hover{
  color: rgba(255,255,255,0.9);
  background: transparent;
}

/* active — синяя капсула, как у выбранного таймфрейма */
.chart-head .chart-draw-tools .tool-btn.active{
  background: #1a2cff;
  color: #fff;
  padding: 0 10px;        /* как TM */
  height: 24px;
  border-radius: 999px;
}

/* если у активной кнопки класс не .active, а например .is-active — добавь дубль */
.chart-head .chart-draw-tools .tool-btn.is-active{
  background: #1a2cff;
  color: #fff;
  padding: 0 10px;
  height: 24px;
  border-radius: 999px;
}

/* ×SIM тоже под TM-стиль */
.chart-head #clear-sim-btn{
  appearance: none;
  border: 0 !important;
  outline: none;
  background: transparent;
  color: rgba(255,80,80,0.9);

  height: 24px;
  padding: 0;
  border-radius: 999px;
}

/* если ×SIM должен быть капсулой при наведении */
.chart-head #clear-sim-btn:hover{
  color: rgba(255,255,255,0.95);
  background: rgba(255,80,80,0.35);
  padding: 0 10px;
}

/* Контейнер ордер-кнопок */
.order-type,
.order-tabs,
.trade-tabs,
.order-switch {
  display: flex;
  align-items: center;
  gap: 14px;
  background: transparent;
  padding: 0;
  border: 0;
  box-shadow: none;
}

/* Общий стиль кнопок */
.order-type button,
.order-tabs button,
.trade-tabs button,
.order-switch button {
  appearance: none;
  border: 0 !important;
  outline: none;
  background: transparent;

  color: rgba(255,255,255,0.65);
  font-size: 12px;
  line-height: 1;
  height: 24px;
  padding: 0;

  border-radius: 999px;
  cursor: pointer;
  transition: color .15s ease, background .15s ease;
}

/* hover — как у TM */
.order-type button:hover,
.order-tabs button:hover,
.trade-tabs button:hover,
.order-switch button:hover {
  color: rgba(255,255,255,0.9);
  background: transparent;
}

/* active — синяя капсула */
.order-type button.active,
.order-tabs button.active,
.trade-tabs button.active,
.order-switch button.active,
.order-type button.is-active,
.order-tabs button.is-active,
.trade-tabs button.is-active,
.order-switch button.is-active {
  background: #1a2cff;
  color: #fff;
  padding: 0 12px;
  height: 24px;
  border-radius: 999px;
}

/* кнопка с caret (TP/SL) */
.order-type button svg,
.order-type button .caret,
.order-tabs button svg {
  margin-left: 6px;
  opacity: 0.7;
}

/* Контейнер */
.trade-types{
  display: flex;
  align-items: center;
  gap: 14px;              /* как TM */
  background: transparent;
  padding: 0;
  border: 0;
}

/* Кнопки */
.trade-types .type-btn{
  appearance: none;
  border: 0 !important;
  outline: none;
  background: transparent;

  color: rgba(255,255,255,0.65);
  font-size: 12px;
  line-height: 1;
  height: 24px;
  padding: 0;

  border-radius: 999px;
  cursor: pointer;
  transition: color .15s ease, background .15s ease;
}

/* hover */
.trade-types .type-btn:hover{
  color: rgba(255,255,255,0.9);
  background: transparent;
}

/* active — синяя капсула */
.trade-types .type-btn.active{
  background: #1a2cff;
  color: #fff;
  padding: 0 12px;        /* капсула как у TM */
  height: 24px;
  border-radius: 999px;
}

/* ===== Spot Orders ===== */
.spot-orders{
  margin-top: 0px;
  padding: 18px 22px 26px;
  border-radius: 16px;

  background: rgba(255,255,255,0.02);
}

/* Header */
.orders-header{
  margin-bottom: 16px;
}

/* Tabs */
.orders-tabs{
  display: flex;
  gap: 22px;
}

.orders-tab{
  background: none;
  border: none;
  padding: 0;
  height: 24px;

  font-size: 14px;
  font-weight: 600;
  color: rgba(255,255,255,0.55);
  cursor: pointer;
  position: relative;
}

.orders-tab:hover{
  color: rgba(255,255,255,0.85);
}

.orders-tab.active{
  color: #fff;
}

.orders-tab.active::after{
  content:"";
  position:absolute;
  left:0;
  bottom:-8px;
  width:100%;
  height:2px;
  background:#1a2cff;
  border-radius:2px;
}

/* Table wrapper */
.orders-table{
  margin-top: 12px;
  border-top: 1px solid rgba(255,255,255,0.08);
}

/* Header row */
.orders-head{
  display: grid;
  grid-template-columns:
    1.2fr
    1.3fr
    0.9fr
    0.9fr
    1fr
    1fr
    1fr
    1fr
    0.8fr;

  padding: 14px 0;
  font-size: 12px;
  color: rgba(255,255,255,0.45);
}

.orders-head .right{
  text-align: right;
}

/* Empty state */
.orders-empty{
  padding: 80px 0 90px;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

.orders-empty-icon{
  font-size: 36px;
  opacity: 0.25;
  margin-bottom: 10px;
}

.orders-empty-title{
  font-size: 15px;
  font-weight: 600;
  color: rgba(255,255,255,0.45);
  margin-bottom: 60px;
}

.orders-empty-text{
  font-size: 13px;
  color: rgba(255,255,255,0.45);
}

/* Таблица должна иметь высоту (или min-height) */
.orders-table{
  display: grid;
  grid-template-rows: auto 1fr;     /* head + body */
  min-height: 220px;               /* подбери под свой дизайн */
}

/* Empty занимает "body" и реально центрируется */
.orders-empty{
  grid-row: 2;
  display: grid;
  place-items: center;             /* идеально по центру */
  padding: 0;                      /* убираем твои 80px */
  text-align: center;
  
}

/* ===== Trade History panel ===== */
.orders-panel.trade-history{
  padding-top: 10px;
}

/* Filters row */
.th-filters{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:16px;
  padding: 10px 0 14px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.th-left{
  display:flex;
  align-items:center;
  gap:18px;
  flex-wrap: wrap;
}

.th-range{
  display:flex;
  align-items:center;
  gap:10px;
}

/* pills like your TM style: no borders */
.th-pill{
  appearance:none;
  border:0 !important;
  background:transparent;
  color: rgba(255,255,255,0.55);
  height: 24px;
  padding: 0 10px;
  border-radius: 999px;
  cursor:pointer;
  font-size: 12px;
  font-weight: 600;
}

.th-pill:hover{
  color: rgba(255,255,255,0.85);
}

.th-pill.active{
  background:#1a2cff;
  color:#fff;
}


/* Scrollable history panels */
.orders-panel[data-panel="ordersHistory"],
.orders-panel[data-panel="tradeHistory"]{
  max-height: 520px;
  overflow-y: auto;
}

/* Hide scrollbar for history panels (keep scroll) */
.orders-panel[data-panel="ordersHistory"],
.orders-panel[data-panel="tradeHistory"]{
  scrollbar-width: none;      /* Firefox */
  scrollbar-color: transparent transparent;
  -ms-overflow-style: none;   /* IE / Edge legacy */
}
.orders-panel[data-panel="ordersHistory"]::-webkit-scrollbar,
.orders-panel[data-panel="tradeHistory"]::-webkit-scrollbar{
  width: 0 !important;
  height: 0 !important;
}
.orders-panel[data-panel="ordersHistory"]::-webkit-scrollbar-thumb,
.orders-panel[data-panel="tradeHistory"]::-webkit-scrollbar-thumb{
  background: transparent !important;
}
.orders-panel[data-panel="ordersHistory"]::-webkit-scrollbar-track,
.orders-panel[data-panel="tradeHistory"]::-webkit-scrollbar-track{
  background: transparent !important;
}


.orders-panel[data-panel="ordersHistory"] .orders-head,
.orders-panel[data-panel="tradeHistory"] .orders-head{
  position: sticky;
  top: 0;
  z-index: 5;
  background: rgba(17,17,17,0.96);
  /* убираем чёрную полосу от sticky-шапки */
  backdrop-filter: none;
}
.th-field{
  display:flex;
  align-items:center;
  gap:10px;
}

.th-label{
  font-size: 12px;
  color: rgba(255,255,255,0.55);
  font-weight: 600;
}

.th-input{
  width: 130px;
  height: 28px;
  border-radius: 8px;
  border: 0 !important;
  outline: none;
  background: rgba(255,255,255,0.06);
  color:#fff;
  padding: 0 10px;
  font-size: 12px;
}

.th-input::placeholder{
  color: rgba(255,255,255,0.35);
}

.th-sep{
  color: rgba(255,255,255,0.35);
  font-size: 12px;
}

/* reset button: clean like your style */
.th-reset{
  height: 28px;
  padding: 0 12px;
  border-radius: 999px;
  border: 0 !important;
  background: rgba(255,255,255,0.08);
  color:#fff;
  cursor:pointer;
  font-size: 12px;
  font-weight: 700;
}

.th-reset:hover{
  background: rgba(255,255,255,0.12);
}

.th-right{
  margin-left:auto;
}

.th-summary{
  font-size: 12px;
  color: rgba(255,255,255,0.55);
  font-weight: 600;
  white-space: nowrap;
}

.th-sum-val{
  color: rgba(255,255,255,0.92);
  font-weight: 800;
}

.th-buy{ color: rgba(0,227,161,0.95); }
.th-sell{ color: rgba(255,77,109,0.95); }

.th-sum-split{
  margin-left: 8px;
  color: rgba(255,255,255,0.45);
}


.th-row{
  display:grid;
  grid-template-columns:
    1.2fr
    1.5fr
    0.9fr
    1.3fr
    1fr
    1fr
    0.9fr
    0.9fr;
  padding: 10px 0;
  border-top: 1px solid rgba(255,255,255,0.06);
  font-size: 12px;
  color: rgba(255,255,255,0.85);
}
.th-row .right{ text-align:right; }
.th-row .buy{ color: rgba(0,227,161,0.95); font-weight: 700; }
.th-row .sell{ color: rgba(255,77,109,0.95); font-weight: 700; }

/* Table */
.th-table{
  padding-top: 10px;
}

.th-head{
  display:grid;
  grid-template-columns:
    1.2fr
    1.5fr
    0.9fr
    1.3fr
    1fr
    1fr
    0.9fr
    0.9fr;

  padding: 12px 0;
  font-size: 12px;
  color: rgba(255,255,255,0.45);
}

.th-head .right{
  text-align:right;
}

/* Empty state (centered, compact gap like we tuned before) */
.th-empty{
  min-height: 200px;
  display:grid;
  place-items:center;
  gap: 6px;
  text-align:center;
  padding: 26px 0 34px;
}

.th-empty-icon{
  font-size: 34px;
  opacity: 0.22;
  line-height: 1;
}

.th-empty-title{
  font-size: 15px;
  font-weight: 700;
  color: rgba(255,255,255,0.85);
  line-height: 1.2;
}

.th-empty-text{
  max-width: 520px;
  font-size: 12px;
  color: rgba(255,255,255,0.45);
  line-height: 1.55;
}

.spot-orders{
  height: 360px;
  overflow: hidden;
}

.orders-table{
  height: 100%;
}

/* Разрешаем странице расти по высоте (чтобы появился scroll страницы) */
body.spot-mode .spot-layout{
  height: auto !important;                 /* убираем 100vh */
  min-height: calc(100vh - var(--topbar-h)); /* чтоб минимум был экран */
}


/* === FINAL FIX: page scroll + no gaps + fixed trading row === */
body.spot-mode .spot-layout{
  height: auto !important;
  min-height: calc(100vh - var(--topbar-h));
  grid-template-rows: auto auto auto;
  grid-template-areas:
    "pair pair pair"
    "chart orderbook trade"
    "orders orders orders";
}

html, body{
  overflow-y: auto !important;
}

body.spot-mode,
body.spot-mode #spot-page,
body.spot-mode main{
  overflow: visible !important;
}

/* fixed trading row height */
body.spot-mode .spot-chart,
body.spot-mode .spot-orderbook,
body.spot-mode .spot-trade{
  height: 640px;
  max-height: 75vh;
  min-height: 520px;
  overflow: hidden;
}

/* internal layout to avoid bottom gaps */
body.spot-mode .spot-orderbook,
body.spot-mode .spot-trade{
  display: flex;
  flex-direction: column;
}

body.spot-mode .spot-orderbook *,
body.spot-mode .spot-trade *{
  min-height: 0;
}

body.spot-mode .spot-orderbook .ob-rows{
  flex: 1 1 auto;
  overflow-y: auto;
}


/* === Spot trading logic: open orders rows === */
.order-row{
  display: grid;
  grid-template-columns: 1.2fr 1.0fr 0.8fr 0.8fr 1.0fr 1.0fr 1.0fr 1.0fr 0.6fr;
  gap: 0;
  padding: 10px 0;
  font-size: 12px;
  color: rgba(255,255,255,0.75);
  border-top: 1px solid rgba(255,255,255,0.06);
}
.order-row .right{ text-align: right; }
.order-row .buy{ color: rgba(0,227,161,0.95); font-weight: 700; }
.order-row .sell{ color: rgba(255,77,109,0.95); font-weight: 700; }
.order-cancel{
  height: 22px;
  padding: 0 10px;
  border-radius: 999px;
  border: 0;
  background: rgba(255,255,255,0.08);
  color: rgba(255,255,255,0.9);
  cursor: pointer;
}
.order-cancel:hover{ background: rgba(255,255,255,0.12); }


/* ===== Last price button (trade panel) ===== */
.trade-field{ position: relative; }
#tradePrice{ padding-right: 92px; }
.last-price-btn{
  position:absolute;
  right: 10px;
  top: 38px; /* aligns with input in our trade-field */
  height: 24px;
  padding: 0 10px;
  border-radius: 999px;
  border: 0 !important;
  background: rgba(26,44,255,0.9);
  color: #fff;
  font-size: 11px;
  font-weight: 800;
  cursor: pointer;
}
.last-price-btn:hover{ opacity: 0.92; }


/* ===== Orders rows styling ===== */
.order-row{
  display:grid;
  grid-template-columns: 1.2fr 1fr 0.8fr 0.8fr 1fr 1fr 1fr 1fr 0.6fr;
  gap: 10px;
  padding: 10px 0;
  border-top: 1px solid rgba(255,255,255,0.06);
  font-size: 12px;
  color: rgba(255,255,255,0.85);
}
.order-row .right{ text-align:right; }
.order-row .buy{ color: #2bd9a8; font-weight: 700; }
.order-row .sell{ color: #ff5b6e; font-weight: 700; }
.order-cancel{
  width: 26px;
  height: 26px;
  border-radius: 8px;
  border: 0;
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.9);
  cursor: pointer;
}
.order-cancel:hover{ background: rgba(255,255,255,0.10); }


/* ===== PATCH v8: slider track fill via CSS variables (webkit+moz) ===== */
#tradePct{
  --pct: 0%;
  --fill: rgba(11,191,118,0.95);
  --rest: rgba(255,255,255,0.14);
  background: transparent !important;
}
#tradePct::-webkit-slider-runnable-track{
  height: 4px;
  border-radius: 999px;
  background: linear-gradient(90deg, var(--fill) 0 var(--pct), var(--rest) var(--pct) 100%);
}
#tradePct::-moz-range-track{
  height: 4px;
  border-radius: 999px;
  background: linear-gradient(90deg, var(--fill) 0 var(--pct), var(--rest) var(--pct) 100%);
}
#tradePct::-ms-track{
  height: 4px;
  border-radius: 999px;
  background: transparent;
  border-color: transparent;
  color: transparent;
}
#tradePct::-ms-fill-lower{ background: var(--fill); border-radius: 999px; }
#tradePct::-ms-fill-upper{ background: var(--rest); border-radius: 999px; }


/* ===== PATCH UI v11: Last price button + slider alignment ===== */
.trade-input-wrap{ position: relative; width: 100%; }
.trade-input-wrap .trade-input{ width: 100%; padding-right: 108px; }
.trade-input-wrap .last-price-btn{
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  height: 26px;
  padding: 0 12px;
  border-radius: 999px;
  border: 0 !important;
  background: rgba(26,44,255,0.9);
  color: #fff;
  font-size: 12px;
  font-weight: 800;
  cursor: pointer;
}
.trade-input-wrap .last-price-btn:hover{ filter: brightness(1.05); }

/* remove old absolute positioning that depended on magic top */
.trade-field > .last-price-btn{ position: static !important; }
#tradePrice{ padding-right: 0 !important; }

/* slider: ensure custom track is visible + thumb centered */
#tradePct{
  -webkit-appearance: none;
  appearance: none;
  height: 18px;              /* gives room for thumb */
  padding: 0;
}
#tradePct:focus{ outline: none; }
#tradePct::-webkit-slider-runnable-track{ height: 4px; }
#tradePct::-webkit-slider-thumb{
  -webkit-appearance: none;
  appearance: none;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #cfd6e4;
  border: 2px solid rgba(0,0,0,.35);
  margin-top: -6px;          /* centers on 4px track */
  cursor: pointer;
}
#tradePct::-moz-range-track{ height: 4px; }
#tradePct::-moz-range-thumb{
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #cfd6e4;
  border: 2px solid rgba(0,0,0,.35);
  cursor: pointer;
}


/* ===== PATCH v12: Market mode UI ===== */
.trade-panel.is-market .trade-field.price-field .trade-input{ opacity: 0.55; }
.trade-panel.is-market .trade-field.price-field .last-price-btn{ opacity: 0.35; pointer-events: none; }
.trade-panel.is-market .trade-field.price-field .trade-input{ cursor: not-allowed; }


/* ===== PATCH v13: Market tab minimal inputs ===== */
/* Hide price always in market */
.trade-panel.is-market .trade-field.price-field{ display:none !important; }
/* In market BUY: hide Amount (BTC), show Total */
.trade-panel.is-market.is-buy .trade-field.amount-field{ display:none !important; }
.trade-panel.is-market.is-buy .trade-field.total-field{ display:block !important; }
/* In market SELL: hide Total (USDT), show Amount */
.trade-panel.is-market.is-sell .trade-field.total-field{ display:none !important; }
.trade-panel.is-market.is-sell .trade-field.amount-field{ display:block !important; }
/* Tighten spacing a bit */
.trade-panel.is-market .trade-field{ margin-top: 10px; }


/* ===== PATCH v14: Market tab minimal (scoped to #tradeCard) ===== */
#tradeCard.is-market .trade-field.price-field{ display:none !important; }
#tradeCard.is-market.is-buy .trade-field.amount-field{ display:none !important; }
#tradeCard.is-market.is-buy .trade-field.total-field{ display:block !important; }
#tradeCard.is-market.is-sell .trade-field.total-field{ display:none !important; }
#tradeCard.is-market.is-sell .trade-field.amount-field{ display:block !important; }
#tradeCard.is-market #lastPriceBtn{ display:none !important; }

/* ===== Hide number input spinners ===== */

/* Chrome, Safari, Edge */
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Firefox */
input[type="number"] {
  -moz-appearance: textfield;
  appearance: textfield;
}

/* скрытый скроллбар для истории */
.history-scroll {
  overflow-y: auto;
  scrollbar-width: none;      /* Firefox */
  scrollbar-color: transparent transparent;
  -ms-overflow-style: none;   /* IE / Edge legacy */
}

.history-scroll::-webkit-scrollbar {
  width: 0;
  height: 0;
}

/* шапка истории — без собственного фона */
.orders-panel table thead,
.orders-panel table thead th {
  background: none;
}

/* аккуратная разделительная линия */
.orders-panel table thead th {
  border-bottom: none;
}

/* =========================================================
   OPEN STOCKS TRADE PAGE (clean)
   depends on existing SPOT styles (.spot-layout, .spot-pair, .spot-chart, .spot-trade, .spot-orders)
   ========================================================= */

/* режим страницы */
html.stocks-trade-mode,
body.stocks-trade-mode{
  overflow-y: auto !important;   /* ✅ вертикальный скролл */
  overflow-x: hidden !important; /* ❌ без горизонтального */
  background: #000 !important;
  overscroll-behavior: none;
}

/* topbar чёрный только на этой странице */
body.stocks-trade-mode .topbar,
body.stocks-trade-mode header{
  background: #000 !important;
  box-shadow: none !important;
}

/* футер скрываем только на этой странице */
body.stocks-trade-mode footer{
  display: none !important;
}

/* сама страница */
#openstockstradepage{
  background: #000;
  min-height: 100vh;
  overflow: hidden;

  /* отступ как у spot-page */
  padding-top: var(--topbar-h);
}

/* ВАЖНО: убираем любые внутренние отступы, чтобы не было "двойного" */
#openstockstradepage .spot-layout{
  padding-top: 0 !important;
  margin-top: 0 !important;

  /* grid без orderbook */
  grid-template-columns: 1fr 320px;
  grid-template-areas:
    "pair pair"
    "chart trade"
    "orders orders";
}

/* чтобы не было лишнего прилипшего margin у верхней панели */
#openstockstradepage .spot-pair{
  margin-top: 0 !important;
}

/* высоты как в spot */
#openstockstradepage .spot-chart,
#openstockstradepage .spot-trade{
  height: 640px;
  min-height: 640px;
}

/* FIX: openstockstradepage grid WITHOUT orderbook */
#openstockstradepage .spot-layout{
  display: grid !important;
  grid-template-columns: 1fr 320px !important;   /* chart | trade */
  grid-template-areas:
    "pair pair"
    "chart trade"
    "orders orders" !important;
  gap: 12px !important;
}

/* на всякий: если где-то остался блок orderbook — скрыть его только тут */
#openstockstradepage .spot-orderbook{
  display: none !important;
}

#openstockstradepage .spot-pair   { grid-area: pair   !important; }
#openstockstradepage .spot-chart  { grid-area: chart  !important; }
#openstockstradepage .spot-trade  { grid-area: trade  !important; }
#openstockstradepage .spot-orders { grid-area: orders !important; }

/* РУЧНАЯ КОМПЕНСАЦИЯ ОТСТУПА */
#openstockstradepage {
  margin-top: -52px;/*-- подбирается */
}

/* ===== FOREX TRADE MODE ===== */
html.forex-trade-mode,
body.forex-trade-mode{
  overflow-y: auto !important;   /* ✅ вертикальный скролл */
  overflow-x: hidden !important; /* ❌ без горизонтального */
  background: #000 !important;
  overscroll-behavior: none;
}

body.forex-trade-mode footer{ display:none !important; }
body.forex-trade-mode .topbar,
body.forex-trade-mode header{
  background:#000 !important;
  box-shadow:none !important;
}

/* ===== FOREX page layout (без orderbook) ===== */
#openforextradepage{
  background:#000;
  min-height:100vh;
  overflow:hidden;
  padding-top: var(--topbar-h);
}

#openforextradepage .spot-layout{
  padding-top: 0 !important;
  margin-top: 0 !important;

  display: grid !important;
  grid-template-columns: 1fr 320px !important;
  grid-template-areas:
    "pair pair"
    "chart trade"
    "orders orders" !important;
  gap: 12px !important;
}

#openforextradepage .spot-pair{ margin-top: 0 !important; }

#openforextradepage .spot-chart,
#openforextradepage .spot-trade{
  height: 640px;
  min-height: 640px;
}

/* ===== FOREX TRADE MODE ===== */
html.forex-trade-mode,
body.forex-trade-mode{
  overflow-y: auto !important;   /* ✅ вертикальный скролл */
  overflow-x: hidden !important; /* ❌ без горизонтального */
  background: #000 !important;
  overscroll-behavior: none;
}

/* ✅ ВСЕГДА показываем и фиксируем topbar в forex-trade */
body.forex-trade-mode header.topbar-wrapper{
  display: block !important;
  position: fixed !important;
  top: 0;
  left: 0;
  right: 0;
  z-index: 20000 !important; /* выше всего терминала */
}

/* чтобы контент не залезал под topbar
body.forex-trade-mode #openforextradepage{
  padding-top: 0px;
} */

/* ===== FIX: FOREX topbar wrapper must be black ===== */
body.forex-trade-mode .topbar-wrapper{
  background: #000 !important;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  backdrop-filter: none !important;
}

body.forex-trade-mode .topbar-wrapper::before,
body.forex-trade-mode .topbar-wrapper::after{
  content: none !important;
  background: none !important;
}

/* FIX: force black header in forex trade */
html.forex-trade-mode body header.topbar-wrapper{
  background: #000 !important;
  backdrop-filter: none !important;
}

html.forex-trade-mode body header.topbar-wrapper::before,
html.forex-trade-mode body header.topbar-wrapper::after{
  content: none !important;
  background: none !important;
}

/* ===== FOREX TRADE MODE (FINAL) ===== */
html.forex-trade-mode,
body.forex-trade-mode{
  overflow-y: auto !important;
  overflow-x: hidden !important;
  background: #000 !important;
  overscroll-behavior: none;
}

/* фиксируем шапку */
body.forex-trade-mode header.topbar-wrapper{
  display: block !important;
  position: fixed !important;
  top: 0; left: 0; right: 0;
  z-index: 20000 !important;
  background: #000 !important;
  box-shadow: none !important;
  backdrop-filter: none !important;
}

/* убираем “синий фон/градиент” если он через псевдо-элементы */
body.forex-trade-mode header.topbar-wrapper::before,
body.forex-trade-mode header.topbar-wrapper::after{
  content: none !important;
  background: none !important;
}

/* сама внутренняя панель */
body.forex-trade-mode .topbar{
  background: #000 !important;
  box-shadow: none !important;
}

/* FIX: убрать верхний отступ в Forex Trade */
body.forex-trade-mode #openforextradepage{
  padding-top: 50px;
}

/* FIX: убрать глобальный main margin в Forex Trade */
body.forex-trade-mode main{
  margin-top: 10px !important;
}

/* STOCKS TRADE list — как SPOT */
#openstockstradepage .pair-dd-list{
  max-height: 1000px;  /* как в spot */
  overflow: auto;      /* как в spot */
  padding: 6px;        /* как в spot */
}

/* ===== STOCKS TRADE: 1:1 scroll как SPOT (#pair-list) ===== */
#openstockstradepage .pair-dd{
  max-height: 60vh;
  overflow: hidden; /* скролл только у списка */
}

#openstockstradepage .pair-dd-list{
  max-height: calc(50vh - 150px);
  overflow: auto;
}

/* тот же scrollbar что у SPOT */
#openstockstradepage .pair-dd-list::-webkit-scrollbar{ width: 8px; }
#openstockstradepage .pair-dd-list::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,.12);
  border-radius: 999px;
}





/* --- FIX: make chart fill the whole block (Spot + StocksTrade) --- */
.spot-chart{
  display:flex;
  flex-direction:column;
}
.spot-chart .chart-head{
  flex:0 0 auto;
}
.spot-chart .chart-stage{
  flex:1 1 auto;
  height:auto !important;
  min-height:0 !important;
  display:flex;
  flex-direction:column;
}
#stocks-chart-mount{
  flex:1 1 auto;
  min-height:0;
  display:flex;
}
#stocks-chart-mount #chart-root{
  flex:1 1 auto;
}
#chart-root{
  width:100%;
  height:100%;
}
#ax-chart{
  width:100%;
  height:100%;
}

/* ✅ OPEN STOCKS TRADE: trade слева, orders по центру/справа, chart убран */
#openstockstradepage .spot-layout{
  display: grid !important;
  grid-template-columns: 360px 1fr !important;   /* BLOCK 1 | BLOCK 2 */
  grid-template-areas:
    "pair pair"
    "trade orders" !important;
  gap: 12px !important;

  padding-top: 0 !important;
  margin-top: 0 !important;
}

/* назначаем области */
#openstockstradepage .spot-pair   { grid-area: pair !important; }
#openstockstradepage .spot-trade  { grid-area: trade !important; }
#openstockstradepage .spot-orders { grid-area: orders !important; }

/* ❌ график убираем полностью */
#openstockstradepage .spot-chart{
  display: none !important;
}

/* чтобы trade был “на месте” и не растягивался */
#openstockstradepage .spot-trade{
  align-self: start;
  position: sticky;
  top: calc(var(--topbar-h) + 12px);
}

/* чтобы orders занимал всю высоту и был со скроллом внутри */
#openstockstradepage .spot-orders{
  min-height: 640px;
  overflow: auto;
}

/* === STOCKS TRADE: фиксируем страницу без общего скролла === */
html, body{
  height: 100%;
}

body.stockstrade-mode{
  overflow: hidden;   /* убираем прокрутку страницы */
}

/* секция занимает весь экран под topbar */
#openstockstradepage{
  position: fixed;
  left: 0; right: 0;
  top: var(--topbar-h, 64px);   /* высота topbar */
  bottom: 0;
  overflow: hidden;             /* без скролла у секции */
  display: none;                /* как у тебя, покажешь через JS */
}

/* layout: 2 строки — pairbar (auto) + контент (1fr) */
#openstockstradepage .spot-layout.openstocks-layout{
  height: 100%;
  display: grid !important;
  grid-template-columns: 360px 1fr;
  grid-template-rows: auto 1fr;
  grid-template-areas:
    "pair pair"
    "trade orders";
  gap: 12px;
}

/* назначаем области */
#openstockstradepage .spot-pair   { grid-area: pair; }
#openstockstradepage .spot-trade  { grid-area: trade; }
#openstockstradepage .spot-orders { grid-area: orders; }

/* тянем оба блока до низа */
#openstockstradepage .spot-trade,
#openstockstradepage .spot-orders{
  height: 100%;
  min-height: 0; /* важно для overflow в grid */
}

/* trade без sticky — просто на всю высоту */
#openstockstradepage .spot-trade{
  position: static !important;
}

/* скролл только внутри таблицы ордеров (если не помещается) */
#openstockstradepage .spot-orders{
  overflow: hidden;  /* внешний без скролла */
}

#openstockstradepage .orders-table{
  height: 100%;
  overflow: auto;    /* внутренний скролл */
  min-height: 0;
}

/* небольшой отступ снизу как на других страницах */
#openstockstradepage{
  padding-bottom: 16px; /* можно 12–24px */
}

/* ✅ OPEN FOREX TRADE: trade слева, orders по центру/справа, chart убран */
#openforextradepage .spot-layout{
  display: grid !important;
  grid-template-columns: 360px 1fr !important;
  grid-template-areas:
    "pair pair"
    "trade orders" !important;
  gap: 12px !important;

  padding-top: 0 !important;
  margin-top: 0 !important;
}

/* назначаем области */
#openforextradepage .spot-pair   { grid-area: pair !important; }
#openforextradepage .spot-trade  { grid-area: trade !important; }
#openforextradepage .spot-orders { grid-area: orders !important; }

/* ❌ график убираем полностью */
#openforextradepage .spot-chart{
  display: none !important;
}

/* чтобы trade был “на месте” и не растягивался */
#openforextradepage .spot-trade{
  align-self: start;
  position: sticky;
  top: calc(var(--topbar-h) + 12px);
}

/* чтобы orders занимал всю высоту и был со скроллом внутри */
#openforextradepage .spot-orders{
  min-height: 640px;
  overflow: auto;
}

/* === FOREX TRADE: фиксируем страницу без общего скролла === */
html, body{
  height: 100%;
}

body.forextrade-mode{
  overflow: hidden;
}

/* секция занимает весь экран под topbar */
#openforextradepage{
  position: fixed;
  left: 0; right: 0;
  top: 12px;
  bottom: 0;
  overflow: hidden;
  display: none; /* показываешь через JS */
}

/* layout: 2 строки — pairbar (auto) + контент (1fr) */
#openforextradepage .spot-layout.forex-layout{
  height: 100%;
  display: grid !important;
  grid-template-columns: 360px 1fr;
  grid-template-rows: auto 1fr;
  grid-template-areas:
    "pair pair"
    "trade orders";
  gap: 12px;
}

/* назначаем области */
#openforextradepage .spot-pair   { grid-area: pair; }
#openforextradepage .spot-trade  { grid-area: trade; }
#openforextradepage .spot-orders { grid-area: orders; }

/* тянем оба блока до низа */
#openforextradepage .spot-trade,
#openforextradepage .spot-orders{
  height: 100%;
  min-height: 0;
}

/* trade без sticky — просто на всю высоту */
#openforextradepage .spot-trade{
  position: static !important;
}

/* скролл только внутри таблицы ордеров */
#openforextradepage .spot-orders{
  overflow: hidden;
}

#openforextradepage .orders-table{
  height: 100%;
  overflow: auto;
  min-height: 0;
}

/* небольшой отступ снизу как на других страницах */
#openforextradepage{
  padding-bottom: 16px;
}
/* убираем лишний верхний отступ внутри forex-trade */
#openforextradepage .spot-layout.forex-layout{
  padding-top: 0 !important;
  margin-top: 0 !important;
}

/* на всякий случай ещё и pairbar (если он тянет вниз) */
#openforextradepage .spot-pair{
  margin-top: 0 !important;
}

.user-divider{
  height: 1px;
  margin: 6px 4px;
  background: rgba(255,255,255,.08);
}

.user-logout{
  width: 100%;
  background: none;
  border: none;
  text-align: left;
  cursor: pointer;
  color: #ff6b6b;
}

.user-logout:hover{
  background: rgba(255,107,107,.12);
}

/* FORCE disable old forex pills */
#openforextradepage .pair-dd-item{
  all: unset !important;
  display: none !important;
}

/* Forex dropdown = Stocks style */
#openforextradepage .pair-item{
  display:flex;
  justify-content: space-between;
  align-items:center;

  padding:14px 16px;
  margin-bottom:8px;

  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius:14px;

  color:#fff;
  cursor:pointer;
}

#openforextradepage .pair-item:hover{
  background: rgba(255,255,255,0.08);
}

#openforextradepage .pair-item .sym{
  font-weight:800;
}

#openforextradepage .pair-item .nm{
  font-size:12px;
  opacity:.6;
}

/* FIX: dropdown не должен обрезаться */
#openforextradepage { overflow: visible !important; }
#openforextradepage .spot-layout { overflow: visible !important; }
#openforextradepage .spot-pair,
#openforextradepage .pairbar,
#openforextradepage .pair-select-wrap { overflow: visible !important; }

/* чтобы dropdown был поверх всего */
#openforextradepage .pair-dd { z-index: 99999 !important; }

/* FIX: открыть dropdown даже если в HTML есть style="display:none" */
#openforextradepage .spot-pair.open .pair-dd{
  display: block !important;
}
#openforextradepage .pair-dd{
  display: none !important;
}

#openforextradepage .pair-dd-list{
  max-height: calc(50vh - 150px);
  overflow: auto;
  padding: 6px;
}
#openforextradepage .pair-dd{ max-height:60vh; overflow:hidden; }
#openforextradepage .pair-dd-list::-webkit-scrollbar{ width:8px; }
#openforextradepage .pair-dd-list::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,.12);
  border-radius: 999px;
}

/* === Forex dropdown: как StocksTrade (плоский список, пилюля только на hover) === */
#openforextradepage .pair-dd-list .pair-item{
  background: transparent !important;
  border: 1px solid transparent !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  margin: 0 !important;
}

/* чуть “плотнее”, как список */
#openforextradepage .pair-dd-list{
  padding: 0 !important;
}

/* пилюля только при наведении */
#openforextradepage .pair-dd-list .pair-item:hover{
  background: rgba(255,255,255,0.06) !important;
  border-color: rgba(255,255,255,0.08) !important;
  border-radius: 14px !important;
}

/* активный (если хочешь подсветку выбранного) */
#openforextradepage .pair-dd-list .pair-item.active{
  background: rgba(255,255,255,0.05) !important;
  border-color: rgba(255,255,255,0.10) !important;
  border-radius: 14px !important;
}


/* ===== FORCE OPEN forex dropdown (перебивает всё) ===== */

/* 1) по умолчанию скрыт */
#openforextradepage .pair-dd{
  display: none !important;
}

/* 2) показываем ТОЛЬКО когда .spot-pair имеет .open */
#openforextradepage .spot-pair.open .pair-dd{
  display: block !important;
}

/* 3) чтобы не обрезало и было поверх */
#openforextradepage,
#openforextradepage .spot-layout,
#openforextradepage .spot-pair,
#openforextradepage .pairbar,
#openforextradepage .pair-select-wrap{
  overflow: visible !important;
}
#openforextradepage .pair-dd{ z-index: 999999 !important; }

.tx-modal-backdrop{
  position: fixed; inset: 0;
  display:none;
  align-items:center; justify-content:center;
  padding: 20px;
  z-index: 9999;
  background: rgba(0,0,0,.35);
  backdrop-filter: blur(10px);
}
.tx-modal-backdrop.open{ display:flex; }

.tx-modal{
  width: min(520px, 96vw);
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.10);
  background: linear-gradient(180deg, rgba(18,22,30,.92), rgba(10,12,18,.92));
  box-shadow: 0 20px 60px rgba(0,0,0,.55);
  color:#fff;
  padding: 18px;
}

.tx-modal-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom: 14px; }
.tx-modal-title{ font-weight:800; font-size:18px; }
.tx-modal-x{
  border:0; background: rgba(255,255,255,.06);
  color:#fff; width:38px; height:38px;
  border-radius: 12px; cursor:pointer; font-size:22px;
}
.tx-modal-x:hover{ background: rgba(255,255,255,.10); }

.tx-grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom: 12px; }
.tx-field label{ display:block; font-size:12px; opacity:.75; margin-bottom: 6px; }
.tx-field select, .tx-field input{
  width:100%;
  padding: 12px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
  color:#fff;
  outline:none;
}

.tx-row{ display:flex; align-items:center; justify-content:space-between; margin: 10px 0 14px; font-size:12px; opacity:.8; }

.tx-actions{ display:flex; gap:10px; justify-content:flex-end; }
.tx-btn{
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
  color:#fff;
  border-radius: 12px;
  padding: 10px 14px;
  cursor:pointer;
  font-weight:800;
}
.tx-btn:hover{ background: rgba(255,255,255,.10); }
.tx-btn.primary{ background: linear-gradient(135deg, #1b6dff, #005bff); border-color: transparent; }
.tx-btn.primary:hover{ filter: brightness(1.05); }

.tx-error{ color:#ff7b7b; font-size:12px; min-height: 16px; }

/* ================= ADMIN UI (layout like screenshot) ================= */
/* ================= ADMIN UI (3 blocks) ================= */

.admin-page{
  min-height: calc(100vh - 70px);
  padding: 18px;
}

/* 2 колонки: (1) left block | (2+3) right block */
.admin-shell{
  width: 100%;
  max-width: 1700px;
  margin: 0 auto;

  display: grid;
  grid-template-columns: 320px 1fr;
  gap: 18px;
  align-items: stretch;

  /* чтобы правая часть с 1fr реально растягивалась */
  min-height: calc(100vh - 70px - 36px); /* 70 topbar + 18*2 padding */
}

/* общий вид карточек */
.admin-card{
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px;
  backdrop-filter: blur(6px);
}

/* (1) левый большой блок */
.admin-left-rail-card{
  height: 100%;
  min-height: 680px;

  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* кнопки слева */
.admin-left-btn{
  height: 46px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.92);
  font-weight: 800;
  cursor: pointer;
  text-align: left;
  padding: 0 14px;
}
.admin-left-btn:hover{ background: rgba(255,255,255,0.09); }
.admin-left-btn.is-active{
  background: rgba(26,44,255,0.30);
  border-color: rgba(26,44,255,0.55);
}

/* заполнитель внутри левого блока */
.admin-left-menu-fill{
  flex: 1;
  border-radius: 14px;
  border: 1px dashed rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.02);
}

/* правая часть: (2) сверху поиск, (3) снизу инфа */
.admin-right{
  height: 100%;
  min-height: 0;

  display: grid;
  grid-template-rows: 120px 1fr;
  gap: 18px;
}

/* (2) верхний блок поиска */
.admin-topbar{
  padding: 16px 24px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.admin-topbar-inner{
  width: 100%;
}

.admin-topbar-title{
  font-weight: 900;
  color: rgba(255,255,255,0.92);
  margin-bottom: 10px;
}

.admin-topbar-row{
  display: grid;
  grid-template-columns: 1fr 110px;
  gap: 10px;
  align-items: center;
}

.admin-input{
  width: 100%;
  min-width: 0;
  height: 42px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.06);
  color: #fff;
  padding: 0 12px;
  outline: none;
}

.admin-btn{
  height: 42px;
  padding: 0 16px;
  border-radius: 12px;
  border: 0;
  cursor: pointer;
  font-weight: 900;
}

/* результаты поиска — на всю ширину блока 2 */
.admin-results{
  margin-top: 12px;
  display: grid;
  gap: 8px;
  max-width: none;
  margin-left: 0;
  margin-right: 0;
}

.admin-result-item{
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.04);
  padding: 10px 12px;
  cursor: pointer;
}
.admin-result-item:hover{ background: rgba(255,255,255,0.07); }

/* (3) нижний большой блок информации */
.admin-details-card{
  min-height: 0;
  overflow: auto;

  display: flex;
  flex-direction: column;
  padding: 20px 24px;
}

.admin-details-title{
  font-weight: 900;
  color: rgba(255,255,255,0.92);
  margin-bottom: 10px;
}

.admin-details{
  flex: 1;
  width: 100%;
  color: rgba(255,255,255,0.75);
  line-height: 1.5;
  font-size: 14px;
}

/* responsive */
@media (max-width: 1200px){
  .admin-shell{ grid-template-columns: 300px 1fr; }
}

@media (max-width: 980px){
  .admin-shell{ grid-template-columns: 1fr; }
  .admin-left-rail-card{ min-height: auto; }
  .admin-right{ grid-template-rows: auto 1fr; }
}
/* Make right cards full-width content */
.admin-topbar{
  display: block !important;
  padding: 16px 24px !important;
}

.admin-topbar-inner{
  width: 100% !important;
  max-width: none !important;
  margin: 0 !important;
  text-align: left !important;
}

/* Search row stretches */
.admin-topbar-row{
  display: grid !important;
  grid-template-columns: 1fr 110px !important;
  gap: 10px !important;
  justify-content: stretch !important;
}

.admin-input{
  width: 100% !important;
  min-width: 0 !important;
}

/* Details content stretches */
.admin-details-card{
  width: 100% !important;
}

.admin-details{
  width: 100% !important;
  flex: 1 !important;
}

.admin-shell{
  min-height: calc(100vh - 70px - 36px) !important;
}

.admin-right{
  height: 100% !important;
  min-height: 0 !important;
}

.admin-details-card{
  min-height: 0 !important;
  overflow: auto !important;
}


/* ===== Account balance pill (trade pages) ===== */
.account-balance-pill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.25);
  backdrop-filter: blur(6px);
  font-weight:800;
  font-size:12px;
  color:#fff;
  white-space:nowrap;
}
.account-balance-pill .unit{ opacity:.75; font-weight:800; }
.account-balance-pill .amt{ font-variant-numeric: tabular-nums; }


/* === TradingView iframe inside existing Spot chart (keeps original layout) === */
#tv-chart, #tv-chart iframe{
  width: 100%;
  height: 100%;
}
#tv-chart iframe{
  border: 0;
  display: block;
}


/* ===============================
   SPOT MOBILE TABS (match example)
   =============================== */
@media (max-width: 720px){

  /* Spot page should not be grid on mobile */
  #spot-page .spot-layout{
    display:flex !important;
    flex-direction:column !important;
    gap:12px !important;
    padding: 12px !important;
  }

  /* Pair header look closer to exchange header */
  #spot-page .spot-pair{
    width:100% !important;
  }
  #spot-page .pairbar{
    display:flex !important;
    flex-direction:column !important;
    gap:10px !important;
    align-items:stretch !important;
  }
  #spot-page .pair-select-wrap{
    width:100% !important;
  }
  #spot-page .pair-select{
    width:100% !important;
    justify-content:flex-start !important;
  }

/* Stats layout like exchange header (price left, metrics right) */
#spot-page .spot-stats{
  display:grid !important;
  grid-template-columns: 1.25fr 1fr !important;
  gap: 8px 14px !important;
  width:100% !important;
  align-items:start;
}
#spot-page .spot-stats .spot-stat{ min-width:0; }

/* place items: 1) price, 2) change on left; rest on right */
#spot-page .spot-stats .spot-stat:nth-child(1){ grid-column:1; grid-row:1; }
#spot-page .spot-stats .spot-stat:nth-child(2){ grid-column:1; grid-row:2; }
#spot-page .spot-stats .spot-stat:nth-child(3){ grid-column:2; grid-row:1; }
#spot-page .spot-stats .spot-stat:nth-child(4){ grid-column:2; grid-row:2; }
#spot-page .spot-stats .spot-stat:nth-child(5){ grid-column:2; grid-row:3; }
#spot-page .spot-stats .spot-stat:nth-child(6){ grid-column:2; grid-row:4; }

#spot-page #spot-last-price{
  font-size: 30px !important;
  font-weight: 900 !important;
  letter-spacing: .2px;
  line-height: 1.05;
}
#spot-page .spot-stat .label{
  font-size: 12px !important;
  opacity: .72;
  margin-bottom: 2px;
}
#spot-page .spot-stat .value,
#spot-page .spot-stat .change,
#spot-page .spot-stat .volume,
#spot-page .spot-stat .high,
#spot-page .spot-stat .low{
  font-size: 13px !important;
  font-weight: 800;
}

  /* Tabs row */
  #spot-page .spot-mobile-tabs{
    display:flex !important;
    gap:14px;
    padding: 8px 6px 2px;
    overflow-x:auto;
    -webkit-overflow-scrolling: touch;
    border-bottom: 1px solid rgba(255,255,255,0.10);
  }
  #spot-page .spot-mobile-tabs::-webkit-scrollbar{ height: 0; }

  #spot-page .spot-mtab{
    appearance:none;
    background: transparent;
    border: none;
    color: rgba(255,255,255,0.75);
    font-weight: 700;
    font-size: 14px;
    padding: 10px 2px;
    white-space: nowrap;
    cursor: pointer;
    position: relative;
  }
  #spot-page .spot-mtab.is-active{
    color: #fff;
  }
  #spot-page .spot-mtab.is-active::after{
    content:"";
    position:absolute;
    left:0;
    right:0;
    bottom:-1px;
    height:2px;
    background: rgba(43,122,255,0.95);
    border-radius: 999px;
  }

  /* Panels: show only active one */
  #spot-page .spot-chart,
  #spot-page .spot-orderbook,
  #spot-page .spot-trade{
    display:none !important;
    width:100% !important;
    min-width: 0 !important;
  }
  #spot-page[data-spot-panel="chart"] .spot-chart{ display:block !important; }
  #spot-page[data-spot-panel="orderbook"] .spot-orderbook{ display:block !important; }
  #spot-page[data-spot-panel="trade"] .spot-trade{ display:block !important; }

/* Compact order book on mobile (show both asks & bids without wasting space) */
#spot-page .spot-orderbook{
  border-radius: 12px !important;
  overflow: hidden;
}
#spot-page .spot-orderbook .ob-head{ display:none; } /* header already in tabs */
#spot-page .spot-orderbook .ob-cols{
  padding: 8px 10px;
  font-size: 11px;
  opacity: .8;
}
#spot-page .spot-orderbook .ob-body{
  display:flex;
  flex-direction:column;
  gap: 6px;
  padding: 0 6px 10px;
}
#spot-page .spot-orderbook .ob-side{
  max-height: 160px;         /* fits on phones */
  overflow: hidden;          /* we limit rows in JS */
  border-radius: 10px;
}
#spot-page .spot-orderbook .ob-mid{
  padding: 8px 10px;
  border-radius: 10px;
}
#spot-page .spot-orderbook .ob-mid-price{
  font-size: 16px;
  font-weight: 900;
}
#spot-page .spot-orderbook .ob-mid-sub{
  font-size: 11px;
  opacity: .75;
}
#spot-page .spot-orderbook .ob-row{
  padding: 4px 8px;
  font-size: 12px;
  line-height: 1.2;
}
#spot-page .spot-orderbook .ob-row span{ font-variant-numeric: tabular-nums; }

  /* Keep orders/history always visible at bottom */
  #spot-page .spot-orders{
    display:block !important;
    width:100% !important;
    min-width:0 !important;
  }

  /* Make sure no leftover sticky/side sizing breaks layout */
  #spot-page .spot-chart .chart-stage,
  #spot-page #chart-root,
  #spot-page #ax-chart{
    width:100% !important;
    max-width:100% !important;
  }


  /* ===== Stockstrade: header like Spot (prevent overflow) ===== */
  #openstockstradepage .spot-pair{ width:100% !important; }

  #openstockstradepage .pairbar{
    display:flex !important;
    flex-direction:column !important;
    align-items:stretch !important;
    gap:10px !important;
    padding: 12px !important;
    border-radius: 16px !important;
  }

  #openstockstradepage .pair-select-wrap{ width:100% !important; }
  #openstockstradepage .pair-select{
    width:100% !important;
    justify-content:space-between !important;
  }

  /* price + metrics grid (no right overflow) */
  #openstockstradepage .spot-stats{
    display:grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 8px 14px !important;
    width:100% !important;
    align-items:start !important;
  }
  #openstockstradepage .spot-stats .spot-stat{ min-width:0 !important; }
  #openstockstradepage .spot-stats .spot-stat:first-child{
    grid-column: 1 / -1 !important;
  }
  #openstockstradepage .spot-stats .last-price{
    font-size: 28px !important;
    line-height: 1.1 !important;
    font-weight: 800 !important;
  }

  /* compact labels */
  #openstockstradepage .spot-stats .label{
    font-size: 12px !important;
    opacity: .7 !important;
  }

}


/* ===== MOBILE FIX: STOCKS/FOREX trade pages — move orders below trade ===== */
@media (max-width: 900px){
  /* STOCKS */
  #openstockstradepage{
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }
  #openstockstradepage .spot-layout.openstocks-layout{
    display: grid !important;
    grid-template-columns: 1fr !important;
    grid-template-rows: auto auto auto !important;
    grid-template-areas:
      "pair"
      "trade"
      "orders" !important;
    gap: 14px !important;
    height: auto !important;
    min-height: 100% !important;
    padding: 14px 12px 18px !important;
  }
  #openstockstradepage .spot-trade,
  #openstockstradepage .spot-orders{
    height: auto !important;
    min-height: auto !important;
    overflow: visible !important;
  }
  /* make cards full-width and avoid side padding inside grid */
  #openstockstradepage .trade-card,
  #openstockstradepage .orders-card{
    width: 100%;
  }

  /* FOREX */
  #openforextradepage{
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }
  #openforextradepage .spot-layout.forex-layout{
    display: grid !important;
    grid-template-columns: 1fr !important;
    grid-template-rows: auto auto auto !important;
    grid-template-areas:
      "pair"
      "trade"
      "orders" !important;
    gap: 14px !important;
    height: auto !important;
    min-height: 100% !important;
    padding: 14px 12px 18px !important;
  }
  #openforextradepage .spot-trade,
  #openforextradepage .spot-orders{
    height: auto !important;
    min-height: auto !important;
    overflow: visible !important;
  }
  #openforextradepage .trade-card,
  #openforextradepage .orders-card{
    width: 100%;
  }
}


/* =========================================================
   MOBILE FIX: STOCKS TRADE layout (orders under trade, full width)
   ========================================================= */
@media (max-width: 720px){
  #openstockstradepage{ margin-top: 0 !important; }
  #openstockstradepage .spot-layout{
    display: flex !important;
    flex-direction: column !important;
    gap: 12px !important;
  }
  /* на мобилке нам нужен только трейдинг + ордера (как ты просил) */
  #openstockstradepage .spot-chart{ display: none !important; }
  #openstockstradepage .spot-trade,
  #openstockstradepage .spot-orders{
    width: 100% !important;
    max-width: 100% !important;
  }
}


/* ===== MOBILE FIX: STOCKS TRADE like SPOT (full width, orders below) ===== */
@media (max-width: 720px){
  body.stocks-trade-mode #openstockstradepage .spot-layout{
    display: flex !important;
    flex-direction: column !important;
    gap: 14px !important;
    padding: 12px !important;
  }

  /* hide chart on phone (trade-only) */
  body.stocks-trade-mode #openstockstradepage .spot-chart{
    display: none !important;
  }

  /* trade + orders take full width */
  body.stocks-trade-mode #openstockstradepage .spot-trade,
  body.stocks-trade-mode #openstockstradepage .spot-orders,
  body.stocks-trade-mode #openstockstradepage .spot-pair{
    width: 100% !important;
    min-width: 0 !important;
    max-width: 100% !important;
  }

  /* prevent inner elements from forcing overflow */
  body.stocks-trade-mode #openstockstradepage .trade-card,
  body.stocks-trade-mode #openstockstradepage .orders-card{
    width: 100% !important;
    min-width: 0 !important;
    max-width: 100% !important;
  }

  /* Buy/Sell tabs must fit */
  body.stocks-trade-mode #openstockstradepage .trade-side-tabs{
    display: flex !important;
    gap: 10px !important;
  }
  body.stocks-trade-mode #openstockstradepage .trade-side-tabs button{
    flex: 1 1 0 !important;
    min-width: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}


/* ===== MOBILE: compact dropdowns (Spot / StocksTrade / ForexTrade) ===== */
@media (max-width: 720px){
  /* make pair dropdown a centered overlay so it never goes out of the screen */
  .pair-select-wrap{ position: relative; }
  .pair-dd{
    position: fixed !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    top: calc(var(--topbar-h, 64px) + 12px) !important;
    width: min(520px, 94vw) !important;
    max-height: calc(100vh - (var(--topbar-h, 64px) + 24px)) !important;
    overflow: hidden !important; /* list scrolls */
    z-index: 999999 !important;
  }
  .pair-dd-head{ padding: 10px !important; }
  .pair-search{ height: 38px !important; }
  .pair-dd-cols{ padding: 8px 10px !important; font-size: 11px !important; }
  .pair-item{ padding: 8px 10px !important; }
  .pair-dd-list{
    max-height: calc(100vh - (var(--topbar-h, 64px) + 170px)) !important;
    overflow: auto !important;
  }

  /* reduce page side paddings a bit to "pull content up" on StocksTrade */
  #openstockstradepage{ padding-top: 0 !important; }
  #openstockstradepage .spot-layout{
    padding-top: 8px !important;
    margin-top: 0 !important;
  }

  /* prevent any parent clipping */
  #openspotpage, #openstockstradepage, #openforextradepage,
  #openspotpage .spot-layout, #openstockstradepage .spot-layout, #openforextradepage .spot-layout,
  #openspotpage .spot-pair, #openstockstradepage .spot-pair, #openforextradepage .spot-pair{
    overflow: visible !important;
  }
}

</style>
</head>
<body>
<script>
/* ===== SPOT storage helpers (localStorage + in-memory fallback) ===== */
(function(){
  const mem = window.__SPOT_MEM__ = window.__SPOT_MEM__ || {};
  function safeParse(v){ try{ return JSON.parse(v); }catch(e){ return null; } }

  window.spotStorageGet = function(key, defVal){
    try{
      const raw = localStorage.getItem(key);
      if(raw === null || raw === undefined) return (mem[key] ?? defVal);
      const parsed = safeParse(raw);
      return (parsed === null) ? (mem[key] ?? defVal) : parsed;
    }catch(e){
      return (mem[key] ?? defVal);
    }
  };

  window.spotStorageSet = function(key, val){
    mem[key] = val;
    try{ localStorage.setItem(key, JSON.stringify(val)); }catch(e){}
  };

  window.__spotReadOrderHistory = function(){
    return window.spotStorageGet("spot_order_history", []);
  };
  window.__spotWriteOrderHistory = function(hist){
    window.spotStorageSet("spot_order_history", hist);
  };
  window.__spotPushOrderHistory = function(entry){
    const hist = window.__spotReadOrderHistory() || [];
    hist.unshift(entry);
    window.__spotWriteOrderHistory(hist);
    return hist;
  };
})();
</script>

  <header class="topbar-wrapper">
    <div class="topbar">
      <div id="logo" class="logo">
  Arste<span>X</span>
</div>

      <nav class="nav">
        <a href="#">Markets</a>
        <a href="#" onclick="openSpotPage(); return false;">Spot</a>
        <a href="#" onclick="openstockstradepage(); return false;">Stocks</a>
        <a href="#" onclick="openforextradepage(); return false;">Forex</a>

      </nav>

      <div class="actions actions-guest" id="topbar-guest">
  <button class="btn btn-outline" id="btn-top-signin">Sign in</button>
  <button class="btn btn-primary" id="btn-top-get-started">Get Started</button>

  <!-- Mobile: burger menu for guest -->
  <button class="top-icon-btn burger-btn" id="mobile-guest-burger" aria-label="Menu" aria-expanded="false" aria-controls="mobile-guest-menu">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M4 7H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M4 17H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>

  <div class="mobile-auth-menu" id="mobile-guest-menu" aria-hidden="true">
    <div class="mobile-auth-panel" role="menu" aria-label="Guest menu">
      <button class="mobile-auth-item" type="button" data-action="signin">Sign in</button>
      <button class="mobile-auth-item primary" type="button" data-action="get-started">Get Started</button>
    </div>
  </div>
</div>

      <div class="actions actions-auth" id="topbar-auth" style="display:none;">
        <!-- Mobile: burger menu (phones). -->
        <button class="top-icon-btn burger-btn" id="mobile-auth-burger" aria-label="Menu" aria-expanded="false" aria-controls="mobile-auth-menu">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 7H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M4 17H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>

        <div class="mobile-auth-menu" id="mobile-auth-menu" aria-hidden="true">
          <div class="mobile-auth-panel mobile-auth-panel--logged" role="menu" aria-label="Account menu">
            <button class="mobile-auth-item" type="button" data-action="assets" role="menuitem">Assets</button>
            <button class="mobile-auth-item" type="button" data-action="deposit" role="menuitem">Deposits</button>
            <button class="mobile-auth-item" type="button" data-action="markets" role="menuitem">Markets</button>
            <button class="mobile-auth-item" type="button" data-action="spot" role="menuitem">Spot</button>
            <button class="mobile-auth-item" type="button" data-action="stocks" role="menuitem">Stocks</button>
            <button class="mobile-auth-item" type="button" data-action="forex" role="menuitem">Forex</button>
            <button class="mobile-auth-item mobile-auth-item--danger" type="button" data-action="logout" role="menuitem">Log Out</button>
          </div>
        </div>

        <button class="top-deposit-btn" type="button">Deposit</button>

  <div class="assets-dropdown" id="assets-dropdown">
  <button class="top-link assets-trigger" type="button" id="assets-trigger">
  Assets
</button>

  <div class="assets-menu">
    <div class="assets-card">
      <div class="assets-total">
        <div class="assets-total-title">Total Assets</div>
        <div class="assets-total-value">
  <span class="big fund-amt" data-acct="overview">0.00</span> <span class="unit">USDT</span>
</div>
<div class="assets-total-sub">
  ≈ $<span class="fund-usd-amt" data-usd-for="overview">0.00</span>
</div>
        <div class="assets-note">*Data updates may be delayed</div>

        <div class="assets-actions">
          <button class="assets-btn ghost" type="button">Withdraw</button>
          <button class="assets-btn primary" type="button">Deposit</button>
        </div>
      </div>

      <div class="assets-section">
        <div class="assets-section-title">Accounts</div>

        <a class="assets-item" href="#" data-nav="spot">Spot Account</a>
<a class="assets-item" href="#" data-nav="forex">Forex Account</a>
<a class="assets-item" href="#" data-nav="stocks">Stocks Account</a>
      </div>

      <div class="assets-section">
        <div class="assets-section-title">Records</div>
        <a class="assets-item" href="#" data-nav="records">Asset Records</a>
      </div>
    </div>
  </div>
</div>

  


  <div class="user-dropdown">
  <button class="top-icon-btn user-trigger" type="button" aria-label="User menu">
    <!-- иконка пользователя -->
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
      <path d="M20 21a8 8 0 10-16 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M12 12a4 4 0 100-8 4 4 0 000 8z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>

  <div class="user-menu">
  <div class="user-card">
<div class="user-divider user-mobile-nav-divider"></div>

    <!-- Mobile quick nav (moved from burger) -->
    
    <div class="user-mobile-nav">
<button class="user-item" type="button" id="user-nav-assets">Assets</button>
    <button class="user-item" type="button" id="user-nav-deposits">Deposits</button>
    <button class="user-item" type="button" id="user-nav-markets">Markets</button>
    <button class="user-item" type="button" id="user-nav-spot">Spot</button>
    <button class="user-item" type="button" id="user-nav-stocks">Stocks</button>
    <button class="user-item" type="button" id="user-nav-forex">Forex</button>
    </div>


    <div class="user-divider"></div>

    <!-- LOG OUT -->
    <button class="user-item user-logout" type="button" onclick="logoutUser()">
      Log Out
    </button>
  </div>
</div>
</div>
</div>

      </div>
    </div>
  </header>

  <div id="home-page">

  <section class="hero">
  <div class="hero-content">
    <h1 class="hero-title">
      Buy & trade on the<br />
      ArsteX crypto exchange
    </h1>

    <p class="hero-subtitle">
      ArsteX makes trading easy, fast & reliable. With 24/7 support,
      staking and bank-grade security & insurance. Since 2020
    </p>

    <button class="hero-btn" id="btn-hero-get-started">Get Started Now</button>
  </div>
</section>

  <section class="markets">
  <div class="markets-wrap">

    <div class="markets-header">
      <div>Crypto</div>
      <div>Last Price</div>
      <div>24h Change</div>
      <div>Charts</div>
      <div>Market Cap</div>
      <div>24h Volume</div>
      <div></div>
    </div>

    <div class="market-row" data-symbol="btcusdt">
      <div class="asset">
        <div class="coin">
      <img src="" alt="Bitcoin icon">
    </div>
        <div>
          <div class="symbol">Bitcoin <span>BTC</span></div>
        </div>
      </div>
      <div class="price">$92,242.91</div>
<div class="change down">−0.36%</div>
      <div class="spark">
  <svg viewBox="0 0 100 40" preserveAspectRatio="none">
    <path
      d="M0 30 L10 28 L20 22 L30 24 L40 18 L50 14 L60 16 L70 10 L80 12 L90 8 L100 10"
      fill="none"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
  </svg>
</div>
      <div class="market-cap">$1.8T</div>
<div class="volume">$53.3B</div>
      <button class="action-btn">Buy</button>
    </div>

    <div class="market-row" data-symbol="dogeusdt">
      <div class="asset">
        <div class="coin">
      <img src="" alt="Dogecoin icon">
    </div>
        <div>
          <div class="symbol">Dogecoin <span>DOGE</span></div>
        </div>
      </div>
      <div class="price">$92,242.91</div>
<div class="change down">−0.36%</div>
      <div class="spark">
  <svg viewBox="0 0 100 40" preserveAspectRatio="none">
    <path
      d="M0 30 L10 28 L20 22 L30 24 L40 18 L50 14 L60 16 L70 10 L80 12 L90 8 L100 10"
      fill="none"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
  </svg>
</div>
      <div class="market-cap">$1.8T</div>
<div class="volume">$53.3B</div>
      <button class="action-btn">Buy</button>
    </div>

    <div class="market-row" data-symbol="ethusdt">
      <div class="asset">
        <div class="coin">
      <img src="" alt="ETH icon">
    </div>
        <div>
          <div class="symbol">Ethereum <span>ETH</span></div>
        </div>
      </div>
      <div class="price">$92,242.91</div>
<div class="change down">−0.36%</div>
      <div class="spark">
  <svg viewBox="0 0 100 40" preserveAspectRatio="none">
    <path
      d="M0 30 L10 28 L20 22 L30 24 L40 18 L50 14 L60 16 L70 10 L80 12 L90 8 L100 10"
      fill="none"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
  </svg>
</div>
      <div class="market-cap">$1.8T</div>
<div class="volume">$53.3B</div>
      <button class="action-btn">Buy</button>
    </div>

    <div class="market-row" data-symbol="pepeusdt">
      <div class="asset">
        <div class="coin">
      <img src="" alt="PEPE icon">
    </div>
        <div>
          <div class="symbol">PEPE <span>PEPE</span></div>
        </div>
      </div>
      <div class="price">$92,242.91</div>
<div class="change down">−0.36%</div>
      <div class="spark">
  <svg viewBox="0 0 100 40" preserveAspectRatio="none">
    <path
      d="M0 30 L10 28 L20 22 L30 24 L40 18 L50 14 L60 16 L70 10 L80 12 L90 8 L100 10"
      fill="none"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
  </svg>
</div>
      <div class="market-cap">$1.8T</div>
<div class="volume">$53.3B</div>
      <button class="action-btn">Buy</button>
    </div>

    <div class="market-row" data-symbol="solusdt">
      <div class="asset">
        <div class="coin">
      <img src="" alt="SOL icon">
    </div>
        <div>
          <div class="symbol">Solana <span>SOL</span></div>
        </div>
      </div>
      <div class="price">$92,242.91</div>
<div class="change down">−0.36%</div>
      <div class="spark">
  <svg viewBox="0 0 100 40" preserveAspectRatio="none">
    <path
      d="M0 30 L10 28 L20 22 L30 24 L40 18 L50 14 L60 16 L70 10 L80 12 L90 8 L100 10"
      fill="none"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
  </svg>
</div>
      <div class="market-cap">$1.8T</div>
<div class="volume">$53.3B</div>
      <button class="action-btn">Buy</button>
    </div>

  </div>

  <div class="markets-footer">
    <button class="more-btn" onclick="openCryptoPage()">Learn More</button>
  </div>
</section>

<section class="markets" id="forex">
  <div class="markets-wrap">

    <div class="markets-header">
      <div>Forex Pair</div>
      <div>Last Price</div>
      <div>24h Change</div>
      <div>Charts</div>
      <div>Market Cap</div>
      <div>24h Volume</div>
      <div></div>
    </div>

    <div class="market-row" data-forex="eurusd">
      <div class="asset">

        <div class="symbol">EUR/USD</div>
      </div>
      <div class="price">1.0000</div>
      <div class="change down">0.00%</div>

      <div class="spark">
        <svg viewBox="0 0 100 40"><path></path></svg>
      </div>

      <div class="market-cap">—</div>
      <div class="volume">—</div>

      <button class="action-btn">Trade</button>
    </div>

    <div class="market-row" data-forex="gbpusd">
      <div class="asset">

        <div class="symbol">GBP/USD</div>
      </div>
      <div class="price">1.0000</div>
      <div class="change down">0.00%</div>

      <div class="spark">
        <svg viewBox="0 0 100 40"><path></path></svg>
      </div>

      <div class="market-cap">—</div>
      <div class="volume">—</div>

      <button class="action-btn">Trade</button>
    </div>

    <div class="market-row" data-forex="usdjpy">
      <div class="asset">

        <div class="symbol">USD/JPY</div>
      </div>
      <div class="price">1.0000</div>
      <div class="change down">0.00%</div>

      <div class="spark">
        <svg viewBox="0 0 100 40"><path></path></svg>
      </div>

      <div class="market-cap">—</div>
      <div class="volume">—</div>

      <button class="action-btn">Trade</button>
    </div>

  </div>

  <div class="markets-footer">
  <button class="more-btn" onclick="openForexPage()">Learn More</button>
</div>

</section>

<!-- =============== STOCKS PREVIEW ON HOMEPAGE =============== -->
<section class="markets" id="stocks">
  <div class="markets-wrap">

    <div class="markets-header">
      <div>Stock</div>
      <div>Last Price</div>
      <div>24h Change</div>
      <div>Charts</div>
      <div>Market Cap</div>
      <div>24h Volume</div>
      <div></div>
    </div>

    <!-- Небольшой превью-список (3 акции) -->
    <div class="market-row" data-stock="aapl">
      <div class="asset">

        <div>
          <div class="symbol">Apple <span>AAPL</span></div>
        </div>
      </div>
      <div class="price">$0.00</div>
      <div class="change">0.00%</div>

      <div class="spark">
        <svg viewBox="0 0 100 40" preserveAspectRatio="none">
          <path></path>
        </svg>
      </div>

      <div class="market-cap">—</div>
      <div class="volume">—</div>

      <button class="action-btn">Trade</button>
    </div>

    <div class="market-row" data-stock="msft">
      <div class="asset">

        <div>
          <div class="symbol">Microsoft <span>MSFT</span></div>
        </div>
      </div>
      <div class="price">$0.00</div>
      <div class="change">0.00%</div>

      <div class="spark">
        <svg viewBox="0 0 100 40" preserveAspectRatio="none">
          <path></path>
        </svg>
      </div>

      <div class="market-cap">—</div>
      <div class="volume">—</div>

      <button class="action-btn">Trade</button>
    </div>

    <div class="market-row" data-stock="tsla">
      <div class="asset">

        <div>
          <div class="symbol">Tesla <span>TSLA</span></div>
        </div>
      </div>
      <div class="price">$0.00</div>
      <div class="change">0.00%</div>

      <div class="spark">
        <svg viewBox="0 0 100 40" preserveAspectRatio="none">
          <path></path>
        </svg>
      </div>

      <div class="market-cap">—</div>
      <div class="volume">—</div>

      <button class="action-btn">Trade</button>
    </div>

  </div>

  <div class="markets-footer">
    <button class="more-btn" onclick="openStocksPage()">Learn More</button>
  </div>
</section>

<section id="steps" class="steps">
  <div class="steps-inner">
    <h2 class="steps-title">First 3 steps to start trading</h2>

    <div class="steps-grid">
      <!-- 1. Register -->
      <div class="step-card">
        <div class="step-icon step-icon-1">
          <img src="img/steps/register.png" alt="Register">
        </div>
        <h3 class="step-heading">1. Register</h3>
        <p class="step-text">
          Create your ArsteX account in a few clicks and verify your identity.
        </p>
      </div>

      <!-- 2. Fund -->
      <div class="step-card">
        <div class="step-icon step-icon-2">
          <img src="img/steps/fund.png" alt="Fund">
        </div>
        <h3 class="step-heading">2. Fund</h3>
        <p class="step-text">
          Top up your balance with transfers or cryptocurrencies.
        </p>
      </div>

      <!-- 3. Trade -->
      <div class="step-card">
        <div class="step-icon step-icon-3">
          <img src="img/steps/trade.png" alt="Trade">
        </div>
        <h3 class="step-heading">3. Trade</h3>
        <p class="step-text">
          Buy, sell and manage leading crypto &amp; forex pairs in one place.
        </p>
      </div>
    </div>
  </div>
</section>

<section id="faq" class="faq">
  <div class="faq-inner">
    <h2 class="faq-title">FAQ</h2>

    <div class="faq-list">

      <!-- 1 -->
      <div class="faq-item">
        <button class="faq-head" type="button">
          <span class="faq-index">1</span>
          <span class="faq-question">
            Why is ArsteX the best exchange for crypto traders?
          </span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-body">
          <p>
            ArsteX combines deep liquidity, low trading fees and fast order
            execution. We offer both spot and derivatives markets, 24/7 support
            and bank-grade security for your funds.
          </p>
        </div>
      </div>

      <!-- 2 -->
      <div class="faq-item">
        <button class="faq-head" type="button">
          <span class="faq-index">2</span>
          <span class="faq-question">
            What products does ArsteX provide?
          </span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-body">
          <p>
            You can trade crypto spot, margin and futures, stake popular coins,
            swap fiat to crypto and access basic forex pairs — all inside one
            account.
          </p>
        </div>
      </div>

      <!-- 3 -->
      <div class="faq-item">
        <button class="faq-head" type="button">
          <span class="faq-index">3</span>
          <span class="faq-question">
            How to buy Bitcoin and other cryptocurrencies on ArsteX?
          </span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-body">
          <p>
            Register, pass a quick verification and top up your balance with a
            bank card, transfer or crypto deposit. After that you can buy any
            listed asset in the “Buy Crypto” or “Markets” section.
          </p>
        </div>
      </div>

      <!-- 4 -->
      <div class="faq-item">
        <button class="faq-head" type="button">
          <span class="faq-index">4</span>
          <span class="faq-question">
            How can I track cryptocurrency prices?
          </span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-body">
          <p>
            Use the Markets page on ArsteX: real-time prices, 24h change,
            sparklines and market-cap data for top assets. You can also add
            favourites and quickly switch between crypto and forex.
          </p>
        </div>
      </div>

      <!-- 5 -->
      <div class="faq-item">
        <button class="faq-head" type="button">
          <span class="faq-index">5</span>
          <span class="faq-question">
            How to start trading cryptocurrencies on ArsteX?
          </span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-body">
          <p>
            After funding your account, open the trading terminal, choose a
            pair, select order type (market or limit) and confirm the trade.
            You can manage open positions and order history in your dashboard.
          </p>
        </div>
      </div>

    </div>
  </div>
</section>

<section class="partners-strip">
  <div class="partners-track">
    <img src="img/partners/moonpay.svg" alt="MoonPay">
    <img src="img/partners/sumsub.svg" alt="Sumsub">
    <img src="img/partners/volet.svg" alt="Volet">
    <img src="img/partners/banxa.svg" alt="Banxa">
    <img src="img/partners/hacken.svg" alt="Hacken">
    <img src="img/partners/tradingview.svg" alt="TradingView">
    <img src="img/partners/chainlink.svg" alt="Chainlink">
    <img src="img/partners/mazars.svg" alt="Mazars">
    <img src="img/partners/consensys.svg" alt="Consensys">
    <img src="img/partners/xanpool.svg" alt="XanPool">

    <!-- Дублируем для бесконечной прокрутки -->
    <img src="img/partners/moonpay.svg" alt="MoonPay">
    <img src="img/partners/sumsub.svg" alt="Sumsub">
    <img src="img/partners/volet.svg" alt="Volet">
    <img src="img/partners/banxa.svg" alt="Banxa">
    <img src="img/partners/hacken.svg" alt="Hacken">
    <img src="img/partners/tradingview.svg" alt="TradingView">
    <img src="img/partners/chainlink.svg" alt="Chainlink">
    <img src="img/partners/mazars.svg" alt="Mazars">
    <img src="img/partners/consensys.svg" alt="Consensys">
    <img src="img/partners/xanpool.svg" alt="XanPool">
    <img src="img/partners/moonpay.svg" alt="MoonPay">
    <img src="img/partners/sumsub.svg" alt="Sumsub">
    <img src="img/partners/volet.svg" alt="Volet">
    <img src="img/partners/banxa.svg" alt="Banxa">
    <img src="img/partners/hacken.svg" alt="Hacken">
    <img src="img/partners/tradingview.svg" alt="TradingView">
    <img src="img/partners/chainlink.svg" alt="Chainlink">
    <img src="img/partners/mazars.svg" alt="Mazars">
    <img src="img/partners/consensys.svg" alt="Consensys">
    <img src="img/partners/xanpool.svg" alt="XanPool">
  </div>
</section>

<section id="crypto-page" style="display:none; padding-top:120px;">

  <div style="text-align:center; margin-bottom:40px;">
    <h1 style="
      font-size: clamp(36px, 5vw, 56px);
      font-weight: 800;
      margin-bottom: 24px;
    ">
      Cryptocurrency Prices Today
    </h1>

    <input
      id="crypto-search"
      type="text"
      placeholder="Search cryptocurrency..."
      style="
        padding:14px 18px;
        width:320px;
        max-width:90%;
        border-radius:12px;
        border:none;
        outline:none;
        background:rgba(255,255,255,0.07);
        color:#fff;
        font-size:16px;
        text-align:center;
      "
    />
  </div>

  <section class="markets">
    <div class="markets-wrap">

      <div class="markets-header">
        <div>Crypto</div>
        <div>Last Price</div>
        <div>24h Change</div>
        <div>Charts</div>
        <div>Market Cap</div>
        <div>24h Volume</div>
        <div></div>
      </div>

      <!-- 🔥 Вставляем те же строки market-row, что и на первой странице -->
      <!-- Можно просто скопировать весь блок market-row отсюда -->

      <div id="crypto-rows"></div>

    </div>
    <div class="markets-footer">
    <button class="pager-btn" id="prev-page">←</button>
    <button class="pager-btn" id="next-page">→</button>
  </div>
  </section>

</section>



<section id="forex-page" class="forex-page" style="display:none; padding-top:120px;">

  <div style="text-align:center; margin-bottom:40px;">
    <h1 style="
      font-size: clamp(36px, 5vw, 56px);
      font-weight: 800;
      margin-bottom: 24px;
    ">
      Forex Rates Today
    </h1>

    <input
      id="forex-search"
      type="text"
      placeholder="Search forex pair..."
      style="
        padding:14px 18px;
        width:320px;
        max-width:90%;
        border-radius:12px;
        border:none;
        outline:none;
        background:rgba(255,255,255,0.07);
        color:#fff;
        font-size:16px;
        text-align:center;
      "
    />
  </div>

  <!-- MAJORS -->
  <section class="markets">
  <div class="markets-wrap">
    <div class="markets-header">
      <div>Majors</div>
      <div>Last Price</div>
      <div>24h Change</div>
      <div>Charts</div>
      <div>Market Cap</div>
      <div>24h Volume</div>
      <div></div>
    </div>

    <div id="forex-majors-rows"></div>
  </div>

  <div class="markets-footer">
    <button class="pager-btn" id="majors-prev">←</button>
    <button class="pager-btn" id="majors-next">→</button>
  </div>
</section>

  <!-- CROSSES -->
  <section class="markets">
  <div class="markets-wrap">
    <div class="markets-header">
      <div>Crosses</div>
      <div>Last Price</div>
      <div>24h Change</div>
      <div>Charts</div>
      <div>Market Cap</div>
      <div>24h Volume</div>
      <div></div>
    </div>

    <div id="forex-crosses-rows"></div>
  </div>

  <div class="markets-footer">
    <button class="pager-btn" id="crosses-prev">←</button>
    <button class="pager-btn" id="crosses-next">→</button>
  </div>
</section>

  <!-- EXOTIC -->
  <section class="markets">
  <div class="markets-wrap">
    <div class="markets-header">
      <div>Exotic</div>
      <div>Last Price</div>
      <div>24h Change</div>
      <div>Charts</div>
      <div>Market Cap</div>
      <div>24h Volume</div>
      <div></div>
    </div>

    <div id="forex-exotic-rows"></div>
  </div>

  <div class="markets-footer">
    <button class="pager-btn" id="exotic-prev">←</button>
    <button class="pager-btn" id="exotic-next">→</button>
  </div>
</section>

</section>

<!-- ===================== STOCKS PAGE ===================== -->
<section id="stocks-page" style="display:none; padding-top:120px;">

  <div style="text-align:center; margin-bottom:40px;">
    <h1 style="
      font-size: clamp(36px, 5vw, 56px);
      font-weight: 800;
      margin-bottom: 24px;
    ">
      Stock Market Today
    </h1>

    <!-- Поиск -->
    <input
      id="stocks-search"
      type="text"
      placeholder="Search stock..."
      style="
        padding:14px 18px;
        width:260px;
        max-width:90%;
        border-radius:12px;
        border:none;
        outline:none;
        background:rgba(255,255,255,0.07);
        color:#fff;
        font-size:16px;
        text-align:center;
        margin-right:10px;
      "
    />

    <!-- Фильтр по сектору -->
    <select
  id="stocks-sector-filter"
  style="
    padding:14px 18px;
    border-radius:12px;
    border:none;
    outline:none;
    background:rgba(255,255,255,0.07);
    color:#fff;
    font-size:14px;
  "
>
  <option value="">All sectors</option>
  <option value="medical_cannabis">Medical Cannabis</option>
  <option value="automobile">Automobile Industries</option>
  <option value="consumer_goods">Consumer Goods</option>
  <option value="consumer_services">Consumer Services</option>
  <option value="healthcare">Healthcare</option>
  <option value="finance">Finance</option>
  <option value="energy">Energy</option>
  <option value="industrials">Industrials</option>
  <option value="luxury">Luxury</option>
  <option value="telecommunications">Telecommunications</option>
  <option value="technologies">Technologies</option>
  <option value="materials">Materials</option>
</select>
  </div>

  <section class="markets">
    <div class="markets-wrap">

      <div class="markets-header">
        <div>Stock</div>
        <div>Last Price</div>
        <div>24h Change</div>
        <div>Charts</div>
        <div>Market Cap</div>
        <div>24h Volume</div>
        <div></div>
      </div>

      <div id="stocks-rows"></div>
    </div>

    <div class="markets-footer">
      <button class="pager-btn" id="stocks-prev">←</button>
      <button class="pager-btn" id="stocks-next">→</button>
    </div>
  </section>

</section>

</div>

<section id="signup-page" class="signup-page" style="display:none;">
  <div class="signup-card">
    <h1 class="signup-title">Create an Account</h1>

    <form id="signup-form">
      <div class="signup-field" data-mode="email">
        <input type="email" name="email" placeholder="Please enter email" required />
      </div>

      <div class="signup-field" data-mode="email">
        <input type="password" name="password" placeholder="Please enter a password" required />
      </div>

      <div class="signup-field optional">
        <label>Referral Code (Optional)</label>
        <input type="text" name="referralCode" placeholder="Enter referral code" />
      </div>

      <label class="signup-checkbox">
        <input type="checkbox" name="agree" required />
        <span>I have read and agree to the Customer Agreement and Privacy Policy</span>
      </label>

      <button type="submit" class="signup-btn" id="signup-submit" disabled>Sign Up</button>

      <!-- <div class="signup-or">
        <span></span>Or<span></span>
      </div>

      <button type="button" class="signup-social google">
        Continue with Google
      </button>
      <button type="button" class="signup-social apple">
        Continue with Apple
      </button> -->

      <div class="signup-footer">
        Already have an account?  <a href="#" id="link-open-login">Log in</a>
      </div>
    </form>
  </div>
</section>

<div id="verification-modal" class="modal-backdrop">
  <div class="modal-card">
    <div class="modal-header">
      <div class="modal-title">Security Verification</div>
      <button class="modal-close" id="modal-close-btn">×</button>
    </div>
    <div class="modal-body">
      <p id="modal-email-text">
        The code has been sent to your email.
      </p>
      <input
        id="verification-code"
        class="modal-input"
        placeholder="Enter"
      />
      <div class="modal-timer" id="modal-timer">60s</div>
      <button class="modal-confirm" id="modal-confirm-btn">Confirm</button>
    </div>
  </div>
</div>

<!-- ===== LOGIN PAGE ===== -->
<section id="login-page" class="signup-page" style="display: none;">
  <div class="signup-card">
    <h2 class="signup-title">Welcome Back</h2>

    <form id="login-form">
      <div class="signup-field">
        <input
          type="email"
          id="login-email"
          placeholder="Please enter email"
          required
        />
      </div>

      <div class="signup-field">
        <input
          type="password"
          id="login-password"
          placeholder="Enter a password of 8 to 30 characters"
          minlength="8"
          maxlength="30"
          required
        />
      </div>

      <div style="text-align: right; font-size: 12px; margin-bottom: 14px;">
        <a href="#" style="color:#2b7aff; text-decoration:none;" id="link-forgot-password">Forgot Password</a>
      </div>

      <button type="submit" class="signup-btn">Welcome Back</button>

      <!-- <div class="signup-or">
        <span></span>
        <div>Or</div>
        <span></span>
      </div>

      <button type="button" class="signup-social">
        Continue with Google
      </button>
      <button type="button" class="signup-social">
        Continue with Apple
      </button> -->

      <div class="signup-footer">
        No Account?
        <a href="#" id="link-open-signup-from-login">Sign Up</a>
      </div>
    </form>
  </div>
</section>

<!-- ===== RESET PASSWORD STEP 1 ===== -->
<section id="reset-email-page" class="signup-page" style="display:none;">
  <div class="signup-card">
    <h2 class="signup-title">Reset Password</h2>

    <div class="signup-field">
      <input type="email" id="reset-email" placeholder="Please enter email">
    </div>

    <button class="signup-btn" id="reset-next-btn">Next</button>

    <div class="signup-footer">
      <a href="#" id="reset-back-to-login">Login with password</a>
    </div>
  </div>
</section>

<!-- ===== RESET PASSWORD STEP 2 ===== -->
<section id="reset-confirm-page" class="signup-page" style="display:none;">
  <div class="auth-card">
    <h1 style="font-size:44px; font-weight:800;">Reset Login Password</h1>

    <div style="margin-top:20px;">
      <div style="color:#9aa0a6; margin-bottom:8px;">New Password</div>
      <input id="reset-new-pass" type="password" placeholder="Enter" class="auth-input" />
    </div>

    <div style="margin-top:16px;">
      <div style="color:#9aa0a6; margin-bottom:8px;">Confirm Password</div>
      <input id="reset-new-pass2" type="password" placeholder="Enter" class="auth-input" />
    </div>

    <div style="margin-top:16px;">
      <div style="color:#9aa0a6; margin-bottom:8px;">Email Verification</div>

      <div style="display:flex; gap:12px;">
        <input id="reset-code" type="text" placeholder="Enter" class="auth-input" style="flex:1;" />
        <button id="reset-get-code" class="auth-btn" style="width:160px;">Get Code</button>
      </div>
    </div>

    <button id="reset-confirm-btn" class="auth-btn" style="margin-top:24px;">Confirm</button>
  </div>
</section>

<section id="about-page" style="display:none; padding-top:120px;">
  <div class="about-wrap">

  <!-- 1) About ArsteX (по центру) -->
  <section class="about-hero">
    <h1 class="about-title">About ArsteX</h1>

    <p class="about-hero-text">
      Founded in 2020, ArsteX is a leading crypto exchange, serving a global community of over 20 million users.
      With a comprehensive suite of and services, including  spot trading, futures, forex, and stocks trading, ArsteX caters
      to the evolving needs of users across all experience levels, from beginners to professionals.
    </p>

  </section>

  <!-- 2) Empowering Traders -->
  <section class="about-block about-split">
    <div class="about-left">
      <h2 class="about-h2">Empowering<br/>Traders<span class="dot">.</span></h2>
      <p class="about-p">
        We are here to provide a user-first platform for swift and seamless crypto trading, empowering traders to stretch their trading skills and
        accomplish more with cryptocurrencies. Our goal is to inspire and keep them ahead of the curve, facilitating secure, efficient, and effective trading.
      </p>
    </div>
    <div class="about-right"></div>
  </section>

  <!-- 3) Shield Fund -->
  <section class="about-block about-split">
    <div class="about-left">
      <h2 class="about-h2">Shield Fund<span class="dot">.</span></h2>
      <p class="about-p">
        ArsteX Shield Fund is a safety net exceeding $150 million, established to safeguard users against unexpected incidents, including technical vulnerabilities,
        security risks, or malicious cyber threats on the platform.
      </p>
      <p class="about-p">
        Fully self-funded and always active, it reflects ArsteX’s long-term commitment to transparency, safety, and putting users first across its trading ecosystem.
      </p>
    </div>
    <div class="about-right"></div>
  </section>

  <!-- 4) Reliable & Trustworthy + 2 карточки -->
  <section class="about-block about-center">
    <h2 class="about-h2-center">Reliable &amp; Trustworthy</h2>
    <p class="about-sub">
      Verified by global authorities, we hold a 100% Proof of Reserves (PoR) certification, backed by a publicly released audit report.
      In collaboration with leading cybersecurity organizations, we’ve successfully passed security audits conducted by top security-focused ranking platforms.
    </p>

    <div class="about-cards">
      <div class="about-card">
        <div class="about-card-title">Mission</div>
        <div class="about-card-text">
          We are committed to providing a trustworthy and transparent platform, making crypto accessible and friendly to everyone.
        </div>
        <div class="about-art mission-art"></div>
      </div>

      <div class="about-card">
        <div class="about-card-title">Vision</div>
        <div class="about-card-text">
          We aim to build a gateway for the next billion crypto users.
        </div>
        <div class="about-art vision-art"></div>
      </div>
    </div>
  </section>

  <!-- 5) ArsteX Values -->
  <section class="about-block about-center">
    <h2 class="about-h2-center">ArsteX Values<span class="dot">.</span></h2>

    <div class="values-grid">
      <div class="value-item">
        <div class="value-icon">
  <img src="img/icons/user.png" alt="">
</div>
        <div>
          <div class="value-title">User-First</div>
          <div class="value-text">We prioritize our users in everything we do, enabling them to constantly stay ahead and do more with crypto.</div>
        </div>
      </div>

      <div class="value-item">
        <div class="value-icon">
  <img src="img/icons/shit.png" alt="">
</div>
        <div>
          <div class="value-title">Reliable</div>
          <div class="value-text">We are committed to providing a secure platform with 100% user asset protection and 24/7 global support.</div>
        </div>
      </div>

      <div class="value-item">
        <div class="value-icon">
  <img src="img/icons/lampa.png" alt="">
</div>
        <div>
          <div class="value-title">Innovative</div>
          <div class="value-text">We continually innovate and introduce new features and strategies to elevate user's trading proficiency.</div>
        </div>
      </div>

      <div class="value-item">
        <div class="value-icon">
  <img src="img/icons/plus.png" alt="">
</div>
        <div>
          <div class="value-title">Diversified</div>
          <div class="value-text">We provide a comprehensive range of products and services to users of all levels, from beginners to professionals.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- 6) 24/7 Customer Service -->
  <section class="about-block about-split service-split">
    <div class="about-left">
      <h2 class="about-h2">24/7 Customer<br/>Service</h2>
      <p class="about-p">
        Our customer service executives are always ready and glad to answer any questions. Please feel free to contact our customer support at
        <span class="about-link">support@ArsteX.com</span>. For immediate assistance, you can start a conversation via the live chat widget.
      </p>
    </div>

    <div class="about-right service-illustration">
      <div class="service-box">
        <div class="service-badge">24/7</div>
        <div class="service-line"></div>
      </div>
    </div>
  </section>

</div>

</section>

<!-- ===== NEWS PAGE ===== -->
<section id="news-page" style="display:none; padding-top:120px;">
  <div class="about-wrap">
    <section class="about-hero">
      <h1 class="about-title">News</h1>
      <p class="about-hero-text">
        Latest ArsteX updates, product announcements and platform news.
      </p>
    </section>

    <section class="about-block about-center" style="margin-top:60px;">
      <div class="about-cards" style="grid-template-columns: 1fr;">
        <div class="about-card" style="text-align:left;">
          <div class="about-card-title">Coming soon</div>
          <div class="about-card-text" style="max-width:none;">
            Add your news posts here (cards or a list).
          </div>
        </div>
      </div>
    </section>
  </div>
</section>

<!-- ===== BLOG PAGE ===== -->
<section id="blog-page" style="display:none; padding-top:120px;">
  <div class="about-wrap">
    <section class="about-hero">
      <h1 class="about-title">Blog</h1>
      <p class="about-hero-text">
        Trading education, guides and insights from ArsteX.
      </p>
    </section>

    <section class="about-block about-center" style="margin-top:60px;">
      <div class="about-cards" style="grid-template-columns: 1fr;">
        <div class="about-card" style="text-align:left;">
          <div class="about-card-title">Coming soon</div>
          <div class="about-card-text" style="max-width:none;">
            Add your blog posts here (cards or articles list).
          </div>
        </div>
      </div>
    </section>
  </div>
</section>

<!-- ===== SUPPORT: 24/7 CHAT ===== -->
<section id="chat-page" style="display:none; padding-top:120px;">
  <div class="about-wrap">
    <section class="about-hero">
      <h1 class="about-title">24/7 Chat Support</h1>
      <p class="about-hero-text">Support is available 24/7.</p>
    </section>
    <section class="about-block about-center" style="margin-top:60px;">
      <div class="about-cards" style="grid-template-columns: 1fr;">
        <div class="about-card" style="text-align:left;">
          <div class="about-card-title">Coming soon</div>
          <div class="about-card-text" style="max-width:none;">
            Add chat widget or support instructions here.
          </div>
        </div>
      </div>
    </section>
  </div>
</section>

<!-- ===== SUPPORT: FEEDBACK ===== -->

<!-- ===== SUPPORT: FEEDBACK ===== -->

<section id="feedback-page" class="feedback-page" style="display:none;">
  <div class="feedback-container">
    <div class="about-wrap">
      <section class="about-hero">
        <h1 class="about-title">Feedback</h1>
        <p class="about-hero-text">Tell us what to improve.</p>
      </section>

      <section class="about-block about-center feedback-block">
        <div class="about-card" style="text-align:left;">
          <form id="feedback-form">
  <div class="signup-field">
    <div class="ax-select" data-name="businessType">
  <button type="button" class="ax-select-btn">
    <span class="ax-select-value">Select Business Type</span>
    <span class="ax-select-arrow">▾</span>
  </button>

  <div class="ax-select-menu">
    <button type="button" class="ax-select-opt" data-value="Retail">Retail</button>
    <button type="button" class="ax-select-opt" data-value="Restaurant">Restaurant</button>
    <button type="button" class="ax-select-opt" data-value="Service">Service</button>
    <button type="button" class="ax-select-opt" data-value="Other">Other</button>
  </div>

  <!-- скрытое поле для отправки формы -->
  <input type="hidden" name="businessType" required />
</div>

  </div>

  <div class="signup-field">
    <textarea name="description" required placeholder="Write your suggestion..."></textarea>
  </div>

  <div class="signup-field">
    <label class="file-upload">
  <input type="file" name="media" accept="image/*,video/*" hidden>
  <span class="file-upload-btn">+</span>
  <span class="file-upload-text">Image / Video</span>
</label>
  </div>

  <button type="submit" class="signup-btn">Submit</button>
</form>

        </div>
      </section>
    </div>
  </div>
</section>

<!-- ===== SUPPORT: TRADING FEES ===== -->
<section id="fees-page" style="display:none; padding-top:120px;">
  <div class="about-wrap">
    <section class="about-hero">
      <h1 class="about-title">Trading Fees</h1>
      <p class="about-hero-text">Fee schedule and VIP tiers.</p>
    </section>
    <section class="about-block about-center" style="margin-top:60px;">
      <div class="about-cards" style="grid-template-columns: 1fr;">
        <div class="about-card" style="text-align:left;">
          <div class="fees-table-wrap">
  <table class="fees-table">
    <thead>
      <tr>
        <th>Level</th>
        <th>Taker</th>
        <th>Maker</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>VIP 0</td><td>0.1000%</td><td>0.1000%</td></tr>
      <tr><td>VIP 1</td><td>0.0600%</td><td>0.0350%</td></tr>
      <tr><td>VIP 2</td><td>0.0500%</td><td>0.0200%</td></tr>
      <tr><td>VIP 3</td><td>0.0450%</td><td>0.0150%</td></tr>
      <tr><td>VIP 4</td><td>0.0375%</td><td>0.0125%</td></tr>
      <tr><td>VIP 5</td><td>0.0325%</td><td>0.0100%</td></tr>
      <tr><td>Supreme VIP</td><td>0.0200%</td><td>0.0050%</td></tr>
    </tbody>
  </table>
</div>
        </div>
      </div>
    </section>
  </div>
</section>

<!-- ===== TERMS: CUSTOMER AGREEMENT ===== -->
<section id="agreement-page" style="display:none; padding-top:120px;">
  <div class="about-wrap">
    <section class="about-hero">
      <h1 class="about-title">Customer Agreement</h1>
      <p class="about-hero-text">Terms of service for using ArsteX.</p>
    </section>
    <section class="about-block about-center" style="margin-top:60px;">
      <div class="about-cards" style="grid-template-columns: 1fr;">
        <div class="about-card" style="text-align:left;">
          <div class="about-card-title">Coming soon</div>
          <div class="about-card-text" style="max-width:none;">
            Paste your agreement text here.
          </div>
        </div>
      </div>
    </section>
  </div>
</section>

<!-- ===== TERMS: PRIVACY POLICY ===== -->
<section id="privacy-page" style="display:none; padding-top:120px;">
  <div class="about-wrap">
    <section class="about-hero">
      <h1 class="about-title">Privacy Policy</h1>
      <p class="about-hero-text">How we collect and use data.</p>
    </section>
    <section class="about-block about-center" style="margin-top:60px;">
      <div class="about-cards" style="grid-template-columns: 1fr;">
        <div class="about-card" style="text-align:left;">
          <div class="about-card-textabout-card-text risk-text" style="max-width:none;">
            <h2>Definition</h2>

  <h3>Virtual Financial Asset</h3>
  <p>
    As used herein, “Virtual Financial Asset”, also called “convertible virtual
    currency”, “cryptocurrency” or “digital goods”, such as bitcoin or ether,
    which is based on the cryptographic protocol of a computer network that may
    be (i) centralized or decentralized, (ii) closed or open-source, and (iii)
    used as a medium of exchange and/or store of value.
  </p>

  <h3>Personal Data</h3>
  <p>
    As used herein, “Personal Data” means any information relating to an
    identified or identifiable natural person, such as a name, an identification
    number, location data, an online identifier or to one or more factors
    specific to the physical, economic, cultural or social identity of you as a
    natural person.
  </p>

  <h2>WHAT PERSONAL DATA WE COLLECT</h2>
  <p>
    <b>ArsteX</b> collects, processes, and stores Personal Data collected from you
    via your use of the Service or where you have given your consent. This
    Personal Data may include contact details, copies of identification
    documentation provided by you or derived from publicly accessible databases,
    your government identification number, as well as information relating to
    your device or internet service (such as an IP address and a MAC number).
  </p>

  <p>
    Operating within certain regulated jurisdictions around the world,
    <b>ArsteX</b> collects, stores, and processes your Personal Data in accordance
    with applicable regulations and aims for the highest standards of compliance.
  </p>

  <p>
    We collect information provided during the <b>ArsteX</b> onboarding process,
    including completed, incomplete, or abandoned registrations. We also
    collect Personal Data through customer support communications and marketing
    subscriptions.
  </p>

  <h3>Individual customers</h3>
  <ul>
    <li>Email address</li>
    <li>Phone number</li>
    <li>Full legal name</li>
    <li>Nationality</li>
    <li>Passport or government-issued ID number</li>
    <li>Date of birth</li>
    <li>Proof of identity</li>
    <li>Residential address</li>
    <li>IP address and device ID</li>
  </ul>

  <h3>Corporate customers</h3>
  <ul>
    <li>Corporate legal name</li>
    <li>Incorporation or registration information</li>
    <li>Beneficial owners and directors</li>
    <li>Business address</li>
    <li>Description of business activities</li>
    <li>Ownership structure</li>
    <li>Source of wealth</li>
    <li>Projected asset injections</li>
  </ul>

  <h2>COLLECTION AND TRANSFER OF DATA OUTSIDE OF YOUR JURISDICTION</h2>
  <p>
    By using the Services, you consent to the transfer of Personal Data outside
    your jurisdiction. If you decline such consent, you will no longer be able
    to use the <b>ArsteX</b> platform, except for withdrawing your digital assets.
  </p>

  <h2>HOW WE USE YOUR PERSONAL DATA</h2>
  <p>
    <b>ArsteX</b> uses Personal Data to administer, improve, and personalize the
    Services, communicate with users, and ensure regulatory compliance.
  </p>

  <p>
    Personal Data may be shared with third parties to:
  </p>
  <ul>
    <li>Enforce Terms of Service</li>
    <li>Comply with legal or regulatory obligations</li>
    <li>Provide operational or technical services</li>
    <li>Support business transfers or restructuring</li>
  </ul>

  <h2>HOW WE STORE YOUR PERSONAL DATA</h2>
  <p>
    <b>ArsteX</b> implements physical, electronic, and administrative safeguards
    to protect Personal Data, including encryption, access controls, and staff
    training.
  </p>

  <p>
    Despite our efforts, no system can guarantee 100% security. Users are
    responsible for taking appropriate safety precautions.
  </p>

  <h2>ACCESS, CORRECTION, AND DELETION OF YOUR PERSONAL DATA</h2>
  <p>
    You may request access to, correction of, or deletion of your Personal Data
    by contacting <b>support@ArsteX.com</b> with the subject “DATA INQUIRY”.
  </p>

  <p>
    Requests will be processed only after proper identity verification. Due to
    operational and jurisdictional constraints, response times cannot be
    guaranteed.
  </p>

  <h2>MARKETING</h2>
  <p>
    <b>ArsteX</b> may send marketing communications related to products and
    services. You may opt out at any time by contacting
    <b>support@ArsteX.com</b>.
  </p>

  <h2>COOKIE USAGE</h2>
  <p>
    Cookies may be used to improve user experience, enhance security, and ensure
    regulatory compliance. Disabling cookies may limit platform functionality.
  </p>

  <h2>CONTACTING ArsteX ABOUT PRIVACY</h2>
  <p>
    If you have questions regarding this Privacy Policy, please contact
    <b>support@ArsteX.com</b> with the subject “PRIVACY REQUEST”.
  </p>

  <h2>CHANGES TO OUR PRIVACY POLICY</h2>
  <p>
    Updates to this Privacy Policy will be posted on this page. Continued use of
    the Services constitutes acceptance of any changes.
  </p>
          </div>
        </div>
      </div>
    </section>
  </div>
</section>

<!-- ===== TERMS: DISCLAIMER ===== -->
<section id="disclaimer-page" style="display:none; padding-top:120px;">
  <div class="about-wrap">
    <section class="about-hero">
      <h1 class="about-title">Disclaimer</h1>
      <p class="about-hero-text">Important legal information.</p>
    </section>
    <section class="about-block about-center" style="margin-top:60px;">
      <div class="about-cards" style="grid-template-columns: 1fr;">
        <div class="about-card" style="text-align:left;">
          <div class="about-card-textabout-card-text risk-text" style="max-width:none;">
            <h2>PURPOSE OF OUR PROGRAM</h2>
  <p>
    We have established and implemented an Anti-Money Laundering, Anti-Terrorist
    Financing, and Trade & Economic Sanctions Program to ensure a robust and
    compliant digital asset trading platform. We want to promote legal,
    transparent business activities and maintain a strong reputation among our
    customers, regulators, and the digital asset industry.
  </p>

  <h2>REGULATORY LANDSCAPE</h2>
  <p>
    We understand that regulatory bodies have taken a diverse approach to the laws
    and regulations regarding digital assets, including some characterizing or
    defining digital assets as a virtual financial asset (by Malta), convertible
    virtual currency (by USA FinCEN), or virtual commodity (by Hong Kong).
  </p>
  <p>
    As a trading platform, we believe that all digital assets available on
    <b>ArsteX</b> are an innovative alternative asset class; therefore, digital
    assets should not be called currency or money.
  </p>

  <h2>DISCLOSURE</h2>
  <p>
    Digital assets are not fiat money nor fiat currency. Digital assets are
    <b>NOT</b> backed by any government or central bank.
  </p>
  <p>
    We may at times have opinions on the different regulatory approaches taken by
    various government bodies; however, at all times, we will fully abide by the
    rules and regulations of the respective countries we operate in. We regularly
    communicate with regulators and industry on the best approach to regulating
    digital asset businesses.
  </p>
  <p>
    We cooperate with governments and respect and comply with applicable
    regulations. As good corporate citizens, we may be asked to provide
    information to law enforcement authorities and will assist if permissible by
    law.
  </p>
  <p>
    Furthermore, <b>ArsteX</b> does not accept certain customers. To maintain a
    strong reputation and ensure a compliant marketplace, we do not accept users
    from certain jurisdictions.
  </p>

  <h2>OUR AML / ATF PROGRAM</h2>
  <p>
    We have designed our Program to be anti-money laundering (AML) and
    anti-terrorist financing (ATF) through a risk-based and multi-layer control
    system.
  </p>

  <p><b>First Layer:</b> Customer identification and verification, including
    beneficial owners in line with FATF standards.</p>

  <p><b>Second Layer:</b> Risk-based due diligence, including screening against
    sanctions lists such as OFAC, UN Security Council, and other regulatory lists.</p>

  <p><b>Third Layer:</b> Ongoing monitoring and reporting of suspicious activity
    to local regulators.</p>

  <h2>RISKS</h2>
  <p>
    Trading digital assets is highly risky. Digital assets are <b>NOT</b> backed
    by any government or central bank. Losses may be substantial.
  </p>

  <h2>LIABILITY</h2>

  <h3>6.1 Disclaimer of Warranties</h3>
  <p>
    All services provided via the <b>ArsteX</b> platform shall be collectively
    referred to as the “Services”.
  </p>
  <p>
    TO THE MAXIMUM EXTENT PERMITTED BY LAW, THE SERVICES ARE PROVIDED ON AN “AS IS”
    AND “AS AVAILABLE” BASIS.
  </p>
  <p>
    <b>ArsteX</b> DISCLAIMS ALL WARRANTIES, INCLUDING IMPLIED WARRANTIES OF
    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT.
  </p>

  <h3>6.2 Disclaimer of Damages and Limitation of Liability</h3>
  <p>
    TO THE MAXIMUM EXTENT PERMITTED BY LAW, <b>ArsteX</b> SHALL NOT BE LIABLE FOR ANY
    INDIRECT, INCIDENTAL, SPECIAL, OR CONSEQUENTIAL DAMAGES.
  </p>
  <p>
    TOTAL LIABILITY SHALL NOT EXCEED THE FEES PAID BY YOU TO <b>ArsteX</b> DURING
    THE TWELVE (12) MONTHS PRECEDING THE CLAIM.
  </p>
          </div>
        </div>
      </div>
    </section>
  </div>
</section>

<!-- ===== TERMS: RISK NOTICE ===== -->
<section id="risk-page" style="display:none; padding-top:120px;">
  <div class="about-wrap">
    <section class="about-hero">
      <h1 class="about-title">Risk Notice</h1>
      <p class="about-hero-text">Trading involves risk. Read carefully.</p>
    </section>
    <section class="about-block about-center" style="margin-top:60px;">
      <div class="about-cards" style="grid-template-columns: 1fr;">
        <div class="about-card" style="text-align:left;">
          <div class="about-card-textabout-card-text risk-text" style="max-width:none;">
             <h2>Financial Risks</h2>

  <h3>1.1 Trading Risk</h3>
  <p>
    You use the Services at your own risk, including but not limited to Spot and
    Derivatives services provided by <b>ArsteX</b>. There can be no assurance that the
    use of the Services will generate a positive return or profit, that significant
    losses will not be incurred, or that your objectives will be achieved.
  </p>

  <p>
    All contracts traded on the Trading Platform are margined and settled using
    digital assets, such as BTC and stablecoins.
  </p>

  <p>
    Contracts traded on the Trading Platform are derivative contracts of high
    financial risk and require sufficient relevant experience. You should only
    fund your own wallet and trade with digital assets that you own and can afford
    to lose. It is possible that you may lose a substantial proportion or all of
    your capital.
  </p>

  <p>
    The Trading Platform is designed to ensure that the maximum risk associated
    with any user’s position shall not exceed the amount of digital assets
    allocated to that position. If a position is liquidated, the digital assets
    allocated as margin may be lost, up to the entire account balance.
  </p>

  <h3>1.2 Price Volatility</h3>
  <p>
    The price of digital assets can be highly unpredictable and volatile when
    compared to other assets such as stocks, bonds, and other tradeable
    instruments.
  </p>

  <p>
    You should not deal in digital asset derivatives unless you fully understand
    their nature and the extent of your exposure to risk. Fees and spreads may
    further increase volatility.
  </p>

  <h3>1.3 Liquidity Risk</h3>
  <p>
    Digital asset derivatives may be less liquid, more volatile, and more
    vulnerable to economic, political, regulatory, and market changes than other
    derivative products.
  </p>

  <p>
    A lack of liquidity may result in delayed order execution or unfilled orders,
    particularly for large trades.
  </p>

  <h3>1.4 Asset Deposit and Withdrawal Risk</h3>
  <p>
    You are responsible for ensuring that the correct address is used for any
    deposit, withdrawal, or transfer and that the digital asset is supported by
    <b>ArsteX</b>. Any error may result in a total and irreversible loss of assets.
  </p>

  <p>
    Digital assets will only be credited to your account after sufficient block
    confirmations, according to <b>ArsteX</b> policies. <b>ArsteX</b> reserves the
    right to determine whether any transfer will be credited.
  </p>

  <ul>
    <li>Network congestion or high demand</li>
    <li>Insufficient network transaction fees</li>
    <li>Technical or system-related issues</li>
    <li>Suspicious activity or breach of Terms of Service</li>
  </ul>

  <p>
    Blockchain protocols may undergo changes such as forks, rollbacks, or attacks.
    <b>ArsteX</b> does not guarantee support for such events, which may result in
    partial or total loss of assets.
  </p>

  <h3>1.5 Information Accuracy Risk</h3>
  <p>
    While <b>ArsteX</b> endeavours to provide accurate and up-to-date information,
    such information may not always be complete, current, or accurately
    translated.
  </p>

  <h2>Regulatory Risk</h2>

  <h3>2.1 General Regulatory Risk</h3>
  <p>
    The regulatory framework governing digital assets is evolving and remains
    uncertain. Future regulatory changes may adversely affect digital assets or
    the Services provided by <b>ArsteX</b>.
  </p>

  <p>
    Regulatory actions may restrict access to the Trading Platform based on
    jurisdiction, potentially impacting asset liquidity and pricing.
  </p>

  <p>
    You are solely responsible for ensuring compliance with all applicable local
    laws and regulations. <b>ArsteX</b> does not provide legal, regulatory, or tax
    advice.
  </p>

  <h2>Cyber Risks</h2>

  <h3>3.1 Risks Related to Cybersecurity</h3>
  <p>
    Malicious actors may attempt to compromise the <b>ArsteX</b> Trading Platform
    through cyberattacks such as malware, denial-of-service attacks, account
    takeovers, or fraudulent transactions.
  </p>

  <p>
    Cyber incidents may result in loss of data, service disruption, or financial
    loss. Failures of third-party service providers may also negatively affect
    the Services.
  </p>

  <p>
    You are responsible for safeguarding your access credentials and ensuring the
    security of the systems you use to access the Services.
  </p>

  <h3>3.2 Platform IT Maintenance Risk</h3>
  <p>
    <b>ArsteX</b> may conduct scheduled or unscheduled maintenance, which may
    result in temporary downtime and restricted access to the Trading Platform.
  </p>

  <h2>Access Risk</h2>
  <p>
    Use of web or mobile trading technology involves risks such as latency,
    connectivity issues, or inaccurate price displays.
  </p>

  <p>
    <b>ArsteX</b> is not liable for delays or trading limitations caused by network
    issues, mobile connectivity, or third-party service providers.
  </p>

  <p>
    Users are responsible for maintaining updated versions of <b>ArsteX</b>
    applications. Use on modified or unsupported operating systems may result in
    security or performance risks.
  </p>
          </div>

        </div>
      </div>
    </section>
  </div>
</section>

<!-- ===== CABINET / DASHBOARD ===== -->

<section id="cabinet-page" class="cabinet-page">
  <div class="cabinet-inner">

    <div class="cabinet-layout">
      <aside class="cabinet-sidebar">
        <nav class="cabinet-nav" id="cabinet-nav">

    <a href="#" class="active" data-tab="overview" onclick="openCabinetTab('overview'); return false;">
      <span class="cabinet-ic" aria-hidden="true">
        <!-- clock -->
        <svg viewBox="0 0 24 24"><path d="M12 8v5l3 2M12 2a10 10 0 1 0 0 20a10 10 0 0 0 0-20Z"/></svg>
      </span>
      Overview
    </a>

    <a href="#" data-tab="spot" onclick="openCabinetTab('spot'); return false;">
      <span class="cabinet-ic" aria-hidden="true">
        <!-- target -->
        <svg viewBox="0 0 24 24"><path d="M12 8a4 4 0 1 0 4 4M12 2a10 10 0 1 0 10 10M12 12h.01"/></svg>
      </span>
      Spot Account
    </a>

    <a href="#" data-tab="copy" onclick="openCabinetTab('copy'); return false;">
      <span class="cabinet-ic" aria-hidden="true">
        <!-- document -->
        <svg viewBox="0 0 24 24"><path d="M8 3h7l3 3v15H8zM11 10h6M11 14h6M11 18h6"/></svg>
      </span>
      Forex Account
    </a>

    <a href="#" data-tab="bots" onclick="openCabinetTab('bots'); return false;">
      <span class="cabinet-ic" aria-hidden="true">
        <!-- bot -->
        <svg viewBox="0 0 24 24"><path d="M12 3v2M7 7h10a4 4 0 0 1 4 4v6a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4v-6a4 4 0 0 1 4-4ZM8 13h.01M16 13h.01"/></svg>
      </span>
      Stocks Account
    </a>

    <div class="divider"></div>

    <a href="#" data-tab="records" onclick="openCabinetTab('records'); return false;">
      <span class="cabinet-ic" aria-hidden="true">
        <!-- folder -->
        <svg viewBox="0 0 24 24"><path d="M3 7h6l2 2h10v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z"/></svg>
      </span>
      Asset Records
    </a>

  </nav>
      </aside>

      <main id="cabinet-content">
  <!-- TAB: OVERVIEW -->
  <section class="cabinet-tab is-active" data-tab-panel="overview">
    <h1 class="overview-title">Overview</h1>

    <div class="fund-card">
      <div class="fund-label">Total Assets</div>

      <div class="fund-value">
        <span class="fund-amt" data-acct="overview">0.00</span>
      </div>

      <div class="fund-sub">≈ $<span class="fund-usd-amt" data-usd-for="overview">0.00</span></div>

      <div class="fund-pnl">
        Today's PnL <span class="fund-pnl-up">+$0.00 (+0.00%)</span>
      </div>

      <div class="fund-actions">
        <button class="fund-btn primary">Deposit</button>
        <button class="fund-btn">Withdraw</button>
      </div>
    </div>

    <!-- НОВЫЙ БЛОК НИЖЕ -->
    <div class="assets-card-simple">
      <div class="assets-card-head">
        <div class="assets-card-title">My Assets</div>
        <div class="assets-card-sub">No assets to display</div>
      </div>

      <div class="assets-card-body">
        <div class="assets-empty">—</div>
      </div>
    </div>
  </section>

  <!-- TAB: SPOT -->
  <section class="cabinet-tab" data-tab-panel="spot">
    <h1 class="overview-title">Spot Account</h1>

    <div class="fund-card">
      <div class="fund-label">Total Assets</div>

      <div class="fund-value">
  <span class="fund-amt" data-acct="spot">0.00</span> <span class="fund-unit">USDT</span>
</div>

      <div class="fund-sub">≈ $<span class="fund-usd-amt" data-usd-for="spot">0.00</span></div>

      <div class="fund-pnl">
        Today's PnL <span class="fund-pnl-up">+$0.00 (+0.00%)</span>
      </div>

      <div class="fund-actions">
        <button class="fund-btn primary">Deposit</button>
        <button class="fund-btn">Withdraw</button>
        <button type="button" class="fund-btn" data-transfer-open data-from="spot">Transfer</button>
        <button class="fund-btn">Convert</button>
      </div>
    </div>

    <!-- НОВЫЙ БЛОК НИЖЕ -->
    <div class="assets-card-simple">
      <div class="assets-card-head">
        <div class="assets-card-title">My Assets</div>
        <div class="assets-card-sub">No assets to display</div>
      </div>

      <div class="assets-card-body">
        <div class="assets-empty">—</div>
      </div>
    </div>
  </section>

  <!-- TAB: FUTURES -->
 

  <!-- TAB: FOREX -->
  <section class="cabinet-tab" data-tab-panel="copy">
    <h1 class="overview-title">Forex Account</h1>

    <div class="fund-card">
      <div class="fund-label">Total Assets</div>

      <div class="fund-value">
        <span class="fund-amt" data-acct="forex">0.00</span> <span class="fund-unit">USD</span>
      </div>

      <div class="fund-sub">≈ $<span class="fund-usd-amt" data-usd-for="forex">0.00</span></div>

      <div class="fund-pnl">
        Today's PnL <span class="fund-pnl-up">+$0.00 (+0.00%)</span>
      </div>

      <div class="fund-actions">
        <button type="button" class="fund-btn" data-transfer-open data-from="forex">Transfer</button>
      </div>
    </div>

    <!-- НОВЫЙ БЛОК НИЖЕ -->
    <div class="assets-card-simple">
      <div class="assets-card-head">
        <div class="assets-card-title">Positions</div>
        <div class="assets-card-sub">No assets to display</div>
      </div>

      <div class="assets-card-body">
        <div class="assets-empty">—</div>
      </div>
    </div>
  </section>

  <!-- TAB: STOCKS -->
  <section class="cabinet-tab" data-tab-panel="bots">
    <h1 class="overview-title">Stocks Account</h1>

    <div class="fund-card">
      <div class="fund-label">Total Assets</div>

      <div class="fund-value">
        <span class="fund-amt" data-acct="stocks">0.00</span> <span class="fund-unit">USD</span>
      </div>

      <div class="fund-sub">≈ $<span class="fund-usd-amt" data-usd-for="stocks">0.00</span></div>

      <div class="fund-pnl">
        Today's PnL <span class="fund-pnl-up">+$0.00 (+0.00%)</span>
      </div>

      <div class="fund-actions">
        <button type="button" class="fund-btn" data-transfer-open data-from="stocks">Transfer</button>
      </div>
    </div>

    <!-- НОВЫЙ БЛОК НИЖЕ -->
    <div class="assets-card-simple">
      <div class="assets-card-head">
        <div class="assets-card-title">Positions</div>
        <div class="assets-card-sub">No assets to display</div>
      </div>

      <div class="assets-card-body">
        <div class="assets-empty">—</div>
      </div>
    </div>
  </section>

  <!-- TAB: RECORDS -->
  <section class="cabinet-tab" data-tab-panel="records">
    <div class="records-tabs">
    <button class="records-tab active" data-tab="overview">Overview</button>
    <button class="records-tab" data-tab="deposit">Deposit</button>
    <button class="records-tab" data-tab="withdraw">Withdraw</button>
  </div>

  <!-- Filters -->
  <div class="records-filters">
    <select id="filter-type">
    <option value="all">Overall</option>
    <option value="deposit">Deposit</option>
    <option value="withdraw">Withdraw</option>
  </select>

    <select id="filter-time">
    <option value="7">Past 7 days</option>
    <option value="30" selected>Past 30 days</option>
    <option value="90">Past 90 days</option>
  </select>

    <select id="filter-coin">
    <option value="all">All</option>
    <option value="USDT">USDT</option>
    <option value="BTC">BTC</option>
    <option value="ETH">ETH</option>
  </select>

    <button class="filter-reset" id="filter-reset">Reset</button>
  </div>

  <!-- Table -->
  <div class="records-table">
    <div class="records-head">
      <div>Time (UTC+8)</div>
      <div>Type</div>
      <div>Coin</div>
      <div>Amount</div>
      <div>Remark</div>
    </div>

    <!-- empty / demo row -->
    <div class="records-row"
     data-type="deposit"
     data-coin="USDT"
     data-time="2025-12-04T18:55:30">
  <div>2025-12-04 18:55:30</div>
  <div>Deposit</div>
  <div>USDT</div>
  <div class="positive">+14.85</div>
  <div>Completed</div>
</div>

<div class="records-row"
     data-type="withdraw"
     data-coin="USDT"
     data-time="2025-12-09T02:09:51">
  <div>2025-12-09 02:09:51</div>
  <div>Withdraw</div>
  <div>USDT</div>
  <div class="negative">-19.390622</div>
  <div>Completed</div>
</div>
  </div>
  </section>
</main>

    </div>

  </div>
</section>

<!-- ===== DEPOSIT PAGE ===== -->
<section id="deposit-page" style="display:none;">
  <div class="deposit-wrap">

    <!-- LEFT -->
    <div class="dep-steps" id="dep-steps">

      <!-- STEP 1 -->
      <div class="dep-step is-active" data-step="1">
  <div class="dep-rail">
    <div class="dep-dot active">1</div>
    <div class="dep-line"></div>
  </div>

  <div class="dep-main">
    <div class="dep-title">Select crypto</div>

    <div class="dep-select" data-select="coin">
      <button class="dep-select-btn" type="button">
        <div class="dep-sel-left">
          <!-- можно оставить кружок, но лучше убрать, пока не выбрано -->
          <span class="dep-sel-text" id="dep-coin-text" data-empty="1">Please select</span>
        </div>
        <span class="dep-arrow">▾</span>
      </button>

              <div class="dep-menu">
    <button class="dep-opt" type="button" data-value="USDT" data-icon="https://cryptologos.cc/logos/tether-usdt-logo.svg">
      <img class="coin-ic" src="https://cryptologos.cc/logos/tether-usdt-logo.svg" />
      USDT
    </button>

    <button class="dep-opt" type="button" data-value="USDC" data-icon="https://cryptologos.cc/logos/usd-coin-usdc-logo.svg">
      <img class="coin-ic" src="https://cryptologos.cc/logos/usd-coin-usdc-logo.svg" />
      USDC
    </button>

    <button class="dep-opt" type="button" data-value="BTC" data-icon="https://cryptologos.cc/logos/bitcoin-btc-logo.svg">
      <img class="coin-ic" src="https://cryptologos.cc/logos/bitcoin-btc-logo.svg" />
      BTC
    </button>

    <button class="dep-opt" type="button" data-value="ETH" data-icon="https://cryptologos.cc/logos/ethereum-eth-logo.svg">
      <img class="coin-ic" src="https://cryptologos.cc/logos/ethereum-eth-logo.svg" />
      ETH
    </button>

    <button class="dep-opt" type="button" data-value="TRX" data-icon="https://cryptologos.cc/logos/tron-trx-logo.svg">
      <img class="coin-ic" src="https://cryptologos.cc/logos/tron-trx-logo.svg" />
      TRX
    </button>
  </div>
          </div>

          <div class="dep-pills" id="dep-coin-pills">
  <button class="dep-pill" type="button" data-coin="USDT">
    <img class="coin-ic" src="https://cryptologos.cc/logos/tether-usdt-logo.svg" alt="USDT"> USDT
  </button>

  <button class="dep-pill" type="button" data-coin="USDC">
    <img class="coin-ic" src="https://cryptologos.cc/logos/usd-coin-usdc-logo.svg" alt="USDC"> USDC
  </button>

  <button class="dep-pill" type="button" data-coin="BTC">
    <img class="coin-ic" src="https://cryptologos.cc/logos/bitcoin-btc-logo.svg" alt="BTC"> BTC
  </button>

  <button class="dep-pill" type="button" data-coin="ETH">
    <img class="coin-ic" src="https://cryptologos.cc/logos/ethereum-eth-logo.svg" alt="ETH"> ETH
  </button>

  <button class="dep-pill" type="button" data-coin="TRX">
    <img class="coin-ic" src="https://cryptologos.cc/logos/tron-trx-logo.svg" alt="TRX"> TRX
  </button>
</div>
        </div>
      </div>

      <!-- STEP 2 -->
      <div class="dep-step is-disabled" data-step="2">
  <div class="dep-rail">
    <div class="dep-dot">2</div>
    <div class="dep-line"></div>
  </div>

  <div class="dep-main">
    <div class="dep-title muted">Select network</div>

    <div class="dep-select" data-select="network">
      <button class="dep-select-btn" type="button">
        <div class="dep-sel-left">
          <span class="dep-sel-text" id="dep-net-text" data-empty="1">Please select</span>
        </div>
        <span class="dep-arrow">▾</span>
      </button>

            <div class="dep-menu">
              <button class="dep-opt" type="button" data-value="Ethereum (ERC20)">Ethereum (ERC20)</button>
              <button class="dep-opt" type="button" data-value="Tron (TRC20)">Tron (TRC20)</button>
              <button class="dep-opt" type="button" data-value="BSC (BEP20)">BSC (BEP20)</button>
            </div>
          </div>

          <div class="dep-hint">
            <span class="dep-i">i</span>
            You have selected <b id="dep-net-bold">—</b>, please ensure that you choose the same network on the withdrawal platform.
          </div>
        </div>
      </div>

      <!-- STEP 3 -->
      <div class="dep-step is-disabled" data-step="3">
  <div class="dep-rail">
    <div class="dep-dot">3</div>
  </div>

        <div class="dep-main">
    <div class="dep-title muted">Deposit info</div>

          <!-- вместо QR: поле как select + адрес + copy -->
          <div class="dep-address-card" id="dep-address-card" style="display:none;">
            <div class="dep-address-label">Deposit Address</div>

            <div class="dep-address-row">
              <div class="dep-address-text" id="dep-address">
                0x6385b5d5b18ae6ea940d10282062401f99f0ef82
              </div>
              <button class="dep-copy" type="button" id="dep-copy-btn">Copy</button>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- RIGHT -->
    <div class="deposit-right">
      <h3 class="faq-title">Frequently Asked Questions</h3>
      <div class="faq-links">
        <a href="#">How to Deposit | Withdraw Crypto</a>
        <a href="#">What to Do When I Deposit the Wrong Crypto or Deposit to the Wrong Address</a>
      </div>
    </div>

  </div>
</section>

<section id="spot-page" style="display:none;">
  <div class="spot-layout">

    <!-- BLOCK 1: Pair info / selector -->
    <!-- Слева: выбор пары -->
<!-- BLOCK 1: Pair / Info -->
<div class="spot-pair">
  <div class="pairbar">

    <!-- LEFT: pair select (button) -->
    <div class="pair-select-wrap">
      <button class="pair-select" id="spot-pair-btn" type="button">
        <img id="spot-pair-icon" src="" alt="" />
        <div class="pair-text">
          <div id="spot-pair-symbol">BTC/USDT</div>
          <div id="spot-pair-name">Bitcoin</div>
        </div>
        <div class="pair-caret">▾</div>
      </button>

      <!-- dropdown -->
      <div class="pair-dd" id="pair-dd">
  <div class="pair-dd-head">
    <div class="pair-search-wrap">
      <input id="pair-search" class="pair-search" placeholder="Search trading pair" />
    </div>

    <div class="pair-tabs">
      <button class="pair-tab" data-tab="fav">Favorites</button>
      <button class="pair-tab is-active" data-tab="usdt">USDT</button>
    </div>
  </div>

  <div class="pair-dd-cols">
    <div>Trading Pair / 24h Vol.</div>
    <div class="t-right">Last Price</div>
    <div class="t-right">24h Change</div>
  </div>

  <div class="pair-dd-list" id="pair-list"></div>
</div>
    </div>

    <!-- RIGHT: stats -->
    <div class="spot-stats">
      <div class="spot-stat">
        <div class="last-price" id="spot-last-price">—</div>
      </div>

      <div class="spot-stat">
        <div class="label">24h Change</div>
        <div class="change" id="spot-24h-change">—</div>
      </div>

      <div class="spot-stat">
        <div class="label">24h Volume</div>
        <div class="volume" id="spot-24h-vol-base">—</div>
      </div>

      <div class="spot-stat">
        <div class="label">24h Vol.</div>
        <div class="value" id="spot-24h-vol-quote">—</div>
      </div>

      <div class="spot-stat">
        <div class="label">24h High</div>
        <div class="high" id="spot-24h-high">—</div>
      </div>

      <div class="spot-stat">
        <div class="label">24h Low</div>
        <div class="low" id="spot-24h-low">—</div>
      </div>
    
    
</div>

  </div>
</div>

    <!-- MOBILE: Spot tabs (Chart / Order Book / Trading) -->
    <div class="spot-mobile-tabs" id="spot-mobile-tabs">
      <button class="spot-mtab is-active" type="button" data-panel="chart">Chart</button>
      <button class="spot-mtab" type="button" data-panel="orderbook">Order Book</button>
      <button class="spot-mtab" type="button" data-panel="trade">Trading</button>
    </div>

    <!-- BLOCK 2: Chart -->
    <div class="spot-chart">
  <div class="chart-card">
    <div class="chart-head">
  <div class="chart-head-left">
    <div class="chart-title">Chart</div>

    <!-- 1-й прямоугольник: таймфреймы -->
    <div class="chart-tools">
      <button class="chart-btn is-active" data-tf="1m">1m</button>
      <button class="chart-btn" data-tf="5m">5m</button>
      <button class="chart-btn" data-tf="15m">15m</button>
      <button class="chart-btn" data-tf="1h">1h</button>
      <button class="chart-btn" data-tf="4h">4h</button>
      <button class="chart-btn" data-tf="1d">1d</button>
    </div>
  </div>

  <!-- 2-й прямоугольник: сюда переедут tools -->
  <div class="chart-head-right" id="chart-top-tools">
    <div id="chart-draw-tools" class="chart-draw-tools">
  
<button id="clear-sim-btn" class="draw-btn"
        title="Clear synthetic candles"
        style="margin-top:6px;border-color:#7a2a2a;color:#ff6b6b;">
  
</button>



  <div class="tool-sep"></div>
  
</div>
  </div>
</div>

    <div class="chart-stage" id="chart-root">
  <div id="tv-chart" style="width:100%;height:100%;">
    <iframe class="tv-iframe"
      src="https://s.tradingview.com/widgetembed/?symbol=BINANCE:BTCUSDT&interval=15&theme=dark&style=1&locale=en&toolbarbg=rgba(0,0,0,0)&enable_publishing=false&hide_top_toolbar=false&hide_side_toolbar=false&allow_symbol_change=true"
      frameborder="0" allowfullscreen></iframe>
  </div>
  
      


  
</div>
  </div>
</div>

    <!-- BLOCK 3: Order Book -->
    <div class="spot-orderbook" id="spot-orderbook">
  <div class="ob-head">Order Book</div>
  <div class="ob-cols">
    <span>Price</span>
    <span class="t-right">Amount</span>
    <span class="t-right">Total</span>
  </div>

  <div class="ob-body">
    <div class="ob-side ob-asks" id="ob-asks">
      <div class="ob-empty">Loading…</div>
    </div>

    <div class="ob-mid" id="ob-mid">
  <div class="ob-mid-price" id="ob-mid-price">—</div>
  <div class="ob-mid-sub" id="ob-mid-sub">—</div>
</div>

<div class="ob-pressure" id="ob-pressure">
  <div class="ob-pressure-buy"  id="ob-pressure-buy"  style="width:50%"></div>
  <div class="ob-pressure-sell" id="ob-pressure-sell" style="width:50%"></div>
  <div class="ob-pressure-labels">
    <span id="ob-buy-pct">Buy: 50%</span>
    <span id="ob-sell-pct">Sell: 50%</span>
  </div>
</div>


    <div class="ob-side ob-bids" id="ob-bids">
      <div class="ob-empty">Loading…</div>
    </div>
  </div>
</div>

    <!-- BLOCK 4: Buy / Sell -->
    <div class="spot-trade">
      <div class="trade-card" id="tradeCard">
        <div class="trade-bs-toggle" role="tablist" aria-label="Buy Sell">
          <button class="bs-btn active" data-side="buy" type="button">Buy</button>
          <button class="bs-btn" data-side="sell" type="button">Sell</button>
        </div>

        <div class="trade-types">
          <button class="type-btn active" data-otype="limit" type="button">Limit</button>
          <button class="type-btn" data-otype="market" type="button">Market</button>
        </div>

        <div class="trade-available">
          <div class="trade-available-label">Available</div>
          <div class="trade-available-val">
            <div class="account-balance-pill" title="Spot balance"><span class="amt fund-amt" data-acct="spot">0.00</span><span class="unit">USDT</span></div>
          </div>
        </div>

        <div class="trade-field price-field">
          <div class="trade-field-label">Price <span class="muted">(USDT)</span></div>
          <div class="trade-input-wrap">
            <input class="trade-input" id="tradePrice" type="number" step="0.01" placeholder="0.00" />
            <button type="button" class="last-price-btn" id="lastPriceBtn">Last price</button>
          </div>
        </div>

        <div class="trade-field amount-field">
          <div class="trade-field-label">Amount <span class="muted">(BTC)</span></div>
          <input class="trade-input" id="tradeAmount" type="number" step="0.000001" placeholder="0.000000" />
        </div>

        <div class="trade-slider">
          <div class="slider-row">
            <input id="tradePct" class="trade-range" type="range" min="0" max="100" value="0" step="1" />
          </div>
          <div class="slider-marks" id="tradeMarks">
            <button type="button" data-p="0">0%</button>
            <button type="button" data-p="25">25%</button>
            <button type="button" data-p="50">50%</button>
            <button type="button" data-p="75">75%</button>
            <button type="button" data-p="100">100%</button>
          </div>
        </div>

        <div class="trade-field total-field">
          <div class="trade-field-label">Total <span class="muted">(USDT)</span></div>
          <input class="trade-input" id="tradeTotal" type="number" step="0.01" placeholder="0.00" />
        </div>

        <label class="trade-tpsl-toggle">
          <input type="checkbox" id="tradeTpslChk" />
          <span>TP / SL</span>
        </label>

        <div class="trade-tpsl-panel" id="tradeTpslPanel" aria-hidden="true">
          <div class="tpsl-field">
            <div class="tpsl-label">TP Trigger</div>
            <div class="tpsl-inputwrap">
              <input class="trade-input tpsl-input" id="tradeTPTrigger" type="number" step="0.01" placeholder="Enter" />
              <span class="tpsl-suffix">USDT</span>
            </div>
          </div>
          <div class="tpsl-field">
            <div class="tpsl-label">SL Trigger</div>
            <div class="tpsl-inputwrap">
              <input class="trade-input tpsl-input" id="tradeSLTrigger" type="number" step="0.01" placeholder="Enter" />
              <span class="tpsl-suffix">USDT</span>
            </div>
          </div>
        </div>

        <button class="trade-submit buy" id="tradeSubmit" type="button">Buy BTC</button>
      </div>
    </div>

    <!-- BLOCK 5: Open Orders -->
    <div class="spot-orders">

  <!-- Header -->
  <div class="orders-header">
    <div class="orders-tabs">
  <button class="orders-tab active" data-tab="open">Open Orders (0)</button>
  <button class="orders-tab" data-tab="ordersHistory">Order History</button>
  <button class="orders-tab" data-tab="tradeHistory">Trade History</button>
</div>
  </div>

  <!-- Table -->
<div class="orders-table">

  <!-- ================= OPEN ORDERS ================= -->
  <div class="orders-panel is-active" data-panel="open">

    <div class="orders-head">
      <div>Pair</div>
      <div>Date</div>
      <div>Type</div>
      <div>Side</div>
      <div>Price</div>
      <div>Amount</div>
      <div>Filled</div>
      <div>Trigger</div>
      <div class="right">Cancel</div>
    </div>

    <div class="orders-empty">
      <div class="orders-empty-icon">📄</div>
      <div class="orders-empty-title">No open orders</div>
      <div class="orders-empty-text">
        Your active spot orders will appear here.
      </div>
    </div>

  </div>

  <!-- ================= ORDER HISTORY ================= -->
  <div class="orders-panel" data-panel="ordersHistory">

    <div class="orders-head">
      <div>Pair</div>
      <div>Date</div>
      <div>Type</div>
      <div>Side</div>
      <div>Price</div>
      <div>Amount</div>
      <div>Filled</div>
      <div>Status</div>
      <div class="right">Fee</div>
    </div>

    <div class="orders-empty">
      <div class="orders-empty-icon">📄</div>
      <div class="orders-empty-title">No order history</div>
      <div class="orders-empty-text">
        Your completed and cancelled orders will appear here.
      </div>
    </div>

  </div>

  <!-- ================= TRADE HISTORY ================= -->
  <div class="orders-panel trade-history" data-panel="tradeHistory">

    <!-- Filters -->
    <div class="th-filters">
      <div class="th-left">
        <div class="th-range">
          <button class="th-pill" type="button" data-range="1d">1 day</button>
          <button class="th-pill" type="button" data-range="3d">3 days</button>
          <button class="th-pill" type="button" data-range="7d">1 week</button>
          <button class="th-pill active" type="button" data-range="30d">1 month</button>
        </div>

        <div class="th-field">
          <span class="th-label">Date</span>
          <input class="th-input" id="thStart" type="date" placeholder="Start date">
          <span class="th-sep">→</span>
          <input class="th-input" id="thEnd" type="date" placeholder="End date">
          <button class="th-reset" id="thReset" type="button">Reset</button>
        </div>
      </div>

      <div class="th-right">
        <div class="th-summary">
          Total filled:
          <span class="th-sum-val">0 USDT</span>
          <span class="th-sum-split">
            ( Buy: <span class="th-buy">0</span> /
            Sell: <span class="th-sell">0</span> )
          </span>
        </div>
      </div>
    </div>

    <!-- Table -->
    <div class="th-table">
      <div class="th-head">
        <div>Pair</div>
        <div>Date</div>
        <div>Side</div>
        <div>Avg. fill price</div>
        <div>Filled</div>
        <div>Total</div>
        <div>Role</div>
        <div class="right">Fee</div>
      </div>

      <div class="th-empty">
        <div class="th-empty-icon">📄</div>
        <div class="th-empty-title">No trades yet</div>
        <div class="th-empty-text">
          Only the last 180 days are shown here.  
          For older history, use the full Orders page.
        </div>
      </div>
    </div>

  </div>

  <!-- ================= OPEN POSITIONS ================= -->
  <div class="orders-panel" data-panel="positions">

    <div class="orders-head">
      <div>Pair</div>
      <div>Side</div>
      <div>Size</div>
      <div>Entry Price</div>
      <div>Mark Price</div>
      <div>PnL</div>
      <div class="right">Close</div>
    </div>

    <div class="orders-empty">
      <div class="orders-empty-icon">📄</div>
      <div class="orders-empty-title">No open positions</div>
      <div class="orders-empty-text">
        Your active positions will appear here.
      </div>
    </div>

  </div>

</div>


</div>

  </div>
</section>

<section id="openstockstradepage" style="display:none;">
  <div class="spot-layout openstocks-layout">

    <!-- BLOCK 1: Pair bar (1в1 как spot-pair) -->
    <div class="spot-pair">
      <div class="pairbar">

        <div class="pair-select-wrap">
          <button class="pair-select" type="button">
            <img src="" alt="" class="openstocks-pair-icon" />
            <div class="pair-text">
              <div class="openstocks-pair-symbol">AAPL</div>
              <div class="openstocks-pair-name">Apple</div>
            </div>
            <div class="pair-caret">▾</div>
          </button>

          <!-- dropdown (пока пустой, только дизайн) -->
          <div class="pair-dd" style="display:none;">
            <div class="pair-dd-head">
              <div class="pair-search-wrap">
                <input class="pair-search" placeholder="Search stock" />
              </div>

              <div class="pair-tabs">
                <button class="pair-tab" type="button">Favorites</button>
                <button class="pair-tab is-active" type="button">US</button>
              </div>
            </div>

            <div class="pair-dd-cols">
              <div>Stock / Vol.</div>
              <div class="t-right">Last</div>
              <div class="t-right">Change</div>
            </div>

            <div class="pair-dd-list">
              <!-- empty -->
            </div>
          </div>
        </div>

        <div class="spot-stats">
          <div class="spot-stat">
            <div class="last-price">0.00</div>
          </div>

          <div class="spot-stat">
            <div class="label">24h Change</div>
            <div class="change">0.00%</div>
          </div>

          <div class="spot-stat">
            <div class="label">Volume</div>
            <div class="volume">0</div>
          </div>
        </div>

        

      </div>
    </div>

    <!-- BLOCK 2: Chart (1в1 как spot-chart) -->
    

    <!-- BLOCK 3: Trade (это твой блок buy/sell) — 1в1 как spot-trade -->
    <div class="spot-trade">
      <div class="trade-card">
        <div class="trade-bs-toggle" role="tablist" aria-label="Buy Sell">
          <button class="bs-btn active" type="button">Buy</button>
          <button class="bs-btn" type="button">Sell</button>
        </div>

        <div class="trade-types">
          <button class="type-btn active" type="button">Limit</button>
          <button class="type-btn" type="button">Market</button>
        </div>

        <div class="trade-available">
          <div class="trade-available-label">Available</div>
          <div class="trade-available-val">
            <div class="account-balance-pill" title="Stocks balance"><span class="amt fund-amt" data-acct="stocks">0.00</span><span class="unit">USD</span></div>
          </div>
        </div>

        <div class="trade-field price-field">
          <div class="trade-field-label">Price <span class="muted">(USDT)</span></div>
          <div class="trade-input-wrap">
            <input class="trade-input" type="number" step="0.01" placeholder="0.00" />
            <button type="button" class="last-price-btn">Last price</button>
          </div>
        </div>

        <div class="trade-field amount-field">
          <div class="trade-field-label">Amount <span class="muted">(AAPL)</span></div>
          <input class="trade-input" type="number" step="1" placeholder="0" />
        </div>

        <div class="trade-slider">
          <div class="slider-row">
            <input class="trade-range" type="range" min="0" max="100" value="0" step="1" />
          </div>
          <div class="slider-marks">
            <button type="button">0%</button>
            <button type="button">25%</button>
            <button type="button">50%</button>
            <button type="button">75%</button>
            <button type="button">100%</button>
          </div>
        </div>

        <div class="trade-field total-field">
          <div class="trade-field-label">Total <span class="muted">(USDT)</span></div>
          <input class="trade-input" type="number" step="0.01" placeholder="0.00" />
        </div>

        <label class="trade-tpsl-toggle">
          <input type="checkbox" />
          <span>TP / SL</span>
        </label>

        <button class="trade-submit buy" type="button">Buy AAPL</button>
      </div>
    </div>

    <!-- BLOCK 4: Orders (1в1 как spot-orders) -->
    <div class="spot-orders">
      <div class="orders-header">
        <div class="orders-tabs">
          <button class="orders-tab active" type="button">Open Orders (0)</button>
          <button class="orders-tab" type="button">Order History</button>
        </div>
      </div>

      <div class="orders-table">
        <div class="orders-panel is-active">
          <div class="orders-head">
            <div>Pair</div><div>Date</div><div>Type</div><div>Side</div><div>Price</div>
            <div>Amount</div><div>Filled</div><div>Trigger</div><div class="right">Cancel</div>
          </div>

          <div class="orders-empty">
            <div class="orders-empty-icon">📄</div>
            <div class="orders-empty-title">No open orders</div>
            <div class="orders-empty-text">Your active orders will appear here.</div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<section id="openforextradepage" style="display:none;">
  <div class="spot-layout forex-layout">

    <!-- BLOCK 1: Pair bar -->
    <div class="spot-pair">
      <div class="pairbar">
        <div class="pair-select-wrap">
          <button class="pair-select" type="button">
            <img src="" alt="" class="forex-pair-icon" />
            <div class="pair-text">
              <div class="forex-pair-symbol">EUR/USD</div>
              <div class="forex-pair-name">Euro / US Dollar</div>
            </div>
            <div class="pair-caret">▾</div>
          </button>

          <!-- dropdown (пока чисто дизайн) -->
          <div class="pair-dd">
            <div class="pair-dd-head">
              <div class="pair-search-wrap">
                <input class="pair-search" placeholder="Search forex pair" />
              </div>
              <div class="pair-tabs">
                <button class="pair-tab" type="button">Favorites</button>
                <button class="pair-tab is-active" type="button">Pairs</button>
              </div>
            </div>

            <div class="pair-dd-cols">
              <div>Pair</div>
              <div class="t-right">Last</div>
            </div>

            <div class="pair-dd-list"></div>
          </div>
        </div>

        <div class="spot-stats">
          <div class="last-price" id="fx-last-price">0.0000</div>
        </div>
      </div>
    </div>

    <!-- BLOCK 2: Chart -->
    

    <!-- BLOCK 3: Trade -->
    <div class="spot-trade">
      <div class="trade-card">
        <div class="trade-bs-toggle">
          <button class="bs-btn active" type="button">Buy</button>
          <button class="bs-btn" type="button">Sell</button>
        </div>

        <div class="trade-available">
          <div class="trade-available-label">Available</div>
          <div class="trade-available-val">
            <div class="account-balance-pill" title="Forex balance"><span class="amt fund-amt" data-acct="forex">0.00</span><span class="unit">USD</span></div>
          </div>
        </div>

        <div class="trade-field price-field">
          <div class="trade-field-label">Price <span class="muted">(USD)</span></div>
          <div class="trade-input-wrap">
            <input class="trade-input" type="number" step="0.0001" placeholder="0.0000" />
            <button type="button" class="last-price-btn">Last price</button>
          </div>
        </div>

        <div class="trade-field amount-field">
          <div class="trade-field-label">Amount <span class="muted">(EUR)</span></div>
          <input class="trade-input" type="number" step="0.01" placeholder="0.00" />
        </div>

        <div class="trade-slider">
          <div class="slider-row">
            <input class="trade-range" type="range" min="0" max="100" value="0" step="1" />
          </div>
          <div class="slider-marks">
            <button type="button">0%</button>
            <button type="button">25%</button>
            <button type="button">50%</button>
            <button type="button">75%</button>
            <button type="button">100%</button>
          </div>
        </div>

        <div class="trade-field total-field">
          <div class="trade-field-label">Total <span class="muted">(USD)</span></div>
          <input class="trade-input" type="number" step="0.01" placeholder="0.00" />
        </div>

        <button class="trade-submit buy" type="button">Buy EUR</button>
      </div>
    </div>

    <!-- BLOCK 4: Orders -->
    <div class="spot-orders">
      <div class="orders-header">
        <div class="orders-tabs">
          <button class="orders-tab active" type="button">Open Orders (0)</button>
          <button class="orders-tab" type="button">Order History</button>
        </div>
      </div>

      <div class="orders-table">
        <div class="orders-panel is-active">
          <div class="orders-head">
            <div>Pair</div><div>Date</div><div>Type</div><div>Side</div><div>Price</div>
            <div>Amount</div><div>Filled</div><div>Trigger</div><div class="right">Cancel</div>
          </div>

          <div class="orders-empty">
            <div class="orders-empty-icon">📄</div>
            <div class="orders-empty-title">No open orders</div>
            <div class="orders-empty-text">Your active forex orders will appear here.</div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- ===== ADMIN PAGE ===== -->
<section id="admin-page" class="admin-page" style="display:none;">
  <div class="admin-shell">

  <!-- ===== BLOCK 1 (LEFT) ===== -->
  <aside class="admin-left-rail">
    <div class="admin-card admin-left-rail-card">

      <button class="admin-left-btn is-active">Admin</button>
      <button class="admin-left-btn">Back to cabinet</button>

      <div class="admin-left-menu-fill"></div>
    </div>
  </aside>

  <!-- ===== BLOCK 2 + 3 (RIGHT) ===== -->
  <main class="admin-right">

    <!-- BLOCK 2 -->
    <section class="admin-card admin-topbar">
      <div class="admin-topbar-inner">
        <div class="admin-topbar-title">Search user</div>
        <div class="admin-topbar-row">
          <input class="admin-input" placeholder="Email or User ID">
          <button class="admin-btn">Search</button>
        </div>
      </div>
    </section>

    <!-- BLOCK 3 -->
    <section class="admin-card admin-details-card">
      <div class="admin-details-title">User details</div>
      <div class="admin-details">
        Select a user to see details here.
      </div>
    </section>

  </main>
</div>
</section>



<script>
// ===================== ОБЩЕЕ: функция рисования спарка =====================
function drawSpark(path, data) {
  if (!path || !data || data.length < 2) return;

  const w = 100;
  const h = 40;
  const max = Math.max(...data);
  const min = Math.min(...data);

  const dAttr = data.map((v, i) => {
    const x = (i / (data.length - 1)) * w;
    const y = h - ((v - min) / (max - min || 1)) * h;
    return `${x},${y}`;
  });

  path.setAttribute("d", `M${dAttr.join(" L")}`);
  // цвет и подсветка берутся из CSS: .spark path { stroke: #3b82f6; ... }
}

function formatMoney(num) {
  if (!num) return "—";
  if (num >= 1e12) return `$${(num / 1e12).toFixed(2)}T`;
  if (num >= 1e9)  return `$${(num / 1e9).toFixed(2)}B`;
  return `$${(num / 1e6).toFixed(2)}M`;
}

// ===================== КРИПТА – статично =====================


const cryptoMap = {
  btcusdt: "bitcoin",
  ethusdt: "ethereum",
  bnbusdt: "binancecoin",
  xrpusdt: "ripple",
  solusdt: "solana",
  adausdt: "cardano",
  dogeusdt: "dogecoin",
  tonusdt: "the-open-network",
  
  linkusdt: "chainlink",
  
  dotusdt: "polkadot",
  liteusdt: "litecoin",
  shibusdt: "shiba-inu",
  avaxusdt: "avalanche-2",
  uniusdt: "uniswap",
  atomusdt: "cosmos",
  xmrusdt: "monero",
  ethusdt: "ethereum",
  etcusdt: "ethereum-classic",
  nearusdt: "near",
  arbusdt: "arbitrum",
  opusdt: "optimism",
  aptusdt: "aptos",
  filusdt: "filecoin",
  hbarusdt: "hedera-hashgraph",
  vetusdt: "vechain",
  icpusdt: "internet-computer",
  algousdt: "algorand",
  galausdt: "gala",
  sandusdt: "the-sandbox",
  manausdt: "decentraland",
  eosusdt: "eos",
  thetcusdt: "theta-token",
  aaveusdt: "aave",
  xlmusdt: "stellar",
  imxusdt: "immutable-x",
  rndrusdt: "render-token",
  injusdt: "injective-protocol",
  batusdt: "basic-attention-token",
  ftmusdt: "fantom",
  egldusdt: "elrond-erd-2",
  chzusdt: "chiliz",
  wavesusdt: "waves",
  enjusdt: "enjincoin",
  fraxusdt: "frax",
  axsusdt: "axie-infinity",
  roseusdt: "oasis-network",
  minausdt: "mina-protocol",
  crvusdt: "curve-dao-token",
  cvxusdt: "convex-finance",
  kncusdt: "kyber-network-crystal",
  omgusdt: "omisego",
  dxyusdt: "dydx",
  balusdt: "balancer",
  sushiusdt: "sushi",
  zecusdt: "zcash",
  neousdt: "neo",
  ksmusdt: "kusama",
  xtzusdt: "tezos",
  hotusdt: "holotoken",
  
  lrcusdt: "loopring",
  fetusdt: "fetch-ai",
  oceanusdt: "ocean-protocol",
  
  pepeusdt: "pepe",
  seiusdt: "sei-network",
  sntusdt: "status",
  gmtusdt: "stepn",
  celousdt: "celo",
  qtumusdt: "qtum",
  lunausdt: "terra-luna",
  
  kavausdt: "kava",
  arbusdt: "arbitrum",
  ldousdt: "lido-dao",
  grtusdt: "the-graph",
  
  
  xecusdt: "ecash",
  kasusdt: "kaspa",
  ronusdt: "ronin",
  
  
  pendleusdt: "pendle",
  flrusdt: "flare-networks",
  celousdt: "celo",
  woousdt: "woo-network",
  dymusdt: "dymension",
  
  
  jupusdt: "jupiter-exchange-solana"
};

const nameMap = {
  btcusdt: "Bitcoin",
  ethusdt: "Ethereum",
  bnbusdt: "BNB",
  xrpusdt: "XRP",
  solusdt: "Solana",
  adausdt: "Cardano",
  dogeusdt: "Dogecoin",
  tonusdt: "Toncoin",

  linkusdt: "Chainlink",
  
  dotusdt: "Polkadot",
  liteusdt: "Litecoin",
  shibusdt: "Shiba Inu",
  avaxusdt: "Avalanche",
  uniusdt: "Uniswap",
  atomusdt: "Cosmos",
  xmrusdt: "Monero",
  etcusdt: "Ethereum Classic",
  nearusdt: "NEAR Protocol",

  arbusdt: "Arbitrum",
  opusdt: "Optimism",
  aptusdt: "Aptos",
  filusdt: "Filecoin",
  hbarusdt: "Hedera Hashgraph",
  vetusdt: "VeChain",
  icpusdt: "Internet Computer",
  algousdt: "Algorand",
  galausdt: "Gala",
  sandusdt: "The Sandbox",
  manausdt: "Decentraland",

  eosusdt: "EOS",
  thetcusdt: "Theta",
  aaveusdt: "Aave",
  xlmusdt: "Stellar",
  imxusdt: "Immutable X",
  rndrusdt: "Render",
  injusdt: "Injective",
  batusdt: "Basic Attention Token",
  ftmusdt: "Fantom",
  egldusdt: "MultiversX (Elrond)",
  chzusdt: "Chiliz",

  wavesusdt: "Waves",
  enjusdt: "Enjin Coin",
  fraxusdt: "Frax",
  axsusdt: "Axie Infinity",
  roseusdt: "Oasis Network",
  minausdt: "Mina Protocol",
  crvusdt: "Curve DAO",
  cvxusdt: "Convex Finance",
  kncusdt: "Kyber Network",
  omgusdt: "OMG Network",
  dxyusdt: "dYdX",

  balusdt: "Balancer",
  sushiusdt: "SushiSwap",
  zecusdt: "Zcash",
  neousdt: "NEO",
  ksmusdt: "Kusama",
  xtzusdt: "Tezos",
  hotusdt: "Holo",
  lrcusdt: "Loopring",
  fetusdt: "Fetch.ai",
  oceanusdt: "Ocean Protocol",

  pepeusdt: "Pepe",
  seiusdt: "Sei",
  sntusdt: "Status",
  gmtusdt: "STEPN",
  celousdt: "Celo",
  qtumusdt: "Qtum",
  lunausdt: "Terra",
  kavausdt: "Kava",

  ldousdt: "Lido DAO",
  grtusdt: "The Graph",

  xecusdt: "eCash",
  kasusdt: "Kaspa",
  ronusdt: "Ronin",

  pendleusdt: "Pendle",
  flrusdt: "Flare",
  woousdt: "WOO Network",
  dymusdt: "Dymension",

  jupusdt: "Jupiter"
};

function parseSymbol(binanceSymbol) {
  const base = binanceSymbol.replace("usdt", "").toUpperCase();
  return {
    ticker: base,
    name: nameMap[binanceSymbol] || base
  };
}

// помогаем JS понять красивое имя и тикер по символу


function renderCryptoRows() {
  const container = document.getElementById("crypto-rows");
  if (!container) return;

  container.innerHTML = ""; // очистить, если уже было

  Object.keys(cryptoMap).forEach(symbol => {
    const { ticker, name } = parseSymbol(symbol);

    const row = document.createElement("div");
    row.className = "market-row";
    row.dataset.symbol = symbol;

    row.innerHTML = `
      <div class="asset">
        <div class="coin">
          <img src="" alt="${name} icon">
        </div>
        <div>
          <div class="symbol">${name} <span>${ticker}</span></div>
        </div>
      </div>
      <div class="price">$0.00</div>
      <div class="change">0.00%</div>
      <div class="spark">
        <svg viewBox="0 0 100 40" preserveAspectRatio="none">
          <path></path>
        </svg>
      </div>
      <div class="market-cap">$0.00</div>
      <div class="volume">$0.00</div>
      <button class="action-btn">Buy</button>
    `;

    container.appendChild(row);
  });
}

async function loadCryptoOnce() {
  try {
    const ids = Object.values(cryptoMap).join(",");
    const res = await fetch(
      `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}&sparkline=true`
    );
    const data = await res.json();

    data.forEach(coin => {
      // находим, какому data-symbol эта монета соответствует
      const symbol = Object.keys(cryptoMap)
  .find(k => cryptoMap[k] === coin.id);
if (!symbol) return;

const rows = document.querySelectorAll(`[data-symbol="${symbol}"]`);
if (!rows.length) return;

rows.forEach(row => {
  // иконка
  const iconEl = row.querySelector(".coin img");
  if (iconEl && coin.image) {
    iconEl.src = coin.image;            // URL иконки с CoinGecko
    iconEl.alt = coin.name + " icon";
  }

  // цена
  const priceEl = row.querySelector(".price");
  if (priceEl) {
    priceEl.textContent = `$${coin.current_price.toLocaleString()}`;
  }

  // 24h change
  const change = coin.price_change_percentage_24h || 0;
  const ch = row.querySelector(".change");
  if (ch) {
    ch.textContent = `${change.toFixed(2)}%`;
    ch.className = "change " + (change >= 0 ? "up" : "down");
  }

  // market cap / volume
  const mcEl = row.querySelector(".market-cap");
  if (mcEl) {
    mcEl.textContent = formatMoney(coin.market_cap);
  }

  const volEl = row.querySelector(".volume");
  if (volEl) {
    volEl.textContent = formatMoney(coin.total_volume);
  }

  // статичный график из sparkline_in_7d
  const path = row.querySelector(".spark path, .spark svg path");
  if (path && coin.sparkline_in_7d && coin.sparkline_in_7d.price) {
    drawSpark(path, coin.sparkline_in_7d.price);
  }
});
    });
  } catch (e) {
    console.error("Crypto load error", e);
  }
  
}

// ===================== FOREX – статично =====================
// ===== FOREX ПАРЫ ПО КАТЕГОРИЯМ =====

// Majors
const forexMajorsMap = {
  eurusd: { base: "EUR", quote: "USD" },
  gbpusd: { base: "GBP", quote: "USD" },
  usdjpy: { base: "USD", quote: "JPY" },
  audusd: { base: "AUD", quote: "USD" },
  usdchf: { base: "USD", quote: "CHF" },
  nzdusd: { base: "NZD", quote: "USD" },
  usdcad: { base: "USD", quote: "CAD" }
};

// Crosses
const forexCrossesMap = {
  eurjpy: { base: "EUR", quote: "JPY" },
  gbpchf: { base: "GBP", quote: "CHF" },
  gbpjpy: { base: "GBP", quote: "JPY" },
  eurchf: { base: "EUR", quote: "CHF" },
  eurgbp: { base: "EUR", quote: "GBP" },
  euraud: { base: "EUR", quote: "AUD" },
  nzdcad: { base: "NZD", quote: "CAD" },
  chfjpy: { base: "CHF", quote: "JPY" },
  gbpaud: { base: "GBP", quote: "AUD" },
  cadjpy: { base: "CAD", quote: "JPY" },
  cadchf: { base: "CAD", quote: "CHF" },
  audnzd: { base: "AUD", quote: "NZD" },
  eurcad: { base: "EUR", quote: "CAD" },
  gbpcad: { base: "GBP", quote: "CAD" },
  audjpy: { base: "AUD", quote: "JPY" },
  audcad: { base: "AUD", quote: "CAD" },
  eurnzd: { base: "EUR", quote: "NZD" },
  audchf: { base: "AUD", quote: "CHF" },
  nzdjpy: { base: "NZD", quote: "JPY" },
  gbpnzd: { base: "GBP", quote: "NZD" },
  nzdchf: { base: "NZD", quote: "CHF" },
  usdpln: { base: "USD", quote: "PLN" },
  eurpln: { base: "EUR", quote: "PLN" }
};

// Exotic
const forexExoticMap = {
  chfsgd: { base: "CHF", quote: "SGD" },
  usdsgd: { base: "USD", quote: "SGD" },
  usdsek: { base: "USD", quote: "SEK" },
  eursek: { base: "EUR", quote: "SEK" },
  usdnok: { base: "USD", quote: "NOK" },
  sgdjpy: { base: "SGD", quote: "JPY" },
  eurnok: { base: "EUR", quote: "NOK" },
  usddkk: { base: "USD", quote: "DKK" },
  eursgd: { base: "EUR", quote: "SGD" },
  eurmxn: { base: "EUR", quote: "MXN" },
  usdmxn: { base: "USD", quote: "MXN" },
  gbpsek: { base: "GBP", quote: "SEK" },
  nokjpy: { base: "NOK", quote: "JPY" },
  usdclp: { base: "USD", quote: "CLP" },
  usdtry: { base: "USD", quote: "TRY" },
  usdzar: { base: "USD", quote: "ZAR" },
  usdcnh: { base: "USD", quote: "CNH" },
  eurtry: { base: "EUR", quote: "TRY" },
  eurcnh: { base: "EUR", quote: "CNH" }
};



// общий объект для расчётов и обновления цен
const forexMap = {
  ...forexMajorsMap,
  ...forexCrossesMap,
  ...forexExoticMap
};

// ✅ export forexMap + build list for forextrade dropdown
window.forexMap = forexMap;

window.FOREX_PAIRS = Object.entries(forexMap).map(([sym, v]) => `${v.base}/${v.quote}`);

// label ("USD/JPY") -> symbol key ("usdjpy")
window.__fxLabelToSymbol = Object.fromEntries(
  Object.entries(forexMap).map(([sym, v]) => [`${v.base}/${v.quote}`, sym])
);

// latest rates cache for forextrade
window.__forexRates = window.__forexRates || {};


function renderForexRows() {
  const container = document.getElementById("forex-rows");
  if (!container) return;

  container.innerHTML = "";

  Object.entries(forexMap).forEach(([symbol, { base, quote }]) => {
    const label = `${base}/${quote}`;

    const row = document.createElement("div");
    row.className = "market-row";
    row.dataset.forex = symbol; // важно — совпадает с ключом forexMap

    row.innerHTML = `
      <div class="asset">
        <div class="symbol">${label}</div>
      </div>
      <div class="price">0.00000</div>
      <div class="change">0.00%</div>
      <div class="spark">
        <svg viewBox="0 0 100 40" preserveAspectRatio="none">
          <path></path>
        </svg>
      </div>
      <div class="market-cap">—</div>
      <div class="volume">—</div>
      <button class="action-btn">Trade</button>
    `;

    container.appendChild(row);
  });
}

async function loadForexOnce() {
  try {
    // 1) основной (с ключом), 2) запасной (без ключа)
    const urls = [
      "https://v6.exchangerate-api.com/v6/00596ee6cb427cca4a8467bf/latest/USD",
      "https://open.er-api.com/v6/latest/USD"
    ];

    let rates = null;

    for (const url of urls) {
      try {
        const res = await fetch(url, { cache: "no-store" });
        const data = await res.json();

        // exchangerate-api: conversion_rates
        // er-api: rates
        const r = data?.conversion_rates || data?.rates;

        if (data?.result === "success" && r && typeof r === "object") {
          rates = r;
          break;
        }
      } catch (e) {
        // пробуем следующий url
      }
    }

    if (!rates) {
      console.warn("Forex: no rates (both sources failed)");
      return;
    }

    // считаем цену для каждой пары из forexMap
    Object.entries(forexMap).forEach(([symbol, { base, quote }]) => {
      const b = (base || "").toUpperCase();
      const q = (quote || "").toUpperCase();
      if (!rates[b] || !rates[q]) return;

      let price;
      if (b === "USD") price = rates[q];
      else if (q === "USD") price = 1 / rates[b];
      else price = rates[q] / rates[b];

      if (!Number.isFinite(price) || price <= 0) return;

      applyForex(symbol, price);
    });

  } catch (e) {
    console.error("Forex load error", e);
  }
}


function applyForex(symbol, price) {
  const rows = document.querySelectorAll(`[data-forex="${symbol}"]`);
  if (!rows.length) return;

    const p = forexMap[symbol] || {};
  const base  = String(p.base || "").toUpperCase();
  const quote = String(p.quote || "").toUpperCase();

  const decimals = (quote === "JPY") ? 3 : 5;
  const basePrice = price;

  // ✅ cache for forextrade (does not affect forex rendering)
  window.__forexRates = window.__forexRates || {};
  if (base && quote) {
    window.__forexRates[`${base}/${quote}`] = price;
  }
  rows.forEach(row => {
    // цена
    row.querySelector(".price").textContent = price.toFixed(decimals);

    // небольшое псевдо-изменение
    const change = (Math.random() - 0.5) * 0.4;
    const ch = row.querySelector(".change");
    ch.textContent = `${change.toFixed(2)}%`;
    ch.className = "change " + (change >= 0 ? "up" : "down");

    // спарк
    const series = Array.from({ length: 40 }, () =>
      basePrice + (Math.random() - 0.5) * basePrice * 0.002
    );
    const path = row.querySelector(".spark path, .spark svg path");
    drawSpark(path, series);
  });
}

const PAGE_SIZE = 10;
let cryptoRows = [];
let currentPage = 0;
let paginationInitialized = false;

function initCryptoPagination() {
  // Берём все строки с монетами в crypto-rows
  cryptoRows = Array.from(
    document.querySelectorAll("#crypto-rows .market-row")
  );

  if (!cryptoRows.length) return;

  currentPage = 0;
  showCryptoPage(currentPage);

  const prevBtn = document.getElementById("prev-page");
  const nextBtn = document.getElementById("next-page");

  if (prevBtn && nextBtn) {
    prevBtn.onclick = () => showCryptoPage(currentPage - 1);
    nextBtn.onclick = () => showCryptoPage(currentPage + 1);
  }

  paginationInitialized = true;
}

function showCryptoPage(page) {
  const total = cryptoRows.length;
  const pageCount = Math.ceil(total / PAGE_SIZE) || 1;

  if (page < 0) page = 0;
  if (page > pageCount - 1) page = pageCount - 1;

  currentPage = page;

  const start = currentPage * PAGE_SIZE;
  const end = start + PAGE_SIZE;

  cryptoRows.forEach((row, index) => {
    row.style.display = (index >= start && index < end) ? "grid" : "none";
  });

  const prevBtn = document.getElementById("prev-page");
  const nextBtn = document.getElementById("next-page");

  if (prevBtn) prevBtn.disabled = currentPage === 0;
  if (nextBtn) nextBtn.disabled = currentPage >= pageCount - 1;
}

function renderForexCategoryRows(containerId, map) {
  const container = document.getElementById(containerId);
  if (!container) return;

  container.innerHTML = "";

  Object.entries(map).forEach(([symbol, { base, quote }]) => {
    const label = `${base}/${quote}`;

    const row = document.createElement("div");
    row.className = "market-row";
    row.dataset.forex = symbol; // важно — совпадает с ключом в forexMap

    row.innerHTML = `
      <div class="asset">
        <div class="symbol">${label}</div>
      </div>
      <div class="price">0.00000</div>
      <div class="change">0.00%</div>
      <div class="spark">
        <svg viewBox="0 0 100 40" preserveAspectRatio="none">
          <path></path>
        </svg>
      </div>
      <div class="market-cap">—</div>
      <div class="volume">—</div>
      <button class="action-btn">Trade</button>
    `;

    container.appendChild(row);
  });
}

function renderAllForexRows() {
  // Render
  renderForexCategoryRows("forex-majors-rows", forexMajorsMap);
  renderForexCategoryRows("forex-crosses-rows", forexCrossesMap);
  renderForexCategoryRows("forex-exotic-rows", forexExoticMap);

  // Save arrays
  majorsRows = Array.from(document.querySelectorAll("#forex-majors-rows .market-row"));
  crossesRows = Array.from(document.querySelectorAll("#forex-crosses-rows .market-row"));
  exoticRows = Array.from(document.querySelectorAll("#forex-exotic-rows .market-row"));

  // Show first pages
  majorsPage = showForexPage(majorsRows, 0, "majors");
  crossesPage = showForexPage(crossesRows, 0, "crosses");
  exoticPage = showForexPage(exoticRows, 0, "exotic");

  // Attach buttons
  document.getElementById("majors-prev").onclick = () => {
    majorsPage = showForexPage(majorsRows, majorsPage - 1);
  };
  document.getElementById("majors-next").onclick = () => {
    majorsPage = showForexPage(majorsRows, majorsPage + 1);
  };

  document.getElementById("crosses-prev").onclick = () => {
    crossesPage = showForexPage(crossesRows, crossesPage - 1);
  };
  document.getElementById("crosses-next").onclick = () => {
    crossesPage = showForexPage(crossesRows, crossesPage + 1);
  };

  document.getElementById("exotic-prev").onclick = () => {
    exoticPage = showForexPage(exoticRows, exoticPage - 1);
  };
  document.getElementById("exotic-next").onclick = () => {
    exoticPage = showForexPage(exoticRows, exoticPage + 1);
  };
}

// ===================== ЗАПУСК ОДИН РАЗ ПРИ ЗАГРУЗКЕ =====================
// renderCryptoRows();
// renderForexRows();
// loadCryptoOnce();
// loadForexOnce();
// loadStocksOnce();

hideAuth();

function hideHomeSections() {
  // секции главной
  const hero = document.querySelector(".hero");
  const firstMarkets = document.querySelectorAll(".markets")[0];
  const forexSection = document.querySelector("#forex");
  const stocksSection = document.querySelector("#stocks");
  const steps = document.querySelector("#steps");
  const faq = document.querySelector("#faq");
  const partners = document.querySelector(".partners-strip");

  if (hero) hero.style.display = "none";
  if (firstMarkets) firstMarkets.style.display = "none";
  if (forexSection) forexSection.style.display = "none";
  if (stocksSection) stocksSection.style.display = "none";
  if (steps) steps.style.display = "none";
  if (faq) faq.style.display = "none";
  if (partners) partners.style.display = "none";
}



function openCabinetPage(){
  hideAuth();
  hideAllPages();
  hideHomeSections();
  exitSpotMode();
  resetTopbarTheme();

  document.body.classList.add("cabinet-mode");

  const el = document.getElementById("cabinet-page");
  if (el) el.style.display = "block";

  openCabinetTab("overview"); // <-- ДОБАВЬ ЭТО

  location.hash = "cabinet";
  window.scrollTo({top:0, behavior:"smooth"});
}

function openCabinetTab(tab){
  // активная ссылка в меню
  document.querySelectorAll('#cabinet-nav a').forEach(a=>{
    a.classList.toggle('active', a.dataset.tab === tab);
  });

  // активная панель
  document.querySelectorAll('.cabinet-tab').forEach(p=>{
    p.classList.toggle('is-active', p.dataset.tabPanel === tab);
  });
}


function openDepositPage(){
  // депозит — для залогиненных, поэтому просто обновляем UI
  applyAuthUI();
  exitSpotMode();
  hideAllPages();
  hideHomeSections?.();
  resetTopbarTheme(); // если у тебя есть эта функция (у других страниц она вызывается)

  const el = document.getElementById("deposit-page");
  if (el) el.style.display = "block";

  location.hash = "deposit";
  window.scrollTo({ top: 0, behavior: "smooth" });
}




function openChatPage(){
  hideAuth();
  hideAllPages();
  hideHomeSections();
  document.getElementById("chat-page").style.display = "block";
  location.hash = "chat";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function openFeedbackPage(){
  hideAuth();
  hideAllPages();
  hideHomeSections();
  document.getElementById("feedback-page").style.display = "block";
  location.hash = "feedback";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function openFeesPage(){
  hideAuth();
  hideAllPages();
  hideHomeSections();
  document.getElementById("fees-page").style.display = "block";
  location.hash = "fees";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function openAgreementPage(){
  hideAuth();
  hideAllPages();
  hideHomeSections();
  document.getElementById("agreement-page").style.display = "block";
  location.hash = "agreement";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function openPrivacyPage(){
  hideAuth();
  hideAllPages();
  hideHomeSections();
  document.getElementById("privacy-page").style.display = "block";
  location.hash = "privacy";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function openDisclaimerPage(){
  hideAuth();
  hideAllPages();
  hideHomeSections();
  document.getElementById("disclaimer-page").style.display = "block";
  location.hash = "disclaimer";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function openRiskPage(){
  hideAuth();
  hideAllPages();
  hideHomeSections();
  document.getElementById("risk-page").style.display = "block";
  location.hash = "risk";
  window.scrollTo({ top: 0, behavior: "smooth" });
}


function openNewsPage() {
  hideAuth();

  const hero = document.querySelector(".hero");
  const firstMarkets = document.querySelectorAll(".markets")[0];
  const forexSection = document.querySelector("#forex");
  const stocksSection = document.querySelector("#stocks");
  const cryptoPage = document.querySelector("#crypto-page");
  const forexPage = document.querySelector("#forex-page");
  const stocksPage = document.querySelector("#stocks-page");
  const steps = document.querySelector("#steps");
  const faq = document.querySelector("#faq");
  const partners = document.querySelector(".partners-strip");

  const aboutPage = document.querySelector("#about-page");
  const newsPage = document.querySelector("#news-page");
  const blogPage = document.querySelector("#blog-page");
  const chatPage = document.getElementById("chat-page");
const feedbackPage = document.getElementById("feedback-page");
const feesPage = document.getElementById("fees-page");
const agreementPage = document.getElementById("agreement-page");
const privacyPage = document.getElementById("privacy-page");
const disclaimerPage = document.getElementById("disclaimer-page");
const riskPage = document.getElementById("risk-page");

if (chatPage) chatPage.style.display = "none";
if (feedbackPage) feedbackPage.style.display = "none";
if (feesPage) feesPage.style.display = "none";
if (agreementPage) agreementPage.style.display = "none";
if (privacyPage) privacyPage.style.display = "none";
if (disclaimerPage) disclaimerPage.style.display = "none";
if (riskPage) riskPage.style.display = "none";


  if (hero) hero.style.display = "none";
  if (firstMarkets) firstMarkets.style.display = "none";
  if (forexSection) forexSection.style.display = "none";
  if (stocksSection) stocksSection.style.display = "none";
  if (steps) steps.style.display = "none";
  if (faq) faq.style.display = "none";
  if (partners) partners.style.display = "none";

  if (cryptoPage) cryptoPage.style.display = "none";
  if (forexPage) forexPage.style.display = "none";
  if (stocksPage) stocksPage.style.display = "none";

  if (aboutPage) aboutPage.style.display = "none";
  if (blogPage) blogPage.style.display = "none";

  if (newsPage) newsPage.style.display = "block";

  location.hash = "news";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

const FAV_KEY = "ArsteX_favorites_v1";
let ACTIVE_TAB = "usdt"; // по умолчанию USDT

function loadFavs(){
  try { return JSON.parse(localStorage.getItem(FAV_KEY) || "[]"); }
  catch { return []; }
}
function saveFavs(arr){
  localStorage.setItem(FAV_KEY, JSON.stringify(arr));
}
function isFav(pairKey){
  return loadFavs().includes(pairKey);
}
function toggleFav(pairKey){
  const favs = loadFavs();
  const i = favs.indexOf(pairKey);
  if(i >= 0) favs.splice(i,1);
  else favs.push(pairKey);
  saveFavs(favs);
}

function openBlogPage() {
  hideAuth();

  const hero = document.querySelector(".hero");
  const firstMarkets = document.querySelectorAll(".markets")[0];
  const forexSection = document.querySelector("#forex");
  const stocksSection = document.querySelector("#stocks");
  const cryptoPage = document.querySelector("#crypto-page");
  const forexPage = document.querySelector("#forex-page");
  const stocksPage = document.querySelector("#stocks-page");
  const steps = document.querySelector("#steps");
  const faq = document.querySelector("#faq");
  const partners = document.querySelector(".partners-strip");

  const aboutPage = document.querySelector("#about-page");
  const newsPage = document.querySelector("#news-page");
  const blogPage = document.querySelector("#blog-page");
  const chatPage = document.getElementById("chat-page");
const feedbackPage = document.getElementById("feedback-page");
const feesPage = document.getElementById("fees-page");
const agreementPage = document.getElementById("agreement-page");
const privacyPage = document.getElementById("privacy-page");
const disclaimerPage = document.getElementById("disclaimer-page");
const riskPage = document.getElementById("risk-page");

if (chatPage) chatPage.style.display = "none";
if (feedbackPage) feedbackPage.style.display = "none";
if (feesPage) feesPage.style.display = "none";
if (agreementPage) agreementPage.style.display = "none";
if (privacyPage) privacyPage.style.display = "none";
if (disclaimerPage) disclaimerPage.style.display = "none";
if (riskPage) riskPage.style.display = "none";


  if (hero) hero.style.display = "none";
  if (firstMarkets) firstMarkets.style.display = "none";
  if (forexSection) forexSection.style.display = "none";
  if (stocksSection) stocksSection.style.display = "none";
  if (steps) steps.style.display = "none";
  if (faq) faq.style.display = "none";
  if (partners) partners.style.display = "none";

  if (cryptoPage) cryptoPage.style.display = "none";
  if (forexPage) forexPage.style.display = "none";
  if (stocksPage) stocksPage.style.display = "none";

  if (aboutPage) aboutPage.style.display = "none";
  if (newsPage) newsPage.style.display = "none";

  if (blogPage) blogPage.style.display = "block";

  location.hash = "blog";
  window.scrollTo({ top: 0, behavior: "smooth" });
}


function openCryptoPage() {
  hideAuth();
  exitSpotMode();
  const hero = document.querySelector(".hero");
  const firstMarkets = document.querySelectorAll(".markets")[0];
  const forexSection = document.querySelector("#forex");
  const stocksSection = document.querySelector("#stocks");
  const forexPage = document.querySelector("#forex-page");
  const cryptoPage = document.querySelector("#crypto-page");
  const stocksPage = document.querySelector("#stocks-page");
  const steps = document.querySelector("#steps");
  const faq = document.querySelector("#faq");
  const partners = document.querySelector(".partners-strip");
  const aboutPage = document.querySelector("#about-page");
  const newsPage = document.querySelector("#news-page");
const blogPage = document.querySelector("#blog-page");
const chatPage = document.getElementById("chat-page");
const feedbackPage = document.getElementById("feedback-page");
const feesPage = document.getElementById("fees-page");
const agreementPage = document.getElementById("agreement-page");
const privacyPage = document.getElementById("privacy-page");
const disclaimerPage = document.getElementById("disclaimer-page");
const riskPage = document.getElementById("risk-page");

if (chatPage) chatPage.style.display = "none";
if (feedbackPage) feedbackPage.style.display = "none";
if (feesPage) feesPage.style.display = "none";
if (agreementPage) agreementPage.style.display = "none";
if (privacyPage) privacyPage.style.display = "none";
if (disclaimerPage) disclaimerPage.style.display = "none";
if (riskPage) riskPage.style.display = "none";

if (newsPage) newsPage.style.display = "none";
if (blogPage) blogPage.style.display = "none";

if (aboutPage) aboutPage.style.display = "none";

  if (hero) hero.style.display = "none";
  if (firstMarkets) firstMarkets.style.display = "none";
  if (forexSection) forexSection.style.display = "none";
  if (stocksSection) stocksSection.style.display = "none";
  if (steps) steps.style.display = "none";
  if (faq) faq.style.display = "none";
  if (partners) partners.style.display = "none";
  if (forexPage) forexPage.style.display = "none";
  if (stocksPage) stocksPage.style.display = "none";

  if (cryptoPage) cryptoPage.style.display = "block";
  if (loginPage) loginPage.style.display = "none";

  if (!paginationInitialized) {
    initCryptoPagination();
  }
  loadCryptoOnce();

  window.scrollTo({ top: 0, behavior: "smooth" });
  location.hash = "crypto";
}

function openForexPage() {
  hideAuth();
  exitSpotMode();
  const hero = document.querySelector(".hero");
  const firstMarkets = document.querySelectorAll(".markets")[0];
  const forexSection = document.querySelector("#forex");
  const stocksSection = document.querySelector("#stocks");
  const cryptoPage = document.querySelector("#crypto-page");
  const forexPage = document.querySelector("#forex-page");
  const stocksPage = document.querySelector("#stocks-page");
  const steps = document.querySelector("#steps");
  const faq = document.querySelector("#faq");
  const partners = document.querySelector(".partners-strip");
  const aboutPage = document.querySelector("#about-page");
  const newsPage = document.querySelector("#news-page");
const blogPage = document.querySelector("#blog-page");
const chatPage = document.getElementById("chat-page");
const feedbackPage = document.getElementById("feedback-page");
const feesPage = document.getElementById("fees-page");
const agreementPage = document.getElementById("agreement-page");
const privacyPage = document.getElementById("privacy-page");
const disclaimerPage = document.getElementById("disclaimer-page");
const riskPage = document.getElementById("risk-page");

if (chatPage) chatPage.style.display = "none";
if (feedbackPage) feedbackPage.style.display = "none";
if (feesPage) feesPage.style.display = "none";
if (agreementPage) agreementPage.style.display = "none";
if (privacyPage) privacyPage.style.display = "none";
if (disclaimerPage) disclaimerPage.style.display = "none";
if (riskPage) riskPage.style.display = "none";

if (newsPage) newsPage.style.display = "none";
if (blogPage) blogPage.style.display = "none";

if (aboutPage) aboutPage.style.display = "none";

  if (hero) hero.style.display = "none";
  if (firstMarkets) firstMarkets.style.display = "none";
  if (forexSection) forexSection.style.display = "none";
  if (stocksSection) stocksSection.style.display = "none";
  if (steps) steps.style.display = "none";
  if (faq) faq.style.display = "none";
  if (partners) partners.style.display = "none";
  if (cryptoPage) cryptoPage.style.display = "none";
  if (stocksPage) stocksPage.style.display = "none";

  if (forexPage) forexPage.style.display = "block";
  if (loginPage) loginPage.style.display = "none";

  renderAllForexRows();
  loadForexOnce();

  window.scrollTo({ top: 0, behavior: "smooth" });
  location.hash = "forex";
}

function openAboutPage() {
  hideAuth();
  exitSpotMode();
  const hero = document.querySelector(".hero");
  const firstMarkets = document.querySelectorAll(".markets")[0];
  const forexSection = document.querySelector("#forex");
  const stocksSection = document.querySelector("#stocks");
  const cryptoPage = document.querySelector("#crypto-page");
  const forexPage = document.querySelector("#forex-page");
  const stocksPage = document.querySelector("#stocks-page");
  const steps = document.querySelector("#steps");
  const faq = document.querySelector("#faq");
  const partners = document.querySelector(".partners-strip");
  const aboutPage = document.querySelector("#about-page");
  const newsPage = document.querySelector("#news-page");
const blogPage = document.querySelector("#blog-page");
const chatPage = document.getElementById("chat-page");
const feedbackPage = document.getElementById("feedback-page");
const feesPage = document.getElementById("fees-page");
const agreementPage = document.getElementById("agreement-page");
const privacyPage = document.getElementById("privacy-page");
const disclaimerPage = document.getElementById("disclaimer-page");
const riskPage = document.getElementById("risk-page");

if (chatPage) chatPage.style.display = "none";
if (feedbackPage) feedbackPage.style.display = "none";
if (feesPage) feesPage.style.display = "none";
if (agreementPage) agreementPage.style.display = "none";
if (privacyPage) privacyPage.style.display = "none";
if (disclaimerPage) disclaimerPage.style.display = "none";
if (riskPage) riskPage.style.display = "none";

if (newsPage) newsPage.style.display = "none";
if (blogPage) blogPage.style.display = "none";


  if (hero) hero.style.display = "none";
  if (firstMarkets) firstMarkets.style.display = "none";
  if (forexSection) forexSection.style.display = "none";
  if (stocksSection) stocksSection.style.display = "none";
  if (steps) steps.style.display = "none";
  if (faq) faq.style.display = "none";
  if (partners) partners.style.display = "none";

  if (cryptoPage) cryptoPage.style.display = "none";
  if (forexPage) forexPage.style.display = "none";
  if (stocksPage) stocksPage.style.display = "none";

  if (aboutPage) aboutPage.style.display = "block";

  window.scrollTo({ top: 0, behavior: "smooth" });
  location.hash = "about";
}

function openStocksPage() {
  hideAuth();
  exitSpotMode();
  const hero = document.querySelector(".hero");
  const firstMarkets = document.querySelectorAll(".markets")[0];
  const forexSection = document.querySelector("#forex");
  const stocksSection = document.querySelector("#stocks");
  const cryptoPage = document.querySelector("#crypto-page");
  const forexPage = document.querySelector("#forex-page");
  const stocksPage = document.querySelector("#stocks-page");
  const steps = document.querySelector("#steps");
  const faq = document.querySelector("#faq");
  const partners = document.querySelector(".partners-strip");
  const aboutPage = document.querySelector("#about-page");
  const newsPage = document.querySelector("#news-page");
const blogPage = document.querySelector("#blog-page");
const chatPage = document.getElementById("chat-page");
const feedbackPage = document.getElementById("feedback-page");
const feesPage = document.getElementById("fees-page");
const agreementPage = document.getElementById("agreement-page");
const privacyPage = document.getElementById("privacy-page");
const disclaimerPage = document.getElementById("disclaimer-page");
const riskPage = document.getElementById("risk-page");

if (chatPage) chatPage.style.display = "none";
if (feedbackPage) feedbackPage.style.display = "none";
if (feesPage) feesPage.style.display = "none";
if (agreementPage) agreementPage.style.display = "none";
if (privacyPage) privacyPage.style.display = "none";
if (disclaimerPage) disclaimerPage.style.display = "none";
if (riskPage) riskPage.style.display = "none";

if (newsPage) newsPage.style.display = "none";
if (blogPage) blogPage.style.display = "none";

if (aboutPage) aboutPage.style.display = "none";

  if (hero) hero.style.display = "none";
  if (firstMarkets) firstMarkets.style.display = "none";
  if (forexSection) forexSection.style.display = "none";
  if (stocksSection) stocksSection.style.display = "none";
  if (steps) steps.style.display = "none";
  if (faq) faq.style.display = "none";
  if (partners) partners.style.display = "none";
  if (cryptoPage) cryptoPage.style.display = "none";
  if (forexPage) forexPage.style.display = "none";

  if (stocksPage) stocksPage.style.display = "block";
  if (loginPage) loginPage.style.display = "none";

  if (!stocksPageInitialized) {
    renderStocksRows();
    initStocksPagination();
    stocksPageInitialized = true;
  }

  // ВАЖНО: подгружаем котировки уже ПОСЛЕ того,
  // как строки акций нарисованы
  // loadStocksOnce();

  window.scrollTo({ top: 0, behavior: "smooth" });
  location.hash = "stocks";
}

// ===================== STOCKS TRADE: dropdown + list (как spot) =====================
(function(){

  const FAV_KEY = "ArsteX_stock_favs_v1";

  function getFavs(){
    try { return JSON.parse(localStorage.getItem(FAV_KEY) || "[]"); } catch { return []; }
  }
  function setFavs(arr){
    try { localStorage.setItem(FAV_KEY, JSON.stringify(arr)); } catch {}
  }
  function isFav(sym){
    sym = (sym||"").toUpperCase();
    return getFavs().includes(sym);
  }
  function toggleFav(sym){
    sym = (sym||"").toUpperCase();
    const favs = getFavs();
    const i = favs.indexOf(sym);
    if(i >= 0) favs.splice(i,1); else favs.unshift(sym);
    setFavs(favs);
  }

  function stockInfoBySymbol(sym){
    sym = (sym||"").toUpperCase();
    const all = Object.values(window.stockmap || {});
    return all.find(s => (s.symbol||"").toUpperCase() === sym) || null;
  }

  function getState(sym){
    sym = (sym||"").toUpperCase();
    return (window.stockState && window.stockState[sym]) ? window.stockState[sym] : null;
  }

  function fmtPrice(v){
    if (typeof v !== "number") return "0.00";
    return v.toFixed(2);
  }
  function fmtVol(v){
    if (typeof v !== "number") return "0";
    return Math.round(v).toLocaleString("en-US");
  }
  function fmtChangePct(state){
    if(!state || typeof state.price !== "number" || typeof state.basePrice !== "number" || state.basePrice === 0) return "0.00%";
    const pct = (state.price / state.basePrice - 1) * 100;
    return pct.toFixed(2) + "%";
  }
  function changeClass(state){
    if(!state || typeof state.price !== "number" || typeof state.basePrice !== "number" || state.basePrice === 0) return "";
    const pct = (state.price / state.basePrice - 1) * 100;
    return (pct >= 0) ? "up" : "down";
  }

  function setSelectedStock(sym){
    sym = (sym||"").toUpperCase();
    const info = stockInfoBySymbol(sym);
    const state = getState(sym);

    // верхний селектор (иконка/символ/название)
    const root = document.getElementById("openstockstradepage");
    if(!root) return;

    const iconEl  = root.querySelector(".openstocks-pair-icon");
    const symEl   = root.querySelector(".openstocks-pair-symbol");
    const nameEl  = root.querySelector(".openstocks-pair-name");

    if (symEl)  symEl.textContent = sym;
    if (nameEl) nameEl.textContent = info?.name || sym;

    // если хочешь — можно поставить любую иконку/логотип
    if (iconEl){
      iconEl.src = ""; // можно потом сделать логотипы
      iconEl.style.display = "none"; // чтобы пустая не мешала
    }

    // stats
    const lastEl = root.querySelector(".spot-stats .last-price");
    const chEl   = root.querySelector(".spot-stats .change");
    const volEl  = root.querySelector(".spot-stats .volume");

    if (lastEl) lastEl.textContent = fmtPrice(state?.price ?? 0);
    if (chEl){
      chEl.textContent = fmtChangePct(state);
      chEl.classList.remove("up","down");
      const cls = changeClass(state);
      if(cls) chEl.classList.add(cls);
    }
    if (volEl) volEl.textContent = fmtVol(state?.volume ?? 0);

    // кнопка Buy/ Sell текст
    const buyBtn = root.querySelector(".trade-submit.buy");
    if (buyBtn) buyBtn.textContent = `Buy ${sym}`;

    // сохраним выбранное
    window.STOCKS_TRADE_SELECTED = sym;
  }

  function renderList(){
    const root = document.getElementById("openstockstradepage");
    if(!root) return;

    const dd = root.querySelector(".pair-dd");
    const list = root.querySelector(".pair-dd-list");
    const search = root.querySelector(".pair-search");
    const tabs = Array.from(root.querySelectorAll(".pair-tab"));

    if(!dd || !list) return;

    const q = (search?.value || "").trim().toLowerCase();
    const activeTab = tabs.find(t => t.classList.contains("is-active"))?.textContent?.trim().toLowerCase() || "us";

    const all = Object.values(window.stockmap || {}).map(s => ({
      symbol: (s.symbol||"").toUpperCase(),
      name: s.name || "",
      sector: s.sector || ""
    }));


    let items = all;

    // вкладка Favorites
    if(activeTab === "favorites"){
      const favs = getFavs();
      items = items.filter(x => favs.includes(x.symbol));
    }

    // поиск
    if(q){
      items = items.filter(x =>
        x.symbol.toLowerCase().includes(q) ||
        x.name.toLowerCase().includes(q)
      );
    }

    // сортировка: избранные сверху, потом по символу
    items.sort((a,b)=>{
      const fa = isFav(a.symbol) ? 1 : 0;
      const fb = isFav(b.symbol) ? 1 : 0;
      if(fa !== fb) return fb - fa;
      return a.symbol.localeCompare(b.symbol);
    });

    list.innerHTML = "";

    items.forEach(it => {
      const state = getState(it.symbol);

      const row = document.createElement("div");
      row.className = "pair-item";
      row.innerHTML = `
        <div class="sym" style="display:flex; align-items:center; gap:10px;">
          <span class="star" data-star="${it.symbol}" style="opacity:${isFav(it.symbol)?1:0.5}; cursor:pointer;">★</span>
          <div>
            <div class="sym">${it.symbol}</div>
            <div class="nm">${it.name}</div>
          </div>
        </div>

        <div class="right t-right">${fmtPrice(state?.price ?? 0)}</div>
        <div class="right t-right ${changeClass(state)}">${fmtChangePct(state)}</div>
      `;

      // клик по строке = выбрать
      row.addEventListener("click", (e)=>{
        // если кликнули по звезде — не закрываем dropdown и не выбираем строку
        const star = e.target.closest("[data-star]");
        if(star) return;

        setSelectedStock(it.symbol);
        dd.style.display = "none";
      });

      // звезда (избранное)
      row.querySelector("[data-star]")?.addEventListener("click",(e)=>{
        e.stopPropagation();
        toggleFav(it.symbol);
        renderList();
      });

      list.appendChild(row);
    });
  }

  function startStocksTradeLive(){
  if (window.__STOCKS_TRADE_LIVE_TIMER__) return;

  window.__STOCKS_TRADE_LIVE_TIMER__ = setInterval(() => {
    const root = document.getElementById("openstockstradepage");
    if (!root) return;

    // обновляем только когда страница реально видна
    if (getComputedStyle(root).display === "none") return;

    // обновить верхнюю панель выбранной акции (цена/%, volume и т.д.)
    const sym = window.STOCKS_TRADE_SELECTED ||
      Object.values(window.stockmap || {})[0]?.symbol;

    if (sym) setSelectedStock(sym);

    // если открыт dropdown — обновить список (чтобы цены/проценты менялись)
    const dd = root.querySelector(".pair-dd");
    if (dd && dd.style.display === "block") {
      renderList();
    }
  }, 800);
 }

  // === LIVE UI UPDATES (как в spot) ===
  let __stocksTradeLiveTimer = null;

  function startStocksTradeLiveUpdates(){
    if (__stocksTradeLiveTimer) return;

    __stocksTradeLiveTimer = setInterval(() => {
      const root = document.getElementById("openstockstradepage");
      if (!root) return;

      // если страница не показана — ничего не делаем
      if (root.style.display === "none") return;

      // 1) обновляем верхний блок по выбранной акции
      const sym = (window.STOCKS_TRADE_SELECTED || "").toUpperCase();
      if (sym) setSelectedStock(sym);
      try{ window.__syncSelectedStockPriceToChart && window.__syncSelectedStockPriceToChart(); }catch(e){}

      // 2) если открыт dropdown — обновляем список
      const dd = root.querySelector(".pair-dd");
      if (dd && dd.style.display === "block") {
        renderList();
      }
    }, 600); // 400–800 мс нормально
  }

  function stopStocksTradeLiveUpdates(){
    if (__stocksTradeLiveTimer){
      clearInterval(__stocksTradeLiveTimer);
      __stocksTradeLiveTimer = null;
    }
  }

  // на всякий случай — наружу (не обязательно)
  window.startStocksTradeLiveUpdates = startStocksTradeLiveUpdates;
  window.stopStocksTradeLiveUpdates = stopStocksTradeLiveUpdates;
  // ===== Shared chart mounting & STOCKS synthetic chart (same engine as Spot) =====
  (function(){
    let __spotChartParent = null;

    function mountSharedChart(target){
      const chartRoot = document.getElementById("chart-root");
      if (!chartRoot) return;

      if (!__spotChartParent) __spotChartParent = chartRoot.parentElement;

      if (target === "stocks"){
        const mount = document.getElementById("stocks-chart-mount");
        if (mount && chartRoot.parentElement !== mount) mount.appendChild(chartRoot);
      } else {
        if (__spotChartParent && chartRoot.parentElement !== __spotChartParent) __spotChartParent.appendChild(chartRoot);
      }

      // resize after DOM move / show
      requestAnimationFrame(() => {
        try{ window.AX_CHART?.resize?.(); }catch(e){}
      });
    }

    // --- stocks synthetic history generator ---
    const STOCK_HIST = { candles: [], interval: "1m", symbol: "AAPL", tfMs: 60_000 };

    function tfToMs(tf){
      switch(String(tf)){
        case "5m": return 5*60_000;
        case "15m": return 15*60_000;
        case "1h": return 60*60_000;
        case "4h": return 4*60*60_000;
        case "1d": return 24*60*60_000;
        case "1m":
        default: return 60_000;
      }
    }

    function genCandlesFromPrice(price, tf, count){
      const tfMs = tfToMs(tf);
      const now = Date.now();
      const startT = now - tfMs*count;
      let p = Number(price) || 100;
      let drift = 0;

      const out = [];
      for(let i=0;i<count;i++){
        const t = startT + i*tfMs;
        // soft regime drift
        drift += (Math.random()-0.5)*0.00008;
        drift = Math.max(-0.0012, Math.min(0.0012, drift));

        const vol = Math.max(0.0006, Math.min(0.02, 0.006 + (Math.random()-0.5)*0.002));
        const o = p;
        // candle return
        const ret = drift + (Math.random()-0.5) * vol;
        const c = Math.max(0.01, o * (1 + ret));
        const hi = Math.max(o,c) * (1 + Math.random()*vol*0.6);
        const lo = Math.min(o,c) * (1 - Math.random()*vol*0.6);

        out.push({ t, o, h: hi, l: lo, c });
        p = c;
      }
      return out;
    }

    function getStockBySymbol(sym){
  const S = (sym || "").toUpperCase();
  const map = window.stockmap || {};
  // stockmap НЕ по символу, поэтому ищем по values
  return Object.values(map).find(x => (x?.symbol || "").toUpperCase() === S) || null;
}

function getSelectedStockPrice(sym){
  const S = (sym || "").toUpperCase();
  // 1) если у тебя есть runtime-state по символу (часто так бывает)
  const stState = window.stockState?.[S];
  const p1 = Number(stState?.price);
  if (Number.isFinite(p1) && p1 > 0) return p1;

  // 2) иначе берём из stockmap по values
  const info = getStockBySymbol(S);
  const p2 = Number(info?.price);
  if (Number.isFinite(p2) && p2 > 0) return p2;

  return NaN;
}


    function syncSelectedStockPriceToChart(){
      if (window.AX_ACTIVE_CHART_SOURCE !== "stocks") return;
      const sym = (window.STOCKS_TRADE_SELECTED || "").toUpperCase();
      const price = getSelectedStockPrice(sym);
      if (!Number.isFinite(price) || price <= 0) return;
      if (!Array.isArray(STOCK_HIST.candles) || STOCK_HIST.candles.length === 0) return;

      const last = STOCK_HIST.candles[STOCK_HIST.candles.length - 1];
      // keep candle timestamp, just update C/H/L
      const c = price;
      const next = {
        ...last,
        c,
        h: Math.max(last.h, c),
        l: Math.min(last.l, c),
      };
      STOCK_HIST.candles[STOCK_HIST.candles.length - 1] = next;
      try{ window.AX_CHART?.updateLast?.(next); }catch(e){}
    }

    async function rebuildStockChartForSelectedSymbol(tf){
      try{
        await waitForChart(2500);
      }catch(e){ /* chart not ready */ }

      const sym = (window.STOCKS_TRADE_SELECTED || Object.values(window.stockmap||{})[0]?.symbol || "AAPL").toUpperCase();
      const basePrice = getSelectedStockPrice(sym);
      const safeBase = (Number.isFinite(basePrice) && basePrice > 0) ? basePrice : 100;


      STOCK_HIST.symbol = sym;
      STOCK_HIST.interval = tf || "1m";
      STOCK_HIST.tfMs = tfToMs(STOCK_HIST.interval);

      // generate history where last close ~= current price
      // load real candles
        // 1) пробуем загрузить реальные свечи
let candles = [];
// полностью синтетическая история для Stocks Trade (без backend/API)
{
  const baseCountMap = { "1m": 420, "5m": 420, "15m": 320, "1h": 260, "4h": 220, "1d": 220 };
  const count = baseCountMap[STOCK_HIST.interval] || 320;
  candles = genCandlesFromPrice(safeBase, STOCK_HIST.interval, count);

  // форсим последнюю свечу под текущую цену (как "live")
  const li = candles.length - 1;
  if (li >= 0) {
    candles[li] = {
      ...candles[li],
      c: safeBase,
      h: Math.max(candles[li].h, safeBase),
      l: Math.min(candles[li].l, safeBase),
    };
  }
}

// 3) применяем в график
STOCK_HIST.candles = candles;
window.AX_CHART?.setCandles?.(candles);

// 4) чтобы последняя свеча совпала с current price из UI
syncSelectedStockPriceToChart();


    }

    // expose for handlers
    window.mountSharedChart = mountSharedChart;
    window.rebuildStockChartForSelectedSymbol = rebuildStockChartForSelectedSymbol;
    window.__syncSelectedStockPriceToChart = syncSelectedStockPriceToChart;
  })();



  function initStocksTradeUI(){
    if(window.__STOCKS_TRADE_UI_INITED__) return;
    window.__STOCKS_TRADE_UI_INITED__ = true;

    const root = document.getElementById("openstockstradepage");
    if(!root) return;

    const wrap = root.querySelector(".pair-select-wrap");
    const btn  = root.querySelector(".pair-select");
    const dd   = root.querySelector(".pair-dd");
    const search = root.querySelector(".pair-search");
    const tabs = Array.from(root.querySelectorAll(".pair-tab"));

    if(!wrap || !btn || !dd) return;

    // откроем dropdown по кнопке
    btn.addEventListener("click", ()=>{
      const isOpen = dd.style.display === "block";
      dd.style.display = isOpen ? "none" : "block";
      if(!isOpen){
        renderList();
        setTimeout(()=>search?.focus?.(), 0);
      }
    });

    // закрытие по клику вне
    document.addEventListener("click", (e)=>{
      if(!root.contains(e.target)) dd.style.display = "none";
    }, true);

    // поиск
    if(search){
      search.addEventListener("input", ()=>renderList());
    }

    // табы
    tabs.forEach(t=>{
      t.addEventListener("click", ()=>{
        tabs.forEach(x=>x.classList.remove("is-active"));
        t.classList.add("is-active");
        renderList();
      });
    });

    // дефолт выбранная акция
    const firstFromMap = Object.values(window.stockmap || {})[0]?.symbol;
  const defaultSym = window.STOCKS_TRADE_SELECTED || firstFromMap;
  if (defaultSym) setSelectedStock(defaultSym);
  startStocksTradeLive();
    startStocksTradeLiveUpdates();
    startStocksTradeLive();
  }

  // делаем доступной функции снаружи
  window.initStocksTradeUI = initStocksTradeUI;
  window.setSelectedStockTrade = setSelectedStock;
  window.__stocksTradeRenderList = renderList;
  window.__stocksTradeSetSelected = setSelectedStock;

  function startStocksTradeLive(){
  if (window.__STOCKS_TRADE_LIVE_TIMER__) return;

  window.__STOCKS_TRADE_LIVE_TIMER__ = setInterval(() => {
    const root = document.getElementById("openstockstradepage");
    if (!root) return;

    // обновляем только когда страница реально показана
    if (root.style.display === "none") return;

    const sym = (window.STOCKS_TRADE_SELECTED || "AAPL").toUpperCase();

    // 1) обновить верхние значения / кнопку Buy
    window.__stocksTradeSetSelected?.(sym);
    window.STOCKS_TRADE_SELECTED = (sym || "").toUpperCase();
window.AX_ACTIVE_CHART_SOURCE = "stocks";


    // 2) если открыт список — обновить цены/проценты в списке
    const dd = root.querySelector(".pair-dd");
    const isOpen = dd && dd.style.display === "block";
    if (isOpen) window.__stocksTradeRenderList?.();
    window.STOCKS_TRADE_SELECTED = (sym || "").toUpperCase();
window.AX_ACTIVE_CHART_SOURCE = "stocks";

  }, 500); // как в spot обычно 300–800мс, поставил 500мс
}
  window.__stocksTradeRenderList = renderList;
window.setSelectedStockTrade = setSelectedStock; // (если уже есть — не дублируй)
})();


const FINNHUB_TOKEN = "d59je4pr01qgqlm0l6ngd59je4pr01qgqlm0l6o0";
const FINNHUB_BASE = "https://finnhub.io/api/v1";

async function fetchStockQuote(sym){
  const r = await fetch(`${FINNHUB_BASE}/quote?symbol=${encodeURIComponent(sym)}&token=${encodeURIComponent(FINNHUB_TOKEN)}`, { cache: "no-store" });
  if (!r.ok) throw new Error("quote " + r.status);
  const j = await r.json();
  // j.c = current price
  return { price: Number(j.c) };
}

async function fetchStockCandles(sym, tf){
  // маппинг tf → resolution Finnhub
  const resMap = { "1m":"1", "5m":"5", "15m":"15", "1h":"60", "4h":"240", "1d":"D" };
  const resolution = resMap[tf] || "1";
  const to = Math.floor(Date.now()/1000);
  const from = to - 60*60*24*7; // например неделя истории

  const url = `${FINNHUB_BASE}/stock/candle?symbol=${encodeURIComponent(sym)}&resolution=${encodeURIComponent(resolution)}&from=${from}&to=${to}&token=${encodeURIComponent(FINNHUB_TOKEN)}`;
  const r = await fetch(url, { cache: "no-store" });
  if (!r.ok) throw new Error("candles " + r.status);
  const j = await r.json();
  if (j.s !== "ok") return [];

  // Finnhub: t,o,h,l,c массивами, t в секундах
  return j.t.map((t,i)=>({
    t: t*1000,
    o: Number(j.o[i]),
    h: Number(j.h[i]),
    l: Number(j.l[i]),
    c: Number(j.c[i])
  }));
}



function openstockstradepage() {
  cleanupStockTrade();
  hideAuth();
  exitSpotMode();
  hideAllPages();
  exitTradingMode();
  resetTopbarTheme();
  const hero = document.querySelector(".hero");
  const firstMarkets = document.querySelectorAll(".markets")[0];
  const forexSection = document.querySelector("#forex");
  const stocksSection = document.querySelector("#stocks");

  const cryptoPage = document.querySelector("#crypto-page");
  const forexPage = document.querySelector("#forex-page");
  const stocksPage = document.querySelector("#stocks-page");

  // 🔥 НОВАЯ СТРАНИЦА
  const stocksTradePage = document.querySelector("#openstockstradepage");

  const steps = document.querySelector("#steps");
  const faq = document.querySelector("#faq");
  const partners = document.querySelector(".partners-strip");

  const aboutPage = document.querySelector("#about-page");
  const newsPage = document.querySelector("#news-page");
  const blogPage = document.querySelector("#blog-page");

  const chatPage = document.getElementById("chat-page");
  const feedbackPage = document.getElementById("feedback-page");
  const feesPage = document.getElementById("fees-page");
  const agreementPage = document.getElementById("agreement-page");
  const privacyPage = document.getElementById("privacy-page");
  const disclaimerPage = document.getElementById("disclaimer-page");
  const riskPage = document.getElementById("risk-page");
  document.body.classList.add("stocks-trade-mode");
  document.documentElement.classList.add("stocks-trade-mode");
  // ─── скрываем всё ───
  [
    chatPage, feedbackPage, feesPage, agreementPage,
    privacyPage, disclaimerPage, riskPage,
    newsPage, blogPage, aboutPage,
    hero, firstMarkets, forexSection, stocksSection,
    steps, faq, partners,
    cryptoPage, forexPage, stocksPage
  ].forEach(el => {
    if (el) el.style.display = "none";
  });

  // ─── показываем ТОЛЬКО новую страницу ───
  if (stocksTradePage) stocksTradePage.style.display = "block";
  try{ enableStocksTradeLive && enableStocksTradeLive(); }catch(e){}
  window.AX_ACTIVE_CHART_SOURCE = "stocks";
  try{ window.mountSharedChart && window.mountSharedChart("stocks"); }catch(e){}
  try{ window.rebuildStockChartForSelectedSymbol && window.rebuildStockChartForSelectedSymbol(__lastChartTF); }catch(e){}
  if (loginPage) loginPage.style.display = "none";
  

  initStocksTradeUI();
  startStocksTradeTicker();
  window.scrollTo({ top: 0, behavior: "smooth" });
  location.hash = "stocks-trade";
}

function openforextradepage() {
  hideAuth();
  exitSpotMode();
  hideAllPages();
  hideHomeSections();
  setFooterVisible(false);

  // снимаем режимы других спец-страниц
  document.documentElement.classList.remove("stockstrade-mode");
  document.body.classList.remove("stockstrade-mode");

  // включаем forex режим (ВАЖНО: без дефиса, как в CSS)
  document.documentElement.classList.add("forextrade-mode");
  document.body.classList.add("forextrade-mode");

  // ─── скрываем главную и остальные секции ───
  const hero = document.querySelector(".hero");
  const firstMarkets = document.querySelectorAll(".markets")[0];
  const forexSection = document.querySelector("#forex");
  const stocksSection = document.querySelector("#stocks");
  const steps = document.querySelector("#steps");
  const faq = document.querySelector("#faq");
  const partners = document.querySelector("#partners");

  const cryptoPage = document.querySelector("#crypto-page");
  const forexPage  = document.querySelector("#forex-page");
  const stocksPage = document.querySelector("#stocks-page");

  const newsPage = document.getElementById("news-page");
  const blogPage = document.getElementById("blog-page");
  const aboutPage = document.getElementById("about-page");
  const chatPage = document.getElementById("chat-page");

  [
    hero, firstMarkets, forexSection, stocksSection, steps, faq, partners,
    cryptoPage, forexPage, stocksPage,
    newsPage, blogPage, aboutPage, chatPage
  ].forEach(el => { if (el) el.style.display = "none"; });

  // скрыть stocks-trade
  const stocksTrade = document.getElementById("openstockstradepage");
  if (stocksTrade) stocksTrade.style.display = "none";

  // показать forex-trade
  const forexTrade = document.getElementById("openforextradepage");
  if (forexTrade) forexTrade.style.display = "block";

  window.scrollTo({ top: 0, behavior: "auto" });
  history.replaceState(null, "", "#openforextradepage");
  setTopbarForexTheme();
  initForexTradeUI();
const first = window.__fx_trade_selected || window.FOREX_PAIRS?.[0];
if (first && window.setForexTradePair) window.setForexTradePair(first);
if (window.startForexTradeTicker) window.startForexTradeTicker();
}


function setTopbarForexTheme() {
  const header = document.querySelector("header.topbar-wrapper");
  const topbar  = document.querySelector(".topbar");
  if (!header) return;

  // сохраняем текущие inline-стили, чтобы можно было восстановить
  if (header.dataset.prevStyle == null) header.dataset.prevStyle = header.getAttribute("style") || "";
  if (topbar && topbar.dataset.prevStyle == null) topbar.dataset.prevStyle = topbar.getAttribute("style") || "";

  // применяем forex-вид
  header.style.position = "fixed";
  header.style.top = "0";
  header.style.left = "0";
  header.style.right = "0";
  header.style.zIndex = "20000";
  header.style.background = "#000";
  header.style.backgroundImage = "none";
  header.style.boxShadow = "none";
  header.style.backdropFilter = "none";

  if (topbar) {
    topbar.style.background = "#000";
    topbar.style.backgroundImage = "none";
    topbar.style.boxShadow = "none";
  }
}

function resetTopbarTheme() {
  const header = document.querySelector("header.topbar-wrapper");
  const topbar  = document.querySelector(".topbar");
  if (!header) return;

  // откатываем именно то, что меняли (inline)
  header.setAttribute("style", header.dataset.prevStyle || "");
  delete header.dataset.prevStyle;

  if (topbar) {
    topbar.setAttribute("style", topbar.dataset.prevStyle || "");
    delete topbar.dataset.prevStyle;
  }
}



// ===== FIX: exitSpotMode was removed during futures cleanup; keep navigation working =====
function exitSpotMode(){
  // In this project "spot mode" is the trading terminal (#spot-page) and related body classes.
  // Use the newer unified helper if present.
  try{
    if (typeof exitTradingMode === "function") return exitTradingMode();
  }catch(e){}
  try{ document.body.classList.remove("spot-mode","futures-mode"); }catch(e){}
  try{
    const sp = document.getElementById("spot-page");
    if(sp) sp.style.display = "none";
  }catch(e){}
}

function openHomePage() {
  resetTopbarTheme();
  hideAllPages()
  exitSpotMode();
  hideAuth();
  exitTradeModes(); 
  stopStocksTradeTicker();
  // обёртки страниц
  const homePage = document.getElementById("home-page");
  const signupPage = document.getElementById("signup-page");
  const loginPage = document.getElementById("login-page");

  // секции внутри главной
  const hero = document.querySelector(".hero");
  const firstMarkets = document.querySelectorAll(".markets")[0];
  const forexSection = document.querySelector("#forex");
  const stocksSection = document.querySelector("#stocks");
  const cryptoPage = document.querySelector("#crypto-page");
  const forexPage = document.querySelector("#forex-page");
  const stocksPage = document.querySelector("#stocks-page");
  const steps = document.querySelector("#steps");
  const faq = document.querySelector("#faq");
  const partners = document.querySelector(".partners-strip");
  const aboutPage = document.querySelector("#about-page");
  const newsPage = document.querySelector("#news-page");
const blogPage = document.querySelector("#blog-page");
const chatPage = document.getElementById("chat-page");
const feedbackPage = document.getElementById("feedback-page");
const feesPage = document.getElementById("fees-page");
const agreementPage = document.getElementById("agreement-page");
const privacyPage = document.getElementById("privacy-page");
const disclaimerPage = document.getElementById("disclaimer-page");
const riskPage = document.getElementById("risk-page");

if (chatPage) chatPage.style.display = "none";
if (feedbackPage) feedbackPage.style.display = "none";
if (feesPage) feesPage.style.display = "none";
if (agreementPage) agreementPage.style.display = "none";
if (privacyPage) privacyPage.style.display = "none";
if (disclaimerPage) disclaimerPage.style.display = "none";
if (riskPage) riskPage.style.display = "none";

if (newsPage) newsPage.style.display = "none";
if (blogPage) blogPage.style.display = "none";

if (aboutPage) aboutPage.style.display = "none";

  // показываем главную обёртку
  if (homePage) homePage.style.display = "block";

  // скрываем формы
  if (signupPage) signupPage.style.display = "none";
  if (loginPage) loginPage.style.display = "none";

  // включаем секции главной
  if (hero) hero.style.display = "";
  if (firstMarkets) firstMarkets.style.display = "";
  if (forexSection) forexSection.style.display = "";
  if (stocksSection) stocksSection.style.display = "";
  if (steps) steps.style.display = "";
  if (faq) faq.style.display = "";
  if (partners) partners.style.display = "";

  // выключаем страницы Learn More
  if (cryptoPage) cryptoPage.style.display = "none";
  if (forexPage) forexPage.style.display = "none";
  if (stocksPage) stocksPage.style.display = "none";

  window.scrollTo({ top: 0, behavior: "smooth" });
  location.hash = "home";
  document.body.classList.remove("cabinet-mode");
  document.body.classList.remove("stocks-trade-mode");
  document.documentElement.classList.remove("stocks-trade-mode");
  document.body.classList.remove('forextrade-mode');
document.getElementById('openforextradepage').style.display = 'none';
}

function hideAuth() {
  const ids = ["login-page", "signup-page", "reset-email-page", "reset-confirm-page"];
  ids.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = "none";
  });
}




const __cryptoSearchEl = document.getElementById("crypto-search");
if (__cryptoSearchEl) __cryptoSearchEl.addEventListener("input", function () {
  const value = this.value.trim().toLowerCase();
  const allRows = Array.from(
    document.querySelectorAll("#crypto-rows .market-row")
  );

  const prevBtn = document.getElementById("prev-page");
  const nextBtn = document.getElementById("next-page");

  // Если поиск пустой — показываем все монеты с обычной пагинацией
  if (!value) {
    cryptoRows = allRows;
    currentPage = 0;

    // сначала прячем все
    allRows.forEach(r => (r.style.display = "none"));
    // потом показываем первую страницу
    showCryptoPage(currentPage);

    if (prevBtn) prevBtn.disabled = true;
    if (nextBtn) nextBtn.disabled = cryptoRows.length <= PAGE_SIZE;
    return;
  }

  // Фильтруем строки по имени, тикеру и data-symbol
  cryptoRows = allRows.filter(row => {
    const text = row.querySelector(".symbol").textContent.toLowerCase(); // "bitcoin btc"
    const symbol = (row.dataset.symbol || "").toLowerCase();             // "btcusdt"
    return (
      text.includes(value) ||
      symbol.includes(value)
    );
  });

  // Сначала скрываем всё
  allRows.forEach(row => {
    row.style.display = "none";
  });

  // Если ничего не нашли — выключаем стрелки
  if (!cryptoRows.length) {
    if (prevBtn) prevBtn.disabled = true;
    if (nextBtn) nextBtn.disabled = true;
    return;
  }

  // Нашли — показываем первую страницу результатов
  currentPage = 0;
  showCryptoPage(currentPage);

  if (prevBtn) prevBtn.disabled = true;
  if (nextBtn) nextBtn.disabled = cryptoRows.length <= PAGE_SIZE;
});



// Сколько пар показывать на странице
const FOREX_PAGE_SIZE = 5;

// Храним страницы
let majorsPage = 0;
let crossesPage = 0;
let exoticPage = 0;

// Храним массивы строк
let majorsRows = [];
let crossesRows = [];
let exoticRows = [];

// Общая функция показа страниц
function showForexPage(rows, page, containerId) {
  const total = rows.length;
  const pageCount = Math.ceil(total / FOREX_PAGE_SIZE);

  if (page < 0) page = 0;
  if (page >= pageCount) page = pageCount - 1;

  const start = page * FOREX_PAGE_SIZE;
  const end = start + FOREX_PAGE_SIZE;

  rows.forEach((row, index) => {
    row.style.display = index >= start && index < end ? "grid" : "none";
  });

  return page;
}

// ===== ПОИСК ПО FOREX НА LEARN MORE =====
const forexSearch = document.getElementById("forex-search");

if (forexSearch) {
  forexSearch.addEventListener("input", function () {
    const value = this.value.trim().toLowerCase();

    const majorsAll = Array.from(
      document.querySelectorAll("#forex-majors-rows .market-row")
    );
    const crossesAll = Array.from(
      document.querySelectorAll("#forex-crosses-rows .market-row")
    );
    const exoticAll = Array.from(
      document.querySelectorAll("#forex-exotic-rows .market-row")
    );

    const majorsPrev = document.getElementById("majors-prev");
    const majorsNext = document.getElementById("majors-next");
    const crossesPrev = document.getElementById("crosses-prev");
    const crossesNext = document.getElementById("crosses-next");
    const exoticPrev = document.getElementById("exotic-prev");
    const exoticNext = document.getElementById("exotic-next");

    // Если строка поиска пустая — возвращаем обычную пагинацию
    if (!value) {
      majorsRows = majorsAll;
      crossesRows = crossesAll;
      exoticRows = exoticAll;

      majorsPage = showForexPage(majorsRows, 0);
      crossesPage = showForexPage(crossesRows, 0);
      exoticPage = showForexPage(exoticRows, 0);

      if (majorsPrev && majorsNext) {
        majorsPrev.disabled = majorsRows.length <= FOREX_PAGE_SIZE;
        majorsNext.disabled = majorsRows.length <= FOREX_PAGE_SIZE;
      }
      if (crossesPrev && crossesNext) {
        crossesPrev.disabled = crossesRows.length <= FOREX_PAGE_SIZE;
        crossesNext.disabled = crossesRows.length <= FOREX_PAGE_SIZE;
      }
      if (exoticPrev && exoticNext) {
        exoticPrev.disabled = exoticRows.length <= FOREX_PAGE_SIZE;
        exoticNext.disabled = exoticRows.length <= FOREX_PAGE_SIZE;
      }
      return;
    }

    // Функция фильтра строки по запросу
    const matchRow = row => {
      const text = row.querySelector(".symbol").textContent.toLowerCase(); // "eur/usd"
      const symbol = (row.dataset.forex || "").toLowerCase();            // "eurusd"
      return text.includes(value) || symbol.includes(value);
    };

    // Фильтруем все три блока
    majorsRows = majorsAll.filter(matchRow);
    crossesRows = crossesAll.filter(matchRow);
    exoticRows = exoticAll.filter(matchRow);

    // Показываем только подходящее, без пагинации
    majorsAll.forEach(r => {
      r.style.display = majorsRows.includes(r) ? "grid" : "none";
    });
    crossesAll.forEach(r => {
      r.style.display = crossesRows.includes(r) ? "grid" : "none";
    });
    exoticAll.forEach(r => {
      r.style.display = exoticRows.includes(r) ? "grid" : "none";
    });

    // На время поиска отключаем стрелки
    if (majorsPrev && majorsNext) {
      majorsPrev.disabled = true;
      majorsNext.disabled = true;
    }
    if (crossesPrev && crossesNext) {
      crossesPrev.disabled = true;
      crossesNext.disabled = true;
    }
    if (exoticPrev && exoticNext) {
      exoticPrev.disabled = true;
      exoticNext.disabled = true;
    }
  });
}

// ===== FAQ accordion =====
document.querySelectorAll(".faq-head").forEach(btn => {
  btn.addEventListener("click", () => {
    const item = btn.closest(".faq-item");
    const isOpen = item.classList.contains("open");

    // если хочешь, чтобы был открыт только один — закрываем остальные
    document.querySelectorAll(".faq-item.open").forEach(openItem => {
      if (openItem !== item) openItem.classList.remove("open");
    });

    // переключаем текущий
    item.classList.toggle("open", !isOpen);
  });
});

// ===================== STOCKS CONFIG (без ключей, как crypto/forex) =====================

const stockmap = {
  // ============ MEDICAL CANNABIS ============
  tlry: { name: "Tilray Inc.", symbol: "TLRY", sector: "medical_cannabis" },
  cron: { name: "Cronos Group Inc.", symbol: "CRON", sector: "medical_cannabis" },
  acb:  { name: "Aurora Cannabis Inc.", symbol: "ACB", sector: "medical_cannabis" },

  // ============ AUTOMOBILE ============
  race:  { name: "Ferrari", symbol: "RACE", sector: "automobile" },
  tsla:  { name: "Tesla Motors", symbol: "TSLA", sector: "automobile" },
  f:     { name: "Ford Motor", symbol: "F", sector: "automobile" },
  hog:   { name: "Harley-Davidson", symbol: "HOG", sector: "automobile" },
  tm:    { name: "Toyota Motor", symbol: "TM", sector: "automobile" },
  bmwy:  { name: "Bayerische Motoren Werke AG", symbol: "BMWYY", sector: "automobile" },
  vwgy:  { name: "Volkswagen AG", symbol: "VWAGY", sector: "automobile" },
  rnlsy: { name: "Renault SA", symbol: "RNLSY", sector: "automobile" },

  // ============ CONSUMER GOODS ============
  nke: { name: "Nike", symbol: "NKE", sector: "consumer_goods" },
  ko:  { name: "The Coca-Cola", symbol: "KO", sector: "consumer_goods" },
  pg:  { name: "Procter & Gamble", symbol: "PG", sector: "consumer_goods" },
  pm:  { name: "Philip Morris International", symbol: "PM", sector: "consumer_goods" },
  addyy: { name: "Adidas AG", symbol: "ADDYY", sector: "consumer_goods" },
  idexy: { name: "IndiTex SA", symbol: "IDEXY", sector: "consumer_goods" },
  atvi:  { name: "Activision Blizzard", symbol: "ATVI", sector: "consumer_goods" },
  amc:   { name: "AMC Entertainment Holdings", symbol: "AMC", sector: "consumer_goods" },
  gme:   { name: "GameStop Corp.", symbol: "GME", sector: "consumer_goods" },

  // ============ CONSUMER SERVICES ============
  sbux: { name: "Starbucks", symbol: "SBUX", sector: "consumer_services" },
  dis:  { name: "Walt Disney", symbol: "DIS", sector: "consumer_services" },
  mcd:  { name: "McDonald's", symbol: "MCD", sector: "consumer_services" },
  hd:   { name: "Home Depot", symbol: "HD", sector: "consumer_services" },
  baba: { name: "Alibaba Group", symbol: "BABA", sector: "consumer_services" },
  ebay: { name: "eBay", symbol: "EBAY", sector: "consumer_services" },
  trip: { name: "TripAdvisor", symbol: "TRIP", sector: "consumer_services" },
  ntdoy: { name: "Nintendo (US)", symbol: "NTDOY", sector: "consumer_services" },
  nintendojp: { name: "Nintendo (JP)", symbol: "7974.T", sector: "consumer_services" },
  lyft: { name: "LYFT Inc.", symbol: "LYFT", sector: "consumer_services" },
  uber: { name: "Uber Technologies", symbol: "UBER", sector: "consumer_services" },

  // ============ HEALTHCARE ============
  jnj:  { name: "Johnson & Johnson", symbol: "JNJ", sector: "healthcare" },
  pfe:  { name: "Pfizer", symbol: "PFE", sector: "healthcare" },
  unh:  { name: "UnitedHealth Group", symbol: "UNH", sector: "healthcare" },
  bayry: { name: "BAYER AG", symbol: "BAYRY", sector: "healthcare" },
  mrna: { name: "Moderna", symbol: "MRNA", sector: "healthcare" },
  gild: { name: "Gilead Sciences", symbol: "GILD", sector: "healthcare" },

  // ============ FINANCE ============
  bac: { name: "Bank of America", symbol: "BAC", sector: "finance" },
  axp: { name: "American Express", symbol: "AXP", sector: "finance" },
  c:   { name: "Citigroup", symbol: "C", sector: "finance" },
  v:   { name: "Visa", symbol: "V", sector: "finance" },
  jpm: { name: "JPMorgan Chase", symbol: "JPM", sector: "finance" },
  ma:  { name: "MasterCard", symbol: "MA", sector: "finance" },
  trv: { name: "The Travelers Companies", symbol: "TRV", sector: "finance" },
  idcby: { name: "Industrial & Commercial Bank of China", symbol: "IDCBY", sector: "finance" },
  bsac: { name: "Banco Santander Chile", symbol: "BSAC", sector: "finance" },
  gs:   { name: "Goldman Sachs", symbol: "GS", sector: "finance" },
  db:   { name: "Deutsche Bank AG", symbol: "DB", sector: "finance" },
  wfc:  { name: "Wells Fargo", symbol: "WFC", sector: "finance" },
  bnpqy: { name: "BNP Paribas SA", symbol: "BNPQY", sector: "finance" },
  coin: { name: "Coinbase Global Inc.", symbol: "COIN", sector: "finance" },

  // ============ ENERGY ============
  xom:   { name: "Exxon Mobil", symbol: "XOM", sector: "energy" },
  pbr:   { name: "Petrobras", symbol: "PBR", sector: "energy" },
  eni:   { name: "ENI SPA", symbol: "E", sector: "energy" },
  enlay: { name: "ENEL SPA", symbol: "ENLAY", sector: "energy" },
  repsa: { name: "Repsol SA", symbol: "REPYY", sector: "energy" },
  enic:  { name: "Enel Chile S.A.", symbol: "ENIC", sector: "energy" },

  // ============ INDUSTRIALS ============
  ba:  { name: "Boeing", symbol: "BA", sector: "industrials" },
  cat: { name: "Caterpillar", symbol: "CAT", sector: "industrials" },
  ge:  { name: "General Electric", symbol: "GE", sector: "industrials" },
  basfy: { name: "BASF SE", symbol: "BASFY", sector: "industrials" },
  eadsy: { name: "Airbus SE", symbol: "EADSY", sector: "industrials" },
  luv: { name: "Southwest Airlines Co", symbol: "LUV", sector: "industrials" },
  tuify: { name: "TUI AG", symbol: "TUIFY", sector: "industrials" },
  save: { name: "Spirit Airlines", symbol: "SAVE", sector: "industrials" },
  rcl:  { name: "Royal Caribbean Cruises", symbol: "RCL", sector: "industrials" },
  nclh: { name: "Norwegian Cruise Line", symbol: "NCLH", sector: "industrials" },
  afly: { name: "Air France KLM SA", symbol: "AFLYY", sector: "industrials" },
  ryaay: { name: "Ryanair Holdings", symbol: "RYAAY", sector: "industrials" },
  ccl:  { name: "Carnival Corp", symbol: "CCL", sector: "industrials" },
  wynn: { name: "Wynn Resorts", symbol: "WYNN", sector: "industrials" },
  spce: { name: "Virgin Galactic", symbol: "SPCE", sector: "industrials" },

  // ============ LUXURY ============
  el: { name: "Estée Lauder", symbol: "EL", sector: "luxury" },
  jwn: { name: "Nordstrom", symbol: "JWN", sector: "luxury" },
  pvh: { name: "PVH", symbol: "PVH", sector: "luxury" },
  rl:  { name: "Ralph Lauren", symbol: "RL", sector: "luxury" },
  vfc: { name: "VF Corporation", symbol: "VFC", sector: "luxury" },
  wsm: { name: "Williams-Sonoma", symbol: "WSM", sector: "luxury" },

  // ============ TELECOMMUNICATIONS ============
  t:   { name: "AT&T", symbol: "T", sector: "telecommunications" },
  vz:  { name: "Verizon Communications", symbol: "VZ", sector: "telecommunications" },
  vod: { name: "Vodafone Group", symbol: "VOD", sector: "telecommunications" },

  // ============ TECHNOLOGIES ============
  aapl: { name: "Apple", symbol: "AAPL", sector: "technologies" },
  msft: { name: "Microsoft", symbol: "MSFT", sector: "technologies" },
  googl: { name: "Alphabet (Google)", symbol: "GOOGL", sector: "technologies" },
  meta:  { name: "Meta Platforms", symbol: "META", sector: "technologies" },
  nvda:  { name: "NVIDIA", symbol: "NVDA", sector: "technologies" },
  nflx:  { name: "Netflix", symbol: "NFLX", sector: "technologies" },
  amd:   { name: "AMD", symbol: "AMD", sector: "technologies" },
  intc:  { name: "Intel", symbol: "INTC", sector: "technologies" },
  crm:   { name: "Salesforce", symbol: "CRM", sector: "technologies" },

  // ============ MATERIALS ============
  rio: { name: "Rio Tinto", symbol: "RIO", sector: "materials" },
  bhp: { name: "BHP Group", symbol: "BHP", sector: "materials" },
  mt:  { name: "ArcelorMittal", symbol: "MT", sector: "materials" },
  shw: { name: "Sherwin-Williams", symbol: "SHW", sector: "materials" }
  
};



// ===================== SYNTHETIC STOCKS (без API) =====================

const stockState = {};
const STOCK_HISTORY_POINTS = 40;
const STOCK_STORAGE_KEY = "ArsteX_stock_state_v1"; // <-- добавили ключ
window.stockmap = stockmap;
window.stockState = stockState;

// === LIVE ONLY FOR STOCKS TRADE ===
window.__STOCKS_TRADE_LIVE__ = false;

function enableStocksTradeLive(){
  window.__STOCKS_TRADE_LIVE__ = true;
}

function disableStocksTradeLive(){
  window.__STOCKS_TRADE_LIVE__ = false;
}

// ===================== STOCKS TRADE ONLY TICKER =====================
let __STOCKS_TRADE_TICKER__ = null;

function tickStocksForTradeOnly(){
  // двигаем state, но НЕ обновляем страницу Stocks
  Object.values(window.stockState || {}).forEach(st => {
    if (!st || typeof st.price !== "number") return;

    const drift = 1 + (Math.random() - 0.5) * 0.007; // +-0.35%
    st.price = Math.max(0.5, st.price * drift);

    if (typeof st.volume === "number") {
      st.volume = Math.max(0, st.volume * (0.96 + Math.random() * 0.08));
    }
    if (!Array.isArray(st.history)) st.history = [];
    st.history.push(st.price);
    if (st.history.length > 40) st.history.shift();
  });

  // обновить ВЕРХНЮЮ ПАНЕЛЬ stockstrade
  if (window.STOCKS_TRADE_SELECTED && window.setSelectedStockTrade) {
    window.setSelectedStockTrade(window.STOCKS_TRADE_SELECTED);
  }

  // если открыт dropdown на stockstrade — обновить список
  if (window.__stocksTradeRenderList) {
    const root = document.getElementById("openstockstradepage");
    const dd = root?.querySelector(".pair-dd");
    if (dd && dd.style.display === "block") {
      window.__stocksTradeRenderList();
    }
  }
}

function startStocksTradeTicker(){
  if (!window.__STOCKS_TRADE_LIVE__) return;
  if (__STOCKS_TRADE_TICKER__) return;
  __STOCKS_TRADE_TICKER__ = setInterval(tickStocksForTradeOnly, 1000);
}

function stopStocksTradeTicker(){
  if (!__STOCKS_TRADE_TICKER__) return;
  clearInterval(__STOCKS_TRADE_TICKER__);
  __STOCKS_TRADE_TICKER__ = null;
}


// базовая цена по сектору, чтобы всё выглядело логично
function getSyntheticBasePrice(sector) {
  switch (sector) {
    case "medical_cannabis":   return 8 + Math.random() * 12;    // 8–20$
    case "automobile":         return 50 + Math.random() * 200;  // 50–250$
    case "consumer_goods":     return 20 + Math.random() * 80;   // 20–100$
    case "consumer_services":  return 15 + Math.random() * 120;  // 15–135$
    case "healthcare":         return 30 + Math.random() * 90;   // 30–120$
    case "finance":            return 25 + Math.random() * 120;  // 25–145$
    case "energy":             return 15 + Math.random() * 80;   // 15–95$
    case "industrials":        return 20 + Math.random() * 150;  // 20–170$
    case "luxury":             return 50 + Math.random() * 250;  // 50–300$
    case "telecommunications": return 10 + Math.random() * 50;   // 10–60$
    case "technologies":       return 80 + Math.random() * 320;  // 80–400$
    case "materials":          return 20 + Math.random() * 100;  // 20–120$
    default:                   return 10 + Math.random() * 90;   // 10–100$
  }
}

function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}


function exitTradeModes(){
  // снять режимы
  document.documentElement.classList.remove("forex-trade-mode","stocks-trade-mode");
  document.body.classList.remove("forex-trade-mode","stocks-trade-mode");

  // спрятать trade-страницы
  const fx = document.getElementById("openforextradepage");
  const st = document.getElementById("openstockstradepage");
  if (fx) fx.style.display = "none";
  if (st) st.style.display = "none";
  stopStocksTradeTicker();
}


// 👉 ДОБАВЬ ЭТО

function generateSparkHistory(base) {
  const history = [base];

  for (let i = 1; i < STOCK_HISTORY_POINTS; i++) {
    const prev = history[i - 1];
    // небольшое случайное движение ±2% вокруг предыдущей цены
    const drift = 1 + (Math.random() - 0.5) * 0.004;
    const next = Math.max(0.5, prev * drift);
    history.push(next);
  }

  return history;
}

// инициализация "рыночного состояния" для всех акций из stockmap
// инициализация "рыночного состояния" для всех акций из stockmap
function initSyntheticStocks() {
  let prevSaved = null;

  // пробуем прочитать прошлое состояние из localStorage
  try {
    const raw = localStorage.getItem(STOCK_STORAGE_KEY);
    if (raw) prevSaved = JSON.parse(raw);
  } catch (e) {
    console.warn("Stock state parse error", e);
  }

  const newSaved = {};

  Object.values(stockmap).forEach(s => {
    const sym = s.symbol.toUpperCase();
    const prev = prevSaved && prevSaved[sym];

    // 1) базовая цена: либо прошлое значение с мелким дрейфом, либо новый базис
    let base;
    if (prev && typeof prev.price === "number") {
      const dailyDrift = 1 + (Math.random() - 0.5) * 0.01; // ±1% между перезагрузками
      base = Math.max(0.5, prev.price * dailyDrift);
    } else {
      base = getSyntheticBasePrice(s.sector);
    }

    // 2) капа и объём: чуть "дышат"
    const marketCap = base * getRandomInt(50_000_000, 900_000_000_000);

    const volume = prev && typeof prev.volume === "number"
      ? prev.volume * (0.9 + Math.random() * 0.2) // ≈ ±10%
      : getRandomInt(500_000, 50_000_000);

    // 3) история цены вокруг base с очень небольшими колебаниями
    const history = generateSparkHistory(base);
    const lastPrice = history[history.length - 1];

    stockState[sym] = {
      symbol: sym,
      basePrice: base,
      price: lastPrice,
      marketCap,
      volume,
      history
    };

    // то, что сохраним для следующей перезагрузки
    newSaved[sym] = {
      price: lastPrice,
      volume
    };
  });

  // сохраняем "рынок" в localStorage
  try {
    localStorage.setItem(STOCK_STORAGE_KEY, JSON.stringify(newSaved));
  } catch (e) {
    console.warn("Stock state save error", e);
  }

  // один раз заливаем цены и графики в DOM
  Object.values(stockState).forEach(updateStockDom);
}



// применяем состояние к DOM (и превью, и stocks-странице)
function updateStockDom(state) {
  const symbolLower = state.symbol.toLowerCase();
  const rows = document.querySelectorAll(`[data-stock="${symbolLower}"]`);
  if (!rows.length) return;

  const changePercent = (state.price / state.basePrice - 1) * 100;

  rows.forEach(row => {
    const priceEl = row.querySelector(".price");
    const changeEl = row.querySelector(".change");
    const volEl = row.querySelector(".volume");
    const mcEl = row.querySelector(".market-cap");
    const path = row.querySelector(".spark path, .spark svg path");

    if (priceEl) {
      priceEl.textContent = `$${state.price.toFixed(2)}`;
    }

    if (changeEl) {
      changeEl.textContent = `${changePercent.toFixed(2)}%`;
      changeEl.className = "change " + (changePercent >= 0 ? "up" : "down");
    }

    if (volEl) {
      volEl.textContent = Math.round(state.volume).toLocaleString("en-US");
    }

    if (mcEl) {
      mcEl.textContent = formatMoney(state.marketCap);
    }

    if (path) {
      // drawSpark уже есть выше в коде и умеет рисовать по массиву чисел
      drawSpark(path, state.history);
    }
  });
}

// ===================== LIVE TICK (synthetic) =====================
let __STOCKS_TICKER__ = null;
let __STOCKS_TICK_COUNT__ = 0;

function tickRealStocks(){
  if (!window.stockState) return;

  Object.values(window.stockState).forEach(st => {
    if (!st || typeof st.price !== "number") return;

    const drift = 1 + (Math.random() - 0.5) * 0.007; // +-0.35%
    st.price = Math.max(0.5, st.price * drift);

    if (typeof st.volume === "number") {
      st.volume = Math.max(0, st.volume * (0.96 + Math.random() * 0.08));
    }

    if (!Array.isArray(st.history)) st.history = [];
    st.history.push(st.price);
    if (st.history.length > STOCK_HISTORY_POINTS) st.history.shift();

    updateStockDom(st); // обновит строки stocks page (price/change/spark)
  });

  // обновить верхнюю панель stockstrade
  if (window.STOCKS_TRADE_SELECTED && window.setSelectedStockTrade) {
    window.setSelectedStockTrade(window.STOCKS_TRADE_SELECTED);
  }

  // если открыт dropdown на stockstrade — обновить список
  if (window.__stocksTradeRenderList) {
    const root = document.getElementById("openstockstradepage");
    const dd = root?.querySelector(".pair-dd");
    if (dd && dd.style.display === "block") {
      window.__stocksTradeRenderList();
    }
  }

  // чтобы последняя свеча подтянулась к новой цене (если надо)
  window.__syncSelectedStockPriceToChart?.();
}



function startStocksTicker(){
  if (__STOCKS_TICKER__) return;
  __STOCKS_TICKER__ = setInterval(tickRealStocks, 1500); // 1.5 сек как “живой” рынок
}

function stopStocksTicker(){
  if (!__STOCKS_TICKER__) return;
  clearInterval(__STOCKS_TICKER__);
  __STOCKS_TICKER__ = null;
}



// ===================== РЕНДЕР СТРОК ДЛЯ STOCKS PAGE =====================
function renderStocksRows() {
  const container = document.getElementById("stocks-rows");
  if (!container) return;

  container.innerHTML = "";

  Object.keys(stockmap).forEach(key => {
    const s = stockmap[key];

    const row = document.createElement("div");
    row.className = "market-row";
    row.dataset.stock = s.symbol.toLowerCase();
    row.dataset.search = (s.name + " " + s.symbol).toLowerCase();
    row.dataset.sector = s.sector;

    row.innerHTML = `
  <div class="asset">
    <div class="coin">
      <img 
        src="https://logo.clearbit.com/${s.name.replace(/[^a-zA-Z]/g,"").toLowerCase()}.com"
        alt="${s.name}"
        onerror="this.onerror=null; this.src='';"
      >
    </div>
    <div class="symbol">${s.name} <span>${s.symbol}</span></div>
  </div>

  <div class="price">$0.00</div>
  <div class="change">0.00%</div>

  <div class="spark">
    <svg viewBox="0 0 100 40"><path></path></svg>
  </div>

  <div class="market-cap">—</div>
  <div class="volume">—</div>

  <button class="action-btn">Trade</button>
`;

    container.appendChild(row);
  });
  // 👉 ДОБАВЬ ЭТУ СТРОКУ:
  Object.values(stockState).forEach(updateStockDom);
}

// все тикеры для запроса
// function getAllStockTickers() {
//   return Object.values(stockmap).map(s => s.symbol.toUpperCase());
// }

// ===================== ПРИМЕНЕНИЕ ДАННЫХ К СТРОКАМ =====================
// function applyStockQuoteYahoo(q) {
//   if (!q || !q.symbol) return;

//   const symbol = q.symbol.toUpperCase();
//   const rows = document.querySelectorAll(
//     `[data-stock="${symbol.toLowerCase()}"]`
//   );
//   if (!rows.length) return;

//   const price = q.regularMarketPrice ?? q.ask ?? q.bid;
//   const changePercent = q.regularMarketChangePercent ?? 0;
//   const volume = q.regularMarketVolume ?? 0;
//   const marketCap = q.marketCap ?? 0;

//   rows.forEach(row => {
//     const priceEl = row.querySelector(".price");
//     const changeEl = row.querySelector(".change");
//     const volumeEl = row.querySelector(".volume");
//     const mcEl = row.querySelector(".market-cap");
//     const path = row.querySelector(".spark path, .spark svg path");

//     if (priceEl && price != null) {
//       priceEl.textContent = `$${price.toFixed(2)}`;
//     }

//     if (changeEl) {
//       changeEl.textContent = `${changePercent.toFixed(2)}%`;
//       changeEl.className = "change " + (changePercent >= 0 ? "up" : "down");
//     }

//     if (volumeEl) {
//       volumeEl.textContent = volume ? volume.toLocaleString("en-US") : "—";
//     }

//     if (mcEl) {
//       mcEl.textContent = marketCap ? formatMoney(marketCap) : "—";
//     }

//     if (path && price != null) {
//       const base = price;
//       const series = Array.from({ length: 40 }, () =>
//         base + (Math.random() - 0.5) * base * 0.01
//       );
//       drawSpark(path, series);
//     }
//   });
// }

// ===================== ЗАГРУЗКА КОТИРОВОК С YAHOO FINANCE =====================
// ===================== ЗАГРУЗКА КОТИРОВОК С YAHOO FINANCE (через прокси) =====================
// ===================== ЗАГРУЗКА КОТИРОВОК С YAHOO FINANCE (через прокси, чанками) =====================
// async function loadStocksOnce() {
//   try {
//     const symbols = getAllStockTickers();
//     if (!symbols.length) return;

//     const CHUNK_SIZE = 40; // по 40 тикеров за запрос
//     const chunks = [];

//     for (let i = 0; i < symbols.length; i += CHUNK_SIZE) {
//       chunks.push(symbols.slice(i, i + CHUNK_SIZE));
//     }

//     for (const chunk of chunks) {
//       const yahooUrl =
//         "https://query1.finance.yahoo.com/v7/finance/quote?symbols=" +
//         encodeURIComponent(chunk.join(","));

//       const proxyUrl =
//         "https://api.allorigins.win/raw?url=" + encodeURIComponent(yahooUrl);

//       const res = await fetch(proxyUrl);
//       const data = await res.json();

//       if (
//         !data ||
//         !data.quoteResponse ||
//         !Array.isArray(data.quoteResponse.result)
//       ) {
//         console.warn("Bad Yahoo response for chunk", chunk, data);
//         continue;
//       }

//       data.quoteResponse.result.forEach(applyStockQuoteYahoo);
//     }
//   } catch (e) {
//     console.error("Stocks load error (Yahoo via proxy)", e);
//   }
// }



// ===================== STOCKS PAGINATION + SEARCH/FILTER =====================
const STOCKS_PAGE_SIZE = 8;
let stocksPageIndex = 0;
let stocksAllRows = [];
let stocksFilteredRows = [];
let stocksPageInitialized = false;

function showStocksPage(page) {
  const total = stocksFilteredRows.length;
  const pageCount = Math.max(1, Math.ceil(total / STOCKS_PAGE_SIZE));

  if (page < 0) page = 0;
  if (page >= pageCount) page = pageCount - 1;

  stocksPageIndex = page;

  const start = stocksPageIndex * STOCKS_PAGE_SIZE;
  const end = start + STOCKS_PAGE_SIZE;

  stocksAllRows.forEach(row => (row.style.display = "none"));

  stocksFilteredRows.forEach((row, index) => {
    const isVisible = index >= start && index < end;
    row.style.display = isVisible ? "grid" : "none";
  });

  const prevBtn = document.getElementById("stocks-prev");
  const nextBtn = document.getElementById("stocks-next");

  if (prevBtn) prevBtn.disabled = stocksPageIndex === 0;
  if (nextBtn) nextBtn.disabled = stocksPageIndex >= pageCount - 1;
}

function applyStocksFilters() {
  const searchInput = document.getElementById("stocks-search");
  const sectorSelect = document.getElementById("stocks-sector-filter");

  const searchVal = (searchInput?.value || "").trim().toLowerCase();
  const sectorVal = (sectorSelect?.value || "").toLowerCase();

  stocksFilteredRows = stocksAllRows.filter(row => {
    const search = (row.dataset.search || "").toLowerCase();
    const sector = (row.dataset.sector || "").toLowerCase();

    const matchesSearch = !searchVal || search.includes(searchVal);
    const matchesSector = !sectorVal || sector === sectorVal;

    return matchesSearch && matchesSector;
  });

  if (!stocksFilteredRows.length) {
    stocksAllRows.forEach(r => (r.style.display = "none"));
    const prevBtn = document.getElementById("stocks-prev");
    const nextBtn = document.getElementById("stocks-next");
    if (prevBtn) prevBtn.disabled = true;
    if (nextBtn) nextBtn.disabled = true;
    return;
  }

  stocksPageIndex = 0;
  showStocksPage(stocksPageIndex);
}

function initStocksPagination() {
  const container = document.getElementById("stocks-rows");
  if (!container) return;

  stocksAllRows = Array.from(container.querySelectorAll(".market-row"));
  stocksFilteredRows = stocksAllRows.slice();
  stocksPageIndex = 0;

  showStocksPage(stocksPageIndex);

  const prevBtn = document.getElementById("stocks-prev");
  const nextBtn = document.getElementById("stocks-next");
  const searchInput = document.getElementById("stocks-search");
  const sectorSelect = document.getElementById("stocks-sector-filter");

  if (prevBtn) prevBtn.onclick = () => showStocksPage(stocksPageIndex - 1);
  if (nextBtn) nextBtn.onclick = () => showStocksPage(stocksPageIndex + 1);
  if (searchInput) searchInput.addEventListener("input", applyStocksFilters);
  if (sectorSelect) sectorSelect.addEventListener("change", applyStocksFilters);
}

document.addEventListener("DOMContentLoaded", () => {
  renderCryptoRows();
  renderAllForexRows();

  loadCryptoOnce();
  loadForexOnce();
    initSyntheticStocks(); 
    startStocksTicker(); // теперь вызывается, когда весь скрипт уже выполнен, stockmap существует
});
// ======= ПЕРЕКЛЮЧЕНИЕ HOME / SIGNUP =======

const homePage = document.getElementById("home-page");
const signupPage = document.getElementById("signup-page");

function showSignupPage() {
  if (homePage) homePage.style.display = "none";
  if (signupPage) signupPage.style.display = "flex";
  location.hash = "signup";
}

function showHomePage() {
  
  if (signupPage) signupPage.style.display = "none";
  if (loginPage) loginPage.style.display = "none";
  openHomePage();
}

// обработчики кнопок
document.getElementById("btn-top-get-started")?.addEventListener("click", showSignupPage);
document.getElementById("btn-hero-get-started")?.addEventListener("click", showSignupPage);

// логотип обратно на главную

// ===== ENABLE / DISABLE SIGNUP BUTTON =====
const emailInput = document.querySelector('input[name="email"]');
const passwordInput = document.querySelector('input[name="password"]');
const agreeCheckbox = document.querySelector('input[name="agree"]');
const signupBtn = document.getElementById("signup-submit");

// Guards in case signup form is not present

function validateSignup() {
  const emailFilled = emailInput.value.trim() !== "";
  const passFilled = passwordInput.value.trim() !== "";
  const agreeChecked = agreeCheckbox.checked;

  if (emailFilled && passFilled && agreeChecked) {
    signupBtn.disabled = false;
    signupBtn.classList.remove("disabled");
  } else {
    signupBtn.disabled = true;
    signupBtn.classList.add("disabled");
  }
}

// обработчики
if (emailInput && passwordInput && agreeCheckbox) {
  emailInput.addEventListener("input", validateSignup);
  passwordInput.addEventListener("input", validateSignup);
  agreeCheckbox.addEventListener("change", validateSignup);
}

// ======= ТАБЫ Email / Phone (пока просто визуально) =======

const tabs = document.querySelectorAll(".signup-tab");
tabs.forEach(tab => {
  tab.addEventListener("click", () => {
    tabs.forEach(t => t.classList.remove("signup-tab-active"));
    tab.classList.add("signup-tab-active");
    // тут можешь переключать поля, если будешь делать регистрацию по телефону
  });
});

// ======= МОДАЛКА =======

const modal = document.getElementById("verification-modal");
const timerEl = document.getElementById("modal-timer");
const modalCloseBtn = document.getElementById("modal-close-btn");
let timerId;

let lastSignupEmail = null;
let currentEmailForVerification = null;

function openVerificationModal(email) {
  currentEmailForVerification = email;
  lastSignupEmail = email; // сохраняем, чтобы потом отправить на /api/verify-email

  document.getElementById("modal-email-text").textContent =
    `The code has been sent to your email.`;
  modal.classList.add("show");

  let seconds = 60;
  timerEl.textContent = seconds + "s";
  clearInterval(timerId);
  timerId = setInterval(() => {
    seconds--;
    if (seconds <= 0) {
      clearInterval(timerId);
      timerEl.textContent = "Resend";
    } else {
      timerEl.textContent = seconds + "s";
    }
  }, 1000);
}

function closeVerificationModal() {
  modal.classList.remove("show");
  clearInterval(timerId);
}

modalCloseBtn?.addEventListener("click", closeVerificationModal);

document.getElementById("modal-confirm-btn")?.addEventListener("click", async () => {
  const codeInput = document.getElementById("verification-code");
  const code = codeInput ? codeInput.value.trim() : "";

  if (!currentEmailForVerification) {
    alert("No email for verification. Please sign up again.");
    return;
  }

  if (!code) {
    alert("Please enter the code from your email.");
    return;
  }

  try {
    const res = await fetch("/api/verify-email", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        email: currentEmailForVerification,
        code: code
      })
    });

    if (!res.ok) {
      const data = await res.json().catch(() => ({}));
      alert(data.detail || "Verification error");
      return;
    }

    closeVerificationModal();
setLoggedIn(true);
openCabinetPage(); // или твоя функция кабинета
  } catch (err) {
    console.error(err);
    alert("Network error during verification");
  }
});

// ======= ОТПРАВКА ФОРМЫ НА БЭКЕНД =======

const signupForm = document.getElementById("signup-form");

if (signupForm) {
  signupForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(signupForm);
    const payload = {
      email: formData.get("email"),
      password: formData.get("password"),
      referralCode: formData.get("referralCode")
    };

    try {
      const res = await fetch("/api/signup", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      if (!res.ok) {
        alert("Error while signing up");
        return;
      }

      // успех: показываем модалку
      openVerificationModal(payload.email);
    } catch (err) {
      console.error(err);
      alert("Network error");
    }
  });
}

// кнопка Confirm – дальше можешь реализовать проверку кода


// Находим страницы
  
  const loginPage = document.getElementById("login-page");
  

  const resetEmailPage = document.getElementById("reset-email-page");
const resetConfirmPage = document.getElementById("reset-confirm-page");

let resetEmailMemory = "";

function openResetEmailPage() {
  if (signupPage) signupPage.style.display = "none";
  if (homePage) homePage.style.display = "none";
  if (loginPage) loginPage.style.display = "none";
  if (resetConfirmPage) resetConfirmPage.style.display = "none";
  if (resetEmailPage) resetEmailPage.style.display = "flex";
  window.scrollTo({ top: 0 });
  location.hash = "reset-email";
}

function openResetConfirmPage() {
  if (resetEmailPage) resetEmailPage.style.display = "none";
  if (resetConfirmPage) resetConfirmPage.style.display = "flex";
  window.scrollTo({ top: 0 });
  location.hash = "reset-confirm";
}


  // Функция открытия страницы входа
  function openLoginPage() {
    hideAllPages();
    resetTopbarTheme();
    if (signupPage) signupPage.style.display = "none";
    if (homePage) homePage.style.display = "none";
    loginPage.style.display = "flex";
    window.scrollTo({ top: 0 });
    location.hash = "login";
  }

  // Функция открытия регистрации
  function openSignupPage() {
    resetTopbarTheme();
    loginPage.style.display = "none";
    if (homePage) homePage.style.display = "none";
    signupPage.style.display = "flex";
    window.scrollTo({ top: 0 });
  }

  // Кнопка "Sign in" в топбаре
  const btnTopSignIn = document.getElementById("btn-top-signin");
  if (btnTopSignIn) {
    btnTopSignIn.addEventListener("click", (e) => {
      e.preventDefault();
      openLoginPage();
    });
  }

  // Кнопка "Log in" под формой регистрации
  const linkOpenLogin = document.getElementById("link-open-login");
  if (linkOpenLogin) {
    linkOpenLogin.addEventListener("click", (e) => {
      e.preventDefault();
      openLoginPage();
    });
  }

  // Кнопка "Sign Up" на странице логина
  const linkOpenSignupFromLogin = document.getElementById("link-open-signup-from-login");
  if (linkOpenSignupFromLogin) {
    linkOpenSignupFromLogin.addEventListener("click", (e) => {
      e.preventDefault();
      openSignupPage();
    });
  }

  // Обработка формы входа
  const loginForm = document.getElementById("login-form");
  if (loginForm) {
    loginForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const email = document.getElementById("login-email").value.trim();
  const password = document.getElementById("login-password").value.trim();

  if (!email || !password) {
    alert("Введите email и пароль");
    return;
  }

  try {
    const res = await fetch("/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();

    if (!res.ok) {
      alert(data.detail || "Неверный email или пароль");
      return;
    }

    setLoggedIn(true);
openCabinetPage(); // или твоя функция кабинета

 fetch("/api/admin/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password })
  }).catch(() => {});

  } catch (err) {
    console.error(err);
    alert("Ошибка подключения к серверу");
  }
});
  }

  const __logoEl = document.getElementById("logo");
__logoEl?.addEventListener("click", () => {
  openHomePage(); // теперь это «главный» возврат на домашку
});

document.getElementById("link-forgot-password")?.addEventListener("click", (e) => {
  e.preventDefault();
  openResetEmailPage();
});

document.getElementById("reset-back-to-login")?.addEventListener("click", (e) => {
  e.preventDefault();
  openLoginPage();
});

document.getElementById("reset-next-btn")?.addEventListener("click", async () => {
  const email = document.getElementById("reset-email").value.trim();
  if (!email) return alert("Введите email");

  // запоминаем email
  resetEmailMemory = email;

  // сразу отправляем код
  const res = await fetch("/api/password-reset/request", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email })
  });

  let data = null;
  try { data = await res.json(); } catch {}

  if (!res.ok) {
    alert(data?.detail || "Ошибка отправки кода");
    return;
  }

  alert(data?.message || "Код отправлен на почту");
  openResetConfirmPage();
});


document.getElementById("reset-get-code")?.addEventListener("click", async () => {
  if (!resetEmailMemory) return alert("Сначала введите email");

  const res = await fetch("/api/password-reset/request", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email: resetEmailMemory })
  });

  // читаем detail/message нормально (у тебя в signup пока alert всегда общий )
  let data = null;
  try { data = await res.json(); } catch {}

  if (!res.ok) {
    alert(data?.detail || "Ошибка отправки кода");
    return;
  }

  alert(data?.message || "Код отправлен на почту");
});

document.getElementById("reset-confirm-btn")?.addEventListener("click", async () => {
  const p1 = document.getElementById("reset-new-pass").value.trim();
  const p2 = document.getElementById("reset-new-pass2").value.trim();
  const code = document.getElementById("reset-code").value.trim();

  if (!p1 || !p2 || !code) return alert("Заполните все поля");
  if (p1 !== p2) return alert("Пароли не совпадают");

  const res = await fetch("/api/password-reset/confirm", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email: resetEmailMemory, code, new_password: p1 })
  });

  let data = null;
  try { data = await res.json(); } catch {}

  if (!res.ok) {
    alert(data?.detail || "Ошибка подтверждения");
    return;
  }

  alert("Пароль изменён. Теперь войдите заново.");
  openLoginPage();
});

const AUTH_KEY = "ArsteX_logged_in";

function isLoggedIn(){
  return localStorage.getItem(AUTH_KEY) === "1";
}

function setLoggedIn(v){
  localStorage.setItem(AUTH_KEY, v ? "1" : "0");
  applyAuthUI();
}

function logoutUser(){
  // Универсальный logout для UI
  setLoggedIn(false);
  closeMobileAuthMenu();
  try{
    // если есть открытое меню профиля — закрыть
    const um = document.querySelector(".user-menu");
    if (um) um.classList.remove("open");
  }catch(e){}
  // Переводим на страницу логина (если функция есть)
  if (typeof openLoginPage === "function") openLoginPage();
}

function applyAuthUI(){
  const guest = document.getElementById("topbar-guest");
  const auth  = document.getElementById("topbar-auth");
  const heroBtn = document.getElementById("btn-hero-get-started");

  if (isLoggedIn()) {
    if (guest) guest.style.display = "none";
    if (auth) auth.style.display = "flex";
    if (heroBtn) heroBtn.style.display = "none";
  } else {
    if (guest) guest.style.display = "flex";
    if (auth) auth.style.display = "none";
    if (heroBtn) heroBtn.style.display = "";
  }

  // Always close the mobile burger menu when auth state/UI changes
  closeMobileAuthMenu();
}

// ===== Mobile burger menu inside authenticated topbar (phones) =====

// ===== Mobile guest menu (Sign in / Get Started) =====
function initMobileGuestMenu(){
  const burger = document.getElementById("mobile-guest-burger");
  const menu = document.getElementById("mobile-guest-menu");
  if (!burger || !menu) return;

  function setOpen(open){
    menu.classList.toggle("open", open);
    burger.setAttribute("aria-expanded", open ? "true" : "false");
    menu.setAttribute("aria-hidden", open ? "false" : "true");
  }

  burger.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    setOpen(!menu.classList.contains("open"));
  });

  // Prevent clicks inside the dropdown from bubbling to document
  menu.addEventListener("click", (e) => {
    e.stopPropagation();
  });

  // Click outside closes (dropdown-style)
  document.addEventListener("click", (e) => {
    if (!menu.classList.contains("open")) return;
    if (menu.contains(e.target) || burger.contains(e.target)) return;
    setOpen(false);
  });

  menu.querySelectorAll(".mobile-auth-item").forEach((btn) => {
    btn.addEventListener("click", () => {
      const action = btn.dataset.action;
      setOpen(false);

      if (action === "signin") {
        document.getElementById("btn-top-signin")?.click();
        return;
      }
      if (action === "get-started") {
        document.getElementById("btn-top-get-started")?.click();
        return;
      }
    });
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") setOpen(false);
  });

  window.__closeMobileGuestMenu = () => setOpen(false);
}

function closeMobileGuestMenu(){
  if (typeof window.__closeMobileGuestMenu === "function") window.__closeMobileGuestMenu();
}

function initMobileAuthMenu(){
  const burger = document.getElementById("mobile-auth-burger");
  const menu = document.getElementById("mobile-auth-menu");
  if (!burger || !menu) return;

  function setOpen(open){
    menu.classList.toggle("open", open);
    burger.setAttribute("aria-expanded", open ? "true" : "false");
    menu.setAttribute("aria-hidden", open ? "false" : "true");
  }

  burger.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    setOpen(!menu.classList.contains("open"));
  });

  // Prevent clicks inside the dropdown from bubbling to document
  menu.addEventListener("click", (e) => {
    e.stopPropagation();
  });

  // Click outside closes (dropdown-style)
  document.addEventListener("click", (e) => {
    if (!menu.classList.contains("open")) return;
    if (menu.contains(e.target) || burger.contains(e.target)) return;
    setOpen(false);
  });

  // Handle menu actions
  menu.querySelectorAll(".mobile-auth-item").forEach((btn) => {
    btn.addEventListener("click", () => {
      const action = btn.dataset.action;
      setOpen(false);

      if (action === "deposit") {
        // Reuse existing deposit button behavior
        document.querySelector("#topbar-auth .top-deposit-btn")?.click();
        return;
      }

      if (action === "assets") {
        // Reuse existing assets dropdown trigger behavior
        document.getElementById("assets-trigger")?.click();
        return;
      }

      if (action === "markets") {
        if (typeof openCryptoPage === "function") openCryptoPage();
        return;
      }

      if (action === "spot") {
        if (typeof openSpotPage === "function") openSpotPage();
        return;
      }

      if (action === "stocks") {
        if (typeof openstockstradepage === "function") openstockstradepage();
        return;
      }

      if (action === "forex") {
        if (typeof openforextradepage === "function") openforextradepage();
        return;
      }

      if (action === "logout") {
        if (typeof logoutUser === "function") logoutUser();
        return;
      }
    });
  });

  // Escape to close
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") setOpen(false);
  });

  // Expose close helper
  window.__closeMobileAuthMenu = () => setOpen(false);
}

function closeMobileAuthMenu(){
  if (typeof window.__closeMobileAuthMenu === "function") window.__closeMobileAuthMenu();
}

function setFooterVisible(visible){
  const footer = document.querySelector("footer.footer");
  if (!footer) return;
  footer.style.display = visible ? "" : "none";
}

function exitTradeModes(){
  document.body.classList.remove("forex-trade-mode", "stocks-trade-mode");
  document.documentElement.classList.remove("forex-trade-mode", "stocks-trade-mode");
  setFooterVisible(true);
  stopStocksTradeTicker();
}


function initProfileMobileNav(){
  const blurUserTrigger = () => {
    const trig = document.querySelector(".user-dropdown .user-trigger");
    if (trig) trig.blur();
  };

  const bind = (id, handler) => {
    const el = document.getElementById(id);
    if (!el) return;
    el.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      try { handler(); } finally { blurUserTrigger(); }
    });
  };

  bind("user-nav-assets", () => {
    const btn = document.querySelector("#topbar-auth #assets-dropdown");
    if (btn) btn.click();
  });

  bind("user-nav-deposits", () => {
    const btn = document.querySelector("#topbar-auth .top-deposit-btn");
    if (btn) btn.click();
  });

  bind("user-nav-markets", () => {
    if (typeof openCryptoPage === "function") openCryptoPage();
  });

  bind("user-nav-spot", () => {
    if (typeof openSpotPage === "function") openSpotPage();
  });

  bind("user-nav-stocks", () => {
    if (typeof openstockstradepage === "function") openstockstradepage();
  });

  bind("user-nav-forex", () => {
    if (typeof openforextradepage === "function") openforextradepage();
  });
}


window.addEventListener("load", () => {
  initMobileGuestMenu();
  initMobileAuthMenu();
  initProfileMobileNav();
  applyAuthUI();

  // если залогинен и нет конкретной страницы в hash — сразу в кабинет
  if (isLoggedIn() && (!location.hash || location.hash === "#home")) {
    openCabinetPage();
    return;
  }

  switch (location.hash) {
    case "#about":      openAboutPage(); break;
    case "#crypto":     openCryptoPage(); break;
    case "#forex":      openForexPage(); break;
    case "#stocks":     openStocksPage(); break;
    case "#spot":      openSpotPage(); break;
    case "#chat":       openChatPage(); break;
    case "#feedback":   openFeedbackPage(); break;
    case "#fees":       openFeesPage(); break;
    case "#agreement":  openAgreementPage(); break;
    case "#privacy":    openPrivacyPage(); break;
    case "#disclaimer": openDisclaimerPage(); break;
    case "#risk":       openRiskPage(); break;
    case "#deposit":    openDepositPage(); break;

    case "#cabinet":    openCabinetPage(); break;
    case "#admin":      openAdminSafely(); break;

    default:
      openHomePage();
      break;
  }
});


function hideAllPages() {
  cleanupStockTrade();
  [
    "about-page","news-page","blog-page",
    "chat-page","feedback-page","fees-page",
    "agreement-page","privacy-page","disclaimer-page","risk-page",
    "crypto-page","forex-page","stocks-page",
    "signup-page","login-page","reset-email-page","reset-confirm-page",
    "chat-page","feedback-page","cabinet-page","fees-page", "deposit-page",
    "openstockstradepage", "openforextradepage", "admin-page"
  ].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = "none";
  });
  document.body.classList.remove("stocks-trade-mode");
document.documentElement.classList.remove("stocks-trade-mode");
document.body.style.overflow = "";
document.documentElement.style.overflow = "";
document.body.style.position = "";
document.body.style.top = "";
  document.body.classList.remove("forex-trade-mode");
document.documentElement.classList.remove("forex-trade-mode");
document.body.style.overflow = "";
document.documentElement.style.overflow = "";
document.body.style.position = "";
document.body.style.top = "";
}

document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("feedback-form");
  const toast = document.getElementById("feedback-toast");

  if (!form || !toast) {
    console.warn("feedback-form or feedback-toast not found");
    return;
  }

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 3000);

    form.reset();
    applyAuthUI();
  });
});
 // Custom select (Feedback)
  document.addEventListener("click", (e) => {
    document.querySelectorAll("#feedback-page .ax-select.open").forEach(sel => {
      if (!sel.contains(e.target)) sel.classList.remove("open");
    });
  });

  document.querySelectorAll("#feedback-page .ax-select").forEach(sel => {
    const btn = sel.querySelector(".ax-select-btn");
    const valueEl = sel.querySelector(".ax-select-value");
    const hidden = sel.querySelector('input[type="hidden"]');

    btn.addEventListener("click", () => {
      sel.classList.toggle("open");
    });

    sel.querySelectorAll(".ax-select-opt").forEach(opt => {
      opt.addEventListener("click", () => {
        const v = opt.dataset.value || opt.textContent.trim();
        hidden.value = v;
        valueEl.textContent = v;
        sel.classList.remove("open");
      });
    });
  });

  
  document.querySelectorAll('.file-upload input[type="file"]').forEach(input => {
    const text = input.closest('.file-upload').querySelector('.file-upload-text');

    input.addEventListener('change', () => {
      if (input.files.length) {
        text.textContent = input.files[0].name;
      } else {
        text.textContent = 'Image / Video';
      }
    });
  });

 





(function initAssetRecords() {
  const recordsTabBtns = document.querySelectorAll('.records-tabs .records-tab'); // только табы Records
  const recordRows = document.querySelectorAll('.records-row');

  const typeSelect = document.getElementById('filter-type');
  const timeSelect = document.getElementById('filter-time');
  const coinSelect = document.getElementById('filter-coin');
  const resetBtn = document.getElementById('filter-reset');

  if (!recordsTabBtns.length || !typeSelect || !timeSelect || !coinSelect || !resetBtn) return;

  let activeTab = 'overview';

  recordsTabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      recordsTabBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeTab = btn.dataset.tab || 'overview';
      applyFilters();
    });
  });

  [typeSelect, timeSelect, coinSelect].forEach(el => {
    el.addEventListener('change', applyFilters);
  });

  resetBtn.addEventListener('click', () => {
    typeSelect.value = 'all';
    timeSelect.value = '30';
    coinSelect.value = 'all';

    activeTab = 'overview';
    recordsTabBtns.forEach(b => b.classList.remove('active'));
    recordsTabBtns[0]?.classList.add('active');

    applyFilters();
  });

  function applyFilters() {
    const type = typeSelect.value;
    const coin = coinSelect.value;
    const days = Number(timeSelect.value);
    const now = new Date();

    recordRows.forEach(row => {
      let show = true;

      const rowType = row.dataset.type;
      const rowCoin = row.dataset.coin;
      const rowTime = new Date(row.dataset.time);

      if (activeTab !== 'overview' && rowType !== activeTab) show = false;
      if (type !== 'all' && rowType !== type) show = false;
      if (coin !== 'all' && rowCoin !== coin) show = false;

      const diffDays = (now - rowTime) / (1000 * 60 * 60 * 24);
      if (diffDays > days) show = false;

      row.style.display = show ? 'grid' : 'none';
    });
  }

  applyFilters(); // сразу применить при загрузке
})();

document.addEventListener("click", (e) => {
  const el = e.target.closest("button, a");
  if (!el) return;

  // НЕ трогаем табы внутри Asset Records
  if (el.classList.contains("records-tab")) return;

  const text = (el.textContent || "").trim().toLowerCase();
  if (text !== "deposit") return;

  // реагируем на Deposit только если он в нужных местах (topbar/dropdown/кабинет)
  const inTopbarAuth = el.closest("#topbar-auth");
  const inAssetsMenu = el.closest(".assets-menu");
  const inCabinet    = el.closest("#cabinet-page") || el.closest(".cabinet-page");

  if (inTopbarAuth || inAssetsMenu || inCabinet) {
    e.preventDefault();
    openDepositPage();
  }
});

// 

document.addEventListener('DOMContentLoaded', () => {
  initDepositUI();
});

function initDepositUI(){
  const page = document.getElementById('deposit-page');
  if (!page) return;

  const step1 = page.querySelector('.dep-step[data-step="1"]');
  const step2 = page.querySelector('.dep-step[data-step="2"]');
  const step3 = page.querySelector('.dep-step[data-step="3"]');
  if(!step1 || !step2 || !step3) return;

  const coinText = document.getElementById('dep-coin-text');
  const netText  = document.getElementById('dep-net-text');
  const netBold  = document.getElementById('dep-net-bold');

  const addrCard = document.getElementById('dep-address-card');
  const addrEl   = document.getElementById('dep-address');

  // --- helpers ---
  function setStepDone(stepEl, done){
    const dot = stepEl.querySelector('.dep-dot');
    const line = stepEl.querySelector('.dep-line');

    if(done){
      dot.classList.remove('active');
      dot.classList.add('done');
      dot.textContent = '✓';
      if(line) line.classList.add('on');
      stepEl.classList.add('is-done');
    } else {
      dot.classList.remove('done');
      dot.textContent = stepEl.dataset.step;
      if(line) line.classList.remove('on');
      stepEl.classList.remove('is-done');
    }
  }

  function setStepActive(stepEl, active){
    const dot = stepEl.querySelector('.dep-dot');
    if(active){
      dot.classList.add('active');
      dot.textContent = stepEl.dataset.step;
      stepEl.classList.add('is-active');
      stepEl.classList.remove('is-disabled');
    } else {
      dot.classList.remove('active');
      stepEl.classList.remove('is-active');
    }
  }

  function setStepDisabled(stepEl, disabled){
    stepEl.classList.toggle('is-disabled', disabled);
  }

  // --- старт: ничего не выбрано ---
  function resetUI(){
    if(coinText){ coinText.textContent = 'Please select'; coinText.dataset.empty='1'; }
    if(netText){ netText.textContent = 'Please select'; netText.dataset.empty='1'; }
    if(netBold) netBold.textContent = '—';

    page.querySelectorAll('.dep-pill').forEach(p => p.classList.remove('active'));
    page.querySelectorAll('.dep-select').forEach(s => s.classList.remove('open'));

    setStepDone(step1,false);
    setStepActive(step1,true);

    setStepDone(step2,false);
    setStepActive(step2,false);
    setStepDisabled(step2,true);

    setStepActive(step3,false);
    setStepDisabled(step3,true);

    if(addrCard) addrCard.style.display='none';
    if(addrEl) addrEl.textContent='';
  }

  resetUI();

  // --- клики: dropdown + pills ---
  page.addEventListener('click', (e) => {
    const opt = e.target.closest('.dep-opt');
    const pill = e.target.closest('.dep-pill');
    const selBtn = e.target.closest('.dep-select-btn');
if (selBtn) {
  const sel = selBtn.closest('.dep-select');
  if (sel.closest('.dep-step')?.classList.contains('is-disabled')) return;

  sel.classList.toggle('open');
  page.querySelectorAll('.dep-select').forEach(s => {
    if (s !== sel) s.classList.remove('open');
  });
  return;
}


    // выбрать coin/network из dropdown
    if(opt){
      const parent = opt.closest('.dep-select');
      const val = opt.dataset.value;

      if(parent?.dataset.select === 'coin'){
        if(coinText){ coinText.textContent = val; delete coinText.dataset.empty; }
        page.querySelectorAll('.dep-pill').forEach(p => p.classList.toggle('active', p.dataset.coin===val));

        setStepDone(step1,true);
        setStepActive(step1,false);

        setStepDisabled(step2,false);
        setStepActive(step2,true);

        setStepDisabled(step3,true);
        setStepActive(step3,false);
        if(addrCard) addrCard.style.display='none';
        if(addrEl) addrEl.textContent='';
        step2.classList.remove('is-disabled');
      }

      if(parent?.dataset.select === 'network'){
        if(netText){ netText.textContent = val; delete netText.dataset.empty; }
        if(netBold) netBold.textContent = val;

        setStepDone(step2,true);
        setStepActive(step2,false);

        setStepDisabled(step3,false);
        setStepActive(step3,true);

        if(addrEl) addrEl.textContent = '0x6385b5d5b18ae6ea940d10282062401f99f0ef82';
        if(addrCard) addrCard.style.display='block';
        step3.classList.remove('is-disabled');
      }

      parent?.classList.remove('open');
      return;
    }

    // выбрать coin через pills
    if(pill){
      const val = pill.dataset.coin;
      if(coinText){ coinText.textContent = val; delete coinText.dataset.empty; }

      page.querySelectorAll('.dep-pill').forEach(p => p.classList.remove('active'));
      pill.classList.add('active');

      setStepDone(step1,true);
      setStepActive(step1,false);

      setStepDisabled(step2,false);
      setStepActive(step2,true);

      // сброс network/addr
      if(netText){ netText.textContent='Please select'; netText.dataset.empty='1'; }
      if(netBold) netBold.textContent='—';
      setStepDone(step2,false);

      setStepDisabled(step3,true);
      setStepActive(step3,false);
      if(addrCard) addrCard.style.display='none';
      if(addrEl) addrEl.textContent='';
      return;
    }

    // клик вне — закрыть меню
    page.querySelectorAll('.dep-select').forEach(s => s.classList.remove('open'));
  });
}

const select = document.getElementById("cryptoSelect");
if (select) {
  const btn = select.querySelector('.dep-select-btn');
const label = document.getElementById('cryptoLabel');
const icon = btn.querySelector('.coin-ic');

btn.addEventListener('click', () => {
  select.classList.toggle('open');
});

select.querySelectorAll('.dep-opt').forEach(opt => {
  opt.addEventListener('click', () => {
    label.textContent = opt.dataset.value;
    icon.src = opt.dataset.icon;
    select.classList.remove('open');
  });
});

document.addEventListener('click', e => {
  if (!select.contains(e.target)) {
    select.classList.remove('open');
  }
});
}

function exitTradingMode(){

  try { stopOrderBook(); } catch (e) {}
  document.body.classList.remove("spot-mode");
  document.body.classList.remove("futures-mode");
  const sp = document.getElementById("spot-page");
  if (sp) sp.style.display = "none";
}

function openTradingPage(mode){
  hideAuth?.();
  exitTradingMode(); // если уже был spot/futures-mode

  hideAllPages?.();
  hideHomeSections?.();

  const sp = document.getElementById("spot-page");
  if (sp) sp.style.display = "block";
  window.AX_ACTIVE_CHART_SOURCE = "spot";
  try{ window.mountSharedChart && window.mountSharedChart("spot"); }catch(e){}

  // режим (визуально один и тот же терминал, но разный "контекст" страницы)
  if (mode === "futures") {
    document.body.classList.add("futures-mode");
    document.body.classList.remove("spot-mode");
    location.hash = "futures";
  } else {
    document.body.classList.add("spot-mode");
    document.body.classList.remove("futures-mode");
    location.hash = "spot";
  }

  document.body.classList.remove("cabinet-mode");

  window.scrollTo({ top: 0, behavior: "smooth" });

  // после показа — пересчитать размеры канваса/графика
  setTimeout(() => {
    window.dispatchEvent(new Event("resize"));
    window.AX_CHART?.redraw?.();
  }, 0);
}

function openSpotPage() { openTradingPage("spot"); }

(function () {
  function safeCall(fnName) {
    const fn = window[fnName];
    if (typeof fn === 'function') { fn(); return true; }
    return false;
  }
document.documentElement.classList.remove("stocks-trade-mode");
  document.addEventListener('click', function (e) {
    const a = e.target.closest('a, button, [role="button"], .clickable');
    if (!a) return;

    // 1) ЛОГО -> HOME
    if (a.id === 'logo' || a.closest('#logo') || a.classList.contains('logo')) {
      e.preventDefault();
      safeCall('openHomePage') || (location.hash = '#home');
      return;
    }

    const text = (a.textContent || '').trim().toLowerCase();

    // 2) DEPOSIT
    if (text === 'deposit' || a.dataset.action === 'deposit' || a.id === 'depositBtn') {
      e.preventDefault();
      safeCall('openDepositPage') || (location.hash = '#deposit');
      return;
    }

    // 3) ASSETS -> CABINET
    if (text === 'assets' || a.dataset.action === 'assets') {
      e.preventDefault();
      safeCall('openCabinetPage') || (location.hash = '#cabinet');
      return;
    }

    // 4) MARKETS / FOREX / STOCKS
    if (text === 'markets') {
      e.preventDefault();
      safeCall('openHomePage') || (location.hash = '#home');
      return;
    }
    if (text === 'forex') {
      e.preventDefault();
      safeCall('openForexpPage') || (location.hash = '#forex');
      return;
    }
    if (text === 'stocks') {
      e.preventDefault();
      safeCall('openStockspPage') || (location.hash = '#stocks');
      return;
    }

    // 5) Стоп на FUTURES (если где-то осталась кнопка/ссылка)
    if (text === 'futures' || a.dataset.action === 'futures') {
      e.preventDefault();
      safeCall('openHomePage') || (location.hash = '#spot');
      return;
    }
  }, true);
})();

function openAdminPage(){
  hideAuth?.();
  hideAllPages?.();
  hideHomeSections?.();
  exitSpotMode?.();
  resetTopbarTheme?.();

  const el = document.getElementById("admin-page");
  if (el) el.style.display = "block";

  // маленький UI-статус
  const st = document.getElementById("admin-status");
  if (st) st.textContent = "Admin access granted";

  location.hash = "admin";
  window.scrollTo({top:0, behavior:"smooth"});
  document.body.classList.add("cabinet-mode");
}

async function openAdminSafely(){
  try{
    const r = await fetch("/api/admin/ping");
    if (r.ok) {
      openAdminPage();
    } else {
      alert("Нет доступа");
      // можно вернуть в кабинет:
      openCabinetPage?.();
    }
  }catch(e){
    console.error(e);
    alert("Ошибка сети");
  }
}


// if (location.hash === '#spot') {
//   openSpotPage();
// }

// ===== Pairs dataset (можешь расширять хоть до тысяч) =====

// ===== REAL BINANCE USDT PAIRS =====
let PAIRS = [];
let PAIRS_SET = new Set();

const PAIRS_CACHE_KEY = "ArsteX_pairs_usdt_v1";
const PAIRS_CACHE_TTL_MS = 6 * 60 * 60 * 1000; // 6h

function rebuildPairsSet() {
  PAIRS_SET = new Set(PAIRS.map(p => p.key));
}

const CG_TOP_CACHE_KEY = "ArsteX_cg_top100_v1";
const CG_TOP_TTL_MS = 6 * 60 * 60 * 1000; // 6h

function isJunkBase(base) {
  return /(UP|DOWN|BULL|BEAR)$/.test(base);
}

async function loadTop100PairsFromCoinGeckoAndBinance() {
  // 1) CoinGecko TOP-100 по объёму (с иконками)
  let cgTop = null;
  try {
    const cached = JSON.parse(localStorage.getItem(CG_TOP_CACHE_KEY) || "null");
    if (cached && Array.isArray(cached.items) && (Date.now() - cached.ts) < CG_TOP_TTL_MS) {
      cgTop = cached.items;
    }
  } catch {}

  if (!cgTop) {
    const cgRes = await fetch(
      "https://api.coingecko.com/api/v3/coins/markets" +
      "?vs_currency=usd&order=volume_desc&per_page=100&page=1&sparkline=false"
    );
    if (!cgRes.ok) throw new Error("CoinGecko markets failed: " + cgRes.status);
    const data = await cgRes.json();

    cgTop = (Array.isArray(data) ? data : []).map(c => ({
      id: c.id,
      symbol: (c.symbol || "").toUpperCase(),
      name: c.name || "",
      icon: c.image || ""
    }));

    try { localStorage.setItem(CG_TOP_CACHE_KEY, JSON.stringify({ ts: Date.now(), items: cgTop })); } catch {}
  }

  const cgBySymbol = new Map();
  cgTop.forEach(c => { if (c.symbol && !cgBySymbol.has(c.symbol)) cgBySymbol.set(c.symbol, c); });

  // 2) Binance: какие BASE/USDT реально торгуются
  const exRes = await fetch("https://api.binance.com/api/v3/exchangeInfo");
  if (!exRes.ok) throw new Error("Binance exchangeInfo failed: " + exRes.status);
  const exData = await exRes.json();
  const symbols = Array.isArray(exData.symbols) ? exData.symbols : [];

  const binanceUsdt = symbols
    .filter(s => s.quoteAsset === "USDT" && s.status === "TRADING")
    .map(s => ({ base: (s.baseAsset || "").toUpperCase(), binanceSymbol: s.symbol }));

  // 3) Пересечение + собираем PAIRS
  PAIRS = [];
  for (const b of binanceUsdt) {
    if (!b.base || isJunkBase(b.base)) continue;
    const cg = cgBySymbol.get(b.base);
    if (!cg) continue;

    PAIRS.push({
      key: `${b.base}/USDT`,
      base: b.base,
      quote: "USDT",
      name: cg.name || b.base,
      binanceSymbol: b.binanceSymbol,
      icon: cg.icon || ""
    });
  }

  // гарантируем максимум 100
  PAIRS = PAIRS.slice(0, 100);

  rebuildPairsSet();
  return PAIRS;
}








const pairWrap = document.querySelector(".pair-select-wrap");
const listEl = document.getElementById("pair-list");
const searchEl = document.getElementById("pair-search");

function ensurePairState(pairKey){
  if (!window.SPOT_PAIRS) window.SPOT_PAIRS = {};
  if (!window.SPOT_PAIRS[pairKey]){
    const p = PAIRS.find(x => x.key === pairKey);
    window.SPOT_PAIRS[pairKey] = {
      base: p?.base,
      quote: p?.quote,
      name: p?.name,
      price: 0,
      volBase: 0,
      volQuote: 0,     // 24h quote volume (USDT)
      changePct: 0,    // 24h change %
      high: 0,
      low: 0
    };
  }
}

function spotRefreshUI(){
  

  // v24: if UI pair changed but chart didn't rebuild (e.g., after SIM clear / async), force rebuild
  try{
    if (window.AX_ACTIVE_CHART_SOURCE !== 'stocks' && window.SPOT_SELECTED && window.__chartActiveKey && window.SPOT_SELECTED !== window.__chartActiveKey) {
      // prevent loops
      window.__chartActiveKey = window.SPOT_SELECTED;
      if (typeof rebuildChartForSelectedPair === "function") rebuildChartForSelectedPair(__lastChartTF);
    }
  }catch(e){}

// Re-render top stats + order book using the same price source as the chart.
  try{
    if (window.AX_ACTIVE_CHART_SOURCE !== 'stocks' && window.SPOT_SELECTED && typeof renderPair === "function") renderPair(window.SPOT_SELECTED);
  }catch(e){}
  try{
    if (typeof renderOrderBook === "function" && typeof __obLatest !== "undefined" && __obLatest){
      renderOrderBook(__obLatest.bids, __obLatest.asks);
    }
  }catch(e){}
}




function renderPairList(filter=""){
  const q = filter.trim().toLowerCase();
  listEl.innerHTML = "";

  let items = PAIRS.filter(p =>
    !q ||
    p.key.toLowerCase().includes(q) ||
    p.name.toLowerCase().includes(q) ||
    p.base.toLowerCase().includes(q)
  );

  // вкладки: usdt / favorites
  if (ACTIVE_TAB === "usdt") {
    items = items.filter(p => p.quote === "USDT");
  }
  if (ACTIVE_TAB === "favorites") {
    const favs = loadFavs();
    items = items.filter(p => favs.includes(p.key));
  }

  items.forEach(p => {
    ensurePairState(p.key);
    const st = window.SPOT_PAIRS[p.key];

    const row = document.createElement("div");
    row.className = "pair-item";

    const priceStr = st.price < 1 ? st.price.toFixed(4) : st.price.toFixed(2);
    const chg = Number(st.changePct || 0);
    const vol = Number(st.volQuote || 0);

    const favActive = isFav(p.key);

    row.innerHTML = `
      <div class="pair-left">
        <div class="pair-star ${favActive ? "active" : ""}" title="Favorite">
          ${favActive ? "★" : "☆"}
        </div>
        <div class="pair-asset">
          <div class="pair-sym">${p.key}</div>
          <div class="pair-vol">${formatVol(vol)}</div>
        </div>
      </div>

      <div class="pair-price">${priceStr}</div>

      <div class="pair-chg ${chg >= 0 ? "up" : "down"}">
        ${chg >= 0 ? "+" : ""}${chg.toFixed(2)}%
      </div>
    `;

    // клик по звезде (НЕ закрывает)
    row.querySelector(".pair-star").addEventListener("click", (e) => {
      e.stopPropagation();
      toggleFav(p.key);
      renderPairList(searchEl.value || "");
    });

    // клик по строке (выбор пары + закрыть)
    row.addEventListener("click", () => {
  window.SPOT_SELECTED = p.key;
  renderPair(window.SPOT_SELECTED);
  rebuildChartForSelectedPair(__lastChartTF); // <-- ДОБАВЬ
  pairWrap.classList.remove("open");
});

    listEl.appendChild(row);
  });
}

function formatVol(n){
  if (!n) return "—";
  if (n >= 1e9) return (n/1e9).toFixed(2) + "B";
  if (n >= 1e6) return (n/1e6).toFixed(2) + "M";
  if (n >= 1e3) return (n/1e3).toFixed(2) + "K";
  return n.toFixed(2);
}


let BINANCE_WS = null;

function binanceToPairKey(sym){
  // BTCUSDT -> BTC/USDT
  if (!sym.endsWith("USDT")) return null;
  return sym.slice(0, -4) + "/USDT";
}

function startSpotLive(){
  if (BINANCE_WS) return;

  BINANCE_WS = new WebSocket("wss://stream.binance.com:9443/ws/!ticker@arr");

  BINANCE_WS.onmessage = (ev) => {
    const arr = JSON.parse(ev.data); // массив тикеров

    for (const t of arr) {
      const key = binanceToPairKey(t.s);
      if (!key) continue;

      // обновляем только те пары, которые есть в твоём списке PAIRS
      if (!PAIRS_SET.has(key)) continue;

      ensurePairState(key);
      const st = window.SPOT_PAIRS[key];

      st.price = Number(t.c);        // last price
      st.changePct = Number(t.P);    // 24h change percent
      st.high = Number(t.h);         // 24h high
      st.low  = Number(t.l);
      st.volBase  = Number(t.v);         // 24h low
      st.volQuote = Number(t.q);     // 24h quote volume (USDT)
    }

    // обновляем UI:
    if (window.AX_ACTIVE_CHART_SOURCE !== 'stocks' && window.SPOT_SELECTED && (!window.CHART_SIM || CHART_SIM.mode === "off")) renderPair(window.SPOT_SELECTED);
    if (pairWrap?.classList.contains("open")) {
      renderPairList(searchEl.value || "");
    }
  };

  BINANCE_WS.onclose = () => {
    BINANCE_WS = null;
    setTimeout(startSpotLive, 1000);
  };

  BINANCE_WS.onerror = () => {
    // дадим переподключиться через onclose
    try { BINANCE_WS.close(); } catch {}
  };
}




const pairBtn = document.getElementById("spot-pair-btn");
const dd = document.getElementById("pair-dd");
dd?.addEventListener("click", (e) => e.stopPropagation());

/* ===================== SPOT: ORDER BOOK (Binance depth stream) ===================== */
let __obLastPaint = 0;
let __obTimer = null;
let __obLatest = null;
const OB_PAINT_MS = 250; // 250-400 обычно приятно
let __obWS = null;
let __obSymbol = null;
let __obPrevMid = null;

function stopOrderBook(){
  try { __obWS?.close?.(); } catch {}
  __obWS = null;
  __obSymbol = null;

  const asksEl = document.getElementById("ob-asks");
  const bidsEl = document.getElementById("ob-bids");
  const midEl  = document.getElementById("ob-mid");
  if (asksEl) asksEl.innerHTML = '<div class="ob-empty">—</div>';
  if (bidsEl) bidsEl.innerHTML = '<div class="ob-empty">—</div>';
}

function startOrderBook(binanceSymbol){
  const asksEl = document.getElementById("ob-asks");
  const bidsEl = document.getElementById("ob-bids");
  const midEl  = document.getElementById("ob-mid");

  if (!asksEl || !bidsEl || !midEl) return;
  if (!binanceSymbol) return stopOrderBook();

  if (__obSymbol === binanceSymbol && __obWS && (__obWS.readyState === 0 || __obWS.readyState === 1)) return;

  stopOrderBook();
  __obSymbol = binanceSymbol;

  asksEl.innerHTML = '<div class="ob-empty">Loading…</div>';
  bidsEl.innerHTML = '<div class="ob-empty">Loading…</div>';

  const stream = `${binanceSymbol.toLowerCase()}@depth20@100ms`;
  const url = `wss://stream.binance.com:9443/ws/${stream}`;

  __obWS = new WebSocket(url);

  __obWS.onmessage = (ev) => {
    let msg = null;
    try { msg = JSON.parse(ev.data); } catch { return; }

    const asks = Array.isArray(msg.asks) ? msg.asks : [];
    const bids = Array.isArray(msg.bids) ? msg.bids : [];

    // Binance дает asks по возрастанию цены (лучшие ближе к началу).
    // Чтобы "лучший ask" был ближе к середине — реверсим.
    __obLatest = { bids, asks };

const now = Date.now();
const wait = Math.max(0, OB_PAINT_MS - (now - __obLastPaint));

if (__obTimer) return; // уже запланирован рендер

__obTimer = setTimeout(() => {
  __obTimer = null;
  __obLastPaint = Date.now();
  if (__obLatest) renderOrderBook(__obLatest.bids, __obLatest.asks);
}, wait);
  };

  __obWS.onclose = () => {
    if (__obSymbol === binanceSymbol) {
      // мягко показываем, что поток остановился
      if (asksEl && asksEl.innerHTML.trim() === "") asksEl.innerHTML = '<div class="ob-empty">—</div>';
      if (bidsEl && bidsEl.innerHTML.trim() === "") bidsEl.innerHTML = '<div class="ob-empty">—</div>';
    }
  };

  __obWS.onerror = () => {
    // не спамим, просто оставляем текущие данные/плейсхолдер
  };
}

function renderOrderBook(bidsRaw, asksRaw){
  const asksEl = document.getElementById("ob-asks");
  const bidsEl = document.getElementById("ob-bids");
  if (!asksEl || !bidsEl) return;

  // 1) convert Binance raw arrays -> objects {p,q}
  const bids = (bidsRaw || []).map(([p,q]) => ({ p: Number(p), q: Number(q) }))
                              .filter(x => Number.isFinite(x.p) && Number.isFinite(x.q));
  const asks = (asksRaw || []).map(([p,q]) => ({ p: Number(p), q: Number(q) }))
                              .filter(x => Number.isFinite(x.p) && Number.isFinite(x.q));

  // 2) BUY/SELL majority
  const buyBar   = document.getElementById("ob-pressure-buy");
  const sellBar  = document.getElementById("ob-pressure-sell");
  const buyPctEl = document.getElementById("ob-buy-pct");
  const sellPctEl= document.getElementById("ob-sell-pct");

  const bidSum = bids.reduce((s,x) => s + (x.p * x.q), 0);
  const askSum = asks.reduce((s,x) => s + (x.p * x.q), 0);
  const total  = bidSum + askSum;

  let buyPct = 50;
  if (total > 0) buyPct = Math.round((bidSum / total) * 100);
  const sellPct = 100 - buyPct;

  if (buyBar && sellBar){
    buyBar.style.width  = buyPct + "%";
    sellBar.style.width = sellPct + "%";
  }
  if (buyPctEl)  buyPctEl.textContent  = `Buy: ${buyPct}%`;
  if (sellPctEl) sellPctEl.textContent = `Sell: ${sellPct}%`;

  // 3) MID (2 строки + цвет)
  const midWrap  = document.getElementById("ob-mid");
  const midPrice = document.getElementById("ob-mid-price");
  const midSub   = document.getElementById("ob-mid-sub");


  // --- SIM: shift orderbook prices to match synthetic chart price ---
  const rawBestBid = bids[0]?.p ?? null;
  const rawBestAsk = asks[0]?.p ?? null;

  let __obShift = 0;
  const hasSim = (typeof CHART_SIM !== "undefined" && CHART_SIM.mode !== "off" && CHART_SIM.cur && Number.isFinite(CHART_SIM.cur.c));

  if (hasSim && Number.isFinite(rawBestBid) && Number.isFinite(rawBestAsk)){
    const liveMid = (rawBestAsk + rawBestBid) / 2;
    __obShift = Number(CHART_SIM.cur.c) - liveMid;

    // shift levels (prices only), keep quantities
    for (const x of bids) x.p = x.p + __obShift;
    for (const x of asks) x.p = x.p + __obShift;
  }

  // recompute best bid/ask AFTER shifting (and optionally override mid to synthetic)
  const bestBid = bids[0]?.p ?? null;
  const bestAsk = asks[0]?.p ?? null;

  if (midWrap && midPrice && midSub && bestBid && bestAsk){
    const spread = bestAsk - bestBid;
    let mid = (bestAsk + bestBid) / 2;
    if (hasSim) mid = Number(CHART_SIM.cur.c);

    if (__obPrevMid != null){
      midWrap.classList.toggle("up", mid > __obPrevMid);
      midWrap.classList.toggle("down", mid < __obPrevMid);
    }
    __obPrevMid = mid;

    const midStr = mid < 1 ? mid.toFixed(6) : mid.toFixed(2);
    const sprStr = spread < 1 ? spread.toFixed(6) : spread.toFixed(2);
    const arrow = midWrap.classList.contains("down") ? "↓" : "↑";

    midPrice.textContent = `${midStr} ${arrow}`;
    midSub.textContent   = `spread: ${sprStr}`;
  }

  // 4) DRAW ORDERBOOK LISTS (ВОТ ЭТОГО У ТЕБЯ НЕ БЫЛО)
  // asks — чтобы лучший ask был ближе к середине: reverse
  const maxRows = (window.innerWidth <= 720) ? 10 : 18;
  // asks: reverse so best ask is near the middle, then take top rows
  asksEl.innerHTML = buildOBHtml(asks.slice().reverse().slice(0, maxRows), "ask");
  bidsEl.innerHTML = buildOBHtml(bids.slice(0, maxRows), "bid");
}

function cleanupStockTrade() {
  // stop bridge interval
  try { if (window.__bridgeTimer) { clearInterval(window.__bridgeTimer); window.__bridgeTimer = null; } } catch(e){}

  // close kline websocket (у тебя есть closeKlineWS())
  try { closeKlineWS(); } catch(e){}

  // stop sim timers if exist
  try { stopBridgeToLive?.(); } catch(e){}
  try { stopChartSimTimer?.(); } catch(e){}
  try { stopChartSim?.(); } catch(e){}

  // IMPORTANT: bump request id so old async fetch results are ignored
  try { window.__chartReqId = (window.__chartReqId || 0) + 1; } catch(e){}
}

function buildOBHtml(levels, side){
  let cum = 0;
  const rows = [];
  for (const lv of levels){
    cum += lv.q;
    rows.push({ ...lv, t: cum });
  }
  const maxT = rows.length ? Math.max(...rows.map(r => r.t)) : 1;

  return rows.map(r => {
    const w = Math.max(0, Math.min(100, (r.t / maxT) * 100));
    const priceStr = r.p < 1 ? r.p.toFixed(6) : r.p.toFixed(2);
    const qtyStr   = r.q < 1 ? r.q.toFixed(6) : r.q.toFixed(4);
    const totStr   = r.t < 1 ? r.t.toFixed(6) : r.t.toFixed(4);

    return `
      <div class="ob-row ${side}">
        <div class="bar" style="width:${w}%; ${side === "ask" ? "margin-left:auto;" : ""}"></div>
        <span class="price">${priceStr}</span>
        <span class="t-right">${qtyStr}</span>
        <span class="t-right">${totStr}</span>
      </div>
    `;
  }).join("") || '<div class="ob-empty">—</div>';
}


function getSpotDisplayPrice(pairKey){
  // When chart simulation is active, use synthetic close as the single source of truth
  try{
    if (typeof CHART_SIM !== "undefined" && CHART_SIM.mode !== "off" && CHART_SIM.cur && Number.isFinite(CHART_SIM.cur.c)) {
      return Number(CHART_SIM.cur.c);
    }
  }catch(e){}
  const st = window.SPOT_PAIRS?.[pairKey];
  const p = st ? Number(st.price) : NaN;
  return Number.isFinite(p) ? p : null;
}


function renderPair(pairKey) {
  const p = PAIRS.find(x => x.key === pairKey);
  if (!p) return;

  ensurePairState(pairKey);
  const st = window.SPOT_PAIRS[pairKey];

  const px = getSpotDisplayPrice(pairKey);


  document.getElementById("spot-pair-symbol").textContent = pairKey;
  document.getElementById("spot-pair-name").textContent = p.name;
  document.getElementById("spot-pair-icon").src = p.icon || "img/coins/default.png";

    if (px != null) {
    const __elPrice = document.getElementById("spot-last-price");
    const __prev = Number(st.__prevDisplayPrice);
    if (Number.isFinite(__prev)) {
      __elPrice.classList.toggle("up", px > __prev);
      __elPrice.classList.toggle("down", px < __prev);
      if (px === __prev) { __elPrice.classList.remove("up","down"); }
    }
    __elPrice.textContent = px < 1 ? px.toFixed(4) : px.toFixed(2);
    st.__prevDisplayPrice = px;
  }

  const __elCh = document.getElementById("spot-24h-change");
  __elCh.textContent = st.changePct.toFixed(2) + "%";
  __elCh.classList.toggle("up", st.changePct > 0);
  __elCh.classList.toggle("down", st.changePct < 0);
  if (st.changePct === 0) { __elCh.classList.remove("up","down"); }

  document.getElementById("spot-24h-vol-base").textContent =
    st.volBase.toFixed(2);

  document.getElementById("spot-24h-vol-quote").textContent =
    st.volQuote.toFixed(2);

  document.getElementById("spot-24h-high").textContent =
    st.high.toFixed(2);

  document.getElementById("spot-24h-low").textContent =
    st.low.toFixed(2);

// 🔥 order book
try { startOrderBook(p?.binanceSymbol || null); } catch (e) {}
}

let __chartReqId = 0;

let __lastChartKey = null;
let __lastChartTF  = "1m";

function tfToMs(tf){
  switch(tf){
    case "1m": return 60_000;
    case "5m": return 5*60_000;
    case "15m": return 15*60_000;
    case "1h": return 60*60_000;
    case "4h": return 4*60*60_000;
    case "1d": return 24*60*60_000;
    default: return 60_000;
  }
}

function tfToTvInterval(tf){
  switch(tf){
    case "1m": return "1";
    case "5m": return "5";
    case "15m": return "15";
    case "1h": return "60";
    case "4h": return "240";
    case "1d": return "D";
    default: return "15";
  }
}

function updateTradingViewEmbed(pairKey, tf){
  const iframe = document.querySelector("#tv-chart iframe");
  if (!iframe) return;

  const sym = toBinanceSymbol(pairKey);         // BTCUSDT
  const tvSym = "BINANCE:" + sym;

  const interval = tfToTvInterval(tf);

  // Rebuild URL safely (keeps other widget params)
  try{
    const u = new URL(iframe.src);
    u.searchParams.set("symbol", tvSym);
    u.searchParams.set("interval", interval);
    iframe.src = u.toString();
  }catch(e){
    // fallback if URL parsing fails
    iframe.src = `https://s.tradingview.com/widgetembed/?symbol=${encodeURIComponent(tvSym)}&interval=${encodeURIComponent(interval)}&theme=dark&style=1&locale=en&toolbarbg=rgba(0,0,0,0)&enable_publishing=false&hide_top_toolbar=false&hide_side_toolbar=false&allow_symbol_change=true`;
  }
}


// --- Smooth catch-up from history to current spot on initial load / pair switch ---
// If the last historical candle is far from the current spot price, we temporarily
// generate synthetic "bridge" candles so the chart reaches live smoothly instead of jumping.
let __bridgeTimer = null;
function stopBridgeToLive(){
  if (__bridgeTimer){ clearInterval(__bridgeTimer); __bridgeTimer = null; }
  try{
    if (typeof CHART_SIM !== "undefined" && CHART_SIM.mode === "bridge"){
      CHART_SIM.mode = "off";
      CHART_SIM.on = false;
      CHART_SIM.cur = null;
    }
  }catch(e){}
}

async function bridgeHistoryToSpotIfNeeded(pairKey, tf, reqId){
  try{
    stopBridgeToLive();
    if (reqId !== __chartReqId) return false;

    // need both history + spot
    const spot = getSpotDisplayPrice(pairKey);
    if (!Number.isFinite(spot)) return true;

    const candles = window.AX_CHART?.candles || HISTORY.candles;
    if (!candles || !candles.length) return true;

    const last = candles[candles.length-1];
    const lastC = Number(last.c);
    if (!Number.isFinite(lastC)) return true;

    const gap = Math.abs(spot - lastC) / Math.max(1, spot);
    // if small gap, do nothing
    if (gap < 0.0025) return true; // 0.25%

    const tfMs = tfToMs(tf) || 60_000;

    // enter bridge mode so top price / orderbook can use synthetic close during catch-up
    if (typeof CHART_SIM !== "undefined"){
      CHART_SIM.mode = "bridge";
      CHART_SIM.on = true;
      CHART_SIM.cur = { t: +last.t, o:+last.o, h:+last.h, l:+last.l, c:+last.c };
    }

    // We mute live candle updates during bridge to avoid jumps,
    // but ticker UI can still update; display uses CHART_SIM in bridge mode.
    LIVE_FEED.muted = true;

    return await new Promise((resolve)=>{
      let prev = { t:+last.t, c:lastC };
      let steps = 0;

      __bridgeTimer = setInterval(()=>{
        if (reqId !== __chartReqId){ stopBridgeToLive(); LIVE_FEED.muted = false; return resolve(false); }

        const nowSpot = getSpotDisplayPrice(pairKey);
        if (!Number.isFinite(nowSpot)){ return; }

        const remaining = nowSpot - prev.c;
        const rel = Math.abs(remaining) / Math.max(1, nowSpot);

        // stop when close enough, or safety max steps
        if (rel < 0.0006 || steps > 180){
          stopBridgeToLive();
          LIVE_FEED.muted = false;
          return resolve(true);
        }

        // move 12% toward spot each step, with tiny jitter
        const drift = remaining * 0.12;
        const jitter = (Math.random() - 0.5) * Math.abs(remaining) * 0.02;
        let nextC = prev.c + drift + jitter;

        // construct a plausible candle
        const t = prev.t + tfMs;
        const o = prev.c;
        const c = nextC;
        const hi = Math.max(o, c) + Math.abs(c-o)*0.25;
        const lo = Math.min(o, c) - Math.abs(c-o)*0.25;

        const candle = { t, o, h:hi, l:lo, c, synthetic:true, bridge:true };

        // append to chart + history
        try{
          HISTORY.candles.push(candle);
          if (window.AX_ACTIVE_CHART_SOURCE !== 'stocks') window.AX_CHART?.setCandles(HISTORY.candles);
        }catch(e){}

        // advance CHART_SIM current candle so UI (top price/orderbook) matches
        try{
          if (typeof CHART_SIM !== "undefined" && CHART_SIM.mode === "bridge"){
            CHART_SIM.cur = { t, o, h:hi, l:lo, c };
          }
        }catch(e){}

        prev = { t, c };
        steps++;
      }, 140); // fast catch-up animation
    });

  }catch(e){
    try{ stopBridgeToLive(); LIVE_FEED.muted = false; }catch(_){}
    return true;
  }
}


const HISTORY = {
  candles: [],
  loading: false,
  oldestOpenTime: null,
  symbol: null,
  interval: null,
};

async function initHistory(symbol, interval, reqId) {
  HISTORY.candles = [];
  HISTORY.loading = false;
  HISTORY.symbol = symbol;
  HISTORY.interval = interval;
  HISTORY.oldestOpenTime = null;

  const chunk = await fetchKlinesChunk(symbol, interval, null, 1000);

  // ✅ если за время fetch пользователь переключил пару/TF — игнор
  if (reqId !== __chartReqId) return false;

  if (!chunk.length) {
    if (window.AX_ACTIVE_CHART_SOURCE !== 'stocks') window.AX_CHART?.setCandles([]);
    return true;
  }

const mapped = mapKlinesToCandles(chunk);

// ---- merge persisted synthetic history (per symbol+interval) ----
let merged = mapped;
const savedSim = SIM_PERSIST.load(symbol, interval);
if (savedSim && Array.isArray(savedSim.candles) && savedSim.candles.length){
  const baseLiveT = Number(savedSim.baseLiveT);
  const timeShiftMs = Number(savedSim.timeShiftMs) || 0;

  if (Number.isFinite(baseLiveT)){
    // Fork timeline: keep ONLY real candles up to the moment simulation started
    merged = mapped.filter(c => c && Number.isFinite(c.t) && c.t <= baseLiveT);

    // Append synthetic candles (sorted, dedup by t)
    const syn = savedSim.candles
      .filter(c => c && Number.isFinite(c.t))
      .map(c => ({ t:+c.t, o:+c.o, h:+c.h, l:+c.l, c:+c.c, synthetic:true }))
      .sort((a,b)=>a.t-b.t);


    // If simulation was active before refresh, restore it (UI + muted live feed)
    try{
      const simOn = localStorage.getItem("ArsteX_ui_sim_on_v1");
      if ((savedSim.mode === "sim") && (simOn !== "0")) {
        // defer actual sim start until chart is rendered, otherwise we can end up muted without a running timer
        __resumeSimDir = Number(savedSim.dir || localStorage.getItem("ArsteX_ui_sim_dir_v1") || 0) || +1;

        // pre-highlight sim buttons (actual start happens after setCandles)
        document.querySelectorAll('#chart-draw-tools .tool-btn[data-tool="sim-up"], #chart-draw-tools .tool-btn[data-tool="sim-down"]')
          .forEach(b => b.classList.toggle("active",
            (__resumeSimDir > 0 && b.dataset.tool === "sim-up") ||
            (__resumeSimDir < 0 && b.dataset.tool === "sim-down")
          ));
      }
    }catch(e){}
    for (const c of syn){
      const prev = merged[merged.length-1];
      if (prev && prev.t === c.t) merged[merged.length-1] = c;
      else if (!prev || c.t > prev.t) merged.push(c);
    }

    // adopt persistence anchor
    SIM_PERSIST.baseLiveT = baseLiveT;
    LIVE_FEED.timeShiftMs = Math.max(0, timeShiftMs, (syn[syn.length-1]?.t || baseLiveT) - baseLiveT);
  }
} else {
  // no persisted sim for this pair+tf
  SIM_PERSIST.baseLiveT = null;
  LIVE_FEED.timeShiftMs = 0;
}

HISTORY.candles = merged;
HISTORY.oldestOpenTime = merged[0]?.t ?? null;


// ensure current synthetic candle for UI/OB sync after reload
try{
  if (CHART_SIM.mode === "sim") {
    const last = merged[merged.length-1];
    if (last) CHART_SIM.cur = last;
  }
}catch(e){}
if (reqId !== __chartReqId) return false;
if (window.AX_ACTIVE_CHART_SOURCE !== 'stocks') window.AX_CHART?.setCandles(HISTORY.candles);

// resume simulation if it was active before reload
if (__resumeSimDir) {
  const d = __resumeSimDir;
  __resumeSimDir = null;
  // ensure we don't stay muted without a timer
  LIVE_FEED.muted = false;
  requestAnimationFrame(() => startChartSim(d));
} else {
  // ensure live updates keep flowing
  LIVE_FEED.muted = false;
}

return true;
}


async function loadOlderIfNeeded() {
  if (HISTORY.loading) return;
  if (!HISTORY.oldestOpenTime) return;

  const reqId = __chartReqId; // ✅ фиксируем актуальный запрос
  HISTORY.loading = true;
  try {
    const endTime = HISTORY.oldestOpenTime - 1;
    const chunk = await fetchKlinesChunk(HISTORY.symbol, HISTORY.interval, endTime, 1000);

    if (reqId !== __chartReqId) return; // ✅ уже переключили пару/TF
    if (!chunk.length) return;

    const mapped = mapKlinesToCandles(chunk);
    HISTORY.candles = mapped.concat(HISTORY.candles);
    HISTORY.oldestOpenTime = HISTORY.candles[0].t;

    if (window.AX_ACTIVE_CHART_SOURCE !== 'stocks') window.AX_CHART?.setCandles(HISTORY.candles);
  } finally {
    HISTORY.loading = false;
  }
}

const KLINE_LIMIT = 1000;

async function fetchKlinesChunk(symbol, interval, endTime = null, limit = KLINE_LIMIT) {
  const url =
    `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}` +
    `&limit=${limit}` +
    (endTime ? `&endTime=${endTime}` : "");

  const res = await fetch(url);
  const data = await res.json();
  return Array.isArray(data) ? data : [];
}

async function rebuildChartForSelectedPair(tf = __lastChartTF){
  __lastChartTF = tf;

  // если в этот момент включена симуляция — выключаем, чтобы переключение пары/TF вернуло live
  if (typeof CHART_SIM !== "undefined" && CHART_SIM.on) stopChartSim();

  const key = window.SPOT_SELECTED;
  if (!key) return;

  // Update TradingView widget immediately (mobile/desktop)
  try{ updateTradingViewEmbed(key, tf); }catch(e){}

  
  // v24: remember which pair the chart is currently showing
  window.__chartActiveKey = key;
const stamp = key + "|" + tf;
  if (stamp === __lastChartKey) return;
  __lastChartKey = stamp;


// 🧹 clear previous chart immediately so old pair doesn't "stick" during async load
try { closeKlineWS(); } catch {}
try { if (window.AX_ACTIVE_CHART_SOURCE !== 'stocks') window.AX_CHART?.setCandles([]); } catch {}

// ✅ hard reset of all live/sim state so new pair never inherits old zoom/shift/ticks
try {
  LIVE_FEED.muted = false;
  LIVE_FEED.lastCandleRaw = null;
  LIVE_FEED.lastCandle = null;
  LIVE_FEED.lastClose = null;
  LIVE_FEED.timeShiftMs = 0;
} catch {}

try {
  if (window.HISTORY) {
    HISTORY.candles = [];
    HISTORY.oldestOpenTime = 0;
  }
} catch {}

try {
  if (typeof SIM_PERSIST !== "undefined") {
    SIM_PERSIST.baseLiveT = null;
    SIM_PERSIST.scenario = null;
    SIM_PERSIST.dir = 0;
  }
} catch {}
  const symbol = toBinanceSymbol(key);

  // ✅ новый запрос (пара/таймфрейм) — новый id
  const reqId = ++__chartReqId;

  // ✅ сразу гасим старый WS, чтобы он не дописывал свечи
  closeKlineWS();
  try{ stopBridgeToLive(); }catch(e){}

  try { await waitForChart(); } catch(e){}

  // ✅ история
  const ok = await initHistory(symbol, tf, reqId);
  if (!ok) return;              // запрос устарел

  if (reqId !== __chartReqId) return; // пока грузили — переключили пару
  // smooth catch-up to current spot if needed (prevents jump/obryv on reload)
  await bridgeHistoryToSpotIfNeeded(key, tf, reqId);
  if (reqId !== __chartReqId) return;
  startKlineWS(symbol, tf);
}




let KLINE_WS = null;

// LIVE feed state (used to smoothly return from simulation)
const LIVE_FEED = {
  muted: false,
  lastClose: null,
  lastCandle: null,
  lastCandleRaw: null,
  timeShiftMs: 0,
};





function toBinanceSymbol(pairKey){
  const p = PAIRS.find(x => x.key === pairKey);
  return (p?.binanceSymbol || pairKey.replace("/", "")).toUpperCase();
}

function mapKlinesToCandles(klines){
  return klines.map(k => ({
    t: Number(k[0]),
    o: Number(k[1]),
    h: Number(k[2]),
    l: Number(k[3]),
    c: Number(k[4]),
  }));
}

function closeKlineWS(){
  if (KLINE_WS){
    try { KLINE_WS.close(); } catch(e) {}
    KLINE_WS = null;
  }
}

function startKlineWS(symbol, interval){
  closeKlineWS();
  const stream = `${symbol.toLowerCase()}@kline_${interval}`;
  KLINE_WS = new WebSocket(`wss://stream.binance.com:9443/ws/${stream}`);
  const token = __chartReqId; // ✅ ignore late WS messages after pair/TF switch

  KLINE_WS.onmessage = (ev) => {
    if (token !== __chartReqId) return; // stale stream
    const msg = JSON.parse(ev.data);
    const k = msg?.k;
    if (!k) return;

    // raw live candle (real exchange timestamps)
    const candleRaw = {
      t: Number(k.t),
      o: Number(k.o),
      h: Number(k.h),
      l: Number(k.l),
      c: Number(k.c),
    };

    // always track latest live candle/price (even when chart is muted)
    LIVE_FEED.lastCandleRaw = candleRaw;
    LIVE_FEED.lastCandle = candleRaw; // backward compat
    LIVE_FEED.lastClose = candleRaw.c;

    if (LIVE_FEED.muted) return;

    // shift live timeline so it continues AFTER synthetic candles (preserves synthetic history)
    const shift = Number(LIVE_FEED.timeShiftMs) || 0;
    const candle = { ...candleRaw, t: candleRaw.t + shift };

    if (window.AX_ACTIVE_CHART_SOURCE !== 'stocks') {
  window.AX_CHART?.updateLast(candle);
}

    // sync HISTORY without wiping synthetic candles
    if (Array.isArray(HISTORY.candles)) {
      const prev = HISTORY.candles[HISTORY.candles.length - 1];
      if (prev && prev.t === candle.t) HISTORY.candles[HISTORY.candles.length - 1] = candle;
      else if (!prev || candle.t > prev.t) HISTORY.candles.push(candle);
    }
  };

  KLINE_WS.onclose = () => { KLINE_WS = null; };

  KLINE_WS.onclose = () => { KLINE_WS = null; };
}






// открыть / закрыть dropdown
if (pairBtn && pairWrap && searchEl && listEl) pairBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  pairWrap.classList.toggle("open");
  if (pairWrap.classList.contains("open")) {
    searchEl.value = "";
    renderPairList("");
    setTimeout(() => searchEl.focus(), 0);

ACTIVE_TAB = "usdt";
document.querySelectorAll(".pair-tab").forEach(x => {
  x.classList.toggle("active", x.dataset.tab === "usdt");
});
renderPairList("");

  }
});

document.addEventListener("click", () => {
  if (pairWrap) pairWrap.classList.remove("open");
});
searchEl.addEventListener("input", () => renderPairList(searchEl.value));


function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

// синтетические свечи "как реальные", но от текущей цены
function genFakeCandlesFromPrice({
  startPrice,
  bars = 200,
  intervalMs = 60_000,
  endTimeMs = Date.now(),
  volatility = 0.0025,     // 0.25% на свечу
  drift = 0.0              // небольшой тренд
}) {
  let p = Math.max(1e-8, Number(startPrice) || 1);
  const out = [];
  const startTime = endTimeMs - bars * intervalMs;

  // небольшой "режим рынка"
  let vol = volatility;

  for (let i = 0; i < bars; i++) {
    const t = startTime + i * intervalMs;

    // иногда спокойнее/бурнее
    if (Math.random() < 0.03) vol *= 1.3;
    if (Math.random() < 0.03) vol *= 0.85;
    vol = clamp(vol, 0.0007, 0.012);

    const o = p;

    // random walk
    const shock = (Math.random() - 0.5) * 2;  // [-1..1]
    const ret = drift + shock * vol;
    const c = Math.max(1e-8, o * (1 + ret));

    // хвосты
    const wickUp = Math.random() * vol * 1.8;
    const wickDn = Math.random() * vol * 1.8;

    const h = Math.max(o, c) * (1 + wickUp);
    const l = Math.min(o, c) * (1 - wickDn);

    out.push({ t, o, h, l: Math.max(1e-8, l), c });
    p = c;

    drift += (Math.random() - 0.5) * 0.00005;
    drift = clamp(drift, -0.0012, 0.0012);
  }

  return out;
}

//
// ===================== CHART SIMULATION (detach from live) =====================
// Нажми ▲ или ▼ — график отцепится от Binance WS и начнет дорисовывать свечи
// "как реальные", но с направлением, которое ты выбрал.
// Нажми ту же кнопку ещё раз — вернём live.

var __resumeSimDir = null; // used to resume simulation after reload
const CHART_SIM = {
  mode: "off",        // "off" | "sim" | "return"
  dir: 0,             // +1 up, -1 down
  timer: null,

  tfMs: 60_000,
  tickMs: 600,
  stepsPerCandle: 100,
  step: 0,

  cur: null,          // current synthetic candle
  drift: 0.0,

  // return-to-live
  target: null,
  returnCandlesLeft: 0,
  // volatility multiplier from UI (0.3..3.0)
  volMul: 1.0,

  // fast return to live (independent of TF)
  returnFast: false,
};

// expose for helpers that check window
window.CHART_SIM = CHART_SIM;


// ===================== SIM PERSISTENCE =====================
// Synthetic candles must survive reload / TF change / pair change.
// We store per (symbol, interval) in localStorage.
const SIM_STORE_PREFIX = "ArsteX_sim_history_v1";

const SIM_PERSIST = {
  baseLiveT: null,       // timestamp (ms) of last REAL candle when simulation started
  saveTimer: null,

  key(symbol, interval){
    return `${SIM_STORE_PREFIX}:${symbol}:${interval}`;
  },

  load(symbol, interval){
    try{
      // v25: one-shot guard after user clears synthetic candles
      try{
        const g = sessionStorage.getItem("ArsteX_clear_sim_once");
        if(g){
          const want = `${symbol}|${interval}`;
          if(g === want){
            sessionStorage.removeItem("ArsteX_clear_sim_once");
            return null;
          }
        }
      }catch(_){}
      const raw = localStorage.getItem(this.key(symbol, interval));
      if(!raw) return null;
      const data = JSON.parse(raw);
      if(!data || !Array.isArray(data.candles)) return null;
      return data;
    }catch(e){
      return null;
    }
  },

  scheduleSave(symbol, interval){
    if(this.saveTimer) return;
    this.saveTimer = setTimeout(()=>{
      this.saveTimer = null;
      this.saveNow(symbol, interval);
    }, 400);
  },

  saveNow(symbol, interval){
    try{
      if(!symbol || !interval) return;
      const baseLiveT = this.baseLiveT;
      if(!Number.isFinite(baseLiveT)) return;

      const syn = (HISTORY.candles || [])
        .filter(c => c && Number.isFinite(c.t) && c.t > baseLiveT)
        .map(c => ({ t:+c.t, o:+c.o, h:+c.h, l:+c.l, c:+c.c }));

      if(!syn.length) return;

      const lastSynT = syn[syn.length-1].t;
      const timeShiftMs = Math.max(0, lastSynT - baseLiveT);

      const payload = {
        baseLiveT,
        timeShiftMs,
        // keep UI mode across reload
        mode: (typeof CHART_SIM !== "undefined" ? CHART_SIM.mode : "off"),
        dir: (typeof CHART_SIM !== "undefined" ? CHART_SIM.dir : 0),
        candles: syn,
        updatedAt: Date.now()
      };

      localStorage.setItem(this.key(symbol, interval), JSON.stringify(payload));
    }catch(e){}
  },

  clear(symbol, interval){
    try{ localStorage.removeItem(this.key(symbol, interval)); }catch(e){}
  }
};

function stopChartSimTimer() {
  if (CHART_SIM.timer) {
    clearInterval(CHART_SIM.timer);
    CHART_SIM.timer = null;
  }
}

function stopChartSimAll() {
  stopChartSimTimer();
  CHART_SIM.mode = "off";
  CHART_SIM.dir = 0;
  CHART_SIM.cur = null;
  CHART_SIM.step = 0;
  CHART_SIM.drift = 0.0;
  CHART_SIM.target = null;
  CHART_SIM.returnCandlesLeft = 0;

  // UI: снять подсветку
  document.querySelectorAll('#chart-draw-tools .tool-btn[data-tool="sim-up"], #chart-draw-tools .tool-btn[data-tool="sim-down"]')
    .forEach(b => b.classList.remove("active"));
}

function beginReturnToLive() {
  // уже выключено — нечего делать
  if (CHART_SIM.mode === "off") return;

  CHART_SIM.mode = "return";
  try{ localStorage.setItem("ArsteX_ui_sim_on_v1","0"); }catch(e){}

  CHART_SIM.dir = 0;

  CHART_SIM.drift = 0.0;
  CHART_SIM.returnFast = true;

  // быстрый возврат не зависит от ТФ — чтобы не ждать минуту/час
  CHART_SIM.tickMs = 200;
  CHART_SIM.stepsPerCandle = 40;

  // цель — последняя известная live-цена
  const tgt = Number(LIVE_FEED.lastClose);
  CHART_SIM.target = (Number.isFinite(tgt) && tgt > 0) ? tgt : null;

  // вернемся плавно за несколько свечей (чем выше ТФ — тем меньше свечей надо)
  const tfMin = Math.max(1, Math.round(CHART_SIM.tfMs / 60_000));
  // количество свечей для "мостика" зависит от того, насколько мы далеко от live-цены
  const cur = CHART_SIM.cur || HISTORY.candles[HISTORY.candles.length - 1];
  const curC = cur ? Number(cur.c) : NaN;
  const tgtC = CHART_SIM.target ? Number(CHART_SIM.target) : NaN;
  const diffPct = (Number.isFinite(curC) && curC > 0 && Number.isFinite(tgtC) && tgtC > 0)
    ? Math.abs((tgtC - curC) / curC)
    : 0.01;

  // чем выше таймфрейм — тем меньше свечей нужно, но всё равно минимум несколько
  const base = Math.round((diffPct * 420) / Math.sqrt(tfMin)); // ~0.5% => ~21 свеча на 1m
  CHART_SIM.returnCandlesLeft = clamp(base, 6, 120);
// остаемся muted пока не состыкуемся
  LIVE_FEED.muted = true;
  // не трогаем timeShiftMs при возврате: live продолжает на смещённом таймлайне до состыковки
  // UI: снять подсветку (режим "возврата" не направление)
  document.querySelectorAll('#chart-draw-tools .tool-btn[data-tool="sim-up"], #chart-draw-tools .tool-btn[data-tool="sim-down"]')
    .forEach(b => b.classList.remove("active"));
}

function stopChartSim(){
  stopChartSimAll();
}

function startChartSim(dir) {
  // toggle: если нажали ту же кнопку — не рубим сразу, а плавно возвращаемся к live
  if (CHART_SIM.mode === "sim" && CHART_SIM.dir === dir) {
    beginReturnToLive();
    return;
  }

  CHART_SIM.mode = "sim";
  CHART_SIM.returnFast = false;
  CHART_SIM.dir = dir;

  
  try{ localStorage.setItem("ArsteX_ui_sim_dir_v1", String(dir)); localStorage.setItem("ArsteX_ui_sim_on_v1","1"); }catch(e){}
// chart muted от live-обновлений, но мы продолжаем слушать WS в фоне
  LIVE_FEED.muted = true;

  // reset timeline shift at sim start
  LIVE_FEED.timeShiftMs = 0;

  // UI: подсветка активной кнопки
  document.querySelectorAll('#chart-draw-tools .tool-btn[data-tool="sim-up"], #chart-draw-tools .tool-btn[data-tool="sim-down"]')
    .forEach(b => b.classList.toggle("active", (dir > 0 && b.dataset.tool === "sim-up") || (dir < 0 && b.dataset.tool === "sim-down")));

  const tfMs = tfToMs(__lastChartTF);
  CHART_SIM.tfMs = tfMs;

  if (!Array.isArray(HISTORY.candles) || HISTORY.candles.length === 0) return;
  // persistence anchor: remember where the REAL timeline ended when we started simulation
  const simSymbol = HISTORY.symbol;
  const simInterval = HISTORY.interval;
  if (!Number.isFinite(SIM_PERSIST.baseLiveT)) {
    const lastReal = HISTORY.candles[HISTORY.candles.length - 1];
    SIM_PERSIST.baseLiveT = lastReal?.t ?? null;
    if (Number.isFinite(SIM_PERSIST.baseLiveT)) {
      // initial save so it survives refresh even before first full candle closes
      SIM_PERSIST.scheduleSave(simSymbol, simInterval);
    }
  }


  // tick такт: в пределах одной свечи будем "подтягивать" close плавно
  const tickMs = clamp(Math.floor(tfMs / 30), 250, 1200);
  CHART_SIM.tickMs = tickMs;
  CHART_SIM.stepsPerCandle = Math.max(8, Math.round(tfMs / tickMs));
  CHART_SIM.step = 0;

  // волатильность под ТФ (умеренная, чтобы не было "резких" свечей)
  const tfFactor = Math.sqrt(Math.max(1, tfMs) / 60_000);
  let baseVol0 = clamp(0.0012 * tfFactor, 0.0007, 0.012);

  // стартовый дрейф (очень небольшой)
  CHART_SIM.drift = dir * 0.00008;

  // первичная синтетическая свеча
  const last = HISTORY.candles[HISTORY.candles.length - 1];
  const t = Number(last.t) + tfMs;
  const o = Number(last.c);
  CHART_SIM.cur = { t, o, h: o, l: o, c: o };

  // если последняя свеча уже на этом t — перезапишем, иначе добавим
  const prev = HISTORY.candles[HISTORY.candles.length - 1];
  if (prev && prev.t === CHART_SIM.cur.t) HISTORY.candles[HISTORY.candles.length - 1] = CHART_SIM.cur;
  else HISTORY.candles.push(CHART_SIM.cur);

  if (window.AX_ACTIVE_CHART_SOURCE !== 'stocks') {
  window.AX_CHART?.updateLast(CHART_SIM.cur);
}

  // не плодим несколько таймеров
  stopChartSimTimer();

  CHART_SIM.timer = setInterval(() => {
    if (CHART_SIM.mode === "off") return;
    if (window.AX_ACTIVE_CHART_SOURCE === 'stocks') return;
    if (!Array.isArray(HISTORY.candles) || HISTORY.candles.length === 0) return;

    // защитно: если cur потеряли — восстановим
    if (!CHART_SIM.cur) {
      const _last = HISTORY.candles[HISTORY.candles.length - 1];
      CHART_SIM.cur = { t: Number(_last.t) + CHART_SIM.tfMs, o: Number(_last.c), h: Number(_last.c), l: Number(_last.c), c: Number(_last.c) };
      HISTORY.candles.push(CHART_SIM.cur);
    }

    // микро-режимы рынка (редко, очень мягко)
    if (Math.random() < 0.02) baseVol0 *= 1.06;
    if (Math.random() < 0.02) baseVol0 *= 0.95;
    baseVol0 = clamp(baseVol0, 0.0005, 0.02);

    // apply UI multiplier live
    const volNow = clamp(baseVol0 * (Number(CHART_SIM.volMul) || 1), 0.0004, 0.08);

    // drift: слегка "гуляет", но держится в разумных пределах
    CHART_SIM.drift += (Math.random() - 0.5) * 0.00001;
    CHART_SIM.drift = clamp(CHART_SIM.drift, -0.0008, 0.0008);

    const cur = CHART_SIM.cur;

    // базовый дрейф по направлению
    let drift = CHART_SIM.drift + (CHART_SIM.mode === "sim" ? CHART_SIM.dir * 0.00006 : 0);

    // при возврате — мягко тянем цену к target
    if (CHART_SIM.mode === "return" && CHART_SIM.target && cur.c > 0) {
      const gap = (CHART_SIM.target - cur.c) / cur.c; // относительная разница
      // распределяем подтягивание на оставшиеся тики текущей + следующих свечей
      const pull = clamp(gap, -0.02, 0.02) * 0.18 / Math.max(6, CHART_SIM.stepsPerCandle);
      drift += pull;
    }

    // шум: небольшой, чтобы свечи были "живые", но не резкие
    const shock = (Math.random() - 0.5) * 2; // [-1..1]
    const ret = drift + shock * volNow * 0.35;

    const newC = Math.max(1e-8, cur.c * (1 + ret));

    cur.c = newC;
    cur.h = Math.max(cur.h, newC);
    cur.l = Math.min(cur.l, newC);

    // обновляем и график, и историю
    window.AX_CHART.updateLast(cur);
    const lastIdx = HISTORY.candles.length - 1;
    if (HISTORY.candles[lastIdx]?.t === cur.t) HISTORY.candles[lastIdx] = { ...cur };
    spotRefreshUI();
    // keep live timeline shifted so real WS candles continue AFTER synthetic history
    if (Number.isFinite(SIM_PERSIST.baseLiveT) && cur.t > SIM_PERSIST.baseLiveT) {
      LIVE_FEED.timeShiftMs = Math.max(LIVE_FEED.timeShiftMs || 0, cur.t - SIM_PERSIST.baseLiveT);
      SIM_PERSIST.scheduleSave(HISTORY.symbol, HISTORY.interval);
    }

    spotRefreshUI();


    CHART_SIM.step += 1;

    // закончили свечу — стартуем следующую
    if (CHART_SIM.step >= CHART_SIM.stepsPerCandle) {
      CHART_SIM.step = 0;

      // при возврате считаем свечи до переключения обратно в live
      if (CHART_SIM.mode === "return") {
        CHART_SIM.returnCandlesLeft -= 1;

        // если уже достаточно близко к live — можно завершать раньше
        if (CHART_SIM.target && cur.c > 0) {
          const diff = Math.abs((CHART_SIM.target - cur.c) / cur.c);
          if (diff < 0.0008) CHART_SIM.returnCandlesLeft = Math.min(CHART_SIM.returnCandlesLeft, 0);
        }

        if (CHART_SIM.returnCandlesLeft <= 0) {
          // финал: НЕ пересобираем историю (чтобы синтетика осталась на графике),
          // просто возвращаемся к live-потоку и размьючиваем.
          stopChartSimTimer();
          CHART_SIM.mode = "off";
      try{ localStorage.setItem("ArsteX_ui_sim_on_v1","0"); }catch(e){}

          CHART_SIM.dir = 0;
          CHART_SIM.target = null;
          CHART_SIM.returnFast = false;
          LIVE_FEED.muted = false;

          // состыковка с live БЕЗ удаления синтетики:
          // сохраняем смещение таймлайна, чтобы live продолжал после synthetic свечей
          const raw = LIVE_FEED.lastCandleRaw || LIVE_FEED.lastCandle;
          if (raw && Array.isArray(HISTORY.candles) && HISTORY.candles.length) {
            const lastT = HISTORY.candles[HISTORY.candles.length - 1].t;
            LIVE_FEED.timeShiftMs = lastT - raw.t;

            // применяем live candle поверх последней синтетической свечи (в тот же timestamp)
            const shifted = { ...raw, t: raw.t + (Number(LIVE_FEED.timeShiftMs) || 0) };

            if (window.AX_ACTIVE_CHART_SOURCE === 'stocks') {
  window.AX_CHART?.updateLast?.(shifted);
}

            const li = HISTORY.candles.length - 1;
            if (HISTORY.candles[li]?.t === shifted.t) HISTORY.candles[li] = shifted;
            else if (HISTORY.candles[li]?.t < shifted.t) HISTORY.candles.push(shifted);
          }

          // снять подсветку кнопок
          document.querySelectorAll('#chart-draw-tools .tool-btn[data-tool="sim-up"], #chart-draw-tools .tool-btn[data-tool="sim-down"]')
            .forEach(b => b.classList.remove("active"));

          return;
        }
      }

      // новая свеча
      const nextT = Number(cur.t) + CHART_SIM.tfMs;
      const nextO = Number(cur.c);
      CHART_SIM.cur = { t: nextT, o: nextO, h: nextO, l: nextO, c: nextO };

      HISTORY.candles.push(CHART_SIM.cur);
      window.AX_CHART.updateLast(CHART_SIM.cur);
    }

  }, tickMs);
}


// первичный рендер
(async function initSpotPairs(){
  try {
    await loadTop100PairsFromCoinGeckoAndBinance();

    renderPairList("");

    const DEFAULT_PAIR = "BTC/USDT";
    window.SPOT_SELECTED = PAIRS_SET.has(DEFAULT_PAIR)
      ? DEFAULT_PAIR
      : (PAIRS[0]?.key || DEFAULT_PAIR);

    renderPair(window.SPOT_SELECTED);

    // ✅ ВОТ ЭТО ДОБАВЬ:
    await rebuildChartForSelectedPair(__lastChartTF);

    startSpotLive();
  } catch (e) {
    console.error("initSpotPairs error:", e);

    PAIRS = [{ key:"BTC/USDT", base:"BTC", quote:"USDT", name:"BTC", binanceSymbol:"BTCUSDT" }];
    rebuildPairsSet();

    renderPairList("");
    window.SPOT_SELECTED = "BTC/USDT";
    renderPair(window.SPOT_SELECTED);

    // ✅ И В FALLBACK ТОЖЕ:
    await rebuildChartForSelectedPair(__lastChartTF);

    startSpotLive();
  }
})();


document.querySelectorAll(".pair-tab").forEach(t => {
  t.addEventListener("click", (e) => {
    e.stopPropagation(); // важно
    document.querySelectorAll(".pair-tab").forEach(x => x.classList.remove("active"));
    t.classList.add("active");
    ACTIVE_TAB = (t.dataset.tab === "fav") ? "favorites" : t.dataset.tab;
    renderPairList(searchEl.value || "");
  });
});



// при первом открытии dropdown всегда USDT
ACTIVE_TAB = "usdt";




// setInterval(() => {
//   if (!window.SPOT_SELECTED) return;
//   const st = window.SPOT_PAIRS[window.SPOT_SELECTED];
//   if (!st) return;

//   const v = st.price * 0.0006;
//   const prev = st.price;
//   st.price = +(st.price + (Math.random() - 0.5) * v).toFixed(4);

//   st.high = Math.max(st.high, st.price);
//   st.low  = Math.min(st.low, st.price);

//   renderPair(window.SPOT_SELECTED);
// }, 1200);

// ===== FOREX TRADE: pairs (reuse same dropdown UI) =====
(function(){
  let FX_TRADE_SELECTED = null;
  let fxLiveTimer = null;

  // Собираем пары как на странице forex (у тебя forexMap уже существует там, где рендерится forex)
  function getFxPairs(){
    // forexMap ожидается в глобале (как в твоей forex странице)
    const m = window.forexMap || {};
    // формат: [{key:"EUR/USD", base:"EUR", quote:"USD", name:"EUR"}]
    return Object.keys(m).map(k => {
      const [base, quote] = k.split("/");
      return { key:k, base, quote, name: base };
    });
  }

  function fxRoot(){ return document.getElementById("openforextradepage"); }

  function fxEls(){
  const root = document.getElementById("openforextradepage");
  if(!root) return {};
  return {
    root,
    btn: root.querySelector(".pair-select"),         // ✅ твоя кнопка
    dd: root.querySelector(".pair-dd"),
    list: root.querySelector(".pair-dd-list"),
    search: root.querySelector(".pair-search"),      // ✅ твой input
    sym: root.querySelector(".forex-pair-symbol"),   // ✅ твой символ
    name: root.querySelector(".forex-pair-name"),    // ✅ твоё имя
    last: root.querySelector("#fx-last-price") || root.querySelector(".spot-stats .last-price") || null
  };
}


  // --- FX state (как SPOT_PAIRS, только для forex) ---
window.FX_PAIRS = window.FX_PAIRS || {}; // key -> { price, prev, changePct }

function ensureFxState(key){
  const k = normalizeFxKey(key);
  if(!window.FX_PAIRS[k]){
    window.FX_PAIRS[k] = { price: NaN, prev: NaN, changePct: 0 };
  }
  return window.FX_PAIRS[k];
}

function renderFxTradeList(filterText=""){
  const { list, root } = fxEls();
  if(!list) return;

  const pairs = getFxPairs();
  const q = (filterText||"").trim().toLowerCase();

  list.innerHTML = "";

  const items = pairs.filter(p =>
    !q ||
    p.key.toLowerCase().includes(q) ||
    (p.base||"").toLowerCase().includes(q) ||
    (p.quote||"").toLowerCase().includes(q)
  );

  items.forEach(p => {
    const st = ensureFxState(p.key);
    if (normalizeFxKey(p.key) === normalizeFxKey(FX_TRADE_SELECTED)) {
  return;
}

    const priceStr = Number.isFinite(st.price) ? formatFx(st.price) : "";
    const chg = Number(st.changePct || 0);

    const row = document.createElement("div");
    row.className = "pair-item";
    row.dataset.fxKey = normalizeFxKey(p.key);

    row.innerHTML = `
  <div class="pair-left">
    <div class="pair-star">★</div>
    <div class="pair-asset">
      <div class="pair-sym">${normalizeFxKey(p.key)}</div>
      <div class="pair-vol">FOREX</div>
    </div>
  </div>

  <div class="pair-price t-right">${priceStr}</div>
    
  </div>
`;


    row.addEventListener("click", () => {
      renderFxTradePair(p.key);
      root?.querySelector(".spot-pair")?.classList.remove("open"); // закрыть
    });

    list.appendChild(row);
  });
}



  function renderFxTradePair(key){
  const { sym, name } = fxEls();

  const norm = normalizeFxKey(key);
  FX_TRADE_SELECTED = norm;

  if(sym) sym.textContent = norm;
  if(name){
    const [b,q] = norm.split("/");
    name.textContent = `${b} / ${q}`;
  }

  window.__fx_trade_selected = norm;
  updateFxPriceNow();
}

function fxPairBox(){
  const root = document.getElementById("openforextradepage");
  return root ? root.querySelector(".spot-pair") : null;
}

function openFxDd(){
  const box = fxPairBox();
  if(box) box.classList.add("open");
}

function closeFxDd(){
  const box = fxPairBox();
  if(box) box.classList.remove("open");
}

  function initForexTradeUI(){
  const root = document.getElementById("openforextradepage");
  if(!root) return;

  const pairWrap = root.querySelector(".spot-pair");
  const { btn, dd, search } = fxEls();
  const list = root.querySelector(".pair-dd-list");
  if(!btn || !dd || !list || !pairWrap) return;

  function openDD(){
  pairWrap.classList.add("open");
  if(search) search.value = "";
  updateFxListPrices();     // <—
  renderFxTradeList("");
}
  function closeDD(){
    pairWrap.classList.remove("open");
  }
  function toggleDD(){
    pairWrap.classList.contains("open") ? closeDD() : openDD();
  }

  btn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    toggleDD();
  });

  dd.addEventListener("click", (e) => e.stopPropagation());
  document.addEventListener("click", closeDD);

  if(search){
    search.addEventListener("input", () => {
      renderFxTradeList(search.value || "");
    });
  }

  renderFxTradeList("");
}





  // ===== “Оживление данных” =====
  // Идея: берём базовую цену из forex страницы (если ты уже грузишь котировки там),
  // а между обновлениями делаем маленький “тик” (рандомный дрейф), чтобы выглядело живым.
  let __fxLast = null;

  function getFxBaseRate(pairKey){
    // если у тебя forex страница уже хранит актуальные цены где-то в window, подцепи сюда.
    // например: window.__forexRates["EUR/USD"] = 1.0865
    const m = window.__forexRates || window.__FOREX_RATES || null;
    if(m && m[pairKey] != null) return Number(m[pairKey]) || null;

    // fallback: если нет стора — не ломаемся
    return null;
  }

  function formatFx(v){
    if(!Number.isFinite(v)) return "--";
    // forex часто 5 знаков, но можно подстроить:
    return (v >= 10) ? v.toFixed(3) : v.toFixed(5);
  }

  function updateFxPriceNow(){
    const { last } = fxEls();
    if(!last) return;

    const base = getFxBaseRate(FX_TRADE_SELECTED);
    let v = base;

    // если base нет — продолжаем “жить” от предыдущего значения
    if(!Number.isFinite(v)){
      v = Number.isFinite(__fxLast) ? __fxLast : 1 + Math.random()*0.2;
    }

    // микротик
    const drift = (Math.random() - 0.5) * v * 0.00015; // ~1.5 bps
    v = v + drift;

    // подсветка up/down
    if(Number.isFinite(__fxLast)){
      last.classList.toggle("up", v > __fxLast);
      last.classList.toggle("down", v < __fxLast);
    }
    __fxLast = v;

    last.textContent = formatFx(v);
    // === update 24h stats (forextrade) ===
const st = ensureFxState(FX_TRADE_SELECTED);

// change% считаем от предыдущей цены (упрощенно)
const prev = Number.isFinite(st.prev) ? st.prev : v;
st.prev = v;
st.price = v;
// синхронизируем цену выбранной пары в открытом дропдауне (блок 2)
const box = fxPairBox();
if (box && box.classList.contains("open")) {
  const sel = normalizeFxKey(FX_TRADE_SELECTED);
  const priceEl = document.querySelector(`.pair-item[data-fx-key="${sel}"] .pair-price`);
  if (priceEl) priceEl.textContent = formatFx(v);
}

st.changePct = prev ? ((v - prev) / prev) * 100 : 0;

// hi/low (упрощенно)
st.high = Number.isFinite(st.high) ? Math.max(st.high, v) : v;
st.low  = Number.isFinite(st.low)  ? Math.min(st.low,  v) : v;

// volume (если реального нет — можно держать 0 или рандом для теста)
st.volume = Number.isFinite(st.volume) ? st.volume : 0;

const root = document.getElementById("openforextradepage");
const elChg = root?.querySelector("#fx-24h-change");
const elHi  = root?.querySelector("#fx-24h-high");
const elLo  = root?.querySelector("#fx-24h-low");
const elVol = root?.querySelector("#fx-24h-volume");

if(elChg) elChg.textContent = `${st.changePct >= 0 ? "+" : ""}${st.changePct.toFixed(2)}%`;
if(elHi)  elHi.textContent  = formatFx(st.high);
if(elLo)  elLo.textContent  = formatFx(st.low);
if(elVol) elVol.textContent = String(st.volume);

  }

  function startForexTradeLive(){
  stopForexTradeLive();

  updateFxPriceNow();
  updateFxListPrices();   // <<< добавили

  fxLiveTimer = setInterval(() => {
    updateFxPriceNow();
    updateFxListPrices(); // <<< добавили
  }, 900);
}

  function stopForexTradeLive(){
    if(fxLiveTimer){ clearInterval(fxLiveTimer); fxLiveTimer = null; }
  }

function updateFxListPrices(){
  const pairs = getFxPairs();

  pairs.forEach(p => {
  const st = ensureFxState(p.key);

  // ✅ ВАЖНО: выбранную пару НЕ пересчитываем тут,
  // чтобы она 1:1 совпадала с ценой сверху (updateFxPriceNow)
  if (normalizeFxKey(p.key) === normalizeFxKey(FX_TRADE_SELECTED)) {
    return;
  }

  // берём базу из стора (если есть)
  let v = getFxBaseRate(p.key);

  // если базы нет — продолжаем от прошлого (или стартуем)
  if(!Number.isFinite(v)){
    v = Number.isFinite(st.price) ? st.price : (1 + Math.random()*0.2);
  }

    // микротик
    const drift = (Math.random() - 0.5) * v * 0.00015;
    v = v + drift;

    // change%
    if(Number.isFinite(st.price)){
      const prev = st.price;
      st.price = v;
      st.changePct = ((v - prev) / prev) * 100;
    } else {
      st.price = v;
      st.changePct = 0;
    }
  });

  // если дропдаун открыт — перерисовать список, чтобы цифры обновились
  const { root, search } = fxEls();
  const opened = root?.querySelector(".spot-pair")?.classList.contains("open");
  if (opened) {
  renderFxTradeList(search?.value || "");
}
}

  // экспортируем наружу
  window.initForexTradeUI = initForexTradeUI;
  window.startForexTradeLive = startForexTradeLive;
  window.stopForexTradeLive = stopForexTradeLive;
  // ✅ make callable from outside (openforextradepage)
window.setForexTradePair = renderFxTradePair;
window.startForexTradeTicker = startForexTradeLive;
window.stopForexTradeTicker = stopForexTradeLive;
})();

function waitForChart(ms = 2000) {
  return new Promise((resolve, reject) => {
    const t0 = Date.now();
    (function tick(){
      if (window.AX_CHART?.setCandles) return resolve();
      if (Date.now() - t0 > ms) return reject(new Error("AX_CHART not ready"));
      requestAnimationFrame(tick);

    })();
  });
}

document.addEventListener("click", (e) => {
  const btn = e.target.closest(".chart-btn");
  if(!btn) return;

  document.querySelectorAll(".chart-btn").forEach(b => b.classList.remove("is-active"));
  btn.classList.add("is-active");

  const tf = btn.dataset.tf;
  
  try{ localStorage.setItem("ArsteX_ui_chart_tf_v1", tf); }catch(e){}
// сюда потом добавишь перерисовку графика / запрос данных
  if (window.AX_ACTIVE_CHART_SOURCE === "stocks") {
    if (typeof rebuildStockChartForSelectedSymbol === "function") rebuildStockChartForSelectedSymbol(tf);
  } else {
    rebuildChartForSelectedPair(tf);
  }
});


function normalizeFxKey(key){
  if(!key) return key;
  key = String(key).trim();

  // если уже EUR/USD — просто в upper
  if(key.includes("/")) return key.toUpperCase();

  // если eurusd -> EUR/USD (берём первые 3 и последние 3)
  const k = key.replace(/\s+/g,"").toUpperCase();
  if(k.length === 6) return k.slice(0,3) + "/" + k.slice(3);

  return k; // fallback
}





// --- restore TF button state after reload ---
document.addEventListener("DOMContentLoaded", () => {
  try{
    const savedTf = localStorage.getItem("ArsteX_ui_chart_tf_v1");
    if (savedTf){
      const btn = document.querySelector(`.chart-btn[data-tf="${savedTf}"]`);
      if (btn) {
        // click to reuse existing logic (also rebuilds chart)
        requestAnimationFrame(()=>btn.click());
      }
    }
  }catch(e){}
});
(function () {
  const canvas = document.getElementById("ax-chart");
  const root = document.getElementById("chart-root");

  // ✅ защита: если графика на странице нет — выходим без ошибок
  if (!canvas || !root) return;

  const ctx = canvas.getContext("2d", { alpha: true });
  if (!ctx) return;

  // HUD
  const hudO = document.getElementById("hud-o");
  const hudH = document.getElementById("hud-h");
  const hudL = document.getElementById("hud-l");
  const hudC = document.getElementById("hud-c");

  // ✅ demo generator (чтобы makeDemoCandles существовала)
  function makeDemoCandles(n) {
    let p = 0.8;
    const out = [];
    const now = Date.now();
    for (let i = 0; i < n; i++) {
      const t = now - (n - i) * 60_000;
      const o = p;
      const drift = (Math.random() - 0.5) * 0.03;
      const c = Math.max(0.0001, o + drift);
      const hi = Math.max(o, c) + Math.random() * 0.02;
      const lo = Math.min(o, c) - Math.random() * 0.02;
      out.push({ t, o, h: hi, l: Math.max(0.0001, lo), c });
      p = c;
    }
    return out;
  }

  // candle: { t, o, h, l, c }
  let candles = [];

  // view state
  let yPan = 0; // сдвиг по цене (в единицах цены)
  let viewCount = 80;
  let viewOffset = 0;
  let mouse = { x: -1, y: -1, inside: false };     // если хочешь оставлять вертикальный сдвиг
let yZoom = 1; 
let rightBars = 20; // ✅ сколько пустых "свечей" справа (future space)

  const PAD = { l: 48, r: 80, t: 18, b: 46 };
  // const CANDLE_RIGHT_GAP = 14; // зазор свечей от блока цен
  function getDynamicGap(innerW, visibleCount){
  const candleW = innerW / Math.max(1, visibleCount);
  return Math.min(40, Math.max(96, candleW * 22.4)); // 6..40px
}


  function clamp(v, a, b) {
    return Math.max(a, Math.min(b, v));
  }

  function resize() {
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    const rect = root.getBoundingClientRect();

    // ✅ защита от 0x0
    const w = Math.max(1, rect.width);
    const h = Math.max(1, rect.height);

    canvas.width = Math.floor(w * dpr);
    canvas.height = Math.floor(h * dpr);
    canvas.style.width = w + "px";
    canvas.style.height = h + "px";

    // рисуем в CSS-пикселях
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    draw();
  }

  function getViewSlice() {
  const total = candles.length;

  // ✅ когда свечей нет — просто возвращаем пустой слайс
  if (total === 0) return { start: 0, end: 0, slice: [] };

  const count = clamp(viewCount, 10, total);
  const maxOffset = Math.max(0, total - count);
  const off = clamp(viewOffset, 0, maxOffset);

  const start = Math.max(0, total - count - off);
  const end = Math.min(total, start + count);

  return { start, end, slice: candles.slice(start, end) };
  }


  function computeMinMax(slice) {
    let min = Infinity,
      max = -Infinity;

    for (const c of slice) {
      if (c.l < min) min = c.l;
      if (c.h > max) max = c.h;
    }

    if (!isFinite(min) || !isFinite(max)) {
      min = 0;
      max = 1;
    }
    if (min === max) {
      min *= 0.999;
      max *= 1.001;
    }

    const pad = (max - min) * 0.04;
    return { min: min - pad, max: max + pad };
  }

  function yOf(price, min, max, h) {
    const innerH = h - PAD.t - PAD.b;
    const k = (price - min) / (max - min);
    return PAD.t + (1 - k) * innerH;
  }

  function drawGrid(w, h) {
    ctx.save();
    ctx.clearRect(0, 0, w, h);

    ctx.fillStyle = "rgba(0,0,0,0)";
    ctx.fillRect(0, 0, w, h);

    ctx.strokeStyle = "rgba(255,255,255,0.06)";
    ctx.lineWidth = 1;

    // горизонтальные линии
    const rows = 5;
    for (let i = 0; i <= rows; i++) {
      const y = PAD.t + (h - PAD.t - PAD.b) * (i / rows);
      ctx.beginPath();
      ctx.moveTo(PAD.l, y);
      ctx.lineTo(w - PAD.r, y);
      ctx.stroke();
    }

    // вертикальные линии
    const cols = 6;
    for (let i = 0; i <= cols; i++) {
      const x = PAD.l + (w - PAD.l - PAD.r) * (i / cols);
      ctx.beginPath();
      ctx.moveTo(x, PAD.t);
      ctx.lineTo(x, h - PAD.b);
      ctx.stroke();
    }

    ctx.restore();
  }

  function drawPriceScale(w, h, min, max) {
    const sx = w - PAD.r; // начало правой панели



// вертикальный разделитель
ctx.strokeStyle = 'rgba(255,255,255,0.18)';
ctx.lineWidth = 1;
ctx.beginPath();
ctx.moveTo(sx + 0.5, 0);
ctx.lineTo(sx + 0.5, h);
ctx.stroke();
    ctx.save();
    ctx.fillStyle = "rgba(255,255,255,0.45)";
    ctx.font = "12px -apple-system, system-ui, sans-serif";
    ctx.textAlign = "right";
    ctx.textBaseline = "middle";

    const rows = 5;
    for (let i = 0; i <= rows; i++) {
      const k = 1 - i / rows;
      const price = min + (max - min) * k;
      const y = PAD.t + (h - PAD.t - PAD.b) * (i / rows);
      ctx.fillText(price.toFixed(4), w - 10, y);
    }
    ctx.restore();
  }

  const NY_FMT = new Intl.DateTimeFormat("en-US", {
  timeZone: "America/New_York",
  hour: "2-digit",
  minute: "2-digit",
  hour12: false
});

function drawTimeScale(w, h, slice, dynamicGap){
  if (!slice || !slice.length) return;

  const n = slice.length;
  const innerW = Math.max(
    1,
    w - PAD.l - PAD.r - EDGE_GAP_L - EDGE_GAP_R - dynamicGap
  );
  const totalSlots = n + rightBars;      // ✅ свечи + пустое пространство справа
const step = innerW / totalSlots;
  const y = h - 14; // линия текста времени

  ctx.save();
  ctx.fillStyle = "rgba(255,255,255,0.55)";
  ctx.font = "12px -apple-system, system-ui, sans-serif";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";

  // сколько меток рисовать
  const ticks = 7; // 7 подписей
  for(let i=0;i<ticks;i++){
    const ix = Math.round(i * (n - 1) / (ticks - 1));
    const t = slice[ix]?.t;
    if (!t) continue;

    const x = PAD.l + EDGE_GAP_L + ix * step + step/2;
    const label = NY_FMT.format(new Date(t)); // ✅ New York time
    ctx.fillText(label, x, y);
  }

  ctx.restore();
}


function drawLastPrice(w, h, last, prev, min, max) {
  if (!Number.isFinite(last) || !Number.isFinite(prev)) return;

  const up = last >= prev; // выросла/упала
  const lineCol = up ? "rgba(0,227,161,0.75)" : "rgba(255,77,109,0.75)";
  const boxCol  = up ? "rgba(0,227,161,0.90)" : "rgba(255,77,109,0.90)";

  const y = yOf(last, min, max, h);

  ctx.save();
  ctx.strokeStyle = lineCol;
  ctx.lineWidth = 1;
  ctx.setLineDash([4, 4]);
  ctx.beginPath();
  ctx.moveTo(PAD.l, y + 0.5);
  ctx.lineTo(w - 2, y + 0.5);
  ctx.stroke();
  ctx.setLineDash([]);

  const text = last < 1 ? last.toFixed(6) : last.toFixed(2);

  ctx.font = "12px -apple-system, system-ui, sans-serif";
  const boxH = 20;
  const padX = 8;
  const tw = ctx.measureText(text).width;
  const boxW = Math.min(PAD.r - 6, tw + padX * 2);

  const bx = w - 4 - boxW;
  let by = y - boxH / 2;
  by = Math.max(2, Math.min(h - boxH - 2, by));

  const r = 6;
  ctx.fillStyle = boxCol;
  ctx.beginPath();
  ctx.moveTo(bx + r, by);
  ctx.arcTo(bx + boxW, by, bx + boxW, by + boxH, r);
  ctx.arcTo(bx + boxW, by + boxH, bx, by + boxH, r);
  ctx.arcTo(bx, by + boxH, bx, by, r);
  ctx.arcTo(bx, by, bx + boxW, by, r);
  ctx.closePath();
  ctx.fill();

  ctx.fillStyle = "#fff";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(text, bx + boxW / 2, by + boxH / 2);

  ctx.restore();
}


function formatHHMM(ms){
  const d = new Date(ms);
  const hh = String(d.getHours()).padStart(2,"0");
  const mm = String(d.getMinutes()).padStart(2,"0");
  return `${hh}:${mm}`;
}

function drawTimeScale(w, h, slice){
  // зона оси по Y: снизу, высота = PAD.b
  const axisTop = h - PAD.b;

  // фон оси (можешь убрать, если не нужен)
  ctx.fillStyle = "rgba(0,0,0,0.18)";
  ctx.fillRect(0, axisTop, w, PAD.b);

  // линия отделения
  ctx.strokeStyle = "rgba(255,255,255,0.08)";
  ctx.beginPath();
  ctx.moveTo(0, axisTop);
  ctx.lineTo(w, axisTop);
  ctx.stroke();

  // геометрия по X должна совпадать со свечами
  const dynamicGap = getDynamicGap(w, Math.max(1, viewCount));
  const innerW = w - PAD.l - PAD.r - dynamicGap;
  const step = innerW / Math.max(1, viewCount);

  // адаптивный шаг подписей (чтобы не слипались)
  const minPx = 90; // минимальная дистанция между подписями
  const every = Math.max(1, Math.ceil(minPx / Math.max(1, step)));

  ctx.fillStyle = "rgba(255,255,255,0.45)";
  ctx.font = "12px system-ui";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";

  for (let i = 0; i < slice.length; i += every){
    const x = PAD.l + i * step + step * 0.5; // центр свечи
    const t = slice[i]?.t;
    if (t == null) continue;
    ctx.fillText(formatHHMM(t), x, axisTop + PAD.b * 0.62);
  }
}


  function drawCandles(w, h, slice, min, max) {
  if (!Array.isArray(slice) || slice.length === 0) return;

  const n = slice.length;

  const baseInnerW = w - PAD.l - PAD.r;
  const dynamicGap = getDynamicGap(baseInnerW, n);

  const innerW = baseInnerW - dynamicGap;
  const totalSlots = n + rightBars;
  const step = innerW / totalSlots;
  const bodyW = Math.max(2, Math.min(step * 0.9, 40));
  

  for (let i = 0; i < n; i++) {
    const c = slice[i];
    if (!c) continue;

    const x = PAD.l + i * step + (step - bodyW) / 2;

    const yo = yOf(c.o, min, max, h);
    const yh = yOf(c.h, min, max, h);
    const yl = yOf(c.l, min, max, h);
    const yc = yOf(c.c, min, max, h);

    const up = c.c >= c.o;

    ctx.strokeStyle = up ? "rgba(34,197,94,1)" : "rgba(239,68,68,1)";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(x + bodyW / 2, yh);
    ctx.lineTo(x + bodyW / 2, yl);
    ctx.stroke();

    const top = Math.min(yo, yc);
    const bot = Math.max(yo, yc);
    const bh = Math.max(3, bot - top);

    ctx.fillStyle = up ? "rgba(34,197,94,0.85)" : "rgba(239,68,68,0.85)";
    ctx.fillRect(x, top, bodyW, bh);
  }
}



  function drawCrosshair(w, h, slice, min, max) {
    if (!mouse.inside || !slice.length) return;
    

    const n = slice.length;
    const dynamicGap = getDynamicGap(w, n);
    const innerW = w - PAD.l - PAD.r - dynamicGap;
    const totalSlots = n + rightBars;
const step = innerW / totalSlots;

// если мышь в "future space" — прижимаем к последней свече
const ix = clamp(Math.floor((mouse.x - PAD.l) / step), 0, n - 1);
    const x = PAD.l + ix * step + step / 2;

    ctx.save();
    ctx.strokeStyle = "rgba(255,255,255,0.18)";
    ctx.lineWidth = 1;
    ctx.setLineDash([4, 4]);

    ctx.beginPath();
    ctx.moveTo(x, PAD.t);
    ctx.lineTo(x, h - PAD.b);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(PAD.l, mouse.y);
    ctx.lineTo(w - PAD.r, mouse.y);
    ctx.stroke();

    ctx.restore();

    const c = slice[ix];
    if (hudO) hudO.textContent = c.o.toFixed(4);
    if (hudH) hudH.textContent = c.h.toFixed(4);
    if (hudL) hudL.textContent = c.l.toFixed(4);
    if (hudC) hudC.textContent = c.c.toFixed(4);
  }

  function draw() {
    const w = root.clientWidth;
    const h = root.clientHeight;

    const { slice } = getViewSlice();
    const mm = computeMinMax(slice);

const mid = (mm.min + mm.max) * 0.5 + yPan;
const half = (mm.max - mm.min) * 0.5;

// yZoom: вверх = расширяем (больше zoom), вниз = сжимаем (меньше zoom)
const halfAdj = half / Math.max(0.2, yZoom);

const min = mid - halfAdj;
const max = mid + halfAdj;


    drawGrid(w, h);
    drawCandles(w, h, slice, min, max);
    drawPriceScale(w, h, min, max);
    const last = candles[candles.length - 1]?.c;
const prev = candles[candles.length - 2]?.c;
drawLastPrice(w, h, last, prev, min, max);
    drawCrosshair(w, h, slice, min, max);
    drawTimeScale(w, h, slice);
  }

  // mouse handling
  root.addEventListener("mousemove", (e) => {
  const r = root.getBoundingClientRect();
  mouse.x = e.clientX - r.left;
  mouse.y = e.clientY - r.top;
  mouse.inside = mouse.x >= 0 && mouse.y >= 0 && mouse.x <= r.width && mouse.y <= r.height;

  // ✅ курсор как на биржах: над правой шкалой — ns-resize
  const overPriceScale = mouse.x >= (r.width - PAD.r);
  if (!isDragging) root.style.cursor = overPriceScale ? "ns-resize" : "";

  draw();
});


  root.addEventListener("mouseleave", () => {
    mouse.inside = false;
    if (hudO) hudO.textContent = "—";
    if (hudH) hudH.textContent = "—";
    if (hudL) hudL.textContent = "—";
    if (hudC) hudC.textContent = "—";
    draw();
  });

  // zoom (wheel) + pan (shift + wheel)
  root.addEventListener(
    "wheel",
    (e) => {
      e.preventDefault();
      const dir = Math.sign(e.deltaY);

      if (e.shiftKey) {
        viewOffset = clamp(viewOffset + dir * 6, 0, Math.max(0, candles.length - 10));
      } else {
        viewCount = clamp(viewCount + dir * 8, 20, Math.max(20, candles.length));
      }
      draw();
    },
    { passive: false }
  );

  // drag pan
  let isDragging = false;
  let dragMode = "pan"; // "pan" | "yzoom"
  let dragStartX = 0;
  let dragStartY = 0;
  let dragStartOffset = 0;
  let dragStartYPan = 0;
  let dragStartYZoom = 1;

  


  root.addEventListener("mousedown", (e) => {
  if (e.button !== 0) return;

  const r = root.getBoundingClientRect();
  const x = e.clientX - r.left;
  const overPriceScale = x >= (r.width - PAD.r);

  isDragging = true;
  dragMode = overPriceScale ? "yzoom" : "pan";   // ✅ ВАЖНО

  dragStartX = e.clientX;
  dragStartY = e.clientY;

  dragStartOffset = viewOffset;
  dragStartYPan = yPan;
  dragStartYZoom = yZoom;

  root.style.cursor = overPriceScale ? "ns-resize" : "grabbing";
});


  window.addEventListener("mouseup", () => {
    if (!isDragging) return;
    isDragging = false;
    root.style.cursor = "";
  });

  window.addEventListener("mousemove", (e) => {
  if (!isDragging) return;

  const dy = e.clientY - dragStartY;

  // ✅ РЕЖИМ ЗУМА ПО ВЫСОТЕ (только на правой шкале)
  if (dragMode === "yzoom") {
    const k = 0.006; // скорость (0.004..0.01)
    // вниз -> сжать (zoom меньше), вверх -> расширить (zoom больше)
    yZoom = clamp(dragStartYZoom * Math.exp(-dy * k), 0.2, 20);
    draw();
    return;
  }

  // ===== обычный pan (как у тебя) =====
  const w = root.clientWidth;
  const dynamicGap = getDynamicGap(w, Math.max(1, viewCount));
  const innerW = w - PAD.l - PAD.r - dynamicGap;
  const step = innerW / Math.max(1, viewCount);

  const dx = e.clientX - dragStartX;
  const bars = Math.round(dx / Math.max(2, step));
  viewOffset = clamp(dragStartOffset + bars, 0, Math.max(0, candles.length - viewCount));

  // (если хочешь оставить панорамирование по Y на поле — оставь этот блок,
  //  но обычно на биржах по полю Y не панят, а только по шкале)
  const { slice } = getViewSlice();
  const mm = computeMinMax(slice);
  const plotH = Math.max(1, root.clientHeight - PAD.t - PAD.b);
  const pricePerPx = (mm.max - mm.min) / plotH;
  yPan = dragStartYPan + (dy) * pricePerPx;

  draw();

  const maxOffset = Math.max(0, candles.length - viewCount);
  if (viewOffset >= maxOffset - 5) {
    if (typeof loadOlderIfNeeded === "function") loadOlderIfNeeded();
  }
});


  // ✅ public API
  window.AX_CHART = {
    setCandles(nextCandles) {
  candles = Array.isArray(nextCandles) ? nextCandles : [];
  // reset zoom/pan when data set changes (pair/TF switch)
  yPan = 0;
  yZoom = 1;
  cross = null;

  const DEFAULT_VIEW = 120;

  // ✅ если пусто — не заставляем график “рисовать 120 баров”
  if (candles.length === 0) {
    viewCount = 0;
    viewOffset = 0;
    draw();
    return;
  }

  viewCount = Math.min(DEFAULT_VIEW, candles.length);
  viewOffset = 0;
  draw();
},


    updateLast(c) {
      if (!c || !candles || candles.length === 0) return;
      const last = candles[candles.length - 1];

      if (last.t === c.t) candles[candles.length - 1] = c;
      else if (c.t > last.t) candles.push(c);

      draw();
    },

    resize(){ try{ resize(); }catch(e){} },


    redraw: draw,
  };

  // ✅ resize watcher + first draw
  new ResizeObserver(resize).observe(root);
  resize();
})();


// ===================== HISTORY (Binance klines) =====================


 let ACTIVE_TOOL = "cursor";

  const drawTools = document.getElementById("chart-draw-tools");

  if (drawTools) {
    drawTools.addEventListener("click", (e) => {
      const btn = e.target.closest(".tool-btn");
      if (!btn) return;

      const tool = btn.dataset.tool;

      // --- simulation buttons (detach chart from live) ---
      if (tool === "sim-up") { startChartSim(+1); return; }
      if (tool === "sim-down") { startChartSim(-1); return; }

      // --- обычные инструменты рисования ---
      drawTools
        .querySelectorAll('.tool-btn:not([data-tool="sim-up"]):not([data-tool="sim-down"])')
        .forEach(b => b.classList.remove("active"));

      btn.classList.add("active");
      ACTIVE_TOOL = tool;

      
      try{ localStorage.setItem("ArsteX_ui_draw_tool_v1", tool); }catch(e){}
console.log("Active tool:", ACTIVE_TOOL);
    });
  }


// --- restore selected drawing tool after reload ---
document.addEventListener("DOMContentLoaded", () => {
  try{
    const savedTool = localStorage.getItem("ArsteX_ui_draw_tool_v1");
    if (!savedTool) return;
    const drawToolsEl = document.getElementById("chart-draw-tools");
    if (!drawToolsEl) return;

    // don't auto-trigger sim buttons here
    if (savedTool === "sim-up" || savedTool === "sim-down") return;

    const btn = drawToolsEl.querySelector(`.tool-btn[data-tool="${savedTool}"]`);
    if (!btn) return;

    drawToolsEl
      .querySelectorAll('.tool-btn:not([data-tool="sim-up"]):not([data-tool="sim-down"])')
      .forEach(b => b.classList.remove("active"));

    btn.classList.add("active");
    ACTIVE_TOOL = savedTool;
  }catch(e){}
});

document.addEventListener("DOMContentLoaded", () => {
  const tools = document.getElementById("chart-draw-tools");
  const host  = document.getElementById("chart-top-tools"); // тот div справа в шапке
  if (tools && host) host.appendChild(tools);
});

(function initOrdersTabs(){
  const root = document.querySelector(".spot-orders");
  if (!root) return;

  const tabs = Array.from(root.querySelectorAll(".orders-tab"));
  if (!tabs.length) return;

  // Если ты позже добавишь панели:
  // <div class="orders-panel" data-panel="open">...</div>
  // то это начнет работать автоматически.
  const panels = Array.from(root.querySelectorAll(".orders-panel"));

  function setActive(tabKey){
    tabs.forEach(btn => btn.classList.toggle("active", btn.dataset.tab === tabKey));

    // если есть панели — показываем нужную
    if (panels.length){
      panels.forEach(p => {
        p.style.display = (p.dataset.panel === tabKey) ? "" : "none";
      });
    } else {
      // пока панелей нет — просто меняем empty текст (чтобы было ощущение переключения)
      const title = root.querySelector(".orders-empty-title");
      const text  = root.querySelector(".orders-empty-text");

      if (!title || !text) return;

      const map = {
        open: ["No open orders", "Your active spot orders will appear here."],
        ordersHistory: ["No order history", "Your completed and cancelled orders will appear here."],
        tradeHistory: ["No trades yet", "Your trade executions will appear here."],
        positions: ["No open positions", "Your current positions will appear here."]
      };

      const msg = map[tabKey] || map.open;
      title.textContent = msg[0];
      text.textContent  = msg[1];
    }
  }

  // клики
  root.addEventListener("click", (e) => {
    const btn = e.target.closest(".orders-tab");
    if (!btn || !root.contains(btn)) return;
    setActive(btn.dataset.tab);
  });

  // стартовое состояние
  const initial = root.querySelector(".orders-tab.active")?.dataset.tab || tabs[0].dataset.tab;
  setActive(initial);
})();



function openForexpPage(){
  hideAllPages();
  document.body.className = ''; // сброс режимов
  document.getElementById('forex-page').style.display = 'block';
  window.scrollTo(0,0);
}

function openStockspPage(){
  hideAllPages();
  document.body.className = '';
  document.getElementById('stocks-page').style.display = 'block';
  window.scrollTo(0,0);
}

</script>

<footer class="footer">
  <div class="footer-inner">

    <!-- Левая колонка: логотип + соцсети + копирайт -->
    <div class="footer-brand">
      <div class="footer-logo">ArsteX</div>

      <div class="footer-copy">
        © 2020–2025 ArsteX. All rights reserved.
      </div>
    </div>

    <!-- Правая часть: колонки ссылок -->
    <div class="footer-columns">

      <div class="footer-col">
        <h4>Services</h4>
        <a href="#" onclick="openAboutPage(); return false;">About Us</a>
        <a href="#" onclick="openNewsPage(); return false;">News</a>
        <a href="#" onclick="openBlogPage(); return false;">Blog</a>

        <a href="https://ru.tradingview.com">TradingView</a>
      </div>

      <div class="footer-col">
        <h4>User Support</h4>
        <a href="#" onclick="openChatPage(); return false;">24/7 Chat Support</a>
<a href="#" onclick="openFeedbackPage(); return false;">Feedback</a>
<a href="#" onclick="openFeesPage(); return false;">Trading Fees</a>
      </div>

      <!-- <div class="footer-col">
        <h4>Company</h4>
        <a href="#">About Us</a>
        <a href="#">Careers</a>
        <a href="#">Affiliate Program</a>
        <a href="#">Proof of Reserves</a>
        <a href="#">Announcement Center</a>
        <a href="#">Blog</a>
      </div> -->

      <div class="footer-col">
        <h4>Terms</h4>
        <a href="#" onclick="openAgreementPage(); return false;">Customer Agreement</a>
<a href="#" onclick="openPrivacyPage(); return false;">Privacy Policy</a>
<a href="#" onclick="openDisclaimerPage(); return false;">Disclaimer</a>
<a href="#" onclick="openRiskPage(); return false;">Risk Notice</a>
      </div>

    </div>
  </div>
</footer>
<div id="feedback-toast" class="toast">
  Submitted! Thank you for your suggestion. We will conduct a review and get back to you in a timely manner.
</div>
<script>

// === VOL slider for simulation (in chart toolbar) ===
// (disabled: keeps toolbar compact)
(function setupSimVolSlider(){ return; })();
</script>

<script>
(function(){
  function $(sel, root){ return (root||document).querySelector(sel); }
  function $all(sel, root){ return Array.from((root||document).querySelectorAll(sel)); }

  function initTradePanel(){
    var card = document.getElementById('tradeCard');
    if(!card) return;

    // default side
    if(!card.getAttribute('data-side')) card.setAttribute('data-side','buy');

    // Wire Buy/Sell toggle
    $all('.trade-bs-toggle .bs-btn', card).forEach(function(btn){
      btn.addEventListener('click', function(){
        var side = btn.getAttribute('data-side');
        card.setAttribute('data-side', side);
        $all('.trade-bs-toggle .bs-btn', card).forEach(function(b){ b.classList.toggle('active', b===btn); });

        var submit = document.getElementById('tradeSubmit');
        if(submit){
          submit.classList.toggle('buy', side==='buy');
          submit.classList.toggle('sell', side==='sell');
          submit.textContent = (side==='buy' ? 'Buy BTC' : 'Sell BTC');
        }

        // tweak checkbox accent
        var chk = document.getElementById('tradeTpslChk');
        if(chk){
          chk.style.accentColor = (side==='buy') ? '#0bbf76' : '#ff4d6d';
        }
      });
    });

    
    // TP/SL checkbox раскрывает панель под собой
    var tpslChk = document.getElementById('tradeTpslChk');
    var tpslPanel = document.getElementById('tradeTpslPanel');
    if(tpslChk && tpslPanel){
      var syncTpsl = function(){
        var on = !!tpslChk.checked;
        tpslPanel.classList.toggle('open', on);
        tpslPanel.setAttribute('aria-hidden', on ? 'false' : 'true');
      };
      tpslChk.addEventListener('change', syncTpsl);
      syncTpsl();
    }

// Order type tabs (visual only)
    $all('.trade-types .type-btn', card).forEach(function(btn){
      btn.addEventListener('click', function(){
        $all('.trade-types .type-btn', card).forEach(function(b){ b.classList.toggle('active', b===btn); });
      });
    });

    // Slider marks
    var range = document.getElementById('tradePct');
    var marks = document.getElementById('tradeMarks');
    if(range && marks){
      marks.addEventListener('click', function(e){
        var t = e.target;
        if(t && t.getAttribute && t.getAttribute('data-p')!=null){
          range.value = t.getAttribute('data-p');
          range.dispatchEvent(new Event('input', {bubbles:true}));
        }
      });

      var paintRange = function(){
        var v = Number(range.value||0);
        var side = card.getAttribute('data-side') || 'buy';
        var on = (side==='buy') ? '#0bbf76' : '#ff4d6d';
        var off = 'rgba(255,255,255,.14)';
        range.style.background = 'linear-gradient(to right, '+on+' 0%, '+on+' '+v+'%, '+off+' '+v+'%, '+off+' 100%)';
      };
      range.addEventListener('input', paintRange);
      paintRange();
    }

    // Fill price by current spot on load + whenever spot updates (best-effort)
    var priceInput = document.getElementById('tradePrice');
    function setPriceFromSpot(){
      if(!priceInput) return;
      try{
        // Prefer the top spot price text if present
        var t = document.getElementById('spot-last-price');
        if(t){
          var num = parseFloat(String(t.textContent).replace(/[^0-9.\-]/g,''));
          if(isFinite(num)) priceInput.value = num.toFixed(2);
        }
      }catch(_){}
    }
    setPriceFromSpot();

    // Hook into existing UI refresh if present
    if(typeof window.spotRefreshUI === 'function'){
      var _orig = window.spotRefreshUI;
      window.spotRefreshUI = function(){
        var r = _orig.apply(this, arguments);
        // keep price synced if empty or unchanged by user
        setPriceFromSpot();
        return r;
      };
    }

    // Available swap (visual only: toggles USDT/BTC label)
    var swap = document.getElementById('tradeAvailSwap');
    if(swap){
      swap.addEventListener('click', function(){
        var ccy = document.getElementById('tradeAvailCcy');
        if(!ccy) return;
        ccy.textContent = (ccy.textContent.trim().toUpperCase()==='USDT') ? 'BTC' : 'USDT';
      });
    }
  }

  if(document.readyState==='loading'){
    document.addEventListener('DOMContentLoaded', initTradePanel);
  }else{
    initTradePanel();
  }
})();
</script>


<script>
(function(){
  const btn = document.getElementById('clear-sim-btn');
  if(!btn) return;

  function getTF(){
    // try a few known globals / UI states
    try{
      if (typeof __lastChartTF !== "undefined" && __lastChartTF) return __lastChartTF;
    }catch(e){}
    try{
      const a = document.querySelector('.tf-btn.active, .tf-btn.is-active, .tf.active');
      if(a) return (a.dataset.tf || a.textContent || '').trim();
    }catch(e){}
    return "1m";
  }

  btn.onclick = function(e){
    try{ e && e.preventDefault && e.preventDefault(); }catch(_){}
    try{ e && e.stopPropagation && e.stopPropagation(); }catch(_){}

    const key = window.SPOT_SELECTED;
    const tf = getTF();

    try{
      if (key && typeof toBinanceSymbol === "function") {
        const symbol = toBinanceSymbol(key);
        if(symbol){
          // delete only this pair+tf synthetic history
          localStorage.removeItem(`${SIM_STORE_PREFIX}:${symbol}:${tf}`);
          // one-shot: ensure we don't merge synthetic on next load even if something lingers
          try{ sessionStorage.setItem("ArsteX_clear_sim_once", `${symbol}|${tf}`); }catch(_){}
        }
      }
    }catch(_){}

    // disable sim flags
    try{ localStorage.setItem("ArsteX_ui_sim_on_v1","0"); }catch(_){}
    try{ localStorage.removeItem("ArsteX_ui_sim_dir_v1"); }catch(_){}
    try{ localStorage.removeItem("ArsteX_ui_sim_pair_v1"); }catch(_){}
    try{ localStorage.removeItem("ArsteX_ui_sim_tf_v1"); }catch(_){}

    // reset runtime sim state
    try{ if(typeof CHART_SIM !== "undefined") CHART_SIM.on = false; }catch(_){}
    try{ if(window.LIVE_FEED){ LIVE_FEED.muted = false; LIVE_FEED.timeShiftMs = 0; } }catch(_){}
    try{ window.__lastChartKey = ""; }catch(_){}

    // safest: reload to ensure a clean real-history rebuild
    location.reload();
  };
})();
</script>



<script>
/* v26: restore Assets button navigation to Cabinet */
(function(){
  function hook(){
    const btn = document.getElementById('assets-trigger') || document.querySelector('.assets-trigger');
    if(!btn) return;
    // avoid double-binding
    if(btn.__cabinetHooked) return;
    btn.__cabinetHooked = true;

    btn.addEventListener('click', function(e){
      try{ e.preventDefault(); }catch(_){}
      try{ e.stopPropagation(); }catch(_){}
      // close dropdown menu if it's open
      try{
        const dd = btn.closest('.assets-dropdown');
        if(dd) dd.classList.remove('open');
      }catch(_){}

      if(typeof openCabinetPage === "function"){
        openCabinetPage();
        // default tab
        if(typeof openCabinetTab === "function") openCabinetTab('overview');
        return;
      }
      // fallback: jump to cabinet section
      const cab = document.getElementById('cabinet-page');
      if(cab){
        document.querySelectorAll('section.page').forEach(p=>p.style.display='none');
        cab.style.display='block';
        window.scrollTo(0,0);
      }
    }, {passive:false});
  }
  if(document.readyState === "loading") document.addEventListener("DOMContentLoaded", hook);
  else hook();
})();
</script>


<script>
/* ===== ArsteX Spot: unifie<script>
/* ===== Spot Trading Logic (rewritten) =====
   Single source of truth for trading balance:
   - Spot account USDT balance is stored in localStorage[demo_balances_v1].spot
   - Trading Available uses Spot account balance (and updates it after trades)
   - BTC/ETH/etc holdings are tracked in localStorage[spot_wallet_v1] for selling
   - Open Orders / Order History / Trade History are persisted
*/
(function(){
  if (window.__SpotTradingRewrittenV1) return;
  window.__SpotTradingRewrittenV1 = true;

  const BAL_KEY   = "demo_balances_v1";
  const WAL_KEY   = "spot_wallet_v1";
  const LS_OPEN   = "spot_orders";          // open orders
  const LS_TRADES = "spot_trades";          // fills (market + limit fills)
  const LS_HIST   = "spot_order_history";   // order history (filled/cancelled)

  // ---------- helpers ----------
  const $$ = (sel, root=document)=>Array.from(root.querySelectorAll(sel));
  const num = (v)=>{ const x = Number(String(v??"").replace(",", ".")); return Number.isFinite(x)?x:0; };
  const fmt2 = (x)=> (Math.round((+x||0)*100)/100).toFixed(2);
  const fmt8 = (x)=> {
    const n = (+x||0);
    // keep up to 8 decimals, trim trailing zeros
    return (Math.round(n*1e8)/1e8).toFixed(8).replace(/\.?0+$/,'');
  };
  const nowId = ()=> String(Date.now()) + "-" + Math.random().toString(16).slice(2,8);

  function readJSON(key, fallback){
    try{
      const v = JSON.parse(localStorage.getItem(key) || "null");
      return (v===null || v===undefined) ? fallback : v;
    }catch(e){ return fallback; }
  }
  function writeJSON(key, val){
    try{ localStorage.setItem(key, JSON.stringify(val)); }catch(e){}
  }

  function baseQuote(pair){
    const p = String(pair||"BTC/USDT").trim();
    const parts = p.split("/");
    return { base: (parts[0]||"BTC").trim().toUpperCase(), quote: (parts[1]||"USDT").trim().toUpperCase() };
  }

  function getCurrentPair(){
    const v = (typeof window.SPOT_SELECTED === "string" && window.SPOT_SELECTED.trim()) ? window.SPOT_SELECTED.trim() : "";
    if(v) return v;
    const el = document.getElementById("spot-pair-symbol");
    const t = el ? (el.textContent||"").trim() : "";
    return t || "BTC/USDT";
  }

  function readLastPrice(){
    // try several common places
    const cand = [
      document.getElementById("spot-last-price"),
      document.getElementById("lastPrice"),
      document.querySelector("[data-last-price]"),
      document.querySelector(".spot-last-price"),
      document.querySelector(".pair-last-price"),
    ].filter(Boolean)[0];

    if(cand){
      const raw = (cand.getAttribute("data-last-price") || cand.textContent || "").replace(/[^\d.,-]/g,"").trim();
      const p = num(raw);
      return p>0 ? p : 0;
    }
    // fallback: keep last price in storage if some other script writes it
    const p = num(readJSON("spot_last_price", 0));
    return p>0 ? p : 0;
  }

  // ---------- balances (USDT) ----------
  function readBalances(){
    const b = readJSON(BAL_KEY, null) || {};
    // ensure keys exist
    const out = { spot: num(b.spot), forex: num(b.forex), stocks: num(b.stocks) };
    // persist normalization (prevents NaN strings)
    writeJSON(BAL_KEY, out);
    return out;
  }
  function writeSpotUSDT(usdt){
    const b = readBalances();
    b.spot = Math.max(0, num(usdt));
    writeJSON(BAL_KEY, b);
    if (typeof window.renderB === "function") window.renderB();
  }

  // ---------- spot wallet (assets for selling) ----------
  function readWallet(){
    const b = readBalances();
    const w = readJSON(WAL_KEY, null) || {};
    // USDT in wallet mirrors spot balance
    const out = { ...w, USDT: num(b.spot) };
    // normalize numeric fields
    Object.keys(out).forEach(k=> out[k] = num(out[k]));
    writeJSON(WAL_KEY, out);
    return out;
  }
  function writeWallet(next){
    const w = { ...(next||{}) };
    Object.keys(w).forEach(k=> w[k] = num(w[k]));
    // keep USDT mirrored
    writeSpotUSDT(w.USDT);
    writeJSON(WAL_KEY, w);
  }

  // ---------- orders / trades ----------
  function openOrders(){ return Array.isArray(readJSON(LS_OPEN, [])) ? readJSON(LS_OPEN, []) : []; }
  function setOpenOrders(arr){ writeJSON(LS_OPEN, Array.isArray(arr)?arr:[]); }

  function trades(){ return Array.isArray(readJSON(LS_TRADES, [])) ? readJSON(LS_TRADES, []) : []; }
  function setTrades(arr){ writeJSON(LS_TRADES, Array.isArray(arr)?arr:[]); }

  function hist(){ return Array.isArray(readJSON(LS_HIST, [])) ? readJSON(LS_HIST, []) : []; }
  function setHist(arr){ writeJSON(LS_HIST, Array.isArray(arr)?arr:[]); }

  // ---------- UI state ----------
  function side(){
    const btn = document.querySelector(".bs-btn.active");
    return (btn?.dataset?.side || "buy").toLowerCase();
  }
  function otype(){
    const btn = document.querySelector(".type-btn.active");
    return (btn?.dataset?.otype || "limit").toLowerCase();
  }

  // Reserved (so user can't place multiple limit orders exceeding balance)
  function reservedQuoteUSDT(pair){
    const { quote } = baseQuote(pair);
    if(quote !== "USDT") return 0; // demo is USDT-quoted pairs
    return openOrders()
      .filter(o=> (o.pair||"")===pair && String(o.side||"buy").toLowerCase()==="buy" && String(o.type||"limit").toLowerCase()==="limit")
      .reduce((s,o)=>{
        const price = num(o.price);
        const amt = num(o.amount);
        const filled = num(o.filled);
        const remaining = Math.max(0, amt - filled);
        return s + price*remaining;
      },0);
  }
  function reservedBase(pair){
    const { base } = baseQuote(pair);
    return openOrders()
      .filter(o=> (o.pair||"")===pair && String(o.side||"sell").toLowerCase()==="sell" && String(o.type||"limit").toLowerCase()==="limit")
      .reduce((s,o)=>{
        const amt = num(o.amount);
        const filled = num(o.filled);
        const remaining = Math.max(0, amt - filled);
        return s + remaining;
      },0);
  }

  function availableFor(s){
    const pair = getCurrentPair();
    const { base, quote } = baseQuote(pair);
    const w = readWallet();

    if(s==="sell"){
      const baseFree = Math.max(0, num(w[base]) - reservedBase(pair));
      return baseFree;
    }

    // buy
    const usdtFree = Math.max(0, num(w[quote] ?? w.USDT) - reservedQuoteUSDT(pair));
    return usdtFree;
  }

  function updateAvailableUI(){
    const pair = getCurrentPair();
    const { base, quote } = baseQuote(pair);

    const s = side();
    const avail = availableFor(s);

    const valEl = document.querySelector('.trade-available-val .account-balance-pill span[data-acct="spot"]');
    const unitEl = document.querySelector('.trade-available-val .account-balance-pill .unit');
    if(valEl) valEl.textContent = (s==="sell") ? fmt8(avail) : fmt2(avail);
    if(unitEl) unitEl.textContent = (s==="sell") ? base : quote;

    // also keep the trade submit button label in sync
    const submit = document.getElementById("tradeSubmit");
    if(submit) submit.textContent = (s==="sell") ? `Sell ${base}` : `Buy ${base}`;
  }

  // ---------- rendering (orders / history) ----------
  function formatDate(ts){
    try{
      const d = new Date(Number(ts)||Date.now());
      const p = (n)=>String(n).padStart(2,"0");
      return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}`;
    }catch(e){ return ""; }
  }

  function renderOpenOrders(){
    const panel = document.querySelector('.orders-panel[data-panel="open"]');
    if(!panel) return;

    const pair = getCurrentPair();
    const orders = openOrders().filter(o => (o.pair||"") === pair);

    // tab count
    const tabBtn = $$(".orders-tab").find(b => (b.textContent||"").toLowerCase().includes("open orders"));
    if(tabBtn) tabBtn.textContent = `Open Orders (${orders.length})`;

    panel.querySelectorAll(".order-row").forEach(r => r.remove());
    const empty = panel.querySelector(".orders-empty");
    if(!orders.length){
      if(empty) empty.style.display = "grid";
      return;
    }
    if(empty) empty.style.display = "none";

    const head = panel.querySelector(".orders-head");
    orders.forEach(o=>{
      const row = document.createElement("div");
      row.className = "order-row";
      row.innerHTML = `
        <div>${o.pair||""}</div>
        <div>${formatDate(o.ts)}</div>
        <div>${(o.type||"limit").toUpperCase()}</div>
        <div class="${(o.side||"buy").toLowerCase()}">${(o.side||"buy").toUpperCase()}</div>
        <div>${fmt2(o.price)}</div>
        <div>${fmt8(o.amount)}</div>
        <div>${fmt8(o.filled||0)}</div>
        <div>—</div>
        <div class="right"><button class="order-cancel" data-cancel-id="${o.id}">Cancel</button></div>
      `;
      head?.insertAdjacentElement("afterend", row);
    });

    // cancel handlers
    panel.querySelectorAll(".order-cancel").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.getAttribute("data-cancel-id");
        cancelOrder(id);
      });
    });
  }

  function renderOrderHistory(){
    const panel = document.querySelector('.orders-panel[data-panel="ordersHistory"]');
    if(!panel) return;
    const pair = getCurrentPair();
    const list = hist().filter(o => (o.pair||"") === pair);

    panel.querySelectorAll(".order-row").forEach(r => r.remove());
    const empty = panel.querySelector(".orders-empty");
    if(!list.length){
      if(empty) empty.style.display = "grid";
      return;
    }
    if(empty) empty.style.display = "none";

    const head = panel.querySelector(".orders-head");
    list.forEach(o=>{
      const row = document.createElement("div");
      row.className = "order-row";
      const status = (o.status||"filled").toUpperCase();
      row.innerHTML = `
        <div>${o.pair||""}</div>
        <div>${formatDate(o.ts)}</div>
        <div>${(o.type||"limit").toUpperCase()}</div>
        <div class="${(o.side||"buy").toLowerCase()}">${(o.side||"buy").toUpperCase()}</div>
        <div>${fmt2(o.price||0)}</div>
        <div>${fmt8(o.amount||0)}</div>
        <div>${fmt8(o.filled||0)}</div>
        <div>${status}</div>
        <div class="right">—</div>
      `;
      head?.insertAdjacentElement("afterend", row);
    });
  }

  function renderTradeHistory(){
    const panel = document.querySelector('.orders-panel[data-panel="tradeHistory"]');
    if(!panel) return;

    const pair = getCurrentPair();
    const list = trades().filter(t => (t.pair||"") === pair);

    // optional filters (if present)
    const thStart = panel.querySelector('input[name="thStart"], #thStart');
    const thEnd   = panel.querySelector('input[name="thEnd"], #thEnd');

    let start = -Infinity, end = Infinity;
    if(thStart?.value){
      const s = Date.parse(thStart.value);
      if(Number.isFinite(s)) start = s;
    }
    if(thEnd?.value){
      const e = Date.parse(thEnd.value);
      if(Number.isFinite(e)) end = e + 24*60*60*1000 - 1;
    }

    const filtered = list.filter(t=>{
      const ts = Number(t.ts)||0;
      return ts>=start && ts<=end;
    });

    panel.querySelectorAll(".trade-row").forEach(r => r.remove());
    const empty = panel.querySelector(".orders-empty");
    if(!filtered.length){
      if(empty) empty.style.display = "grid";
      return;
    }
    if(empty) empty.style.display = "none";

    const head = panel.querySelector(".trade-head") || panel.querySelector(".orders-head");
    filtered.forEach(t=>{
      const row = document.createElement("div");
      row.className = "trade-row";
      row.innerHTML = `
        <div>${t.pair||""}</div>
        <div>${formatDate(t.ts)}</div>
        <div class="${(t.side||"buy").toLowerCase()}">${(t.side||"buy").toUpperCase()}</div>
        <div>${fmt2(t.price||0)}</div>
        <div>${fmt8(t.amount||0)}</div>
        <div>${fmt2(t.total||0)}</div>
        <div>${(t.role||"taker").toUpperCase()}</div>
      `;
      head?.insertAdjacentElement("afterend", row);
    });
  }

  function renderAll(){
    renderOpenOrders();
    renderOrderHistory();
    renderTradeHistory();
    updateAvailableUI();
  }

  // ---------- order actions ----------
  function pushTrade({pair, side, price, amount, total, role="taker", fee=0}){
    const tr = trades();
    tr.unshift({ id: nowId(), pair, side, price: Number(price), amount: Number(amount), total: Number(total), ts: Date.now(), role, fee });
    setTrades(tr);
  }

  function pushHistory(order, status){
    const h = hist();
    h.unshift({ ...order, status, ts: Date.now() });
    setHist(h);
  }

  function cancelOrder(id){
    const all = openOrders();
    const idx = all.findIndex(o => o.id === id);
    if(idx<0) return;

    const o = all[idx];
    all.splice(idx,1);
    setOpenOrders(all);

    pushHistory(o, "cancelled");

    renderAll();
  }

  // Limit auto-fill when price crosses (simple, per current pair)
  function tryFillLimits(){
    const last = readLastPrice();
    if(!(last>0)) return;

    const pair = getCurrentPair();
    const { base, quote } = baseQuote(pair);

    const all = openOrders();
    if(!all.length) return;

    const keep=[];
    let changed=false;

    let w = readWallet();

    for(const o of all){
      if((o.pair||"") !== pair){ keep.push(o); continue; }
      if(String(o.type||"limit").toLowerCase()!=="limit"){ keep.push(o); continue; }

      const s = String(o.side||"buy").toLowerCase();
      const p = num(o.price);
      const a = num(o.amount);
      const filled = num(o.filled);
      const remaining = Math.max(0, a - filled);

      const canFill = remaining>0 && ((s==="buy" && last <= p) || (s==="sell" && last >= p));
      if(!canFill){ keep.push(o); continue; }

      const execAmt = remaining;
      const cost = p * execAmt;

      if(s==="buy"){
        const availUSDT = Math.max(0, num(w[quote] ?? w.USDT));
        if(cost > availUSDT + 1e-9){ keep.push(o); continue; } // not enough, skip
        w[quote] = availUSDT - cost;
        w[base]  = num(w[base]) + execAmt;
      }else{
        const availBase = Math.max(0, num(w[base]));
        if(execAmt > availBase + 1e-12){ keep.push(o); continue; }
        w[base]  = availBase - execAmt;
        w[quote] = num(w[quote] ?? w.USDT) + cost;
      }

      // record
      pushTrade({pair, side:s, price:p, amount:execAmt, total:cost, role:"maker", fee:0});
      pushHistory({ ...o, filled: a }, "filled");

      changed=true;
    }

    if(changed){
      writeWallet(w);
      setOpenOrders(keep);
      renderAll();
    }
  }

  // ---------- trade form wiring ----------
  function hookTradeForm(){
    const priceInput  = document.getElementById("tradePrice");
    const amountInput = document.getElementById("tradeAmount");
    const totalInput  = document.getElementById("tradeTotal");
    const lastBtn     = document.getElementById("lastPriceBtn");
    const slider      = document.getElementById("tradePct");
    const submitBtn   = document.getElementById("tradeSubmit");
    const card        = document.getElementById("tradeCard") || document.querySelector(".trade-panel");

    if(!amountInput || !totalInput || !submitBtn) return;

    // sync Total<->Amount for limit (and generally)
    let lock=false;
    const syncFromAmount = ()=>{
      if(lock) return;
      lock=true;
      const p=num(priceInput?.value); const a=num(amountInput.value);
      totalInput.value = (p>0 && a>0) ? (p*a).toFixed(2) : "";
      lock=false;
    };
    const syncFromTotal = ()=>{
      if(lock) return;
      lock=true;
      const p=num(priceInput?.value); const t=num(totalInput.value);
      amountInput.value = (p>0 && t>0) ? (t/p).toFixed(8) : "";
      lock=false;
    };

    amountInput.addEventListener("input", ()=>{ if(otype()==="limit") syncFromAmount(); });
    totalInput.addEventListener("input", ()=>{ if(otype()==="limit") syncFromTotal(); });

    // last price button
    if(lastBtn && priceInput){
      lastBtn.addEventListener("click", ()=>{
        const p = readLastPrice();
        if(!(p>0)) return;
        priceInput.value = p.toFixed(2);
        if(otype()==="limit"){
          const a=num(amountInput.value); const t=num(totalInput.value);
          if(a>0) syncFromAmount();
          else if(t>0) syncFromTotal();
        }
      });
    }

    // Market UI toggle: disable price input
    function applyMarketUI(){
      const isMarket = (otype()==="market");
      if(priceInput){
        priceInput.disabled = isMarket;
        priceInput.style.opacity = isMarket ? "0.6" : "";
      }
      // recompute button label + available
      updateAvailableUI();
    }

    // click toggles
    $$(".type-btn").forEach(b=> b.addEventListener("click", ()=>{
      $$(".type-btn").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      applyMarketUI();
    }));

    $$(".bs-btn").forEach(b=> b.addEventListener("click", ()=>{
      $$(".bs-btn").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      updateAvailableUI();
      if(slider) slider.value="0";
    }));

    // slider percent (uses Available depending on side)
    function applyPct(){
      const pct = num(slider?.value);
      const s = side();
      const pair = getCurrentPair();
      const { base } = baseQuote(pair);
      const p = (otype()==="market") ? readLastPrice() : num(priceInput?.value);
      const avail = availableFor(s);
      if(!(pct>0)) return;

      if(s==="buy"){
        if(!(p>0)) return;
        const useUSDT = avail * (pct/100);
        const a = useUSDT / p;
        amountInput.value = a.toFixed(8);
        if(otype()==="limit") syncFromAmount();
        else totalInput.value = useUSDT.toFixed(2);
      }else{
        const a = avail * (pct/100);
        amountInput.value = a.toFixed(8);
        if(otype()==="limit") syncFromAmount();
        else{
          if(p>0) totalInput.value = (a*p).toFixed(2);
        }
      }
    }
    if(slider){
      slider.addEventListener("input", ()=>{ applyPct(); });
    }

    // submit
    submitBtn.addEventListener("click", (e)=>{
      e.preventDefault();

      const pair = getCurrentPair();
      const { base, quote } = baseQuote(pair);

      const s = side();
      const t = otype();

      const execPrice = (t==="market") ? readLastPrice() : num(priceInput?.value);
      if(!(execPrice>0)) return alert("Fill price");

      const amt = num(amountInput.value);
      if(!(amt>0)) return alert("Fill amount");

      const avail = availableFor(s);
      const cost = execPrice * amt;

      if(s==="buy" && cost > avail + 1e-9) return alert("Not enough " + quote);
      if(s==="sell" && amt  > avail + 1e-12) return alert("Not enough " + base);

      // LIMIT => store open order (reserved via availableFor)
      if(t==="limit"){
        const all = openOrders();
        all.push({
          id: nowId(),
          pair,
          side: s,
          type: "limit",
          price: Number(execPrice),
          amount: Number(amt),
          filled: 0,
          ts: Date.now()
        });
        setOpenOrders(all);

        renderAll();
        return;
      }

      // MARKET instant fill
      const w = readWallet();
      if(s==="buy"){
        w[quote] = Math.max(0, num(w[quote] ?? w.USDT) - cost);
        w[base]  = num(w[base]) + amt;
      }else{
        w[base]  = Math.max(0, num(w[base]) - amt);
        w[quote] = num(w[quote] ?? w.USDT) + cost;
      }
      writeWallet(w);

      pushTrade({pair, side:s, price:execPrice, amount:amt, total:cost, role:"taker", fee:0});
      pushHistory({ id: nowId(), pair, side:s, type:"market", price:execPrice, amount:amt, filled:amt }, "filled");

      // reset pct
      if(slider) slider.value="0";

      renderAll();
    });

    applyMarketUI();
  }

  // ---------- boot ----------
  function hookOrdersTabs(){
    $$(".orders-tab").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        $$(".orders-tab").forEach(x=>x.classList.remove("active"));
        btn.classList.add("active");

        const tab = btn.getAttribute("data-tab");
        $$('.orders-panel').forEach(p=>p.classList.remove("is-active"));
        const panel = document.querySelector(`.orders-panel[data-panel="${tab}"]`);
        if(panel) panel.classList.add("is-active");

        renderAll();
      });
    });
  }

  function boot(){
    // ensure balances exist
    readWallet(); // also normalizes BAL_KEY.spot
    hookTradeForm();
    hookOrdersTabs();
    renderAll();

    // re-render periodically to attempt limit fills
    setInterval(()=>{ tryFillLimits(); }, 1000);

    // if pair changes somewhere else in the UI
    document.addEventListener("spot:pairChanged", ()=>{ renderAll(); });
    document.addEventListener("spot:lastPrice", (e)=>{
      const p = num(e?.detail?.price);
      if(p>0) writeJSON("spot_last_price", p);
      tryFillLimits();
    });
  }

  if(document.readyState === "loading") document.addEventListener("DOMContentLoaded", boot);
  else boot();

})();
</script>  

<script>
  const BAL_KEY = "demo_balances_v1";
const ACCOUNTS = ["spot","forex","stocks"];

function loadB(){
  try{ const b = JSON.parse(localStorage.getItem(BAL_KEY)||""); if(b) return b; }catch(e){}
  const init = {spot:0, forex:0, stocks:0};
  localStorage.setItem(BAL_KEY, JSON.stringify(init));
  return init;
}
function saveB(b){ localStorage.setItem(BAL_KEY, JSON.stringify(b)); }
function fmt2(x){ return (Math.round((+x||0)*100)/100).toFixed(2); }
function total(b){ return ACCOUNTS.reduce((s,a)=>s+(+b[a]||0),0); }

function renderB(){
  const b = loadB(); // {spot, forex, stocks}
  const ov = (b.spot||0) + (b.forex||0) + (b.stocks||0);

  // USDT
  document.querySelectorAll(".fund-amt[data-acct]").forEach(el=>{
    const acct = el.dataset.acct;
    if(acct === "overview") el.textContent = fmt2(ov);
    else el.textContent = fmt2(b[acct] || 0);
  });

  // ≈ USD (для демо считаем 1 USDT = 1 USD)
  document.querySelectorAll(".fund-usd-amt[data-usd-for]").forEach(el=>{
    const a = el.dataset.usdFor;
    const v = (a === "overview") ? ov : (b[a] || 0);
    el.textContent = fmt2(v);
  });
}

function openTx(from){
  const m = document.getElementById("tx-modal");
  m.classList.add("open");
  m.setAttribute("aria-hidden","false");
  document.getElementById("tx-error").textContent = "";
  document.getElementById("tx-amt").value = "";
  if(from) document.getElementById("tx-from").value = from;
  updateAvail();
}
function closeTx(){
  const m = document.getElementById("tx-modal");
  m.classList.remove("open");
  m.setAttribute("aria-hidden","true");
}

function updateAvail(){
  const b = loadB();
  const from = document.getElementById("tx-from").value;
  document.getElementById("tx-avail").textContent = fmt2(b[from]||0);
}

function doTx(){
  const from = document.getElementById("tx-from").value;
  const to   = document.getElementById("tx-to").value;
  const amt  = Number(String(document.getElementById("tx-amt").value).replace(",", "."));
  const err  = document.getElementById("tx-error");

  if(from===to){ err.textContent="Choose different accounts."; return; }
  if(!Number.isFinite(amt) || amt<=0){ err.textContent="Enter a valid amount."; return; }

  const b = loadB();
  if((b[from]||0) + 1e-9 < amt){ err.textContent="Insufficient balance."; return; }

  b[from] = (b[from]||0) - amt;
  b[to]   = (b[to]||0) + amt;

  saveB(b);
  renderB();
  closeTx();
}

document.addEventListener("DOMContentLoaded", ()=>{
  renderB();

  // Открытие — ТОЛЬКО по data-transfer-open
  document.querySelectorAll("[data-transfer-open]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      openTx(btn.getAttribute("data-from") || "spot");
    });
  });

  // Закрытие
  document.getElementById("tx-close").addEventListener("click", closeTx);
  document.getElementById("tx-cancel").addEventListener("click", closeTx);

  // Клик по фону — закрыть
  document.getElementById("tx-modal").addEventListener("click", (e)=>{
    if(e.target && e.target.id === "tx-modal") closeTx();
  });

  // Обновление available при смене From
  document.getElementById("tx-from").addEventListener("change", updateAvail);

  // Max
  document.getElementById("tx-max").addEventListener("click", ()=>{
    const b = loadB();
    const from = document.getElementById("tx-from").value;
    document.getElementById("tx-amt").value = fmt2(b[from]||0);
  });

  // Transfer
  document.getElementById("tx-send").addEventListener("click", doTx);
});


</script>

<script>
  function clickLeftMenu(labelText){
  // ищем в левом меню элемент с таким текстом и кликаем
  const items = Array.from(document.querySelectorAll("a, button, div"))
    .filter(el => (el.textContent || "").trim() === labelText);

  // предпочтительно кликаем тот, что в сайдбаре (обычно ближе к nav)
  const target = items.find(el => el.closest("nav") || el.closest(".sidebar") || el.closest(".menu")) || items[0];
  if (target) target.click();
}

document.addEventListener("click", (e) => {
  const a = e.target.closest(".assets-item[data-nav]");
  if(!a) return;
  e.preventDefault();

  const v = a.dataset.nav;
  if(v === "spot")   clickLeftMenu("Spot Account");
  if(v === "forex")  clickLeftMenu("Forex Account");
  if(v === "stocks") clickLeftMenu("Stocks Account");
  if(v === "records")clickLeftMenu("Asset Records");
});

</script>

<script>
  async function openAdminSafely(){
  const r = await fetch("/api/admin/ping");
  if (r.ok) {
    openAdminPage();
  } else {
    alert("Нет доступа");
  }
}

</script>

<script>
  document.addEventListener("click", (e) => {
  const back = e.target.closest("#admin-nav-back");
  if (back) {
    location.hash = "cabinet";
    return;
  }

  const adminBtn = e.target.closest("#admin-nav-admin");
  if (adminBtn) {
    location.hash = "cabinet/#admin";
    return;
  }
});

</script>

<div id="tx-modal" class="tx-modal-backdrop" aria-hidden="true">
  <div class="tx-modal" role="dialog" aria-modal="true">
    <div class="tx-modal-head">
      <div class="tx-modal-title">Transfer</div>
      <button id="tx-close" class="tx-modal-x" type="button">×</button>
    </div>

    <div class="tx-grid">
      <div class="tx-field">
        <label>From</label>
        <select id="tx-from">
          <option value="spot">Spot</option>
          <option value="forex">Forex</option>
          <option value="stocks">Stocks</option>
        </select>
      </div>

      <div class="tx-field">
        <label>To</label>
        <select id="tx-to">
          <option value="spot">Spot</option>
          <option value="forex">Forex</option>
          <option value="stocks">Stocks</option>
        </select>
      </div>
    </div>

    <div class="tx-field">
      <label>Amount (USDT)</label>
      <input id="tx-amt" inputmode="decimal" placeholder="0.00" />
    </div>

    <div class="tx-row">
      <div>Available: <span id="tx-avail">0.00</span> USDT</div>
      <button id="tx-max" class="tx-btn" type="button">Max</button>
    </div>

    <div id="tx-error" class="tx-error"></div>

    <div class="tx-actions">
      <button id="tx-cancel" class="tx-btn" type="button">Cancel</button>
      <button id="tx-send" class="tx-btn primary" type="button">Transfer</button>
    </div>
  </div>
</div>

<script>
let tvWidget = null;

function showChart(pair, tf){
  document.getElementById("tv-chart").innerHTML = "";

  const symbol = "BINANCE:" + pair.replace("/", "");

  const tfMap = {
    "1m":"1",
    "5m":"5",
    "15m":"15",
    "1h":"60",
    "4h":"240",
    "1d":"D"
  };

  tvWidget = new TradingView.widget({
    container_id: "tv-chart",
    symbol: symbol,
    interval: tfMap[tf],
    autosize: true,
    theme: "dark"
  });
}
</script>

<script src="https://s3.tradingview.com/tv.js"></script>

<script>
(function(){
  function setSpotPanel(panel){
    var spotPage = document.getElementById('spot-page');
    if(!spotPage) return;
    spotPage.setAttribute('data-spot-panel', panel);

    var tabs = spotPage.querySelectorAll('.spot-mtab');
    tabs.forEach(function(t){
      t.classList.toggle('is-active', t.getAttribute('data-panel') === panel);
    });
  }

  function initSpotMobileTabs(){
    var spotPage = document.getElementById('spot-page');
    if(!spotPage || spotPage.__spotTabsInited) return;
    spotPage.__spotTabsInited = true;

    // default panel
    if(!spotPage.getAttribute('data-spot-panel')){
      setSpotPanel('chart');
    }

    var tabsWrap = document.getElementById('spot-mobile-tabs');
    if(!tabsWrap) return;

    tabsWrap.addEventListener('click', function(e){
      var btn = e.target && e.target.closest ? e.target.closest('.spot-mtab') : null;
      if(!btn) return;
      e.preventDefault();
      setSpotPanel(btn.getAttribute('data-panel') || 'chart');

      // If chart is selected, ensure it fits (TradingView needs resize sometimes)
      try{
        if (btn.getAttribute('data-panel') === 'chart'){
          if(window.AX_CHART && typeof window.AX_CHART.resize === 'function') window.AX_CHART.resize();
        }
      }catch(_){}
    }, false);
  }

  document.addEventListener('DOMContentLoaded', initSpotMobileTabs);
  // In case the page is shown later via SPA navigation:
  window.initSpotMobileTabs = initSpotMobileTabs;
})();
</script>

</body>
</html>
